import{a as He,Q as Ra}from"./QCard.dc95d8be.js";import{u as gi}from"./use-quasar.08caf103.js";import{A as De,B as D,C as oe,D as Q,M as se,N as Se,ah as Or,d as $,as as rn,E as ne,J as dt,F as ht,P as Ve,_ as Xe,I as kt,O as ce,r as B,ad as yi,a7 as Yi,n as Oa,a5 as Ji,w as qe,k as mi,o as pt,j as xt,aa as Tl,T as Vn,at as Pr,z as jl,an as Cl,h as te,au as Nl,av as Ml,aw as $l,a as x,a0 as Pa,a1 as ql,Y as bi,c as ir,a9 as xl,e as wi,ae as Yt,ax as Ta,Z as ja,G as Y,u as at,m as Jt,ay as Si,az as Dl,aA as Il,p as Ll,aB as Fl,am as Bl,ap as zl,s as Ul,H as mr,aj as Wl,ak as Hl,aC as Gl,aD as Vl,a3 as Kl,Q as Xi}from"./index.3927d6fc.js";import{b as Ur,a as Xt,Q as Ca}from"./QList.ecf95ed3.js";import{i as Ql,g as Yl,u as Na,a as Ma,b as $a,c as qa,j as Jl,e as br,Q as Zi,h as Xl,s as eo,k as bn,T as to,d as Zl,f as eu}from"./QScrollObserver.a9429a1c.js";import{u as ki,a as _i}from"./use-dark.5f2f196d.js";import{b as ro,c as tu,a as xa}from"./focus-manager.202af5b7.js";import{_ as jt,Q as no}from"./chess-piece.20d5a6d0.js";import{Q as Kn}from"./QSeparator.27b33062.js";import{u as ru}from"./notify.2dbd5b7f.js";import{a4 as nu}from"./exports.561b04df.js";var Qe=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};const iu={class:"col-sm col-xs-12"},ou={class:"col-xl-2 col-lg-3 col-sm-5 col-xs-12"},Cg=De({__name:"game-layout",setup(e){const t=gi();return(r,n)=>(D(),oe(He,{horizontal:se(t).screen.gt.sm,class:"q-gutter-md q-pa-none col row"},{default:Q(()=>[Se("div",iu,[Or(r.$slots,"board")]),Se("div",ou,[Or(r.$slots,"sidebar")]),Or(r.$slots,"default")]),_:3},8,["horizontal"]))}});var or={exports:{}},Ei={},Ce={},Da={},Ai=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[r]=i;for(r in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,r);if(a.value!==i||a.enumerable!==!0)return!1}return!0},au=Ai,Ri=function(){return au()&&!!Symbol.toStringTag},io=typeof Symbol!="undefined"&&Symbol,su=Ai,lu=function(){return typeof io!="function"||typeof Symbol!="function"||typeof io("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:su()},oo={foo:{}},uu=Object,cu=function(){return{__proto__:oo}.foo===oo.foo&&!({__proto__:null}instanceof uu)},fu="Function.prototype.bind called on incompatible ",wn=Array.prototype.slice,du=Object.prototype.toString,hu="[object Function]",pu=function(t){var r=this;if(typeof r!="function"||du.call(r)!==hu)throw new TypeError(fu+r);for(var n=wn.call(arguments,1),i,o=function(){if(this instanceof i){var c=r.apply(this,n.concat(wn.call(arguments)));return Object(c)===c?c:this}else return r.apply(t,n.concat(wn.call(arguments)))},a=Math.max(0,r.length-n.length),s=[],l=0;l<a;l++)s.push("$"+l);if(i=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")(o),r.prototype){var u=function(){};u.prototype=r.prototype,i.prototype=new u,u.prototype=null}return i},vu=pu,Oi=Function.prototype.bind||vu,gu=Oi,yu=gu.call(Function.call,Object.prototype.hasOwnProperty),W,Ct=SyntaxError,Ia=Function,_t=TypeError,Sn=function(e){try{return Ia('"use strict"; return ('+e+").constructor;")()}catch{}},st=Object.getOwnPropertyDescriptor;if(st)try{st({},"")}catch{st=null}var kn=function(){throw new _t},mu=st?function(){try{return arguments.callee,kn}catch{try{return st(arguments,"callee").get}catch{return kn}}}():kn,yt=lu(),bu=cu(),fe=Object.getPrototypeOf||(bu?function(e){return e.__proto__}:null),wt={},wu=typeof Uint8Array=="undefined"||!fe?W:fe(Uint8Array),lt={"%AggregateError%":typeof AggregateError=="undefined"?W:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer=="undefined"?W:ArrayBuffer,"%ArrayIteratorPrototype%":yt&&fe?fe([][Symbol.iterator]()):W,"%AsyncFromSyncIteratorPrototype%":W,"%AsyncFunction%":wt,"%AsyncGenerator%":wt,"%AsyncGeneratorFunction%":wt,"%AsyncIteratorPrototype%":wt,"%Atomics%":typeof Atomics=="undefined"?W:Atomics,"%BigInt%":typeof BigInt=="undefined"?W:BigInt,"%BigInt64Array%":typeof BigInt64Array=="undefined"?W:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array=="undefined"?W:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView=="undefined"?W:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array=="undefined"?W:Float32Array,"%Float64Array%":typeof Float64Array=="undefined"?W:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry=="undefined"?W:FinalizationRegistry,"%Function%":Ia,"%GeneratorFunction%":wt,"%Int8Array%":typeof Int8Array=="undefined"?W:Int8Array,"%Int16Array%":typeof Int16Array=="undefined"?W:Int16Array,"%Int32Array%":typeof Int32Array=="undefined"?W:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":yt&&fe?fe(fe([][Symbol.iterator]())):W,"%JSON%":typeof JSON=="object"?JSON:W,"%Map%":typeof Map=="undefined"?W:Map,"%MapIteratorPrototype%":typeof Map=="undefined"||!yt||!fe?W:fe(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise=="undefined"?W:Promise,"%Proxy%":typeof Proxy=="undefined"?W:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect=="undefined"?W:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set=="undefined"?W:Set,"%SetIteratorPrototype%":typeof Set=="undefined"||!yt||!fe?W:fe(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer=="undefined"?W:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":yt&&fe?fe(""[Symbol.iterator]()):W,"%Symbol%":yt?Symbol:W,"%SyntaxError%":Ct,"%ThrowTypeError%":mu,"%TypedArray%":wu,"%TypeError%":_t,"%Uint8Array%":typeof Uint8Array=="undefined"?W:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray=="undefined"?W:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array=="undefined"?W:Uint16Array,"%Uint32Array%":typeof Uint32Array=="undefined"?W:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap=="undefined"?W:WeakMap,"%WeakRef%":typeof WeakRef=="undefined"?W:WeakRef,"%WeakSet%":typeof WeakSet=="undefined"?W:WeakSet};if(fe)try{null.error}catch(e){var Su=fe(fe(e));lt["%Error.prototype%"]=Su}var ku=function e(t){var r;if(t==="%AsyncFunction%")r=Sn("async function () {}");else if(t==="%GeneratorFunction%")r=Sn("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=Sn("async function* () {}");else if(t==="%AsyncGenerator%"){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var i=e("%AsyncGenerator%");i&&fe&&(r=fe(i.prototype))}return lt[t]=r,r},ao={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ar=Oi,Wr=yu,_u=ar.call(Function.call,Array.prototype.concat),Eu=ar.call(Function.apply,Array.prototype.splice),so=ar.call(Function.call,String.prototype.replace),Hr=ar.call(Function.call,String.prototype.slice),Au=ar.call(Function.call,RegExp.prototype.exec),Ru=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ou=/\\(\\)?/g,Pu=function(t){var r=Hr(t,0,1),n=Hr(t,-1);if(r==="%"&&n!=="%")throw new Ct("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new Ct("invalid intrinsic syntax, expected opening `%`");var i=[];return so(t,Ru,function(o,a,s,l){i[i.length]=s?so(l,Ou,"$1"):a||o}),i},Tu=function(t,r){var n=t,i;if(Wr(ao,n)&&(i=ao[n],n="%"+i[0]+"%"),Wr(lt,n)){var o=lt[n];if(o===wt&&(o=ku(n)),typeof o=="undefined"&&!r)throw new _t("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:o}}throw new Ct("intrinsic "+t+" does not exist!")},sr=function(t,r){if(typeof t!="string"||t.length===0)throw new _t("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new _t('"allowMissing" argument must be a boolean');if(Au(/^%?[^%]*%?$/,t)===null)throw new Ct("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=Pu(t),i=n.length>0?n[0]:"",o=Tu("%"+i+"%",r),a=o.name,s=o.value,l=!1,u=o.alias;u&&(i=u[0],Eu(n,_u([0,1],u)));for(var c=1,f=!0;c<n.length;c+=1){var p=n[c],h=Hr(p,0,1),v=Hr(p,-1);if((h==='"'||h==="'"||h==="`"||v==='"'||v==="'"||v==="`")&&h!==v)throw new Ct("property names with quotes must have matching quotes");if((p==="constructor"||!f)&&(l=!0),i+="."+p,a="%"+i+"%",Wr(lt,a))s=lt[a];else if(s!=null){if(!(p in s)){if(!r)throw new _t("base intrinsic for "+t+" exists, but the property is not available.");return}if(st&&c+1>=n.length){var b=st(s,p);f=!!b,f&&"get"in b&&!("originalValue"in b.get)?s=b.get:s=s[p]}else f=Wr(s,p),s=s[p];f&&!l&&(lt[a]=s)}}return s},lr={exports:{}};(function(e){var t=Oi,r=sr,n=r("%Function.prototype.apply%"),i=r("%Function.prototype.call%"),o=r("%Reflect.apply%",!0)||t.call(i,n),a=r("%Object.getOwnPropertyDescriptor%",!0),s=r("%Object.defineProperty%",!0),l=r("%Math.max%");if(s)try{s({},"a",{value:1})}catch{s=null}e.exports=function(f){var p=o(t,i,arguments);if(a&&s){var h=a(p,"length");h.configurable&&s(p,"length",{value:1+l(0,f.length-(arguments.length-1))})}return p};var u=function(){return o(t,n,arguments)};s?s(e.exports,"apply",{value:u}):e.exports.apply=u})(lr);var La=sr,Fa=lr.exports,ju=Fa(La("String.prototype.indexOf")),nn=function(t,r){var n=La(t,!!r);return typeof n=="function"&&ju(t,".prototype.")>-1?Fa(n):n},Cu=Ri(),Nu=nn,Qn=Nu("Object.prototype.toString"),on=function(t){return Cu&&t&&typeof t=="object"&&Symbol.toStringTag in t?!1:Qn(t)==="[object Arguments]"},Ba=function(t){return on(t)?!0:t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Qn(t)!=="[object Array]"&&Qn(t.callee)==="[object Function]"},Mu=function(){return on(arguments)}();on.isLegacyArguments=Ba;var $u=Mu?on:Ba,qu=Object.prototype.toString,xu=Function.prototype.toString,Du=/^\s*(?:function)?\*/,za=Ri(),_n=Object.getPrototypeOf,Iu=function(){if(!za)return!1;try{return Function("return function*() {}")()}catch{}},En,Lu=function(t){if(typeof t!="function")return!1;if(Du.test(xu.call(t)))return!0;if(!za){var r=qu.call(t);return r==="[object GeneratorFunction]"}if(!_n)return!1;if(typeof En=="undefined"){var n=Iu();En=n?_n(n):!1}return _n(t)===En},Ua=Function.prototype.toString,St=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Yn,Tr;if(typeof St=="function"&&typeof Object.defineProperty=="function")try{Yn=Object.defineProperty({},"length",{get:function(){throw Tr}}),Tr={},St(function(){throw 42},null,Yn)}catch(e){e!==Tr&&(St=null)}else St=null;var Fu=/^\s*class\b/,Jn=function(t){try{var r=Ua.call(t);return Fu.test(r)}catch{return!1}},An=function(t){try{return Jn(t)?!1:(Ua.call(t),!0)}catch{return!1}},jr=Object.prototype.toString,Bu="[object Object]",zu="[object Function]",Uu="[object GeneratorFunction]",Wu="[object HTMLAllCollection]",Hu="[object HTML document.all class]",Gu="[object HTMLCollection]",Vu=typeof Symbol=="function"&&!!Symbol.toStringTag,Ku=!(0 in[,]),Xn=function(){return!1};if(typeof document=="object"){var Qu=document.all;jr.call(Qu)===jr.call(document.all)&&(Xn=function(t){if((Ku||!t)&&(typeof t=="undefined"||typeof t=="object"))try{var r=jr.call(t);return(r===Wu||r===Hu||r===Gu||r===Bu)&&t("")==null}catch{}return!1})}var Yu=St?function(t){if(Xn(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{St(t,null,Yn)}catch(r){if(r!==Tr)return!1}return!Jn(t)&&An(t)}:function(t){if(Xn(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(Vu)return An(t);if(Jn(t))return!1;var r=jr.call(t);return r!==zu&&r!==Uu&&!/^\[object HTML/.test(r)?!1:An(t)},Ju=Yu,Xu=Object.prototype.toString,Wa=Object.prototype.hasOwnProperty,Zu=function(t,r,n){for(var i=0,o=t.length;i<o;i++)Wa.call(t,i)&&(n==null?r(t[i],i,t):r.call(n,t[i],i,t))},ec=function(t,r,n){for(var i=0,o=t.length;i<o;i++)n==null?r(t.charAt(i),i,t):r.call(n,t.charAt(i),i,t)},tc=function(t,r,n){for(var i in t)Wa.call(t,i)&&(n==null?r(t[i],i,t):r.call(n,t[i],i,t))},rc=function(t,r,n){if(!Ju(r))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=n),Xu.call(t)==="[object Array]"?Zu(t,r,i):typeof t=="string"?ec(t,r,i):tc(t,r,i)},nc=rc,Rn=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],ic=typeof globalThis=="undefined"?Qe:globalThis,oc=function(){for(var t=[],r=0;r<Rn.length;r++)typeof ic[Rn[r]]=="function"&&(t[t.length]=Rn[r]);return t},ac=sr,Cr=ac("%Object.getOwnPropertyDescriptor%",!0);if(Cr)try{Cr([],"length")}catch{Cr=null}var Ha=Cr,Gr=nc,sc=oc,lo=lr.exports,Pi=nn,Nr=Ha,lc=Pi("Object.prototype.toString"),Ga=Ri(),uo=typeof globalThis=="undefined"?Qe:globalThis,Zn=sc(),Ti=Pi("String.prototype.slice"),On=Object.getPrototypeOf,uc=Pi("Array.prototype.indexOf",!0)||function(t,r){for(var n=0;n<t.length;n+=1)if(t[n]===r)return n;return-1},Vr={__proto__:null};Ga&&Nr&&On?Gr(Zn,function(e){var t=new uo[e];if(Symbol.toStringTag in t){var r=On(t),n=Nr(r,Symbol.toStringTag);if(!n){var i=On(r);n=Nr(i,Symbol.toStringTag)}Vr["$"+e]=lo(n.get)}}):Gr(Zn,function(e){var t=new uo[e];Vr["$"+e]=lo(t.slice)});var cc=function(t){var r=!1;return Gr(Vr,function(n,i){if(!r)try{"$"+n(t)===i&&(r=Ti(i,1))}catch{}}),r},fc=function(t){var r=!1;return Gr(Vr,function(n,i){if(!r)try{n(t),r=Ti(i,1)}catch{}}),r},Va=function(t){if(!t||typeof t!="object")return!1;if(!Ga){var r=Ti(lc(t),8,-1);return uc(Zn,r)>-1?r:r!=="Object"?!1:fc(t)}return Nr?cc(t):null},dc=Va,hc=function(t){return!!dc(t)};(function(e){var t=$u,r=Lu,n=Va,i=hc;function o(y){return y.call.bind(y)}var a=typeof BigInt!="undefined",s=typeof Symbol!="undefined",l=o(Object.prototype.toString),u=o(Number.prototype.valueOf),c=o(String.prototype.valueOf),f=o(Boolean.prototype.valueOf);if(a)var p=o(BigInt.prototype.valueOf);if(s)var h=o(Symbol.prototype.valueOf);function v(y,Pl){if(typeof y!="object")return!1;try{return Pl(y),!0}catch{return!1}}e.isArgumentsObject=t,e.isGeneratorFunction=r,e.isTypedArray=i;function b(y){return typeof Promise!="undefined"&&y instanceof Promise||y!==null&&typeof y=="object"&&typeof y.then=="function"&&typeof y.catch=="function"}e.isPromise=b;function E(y){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(y):i(y)||g(y)}e.isArrayBufferView=E;function P(y){return n(y)==="Uint8Array"}e.isUint8Array=P;function M(y){return n(y)==="Uint8ClampedArray"}e.isUint8ClampedArray=M;function j(y){return n(y)==="Uint16Array"}e.isUint16Array=j;function S(y){return n(y)==="Uint32Array"}e.isUint32Array=S;function k(y){return n(y)==="Int8Array"}e.isInt8Array=k;function T(y){return n(y)==="Int16Array"}e.isInt16Array=T;function w(y){return n(y)==="Int32Array"}e.isInt32Array=w;function U(y){return n(y)==="Float32Array"}e.isFloat32Array=U;function K(y){return n(y)==="Float64Array"}e.isFloat64Array=K;function de(y){return n(y)==="BigInt64Array"}e.isBigInt64Array=de;function le(y){return n(y)==="BigUint64Array"}e.isBigUint64Array=le;function ve(y){return l(y)==="[object Map]"}ve.working=typeof Map!="undefined"&&ve(new Map);function Oe(y){return typeof Map=="undefined"?!1:ve.working?ve(y):y instanceof Map}e.isMap=Oe;function me(y){return l(y)==="[object Set]"}me.working=typeof Set!="undefined"&&me(new Set);function we(y){return typeof Set=="undefined"?!1:me.working?me(y):y instanceof Set}e.isSet=we;function R(y){return l(y)==="[object WeakMap]"}R.working=typeof WeakMap!="undefined"&&R(new WeakMap);function q(y){return typeof WeakMap=="undefined"?!1:R.working?R(y):y instanceof WeakMap}e.isWeakMap=q;function L(y){return l(y)==="[object WeakSet]"}L.working=typeof WeakSet!="undefined"&&L(new WeakSet);function re(y){return L(y)}e.isWeakSet=re;function he(y){return l(y)==="[object ArrayBuffer]"}he.working=typeof ArrayBuffer!="undefined"&&he(new ArrayBuffer);function Me(y){return typeof ArrayBuffer=="undefined"?!1:he.working?he(y):y instanceof ArrayBuffer}e.isArrayBuffer=Me;function d(y){return l(y)==="[object DataView]"}d.working=typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined"&&d(new DataView(new ArrayBuffer(1),0,1));function g(y){return typeof DataView=="undefined"?!1:d.working?d(y):y instanceof DataView}e.isDataView=g;var m=typeof SharedArrayBuffer!="undefined"?SharedArrayBuffer:void 0;function A(y){return l(y)==="[object SharedArrayBuffer]"}function N(y){return typeof m=="undefined"?!1:(typeof A.working=="undefined"&&(A.working=A(new m)),A.working?A(y):y instanceof m)}e.isSharedArrayBuffer=N;function F(y){return l(y)==="[object AsyncFunction]"}e.isAsyncFunction=F;function I(y){return l(y)==="[object Map Iterator]"}e.isMapIterator=I;function O(y){return l(y)==="[object Set Iterator]"}e.isSetIterator=O;function J(y){return l(y)==="[object Generator]"}e.isGeneratorObject=J;function ge(y){return l(y)==="[object WebAssembly.Module]"}e.isWebAssemblyCompiledModule=ge;function Ie(y){return v(y,u)}e.isNumberObject=Ie;function gr(y){return v(y,c)}e.isStringObject=gr;function gt(y){return v(y,f)}e.isBooleanObject=gt;function yr(y){return a&&v(y,p)}e.isBigIntObject=yr;function Qi(y){return s&&v(y,h)}e.isSymbolObject=Qi;function Rl(y){return Ie(y)||gr(y)||gt(y)||yr(y)||Qi(y)}e.isBoxedPrimitive=Rl;function Ol(y){return typeof Uint8Array!="undefined"&&(Me(y)||N(y))}e.isAnyArrayBuffer=Ol,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(y){Object.defineProperty(e,y,{enumerable:!1,value:function(){throw new Error(y+" is not supported in userland")}})})})(Da);var pc=function(t){return t instanceof $.Buffer},Fe={exports:{}};typeof Object.create=="function"?Fe.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Fe.exports=function(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}};(function(e){var t=Object.getOwnPropertyDescriptors||function(g){for(var m=Object.keys(g),A={},N=0;N<m.length;N++)A[m[N]]=Object.getOwnPropertyDescriptor(g,m[N]);return A},r=/%[sdj%]/g;e.format=function(d){if(!k(d)){for(var g=[],m=0;m<arguments.length;m++)g.push(a(arguments[m]));return g.join(" ")}for(var m=1,A=arguments,N=A.length,F=String(d).replace(r,function(O){if(O==="%%")return"%";if(m>=N)return O;switch(O){case"%s":return String(A[m++]);case"%d":return Number(A[m++]);case"%j":try{return JSON.stringify(A[m++])}catch{return"[Circular]"}default:return O}}),I=A[m];m<N;I=A[++m])M(I)||!K(I)?F+=" "+I:F+=" "+a(I);return F},e.deprecate=function(d,g){if(typeof $.process!="undefined"&&$.process.noDeprecation===!0)return d;if(typeof $.process=="undefined")return function(){return e.deprecate(d,g).apply(this,arguments)};var m=!1;function A(){if(!m){if($.process.throwDeprecation)throw new Error(g);$.process.traceDeprecation?console.trace(g):console.error(g),m=!0}return d.apply(this,arguments)}return A};var n={},i=/^$/;if({}.NODE_DEBUG){var o={}.NODE_DEBUG;o=o.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),i=new RegExp("^"+o+"$","i")}e.debuglog=function(d){if(d=d.toUpperCase(),!n[d])if(i.test(d)){var g=$.process.pid;n[d]=function(){var m=e.format.apply(e,arguments);console.error("%s %d: %s",d,g,m)}}else n[d]=function(){};return n[d]};function a(d,g){var m={seen:[],stylize:l};return arguments.length>=3&&(m.depth=arguments[2]),arguments.length>=4&&(m.colors=arguments[3]),P(g)?m.showHidden=g:g&&e._extend(m,g),w(m.showHidden)&&(m.showHidden=!1),w(m.depth)&&(m.depth=2),w(m.colors)&&(m.colors=!1),w(m.customInspect)&&(m.customInspect=!0),m.colors&&(m.stylize=s),c(m,d,m.depth)}e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function s(d,g){var m=a.styles[g];return m?"\x1B["+a.colors[m][0]+"m"+d+"\x1B["+a.colors[m][1]+"m":d}function l(d,g){return d}function u(d){var g={};return d.forEach(function(m,A){g[m]=!0}),g}function c(d,g,m){if(d.customInspect&&g&&ve(g.inspect)&&g.inspect!==e.inspect&&!(g.constructor&&g.constructor.prototype===g)){var A=g.inspect(m,d);return k(A)||(A=c(d,A,m)),A}var N=f(d,g);if(N)return N;var F=Object.keys(g),I=u(F);if(d.showHidden&&(F=Object.getOwnPropertyNames(g)),le(g)&&(F.indexOf("message")>=0||F.indexOf("description")>=0))return p(g);if(F.length===0){if(ve(g)){var O=g.name?": "+g.name:"";return d.stylize("[Function"+O+"]","special")}if(U(g))return d.stylize(RegExp.prototype.toString.call(g),"regexp");if(de(g))return d.stylize(Date.prototype.toString.call(g),"date");if(le(g))return p(g)}var J="",ge=!1,Ie=["{","}"];if(E(g)&&(ge=!0,Ie=["[","]"]),ve(g)){var gr=g.name?": "+g.name:"";J=" [Function"+gr+"]"}if(U(g)&&(J=" "+RegExp.prototype.toString.call(g)),de(g)&&(J=" "+Date.prototype.toUTCString.call(g)),le(g)&&(J=" "+p(g)),F.length===0&&(!ge||g.length==0))return Ie[0]+J+Ie[1];if(m<0)return U(g)?d.stylize(RegExp.prototype.toString.call(g),"regexp"):d.stylize("[Object]","special");d.seen.push(g);var gt;return ge?gt=h(d,g,m,I,F):gt=F.map(function(yr){return v(d,g,m,I,yr,ge)}),d.seen.pop(),b(gt,J,Ie)}function f(d,g){if(w(g))return d.stylize("undefined","undefined");if(k(g)){var m="'"+JSON.stringify(g).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return d.stylize(m,"string")}if(S(g))return d.stylize(""+g,"number");if(P(g))return d.stylize(""+g,"boolean");if(M(g))return d.stylize("null","null")}function p(d){return"["+Error.prototype.toString.call(d)+"]"}function h(d,g,m,A,N){for(var F=[],I=0,O=g.length;I<O;++I)L(g,String(I))?F.push(v(d,g,m,A,String(I),!0)):F.push("");return N.forEach(function(J){J.match(/^\d+$/)||F.push(v(d,g,m,A,J,!0))}),F}function v(d,g,m,A,N,F){var I,O,J;if(J=Object.getOwnPropertyDescriptor(g,N)||{value:g[N]},J.get?J.set?O=d.stylize("[Getter/Setter]","special"):O=d.stylize("[Getter]","special"):J.set&&(O=d.stylize("[Setter]","special")),L(A,N)||(I="["+N+"]"),O||(d.seen.indexOf(J.value)<0?(M(m)?O=c(d,J.value,null):O=c(d,J.value,m-1),O.indexOf(`
`)>-1&&(F?O=O.split(`
`).map(function(ge){return"  "+ge}).join(`
`).slice(2):O=`
`+O.split(`
`).map(function(ge){return"   "+ge}).join(`
`))):O=d.stylize("[Circular]","special")),w(I)){if(F&&N.match(/^\d+$/))return O;I=JSON.stringify(""+N),I.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(I=I.slice(1,-1),I=d.stylize(I,"name")):(I=I.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),I=d.stylize(I,"string"))}return I+": "+O}function b(d,g,m){var A=d.reduce(function(N,F){return F.indexOf(`
`)>=0,N+F.replace(/\u001b\[\d\d?m/g,"").length+1},0);return A>60?m[0]+(g===""?"":g+`
 `)+" "+d.join(`,
  `)+" "+m[1]:m[0]+g+" "+d.join(", ")+" "+m[1]}e.types=Da;function E(d){return Array.isArray(d)}e.isArray=E;function P(d){return typeof d=="boolean"}e.isBoolean=P;function M(d){return d===null}e.isNull=M;function j(d){return d==null}e.isNullOrUndefined=j;function S(d){return typeof d=="number"}e.isNumber=S;function k(d){return typeof d=="string"}e.isString=k;function T(d){return typeof d=="symbol"}e.isSymbol=T;function w(d){return d===void 0}e.isUndefined=w;function U(d){return K(d)&&me(d)==="[object RegExp]"}e.isRegExp=U,e.types.isRegExp=U;function K(d){return typeof d=="object"&&d!==null}e.isObject=K;function de(d){return K(d)&&me(d)==="[object Date]"}e.isDate=de,e.types.isDate=de;function le(d){return K(d)&&(me(d)==="[object Error]"||d instanceof Error)}e.isError=le,e.types.isNativeError=le;function ve(d){return typeof d=="function"}e.isFunction=ve;function Oe(d){return d===null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||typeof d=="symbol"||typeof d=="undefined"}e.isPrimitive=Oe,e.isBuffer=pc;function me(d){return Object.prototype.toString.call(d)}function we(d){return d<10?"0"+d.toString(10):d.toString(10)}var R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function q(){var d=new Date,g=[we(d.getHours()),we(d.getMinutes()),we(d.getSeconds())].join(":");return[d.getDate(),R[d.getMonth()],g].join(" ")}e.log=function(){console.log("%s - %s",q(),e.format.apply(e,arguments))},e.inherits=Fe.exports,e._extend=function(d,g){if(!g||!K(g))return d;for(var m=Object.keys(g),A=m.length;A--;)d[m[A]]=g[m[A]];return d};function L(d,g){return Object.prototype.hasOwnProperty.call(d,g)}var re=typeof Symbol!="undefined"?Symbol("util.promisify.custom"):void 0;e.promisify=function(g){if(typeof g!="function")throw new TypeError('The "original" argument must be of type Function');if(re&&g[re]){var m=g[re];if(typeof m!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(m,re,{value:m,enumerable:!1,writable:!1,configurable:!0}),m}function m(){for(var A,N,F=new Promise(function(J,ge){A=J,N=ge}),I=[],O=0;O<arguments.length;O++)I.push(arguments[O]);I.push(function(J,ge){J?N(J):A(ge)});try{g.apply(this,I)}catch(J){N(J)}return F}return Object.setPrototypeOf(m,Object.getPrototypeOf(g)),re&&Object.defineProperty(m,re,{value:m,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(m,t(g))},e.promisify.custom=re;function he(d,g){if(!d){var m=new Error("Promise was rejected with a falsy value");m.reason=d,d=m}return g(d)}function Me(d){if(typeof d!="function")throw new TypeError('The "original" argument must be of type Function');function g(){for(var m=[],A=0;A<arguments.length;A++)m.push(arguments[A]);var N=m.pop();if(typeof N!="function")throw new TypeError("The last argument must be of type Function");var F=this,I=function(){return N.apply(F,arguments)};d.apply(this,m).then(function(O){$.process.nextTick(I.bind(null,null,O))},function(O){$.process.nextTick(he.bind(null,O,I))})}return Object.setPrototypeOf(g,Object.getPrototypeOf(d)),Object.defineProperties(g,t(d)),g}e.callbackify=Me})(Ce);function Ye(e){return Ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ye(e)}function co(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gc(n.key),n)}}function vc(e,t,r){return t&&co(e.prototype,t),r&&co(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function gc(e){var t=yc(e,"string");return Ye(t)==="symbol"?t:String(t)}function yc(e,t){if(Ye(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Ye(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function mc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bc(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ei(e,t)}function ei(e,t){return ei=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},ei(e,t)}function wc(e){var t=_c();return function(){var n=Kr(e),i;if(t){var o=Kr(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Sc(this,i)}}function Sc(e,t){if(t&&(Ye(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kc(e)}function kc(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Kr(e){return Kr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Kr(e)}var Ka={},Et,Pn;function ur(e,t,r){r||(r=Error);function n(o,a,s){return typeof t=="string"?t:t(o,a,s)}var i=function(o){bc(s,o);var a=wc(s);function s(l,u,c){var f;return mc(this,s),f=a.call(this,n(l,u,c)),f.code=e,f}return vc(s)}(r);Ka[e]=i}function fo(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(n){return String(n)}),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:r===2?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}else return"of ".concat(t," ").concat(String(e))}function Ec(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function Ac(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function Rc(e,t,r){return typeof r!="number"&&(r=0),r+t.length>e.length?!1:e.indexOf(t,r)!==-1}ur("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError);ur("ERR_INVALID_ARG_TYPE",function(e,t,r){Et===void 0&&(Et=or.exports),Et(typeof e=="string","'name' must be a string");var n;typeof t=="string"&&Ec(t,"not ")?(n="must not be",t=t.replace(/^not /,"")):n="must be";var i;if(Ac(e," argument"))i="The ".concat(e," ").concat(n," ").concat(fo(t,"type"));else{var o=Rc(e,".")?"property":"argument";i='The "'.concat(e,'" ').concat(o," ").concat(n," ").concat(fo(t,"type"))}return i+=". Received type ".concat(Ye(r)),i},TypeError);ur("ERR_INVALID_ARG_VALUE",function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"is invalid";Pn===void 0&&(Pn=Ce);var n=Pn.inspect(t);return n.length>128&&(n="".concat(n.slice(0,128),"...")),"The argument '".concat(e,"' ").concat(r,". Received ").concat(n)},TypeError);ur("ERR_INVALID_RETURN_VALUE",function(e,t,r){var n;return r&&r.constructor&&r.constructor.name?n="instance of ".concat(r.constructor.name):n="type ".concat(Ye(r)),"Expected ".concat(e,' to be returned from the "').concat(t,'"')+" function but got ".concat(n,".")},TypeError);ur("ERR_MISSING_ARGS",function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Et===void 0&&(Et=or.exports),Et(t.length>0,"At least one arg needs to be specified");var n="The ",i=t.length;switch(t=t.map(function(o){return'"'.concat(o,'"')}),i){case 1:n+="".concat(t[0]," argument");break;case 2:n+="".concat(t[0]," and ").concat(t[1]," arguments");break;default:n+=t.slice(0,i-1).join(", "),n+=", and ".concat(t[i-1]," arguments");break}return"".concat(n," must be specified")},TypeError);Ei.codes=Ka;function ho(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function po(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ho(Object(r),!0).forEach(function(n){Oc(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ho(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Oc(e,t,r){return t=Qa(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Qa(n.key),n)}}function Tc(e,t,r){return t&&vo(e.prototype,t),r&&vo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Qa(e){var t=jc(e,"string");return ke(t)==="symbol"?t:String(t)}function jc(e,t){if(ke(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ke(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Cc(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zt(e,t)}function Nc(e){var t=Ja();return function(){var n=er(e),i;if(t){var o=er(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Ya(this,i)}}function Ya(e,t){if(t&&(ke(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ti(e)}function ti(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ri(e){var t=typeof Map=="function"?new Map:void 0;return ri=function(n){if(n===null||!Mc(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t!="undefined"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return Mr(n,arguments,er(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Zt(i,n)},ri(e)}function Mr(e,t,r){return Ja()?Mr=Reflect.construct.bind():Mr=function(i,o,a){var s=[null];s.push.apply(s,o);var l=Function.bind.apply(i,s),u=new l;return a&&Zt(u,a.prototype),u},Mr.apply(null,arguments)}function Ja(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Mc(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function Zt(e,t){return Zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Zt(e,t)}function er(e){return er=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},er(e)}function ke(e){return ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ke(e)}var $c=Ce,ni=$c.inspect,qc=Ei,xc=qc.codes.ERR_INVALID_ARG_TYPE;function go(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function Dc(e,t){if(t=Math.floor(t),e.length==0||t==0)return"";var r=e.length*t;for(t=Math.floor(Math.log(t)/Math.log(2));t;)e+=e,t--;return e+=e.substring(0,r-e.length),e}var Pe="",Wt="",Ht="",pe="",nt={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"},Ic=10;function yo(e){var t=Object.keys(e),r=Object.create(Object.getPrototypeOf(e));return t.forEach(function(n){r[n]=e[n]}),Object.defineProperty(r,"message",{value:e.message}),r}function Gt(e){return ni(e,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}function Lc(e,t,r){var n="",i="",o=0,a="",s=!1,l=Gt(e),u=l.split(`
`),c=Gt(t).split(`
`),f=0,p="";if(r==="strictEqual"&&ke(e)==="object"&&ke(t)==="object"&&e!==null&&t!==null&&(r="strictEqualObject"),u.length===1&&c.length===1&&u[0]!==c[0]){var h=u[0].length+c[0].length;if(h<=Ic){if((ke(e)!=="object"||e===null)&&(ke(t)!=="object"||t===null)&&(e!==0||t!==0))return"".concat(nt[r],`

`)+"".concat(u[0]," !== ").concat(c[0],`
`)}else if(r!=="strictEqualObject"){var v=$.process.stderr&&$.process.stderr.isTTY?$.process.stderr.columns:80;if(h<v){for(;u[0][f]===c[0][f];)f++;f>2&&(p=`
  `.concat(Dc(" ",f),"^"),f=0)}}}for(var b=u[u.length-1],E=c[c.length-1];b===E&&(f++<2?a=`
  `.concat(b).concat(a):n=b,u.pop(),c.pop(),!(u.length===0||c.length===0));)b=u[u.length-1],E=c[c.length-1];var P=Math.max(u.length,c.length);if(P===0){var M=l.split(`
`);if(M.length>30)for(M[26]="".concat(Pe,"...").concat(pe);M.length>27;)M.pop();return"".concat(nt.notIdentical,`

`).concat(M.join(`
`),`
`)}f>3&&(a=`
`.concat(Pe,"...").concat(pe).concat(a),s=!0),n!==""&&(a=`
  `.concat(n).concat(a),n="");var j=0,S=nt[r]+`
`.concat(Wt,"+ actual").concat(pe," ").concat(Ht,"- expected").concat(pe),k=" ".concat(Pe,"...").concat(pe," Lines skipped");for(f=0;f<P;f++){var T=f-o;if(u.length<f+1)T>1&&f>2&&(T>4?(i+=`
`.concat(Pe,"...").concat(pe),s=!0):T>3&&(i+=`
  `.concat(c[f-2]),j++),i+=`
  `.concat(c[f-1]),j++),o=f,n+=`
`.concat(Ht,"-").concat(pe," ").concat(c[f]),j++;else if(c.length<f+1)T>1&&f>2&&(T>4?(i+=`
`.concat(Pe,"...").concat(pe),s=!0):T>3&&(i+=`
  `.concat(u[f-2]),j++),i+=`
  `.concat(u[f-1]),j++),o=f,i+=`
`.concat(Wt,"+").concat(pe," ").concat(u[f]),j++;else{var w=c[f],U=u[f],K=U!==w&&(!go(U,",")||U.slice(0,-1)!==w);K&&go(w,",")&&w.slice(0,-1)===U&&(K=!1,U+=","),K?(T>1&&f>2&&(T>4?(i+=`
`.concat(Pe,"...").concat(pe),s=!0):T>3&&(i+=`
  `.concat(u[f-2]),j++),i+=`
  `.concat(u[f-1]),j++),o=f,i+=`
`.concat(Wt,"+").concat(pe," ").concat(U),n+=`
`.concat(Ht,"-").concat(pe," ").concat(w),j+=2):(i+=n,n="",(T===1||f===0)&&(i+=`
  `.concat(U),j++))}if(j>20&&f<P-2)return"".concat(S).concat(k,`
`).concat(i,`
`).concat(Pe,"...").concat(pe).concat(n,`
`)+"".concat(Pe,"...").concat(pe)}return"".concat(S).concat(s?k:"",`
`).concat(i).concat(n).concat(a).concat(p)}var Fc=function(e,t){Cc(n,e);var r=Nc(n);function n(i){var o;if(Pc(this,n),ke(i)!=="object"||i===null)throw new xc("options","Object",i);var a=i.message,s=i.operator,l=i.stackStartFn,u=i.actual,c=i.expected,f=Error.stackTraceLimit;if(Error.stackTraceLimit=0,a!=null)o=r.call(this,String(a));else if($.process.stderr&&$.process.stderr.isTTY&&($.process.stderr&&$.process.stderr.getColorDepth&&$.process.stderr.getColorDepth()!==1?(Pe="\x1B[34m",Wt="\x1B[32m",pe="\x1B[39m",Ht="\x1B[31m"):(Pe="",Wt="",pe="",Ht="")),ke(u)==="object"&&u!==null&&ke(c)==="object"&&c!==null&&"stack"in u&&u instanceof Error&&"stack"in c&&c instanceof Error&&(u=yo(u),c=yo(c)),s==="deepStrictEqual"||s==="strictEqual")o=r.call(this,Lc(u,c,s));else if(s==="notDeepStrictEqual"||s==="notStrictEqual"){var p=nt[s],h=Gt(u).split(`
`);if(s==="notStrictEqual"&&ke(u)==="object"&&u!==null&&(p=nt.notStrictEqualObject),h.length>30)for(h[26]="".concat(Pe,"...").concat(pe);h.length>27;)h.pop();h.length===1?o=r.call(this,"".concat(p," ").concat(h[0])):o=r.call(this,"".concat(p,`

`).concat(h.join(`
`),`
`))}else{var v=Gt(u),b="",E=nt[s];s==="notDeepEqual"||s==="notEqual"?(v="".concat(nt[s],`

`).concat(v),v.length>1024&&(v="".concat(v.slice(0,1021),"..."))):(b="".concat(Gt(c)),v.length>512&&(v="".concat(v.slice(0,509),"...")),b.length>512&&(b="".concat(b.slice(0,509),"...")),s==="deepEqual"||s==="equal"?v="".concat(E,`

`).concat(v,`

should equal

`):b=" ".concat(s," ").concat(b)),o=r.call(this,"".concat(v).concat(b))}return Error.stackTraceLimit=f,o.generatedMessage=!a,Object.defineProperty(ti(o),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),o.code="ERR_ASSERTION",o.actual=u,o.expected=c,o.operator=s,Error.captureStackTrace&&Error.captureStackTrace(ti(o),l),o.stack,o.name="AssertionError",Ya(o)}return Tc(n,[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:t,value:function(o,a){return ni(this,po(po({},a),{},{customInspect:!1,depth:0}))}}]),n}(ri(Error),ni.custom),Bc=Fc,mo=Object.prototype.toString,Xa=function(t){var r=mo.call(t),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&mo.call(t.callee)==="[object Function]"),n},Za;if(!Object.keys){var wr=Object.prototype.hasOwnProperty,bo=Object.prototype.toString,zc=Xa,wo=Object.prototype.propertyIsEnumerable,Uc=!wo.call({toString:null},"toString"),Wc=wo.call(function(){},"prototype"),Sr=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Tn=function(e){var t=e.constructor;return t&&t.prototype===e},Hc={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Gc=function(){if(typeof window=="undefined")return!1;for(var e in window)try{if(!Hc["$"+e]&&wr.call(window,e)&&window[e]!==null&&typeof window[e]=="object")try{Tn(window[e])}catch{return!0}}catch{return!0}return!1}(),Vc=function(e){if(typeof window=="undefined"||!Gc)return Tn(e);try{return Tn(e)}catch{return!1}};Za=function(t){var r=t!==null&&typeof t=="object",n=bo.call(t)==="[object Function]",i=zc(t),o=r&&bo.call(t)==="[object String]",a=[];if(!r&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var s=Wc&&n;if(o&&t.length>0&&!wr.call(t,0))for(var l=0;l<t.length;++l)a.push(String(l));if(i&&t.length>0)for(var u=0;u<t.length;++u)a.push(String(u));else for(var c in t)!(s&&c==="prototype")&&wr.call(t,c)&&a.push(String(c));if(Uc)for(var f=Vc(t),p=0;p<Sr.length;++p)!(f&&Sr[p]==="constructor")&&wr.call(t,Sr[p])&&a.push(Sr[p]);return a}}var Kc=Za,Qc=Array.prototype.slice,Yc=Xa,So=Object.keys,$r=So?function(t){return So(t)}:Kc,ko=Object.keys;$r.shim=function(){if(Object.keys){var t=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);t||(Object.keys=function(n){return Yc(n)?ko(Qc.call(n)):ko(n)})}else Object.keys=$r;return Object.keys||$r};var es=$r,Jc=es,ts=Ai(),rs=nn,_o=Object,Xc=rs("Array.prototype.push"),Eo=rs("Object.prototype.propertyIsEnumerable"),Zc=ts?Object.getOwnPropertySymbols:null,ef=function(t,r){if(t==null)throw new TypeError("target must be an object");var n=_o(t);if(arguments.length===1)return n;for(var i=1;i<arguments.length;++i){var o=_o(arguments[i]),a=Jc(o),s=ts&&(Object.getOwnPropertySymbols||Zc);if(s)for(var l=s(o),u=0;u<l.length;++u){var c=l[u];Eo(o,c)&&Xc(a,c)}for(var f=0;f<a.length;++f){var p=a[f];if(Eo(o,p)){var h=o[p];n[p]=h}}}return n},jn=ef,tf=function(){if(!Object.assign)return!1;for(var e="abcdefghijklmnopqrst",t=e.split(""),r={},n=0;n<t.length;++n)r[t[n]]=t[n];var i=Object.assign({},r),o="";for(var a in i)o+=a;return e!==o},rf=function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch{return e[1]==="y"}return!1},nf=function(){return!Object.assign||tf()||rf()?jn:Object.assign},Ao=function(e){return e!==e},ns=function(t,r){return t===0&&r===0?1/t===1/r:!!(t===r||Ao(t)&&Ao(r))},of=ns,ji=function(){return typeof Object.is=="function"?Object.is:of},af=sr,ii=af("%Object.defineProperty%",!0),oi=function(){if(ii)try{return ii({},"a",{value:1}),!0}catch{return!1}return!1};oi.hasArrayLengthDefineBug=function(){if(!oi())return null;try{return ii([],"length",{value:1}).length!==1}catch{return!0}};var is=oi,sf=is(),Ci=sr,Ro=sf&&Ci("%Object.defineProperty%",!0),lf=Ci("%SyntaxError%"),mt=Ci("%TypeError%"),Oo=Ha,uf=function(t,r,n){if(!t||typeof t!="object"&&typeof t!="function")throw new mt("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new mt("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new mt("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new mt("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new mt("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new mt("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,l=!!Oo&&Oo(t,r);if(Ro)Ro(t,r,{configurable:a===null&&l?l.configurable:!a,enumerable:i===null&&l?l.enumerable:!i,value:n,writable:o===null&&l?l.writable:!o});else if(s||!i&&!o&&!a)t[r]=n;else throw new lf("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},cf=es,ff=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",df=Object.prototype.toString,hf=Array.prototype.concat,Po=uf,pf=function(e){return typeof e=="function"&&df.call(e)==="[object Function]"},os=is(),vf=function(e,t,r,n){if(t in e){if(n===!0){if(e[t]===r)return}else if(!pf(n)||!n())return}os?Po(e,t,r,!0):Po(e,t,r)},as=function(e,t){var r=arguments.length>2?arguments[2]:{},n=cf(t);ff&&(n=hf.call(n,Object.getOwnPropertySymbols(t)));for(var i=0;i<n.length;i+=1)vf(e,n[i],t[n[i]],r[n[i]])};as.supportsDescriptors=!!os;var an=as,gf=ji,yf=an,mf=function(){var t=gf();return yf(Object,{is:t},{is:function(){return Object.is!==t}}),t},bf=an,wf=lr.exports,Sf=ns,ss=ji,kf=mf,ls=wf(ss(),Object);bf(ls,{getPolyfill:ss,implementation:Sf,shim:kf});var _f=ls,us=function(t){return t!==t},Ef=us,cs=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:Ef},Af=an,Rf=cs,Of=function(){var t=Rf();return Af(Number,{isNaN:t},{isNaN:function(){return Number.isNaN!==t}}),t},Pf=lr.exports,Tf=an,jf=us,fs=cs,Cf=Of,ds=Pf(fs(),Number);Tf(ds,{getPolyfill:fs,implementation:jf,shim:Cf});var Nf=ds;function To(e,t){return xf(e)||qf(e,t)||$f(e,t)||Mf()}function Mf(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $f(e,t){if(!!e){if(typeof e=="string")return jo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jo(e,t)}}function jo(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qf(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,a,s=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}function xf(e){if(Array.isArray(e))return e}function _e(e){return _e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_e(e)}var Df=/a/g.flags!==void 0,Qr=function(t){var r=[];return t.forEach(function(n){return r.push(n)}),r},Co=function(t){var r=[];return t.forEach(function(n,i){return r.push([i,n])}),r},hs=Object.is?Object.is:_f,qr=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},ai=Number.isNaN?Number.isNaN:Nf;function Ni(e){return e.call.bind(e)}var zt=Ni(Object.prototype.hasOwnProperty),xr=Ni(Object.prototype.propertyIsEnumerable),No=Ni(Object.prototype.toString),be=Ce.types,If=be.isAnyArrayBuffer,Lf=be.isArrayBufferView,Mo=be.isDate,kr=be.isMap,$o=be.isRegExp,_r=be.isSet,Ff=be.isNativeError,Bf=be.isBoxedPrimitive,qo=be.isNumberObject,xo=be.isStringObject,Do=be.isBooleanObject,Io=be.isBigIntObject,zf=be.isSymbolObject,Uf=be.isFloat32Array,Wf=be.isFloat64Array;function Hf(e){if(e.length===0||e.length>10)return!0;for(var t=0;t<e.length;t++){var r=e.charCodeAt(t);if(r<48||r>57)return!0}return e.length===10&&e>=Math.pow(2,32)}function Er(e){return Object.keys(e).filter(Hf).concat(qr(e).filter(Object.prototype.propertyIsEnumerable.bind(e)))}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function ps(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}var Gf=!0,Vf=!1,si=0,Mi=1,vs=2,gs=3;function Kf(e,t){return Df?e.source===t.source&&e.flags===t.flags:RegExp.prototype.toString.call(e)===RegExp.prototype.toString.call(t)}function Qf(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Yf(e,t){return e.byteLength!==t.byteLength?!1:ps(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))===0}function Jf(e,t){return e.byteLength===t.byteLength&&ps(new Uint8Array(e),new Uint8Array(t))===0}function Xf(e,t){return qo(e)?qo(t)&&hs(Number.prototype.valueOf.call(e),Number.prototype.valueOf.call(t)):xo(e)?xo(t)&&String.prototype.valueOf.call(e)===String.prototype.valueOf.call(t):Do(e)?Do(t)&&Boolean.prototype.valueOf.call(e)===Boolean.prototype.valueOf.call(t):Io(e)?Io(t)&&BigInt.prototype.valueOf.call(e)===BigInt.prototype.valueOf.call(t):zf(t)&&Symbol.prototype.valueOf.call(e)===Symbol.prototype.valueOf.call(t)}function Ee(e,t,r,n){if(e===t)return e!==0?!0:r?hs(e,t):!0;if(r){if(_e(e)!=="object")return typeof e=="number"&&ai(e)&&ai(t);if(_e(t)!=="object"||e===null||t===null||Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1}else{if(e===null||_e(e)!=="object")return t===null||_e(t)!=="object"?e==t:!1;if(t===null||_e(t)!=="object")return!1}var i=No(e),o=No(t);if(i!==o)return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;var a=Er(e),s=Er(t);return a.length!==s.length?!1:Lt(e,t,r,n,Mi,a)}if(i==="[object Object]"&&(!kr(e)&&kr(t)||!_r(e)&&_r(t)))return!1;if(Mo(e)){if(!Mo(t)||Date.prototype.getTime.call(e)!==Date.prototype.getTime.call(t))return!1}else if($o(e)){if(!$o(t)||!Kf(e,t))return!1}else if(Ff(e)||e instanceof Error){if(e.message!==t.message||e.name!==t.name)return!1}else if(Lf(e)){if(!r&&(Uf(e)||Wf(e))){if(!Qf(e,t))return!1}else if(!Yf(e,t))return!1;var l=Er(e),u=Er(t);return l.length!==u.length?!1:Lt(e,t,r,n,si,l)}else{if(_r(e))return!_r(t)||e.size!==t.size?!1:Lt(e,t,r,n,vs);if(kr(e))return!kr(t)||e.size!==t.size?!1:Lt(e,t,r,n,gs);if(If(e)){if(!Jf(e,t))return!1}else if(Bf(e)&&!Xf(e,t))return!1}return Lt(e,t,r,n,si)}function Lo(e,t){return t.filter(function(r){return xr(e,r)})}function Lt(e,t,r,n,i,o){if(arguments.length===5){o=Object.keys(e);var a=Object.keys(t);if(o.length!==a.length)return!1}for(var s=0;s<o.length;s++)if(!zt(t,o[s]))return!1;if(r&&arguments.length===5){var l=qr(e);if(l.length!==0){var u=0;for(s=0;s<l.length;s++){var c=l[s];if(xr(e,c)){if(!xr(t,c))return!1;o.push(c),u++}else if(xr(t,c))return!1}var f=qr(t);if(l.length!==f.length&&Lo(t,f).length!==u)return!1}else{var p=qr(t);if(p.length!==0&&Lo(t,p).length!==0)return!1}}if(o.length===0&&(i===si||i===Mi&&e.length===0||e.size===0))return!0;if(n===void 0)n={val1:new Map,val2:new Map,position:0};else{var h=n.val1.get(e);if(h!==void 0){var v=n.val2.get(t);if(v!==void 0)return h===v}n.position++}n.val1.set(e,n.position),n.val2.set(t,n.position);var b=nd(e,t,r,o,n,i);return n.val1.delete(e),n.val2.delete(t),b}function Fo(e,t,r,n){for(var i=Qr(e),o=0;o<i.length;o++){var a=i[o];if(Ee(t,a,r,n))return e.delete(a),!0}return!1}function ys(e){switch(_e(e)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":e=+e;case"number":if(ai(e))return!1}return!0}function Zf(e,t,r){var n=ys(r);return n!=null?n:t.has(n)&&!e.has(n)}function ed(e,t,r,n,i){var o=ys(r);if(o!=null)return o;var a=t.get(o);return a===void 0&&!t.has(o)||!Ee(n,a,!1,i)?!1:!e.has(o)&&Ee(n,a,!1,i)}function td(e,t,r,n){for(var i=null,o=Qr(e),a=0;a<o.length;a++){var s=o[a];if(_e(s)==="object"&&s!==null)i===null&&(i=new Set),i.add(s);else if(!t.has(s)){if(r||!Zf(e,t,s))return!1;i===null&&(i=new Set),i.add(s)}}if(i!==null){for(var l=Qr(t),u=0;u<l.length;u++){var c=l[u];if(_e(c)==="object"&&c!==null){if(!Fo(i,c,r,n))return!1}else if(!r&&!e.has(c)&&!Fo(i,c,r,n))return!1}return i.size===0}return!0}function Bo(e,t,r,n,i,o){for(var a=Qr(e),s=0;s<a.length;s++){var l=a[s];if(Ee(r,l,i,o)&&Ee(n,t.get(l),i,o))return e.delete(l),!0}return!1}function rd(e,t,r,n){for(var i=null,o=Co(e),a=0;a<o.length;a++){var s=To(o[a],2),l=s[0],u=s[1];if(_e(l)==="object"&&l!==null)i===null&&(i=new Set),i.add(l);else{var c=t.get(l);if(c===void 0&&!t.has(l)||!Ee(u,c,r,n)){if(r||!ed(e,t,l,u,n))return!1;i===null&&(i=new Set),i.add(l)}}}if(i!==null){for(var f=Co(t),p=0;p<f.length;p++){var h=To(f[p],2),v=h[0],b=h[1];if(_e(v)==="object"&&v!==null){if(!Bo(i,e,v,b,r,n))return!1}else if(!r&&(!e.has(v)||!Ee(e.get(v),b,!1,n))&&!Bo(i,e,v,b,!1,n))return!1}return i.size===0}return!0}function nd(e,t,r,n,i,o){var a=0;if(o===vs){if(!td(e,t,r,i))return!1}else if(o===gs){if(!rd(e,t,r,i))return!1}else if(o===Mi)for(;a<e.length;a++)if(zt(e,a)){if(!zt(t,a)||!Ee(e[a],t[a],r,i))return!1}else{if(zt(t,a))return!1;for(var s=Object.keys(e);a<s.length;a++){var l=s[a];if(!zt(t,l)||!Ee(e[l],t[l],r,i))return!1}return s.length===Object.keys(t).length}for(a=0;a<n.length;a++){var u=n[a];if(!Ee(e[u],t[u],r,i))return!1}return!0}function id(e,t){return Ee(e,t,Vf)}function od(e,t){return Ee(e,t,Gf)}var ad={isDeepEqual:id,isDeepStrictEqual:od};function Te(e){return Te=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Te(e)}function zo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ld(n.key),n)}}function sd(e,t,r){return t&&zo(e.prototype,t),r&&zo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function ld(e){var t=ud(e,"string");return Te(t)==="symbol"?t:String(t)}function ud(e,t){if(Te(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Te(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function cd(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var fd=Ei,cr=fd.codes,Uo=cr.ERR_AMBIGUOUS_ARGUMENT,Nt=cr.ERR_INVALID_ARG_TYPE,dd=cr.ERR_INVALID_ARG_VALUE,hd=cr.ERR_INVALID_RETURN_VALUE,Ze=cr.ERR_MISSING_ARGS,et=Bc,pd=Ce,Dr=pd.inspect,ms=Ce.types,vd=ms.isPromise,Yr=ms.isRegExp,gd=nf(),bs=ji(),Jr=nn("RegExp.prototype.test"),Je,sn;function fr(){var e=ad;Je=e.isDeepEqual,sn=e.isDeepStrictEqual}var Wo=!1,ee=or.exports=$i,ln={};function Ne(e){throw e.message instanceof Error?e.message:new et(e)}function ws(e,t,r,n,i){var o=arguments.length,a;if(o===0)a="Failed";else if(o===1)r=e,e=void 0;else{if(Wo===!1){Wo=!0;var s=$.process.emitWarning?$.process.emitWarning:console.warn.bind(console);s("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")}o===2&&(n="!=")}if(r instanceof Error)throw r;var l={actual:e,expected:t,operator:n===void 0?"fail":n,stackStartFn:i||ws};r!==void 0&&(l.message=r);var u=new et(l);throw a&&(u.message=a,u.generatedMessage=!0),u}ee.fail=ws;ee.AssertionError=et;function Ss(e,t,r,n){if(!r){var i=!1;if(t===0)i=!0,n="No value argument passed to `assert.ok()`";else if(n instanceof Error)throw n;var o=new et({actual:r,expected:!0,message:n,operator:"==",stackStartFn:e});throw o.generatedMessage=i,o}}function $i(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Ss.apply(void 0,[$i,t.length].concat(t))}ee.ok=$i;ee.equal=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");t!=r&&Ne({actual:t,expected:r,message:n,operator:"==",stackStartFn:e})};ee.notEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");t==r&&Ne({actual:t,expected:r,message:n,operator:"!=",stackStartFn:e})};ee.deepEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");Je===void 0&&fr(),Je(t,r)||Ne({actual:t,expected:r,message:n,operator:"deepEqual",stackStartFn:e})};ee.notDeepEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");Je===void 0&&fr(),Je(t,r)&&Ne({actual:t,expected:r,message:n,operator:"notDeepEqual",stackStartFn:e})};ee.deepStrictEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");Je===void 0&&fr(),sn(t,r)||Ne({actual:t,expected:r,message:n,operator:"deepStrictEqual",stackStartFn:e})};ee.notDeepStrictEqual=ks;function ks(e,t,r){if(arguments.length<2)throw new Ze("actual","expected");Je===void 0&&fr(),sn(e,t)&&Ne({actual:e,expected:t,message:r,operator:"notDeepStrictEqual",stackStartFn:ks})}ee.strictEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");bs(t,r)||Ne({actual:t,expected:r,message:n,operator:"strictEqual",stackStartFn:e})};ee.notStrictEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");bs(t,r)&&Ne({actual:t,expected:r,message:n,operator:"notStrictEqual",stackStartFn:e})};var Ho=sd(function e(t,r,n){var i=this;cd(this,e),r.forEach(function(o){o in t&&(n!==void 0&&typeof n[o]=="string"&&Yr(t[o])&&Jr(t[o],n[o])?i[o]=n[o]:i[o]=t[o])})});function yd(e,t,r,n,i,o){if(!(r in e)||!sn(e[r],t[r])){if(!n){var a=new Ho(e,i),s=new Ho(t,i,e),l=new et({actual:a,expected:s,operator:"deepStrictEqual",stackStartFn:o});throw l.actual=e,l.expected=t,l.operator=o.name,l}Ne({actual:e,expected:t,message:n,operator:o.name,stackStartFn:o})}}function _s(e,t,r,n){if(typeof t!="function"){if(Yr(t))return Jr(t,e);if(arguments.length===2)throw new Nt("expected",["Function","RegExp"],t);if(Te(e)!=="object"||e===null){var i=new et({actual:e,expected:t,message:r,operator:"deepStrictEqual",stackStartFn:n});throw i.operator=n.name,i}var o=Object.keys(t);if(t instanceof Error)o.push("name","message");else if(o.length===0)throw new dd("error",t,"may not be an empty object");return Je===void 0&&fr(),o.forEach(function(a){typeof e[a]=="string"&&Yr(t[a])&&Jr(t[a],e[a])||yd(e,t,a,r,o,n)}),!0}return t.prototype!==void 0&&e instanceof t?!0:Error.isPrototypeOf(t)?!1:t.call({},e)===!0}function Es(e){if(typeof e!="function")throw new Nt("fn","Function",e);try{e()}catch(t){return t}return ln}function Go(e){return vd(e)||e!==null&&Te(e)==="object"&&typeof e.then=="function"&&typeof e.catch=="function"}function As(e){return Promise.resolve().then(function(){var t;if(typeof e=="function"){if(t=e(),!Go(t))throw new hd("instance of Promise","promiseFn",t)}else if(Go(e))t=e;else throw new Nt("promiseFn",["Function","Promise"],e);return Promise.resolve().then(function(){return t}).then(function(){return ln}).catch(function(r){return r})})}function Rs(e,t,r,n){if(typeof r=="string"){if(arguments.length===4)throw new Nt("error",["Object","Error","Function","RegExp"],r);if(Te(t)==="object"&&t!==null){if(t.message===r)throw new Uo("error/message",'The error message "'.concat(t.message,'" is identical to the message.'))}else if(t===r)throw new Uo("error/message",'The error "'.concat(t,'" is identical to the message.'));n=r,r=void 0}else if(r!=null&&Te(r)!=="object"&&typeof r!="function")throw new Nt("error",["Object","Error","Function","RegExp"],r);if(t===ln){var i="";r&&r.name&&(i+=" (".concat(r.name,")")),i+=n?": ".concat(n):".";var o=e.name==="rejects"?"rejection":"exception";Ne({actual:void 0,expected:r,operator:e.name,message:"Missing expected ".concat(o).concat(i),stackStartFn:e})}if(r&&!_s(t,r,n,e))throw t}function Os(e,t,r,n){if(t!==ln){if(typeof r=="string"&&(n=r,r=void 0),!r||_s(t,r)){var i=n?": ".concat(n):".",o=e.name==="doesNotReject"?"rejection":"exception";Ne({actual:t,expected:r,operator:e.name,message:"Got unwanted ".concat(o).concat(i,`
`)+'Actual message: "'.concat(t&&t.message,'"'),stackStartFn:e})}throw t}}ee.throws=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];Rs.apply(void 0,[e,Es(t)].concat(n))};ee.rejects=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return As(t).then(function(o){return Rs.apply(void 0,[e,o].concat(n))})};ee.doesNotThrow=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];Os.apply(void 0,[e,Es(t)].concat(n))};ee.doesNotReject=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return As(t).then(function(o){return Os.apply(void 0,[e,o].concat(n))})};ee.ifError=function e(t){if(t!=null){var r="ifError got unwanted exception: ";Te(t)==="object"&&typeof t.message=="string"?t.message.length===0&&t.constructor?r+=t.constructor.name:r+=t.message:r+=Dr(t);var n=new et({actual:t,expected:null,operator:"ifError",message:r,stackStartFn:e}),i=t.stack;if(typeof i=="string"){var o=i.split(`
`);o.shift();for(var a=n.stack.split(`
`),s=0;s<o.length;s++){var l=a.indexOf(o[s]);if(l!==-1){a=a.slice(0,l);break}}n.stack="".concat(a.join(`
`),`
`).concat(o.join(`
`))}throw n}};function Ps(e,t,r,n,i){if(!Yr(t))throw new Nt("regexp","RegExp",t);var o=i==="match";if(typeof e!="string"||Jr(t,e)!==o){if(r instanceof Error)throw r;var a=!r;r=r||(typeof e!="string"?'The "string" argument must be of type string. Received type '+"".concat(Te(e)," (").concat(Dr(e),")"):(o?"The input did not match the regular expression ":"The input was expected to not match the regular expression ")+"".concat(Dr(t),`. Input:

`).concat(Dr(e),`
`));var s=new et({actual:e,expected:t,message:r,operator:i,stackStartFn:n});throw s.generatedMessage=a,s}}ee.match=function e(t,r,n){Ps(t,r,n,e,"match")};ee.doesNotMatch=function e(t,r,n){Ps(t,r,n,e,"doesNotMatch")};function Ts(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Ss.apply(void 0,[Ts,t.length].concat(t))}ee.strict=gd(Ts,ee,{equal:ee.strictEqual,deepEqual:ee.deepStrictEqual,notEqual:ee.notStrictEqual,notDeepEqual:ee.notDeepStrictEqual});ee.strict.strict=ee.strict;var dr={exports:{}},At=typeof Reflect=="object"?Reflect:null,Vo=At&&typeof At.apply=="function"?At.apply:function(t,r,n){return Function.prototype.apply.call(t,r,n)},Ir;At&&typeof At.ownKeys=="function"?Ir=At.ownKeys:Object.getOwnPropertySymbols?Ir=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Ir=function(t){return Object.getOwnPropertyNames(t)};function md(e){console&&console.warn&&console.warn(e)}var js=Number.isNaN||function(t){return t!==t};function Z(){Z.init.call(this)}dr.exports=Z;dr.exports.once=kd;Z.EventEmitter=Z;Z.prototype._events=void 0;Z.prototype._eventsCount=0;Z.prototype._maxListeners=void 0;var Ko=10;function un(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(Z,"defaultMaxListeners",{enumerable:!0,get:function(){return Ko},set:function(e){if(typeof e!="number"||e<0||js(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Ko=e}});Z.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Z.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||js(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Cs(e){return e._maxListeners===void 0?Z.defaultMaxListeners:e._maxListeners}Z.prototype.getMaxListeners=function(){return Cs(this)};Z.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=t==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var a;if(r.length>0&&(a=r[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=o[t];if(l===void 0)return!1;if(typeof l=="function")Vo(l,this,r);else for(var u=l.length,c=xs(l,u),n=0;n<u;++n)Vo(c[n],this,r);return!0};function Ns(e,t,r,n){var i,o,a;if(un(r),o=e._events,o===void 0?(o=e._events=Object.create(null),e._eventsCount=0):(o.newListener!==void 0&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),a===void 0)a=o[t]=r,++e._eventsCount;else if(typeof a=="function"?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),i=Cs(e),i>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,md(s)}return e}Z.prototype.addListener=function(t,r){return Ns(this,t,r,!1)};Z.prototype.on=Z.prototype.addListener;Z.prototype.prependListener=function(t,r){return Ns(this,t,r,!0)};function bd(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ms(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=bd.bind(n);return i.listener=r,n.wrapFn=i,i}Z.prototype.once=function(t,r){return un(r),this.on(t,Ms(this,t,r)),this};Z.prototype.prependOnceListener=function(t,r){return un(r),this.prependListener(t,Ms(this,t,r)),this};Z.prototype.removeListener=function(t,r){var n,i,o,a,s;if(un(r),i=this._events,i===void 0)return this;if(n=i[t],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||r));else if(typeof n!="function"){for(o=-1,a=n.length-1;a>=0;a--)if(n[a]===r||n[a].listener===r){s=n[a].listener,o=a;break}if(o<0)return this;o===0?n.shift():wd(n,o),n.length===1&&(i[t]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",t,s||r)}return this};Z.prototype.off=Z.prototype.removeListener;Z.prototype.removeAllListeners=function(t){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var o=Object.keys(n),a;for(i=0;i<o.length;++i)a=o[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(t,r[i]);return this};function $s(e,t,r){var n=e._events;if(n===void 0)return[];var i=n[t];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?Sd(i):xs(i,i.length)}Z.prototype.listeners=function(t){return $s(this,t,!0)};Z.prototype.rawListeners=function(t){return $s(this,t,!1)};Z.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):qs.call(e,t)};Z.prototype.listenerCount=qs;function qs(e){var t=this._events;if(t!==void 0){var r=t[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Z.prototype.eventNames=function(){return this._eventsCount>0?Ir(this._events):[]};function xs(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function wd(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function Sd(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function kd(e,t){return new Promise(function(r,n){function i(a){e.removeListener(t,o),n(a)}function o(){typeof e.removeListener=="function"&&e.removeListener("error",i),r([].slice.call(arguments))}Ds(e,t,o,{once:!0}),t!=="error"&&_d(e,i,{once:!0})})}function _d(e,t,r){typeof e.on=="function"&&Ds(e,"error",t,r)}function Ds(e,t,r,n){if(typeof e.on=="function")n.once?e.once(t,r):e.on(t,r);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(o){n.once&&e.removeEventListener(t,i),r(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var Is=dr.exports.EventEmitter;function Qo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Yo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Qo(Object(r),!0).forEach(function(n){Ed(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ed(e,t,r){return t=Ls(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ad(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Jo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ls(n.key),n)}}function Rd(e,t,r){return t&&Jo(e.prototype,t),r&&Jo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ls(e){var t=Od(e,"string");return typeof t=="symbol"?t:String(t)}function Od(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Pd=rn,Lr=Pd.Buffer,Td=Ce,li=Td.inspect,jd=li&&li.custom||"inspect";function Cd(e,t,r){Lr.prototype.copy.call(e,t,r)}var Nd=function(){function e(){Ad(this,e),this.head=null,this.tail=null,this.length=0}return Rd(e,[{key:"push",value:function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length!==0){var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=r+n.data;return i}},{key:"concat",value:function(r){if(this.length===0)return Lr.alloc(0);for(var n=Lr.allocUnsafe(r>>>0),i=this.head,o=0;i;)Cd(i.data,n,o),o+=i.data.length,i=i.next;return n}},{key:"consume",value:function(r,n){var i;return r<this.head.data.length?(i=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?i=this.shift():i=n?this._getString(r):this._getBuffer(r),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var n=this.head,i=1,o=n.data;for(r-=o.length;n=n.next;){var a=n.data,s=r>a.length?a.length:r;if(s===a.length?o+=a:o+=a.slice(0,r),r-=s,r===0){s===a.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=a.slice(s));break}++i}return this.length-=i,o}},{key:"_getBuffer",value:function(r){var n=Lr.allocUnsafe(r),i=this.head,o=1;for(i.data.copy(n),r-=i.data.length;i=i.next;){var a=i.data,s=r>a.length?a.length:r;if(a.copy(n,n.length-r,0,s),r-=s,r===0){s===a.length?(++o,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=a.slice(s));break}++o}return this.length-=o,n}},{key:jd,value:function(r,n){return li(this,Yo(Yo({},n),{},{depth:0,customInspect:!1}))}}]),e}();function Md(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,$.process.nextTick(ui,this,e)):$.process.nextTick(ui,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(o){!t&&o?r._writableState?r._writableState.errorEmitted?$.process.nextTick(Fr,r):(r._writableState.errorEmitted=!0,$.process.nextTick(Xo,r,o)):$.process.nextTick(Xo,r,o):t?($.process.nextTick(Fr,r),t(o)):$.process.nextTick(Fr,r)}),this)}function Xo(e,t){ui(e,t),Fr(e)}function Fr(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function $d(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function ui(e,t){e.emit("error",t)}function qd(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}var Fs={destroy:Md,undestroy:$d,errorOrDestroy:qd},vt={};function xd(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Bs={};function Re(e,t,r){r||(r=Error);function n(o,a,s){return typeof t=="string"?t:t(o,a,s)}var i=function(o){xd(a,o);function a(s,l,u){return o.call(this,n(s,l,u))||this}return a}(r);i.prototype.name=r.name,i.prototype.code=e,Bs[e]=i}function Zo(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(n){return String(n)}),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:r===2?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}else return"of ".concat(t," ").concat(String(e))}function Dd(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function Id(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function Ld(e,t,r){return typeof r!="number"&&(r=0),r+t.length>e.length?!1:e.indexOf(t,r)!==-1}Re("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError);Re("ERR_INVALID_ARG_TYPE",function(e,t,r){var n;typeof t=="string"&&Dd(t,"not ")?(n="must not be",t=t.replace(/^not /,"")):n="must be";var i;if(Id(e," argument"))i="The ".concat(e," ").concat(n," ").concat(Zo(t,"type"));else{var o=Ld(e,".")?"property":"argument";i='The "'.concat(e,'" ').concat(o," ").concat(n," ").concat(Zo(t,"type"))}return i+=". Received type ".concat(typeof r),i},TypeError);Re("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");Re("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"});Re("ERR_STREAM_PREMATURE_CLOSE","Premature close");Re("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"});Re("ERR_MULTIPLE_CALLBACK","Callback called multiple times");Re("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");Re("ERR_STREAM_WRITE_AFTER_END","write after end");Re("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);Re("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError);Re("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");vt.codes=Bs;var Fd=vt.codes.ERR_INVALID_OPT_VALUE;function Bd(e,t,r){return e.highWaterMark!=null?e.highWaterMark:t?e[r]:null}function zd(e,t,r,n){var i=Bd(t,n,r);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var o=n?r:"highWaterMark";throw new Fd(o,i)}return Math.floor(i)}return e.objectMode?16:16*1024}var zs={getHighWaterMark:zd},Ud=Wd;function Wd(e,t){if(Cn("noDeprecation"))return e;var r=!1;function n(){if(!r){if(Cn("throwDeprecation"))throw new Error(t);Cn("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}return n}function Cn(e){try{if(!Qe.localStorage)return!1}catch{return!1}var t=Qe.localStorage[e];return t==null?!1:String(t).toLowerCase()==="true"}var Us=ie;function Ws(e){var t=this;this.next=null,this.entry=null,this.finish=function(){yh(t,e)}}var Rt;ie.WritableState=hr;var Hd={deprecate:Ud},Hs=Is,cn=rn.Buffer,Gd=(typeof Qe!="undefined"?Qe:typeof window!="undefined"?window:typeof self!="undefined"?self:{}).Uint8Array||function(){};function Vd(e){return cn.from(e)}function Kd(e){return cn.isBuffer(e)||e instanceof Gd}var qi=Fs,Qd=zs,Yd=Qd.getHighWaterMark,tt=vt.codes,Jd=tt.ERR_INVALID_ARG_TYPE,Xd=tt.ERR_METHOD_NOT_IMPLEMENTED,Zd=tt.ERR_MULTIPLE_CALLBACK,eh=tt.ERR_STREAM_CANNOT_PIPE,th=tt.ERR_STREAM_DESTROYED,rh=tt.ERR_STREAM_NULL_VALUES,nh=tt.ERR_STREAM_WRITE_AFTER_END,ih=tt.ERR_UNKNOWN_ENCODING,Mt=qi.errorOrDestroy;Fe.exports(ie,Hs);function oh(){}function hr(e,t,r){Rt=Rt||Dt,e=e||{},typeof r!="boolean"&&(r=t instanceof Rt),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=Yd(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=e.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(i){dh(t,i)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new Ws(this)}hr.prototype.getBuffer=function(){for(var t=this.bufferedRequest,r=[];t;)r.push(t),t=t.next;return r};(function(){try{Object.defineProperty(hr.prototype,"buffer",{get:Hd.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var Br;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Br=Function.prototype[Symbol.hasInstance],Object.defineProperty(ie,Symbol.hasInstance,{value:function(t){return Br.call(this,t)?!0:this!==ie?!1:t&&t._writableState instanceof hr}})):Br=function(t){return t instanceof this};function ie(e){Rt=Rt||Dt;var t=this instanceof Rt;if(!t&&!Br.call(ie,this))return new ie(e);this._writableState=new hr(e,this,t),this.writable=!0,e&&(typeof e.write=="function"&&(this._write=e.write),typeof e.writev=="function"&&(this._writev=e.writev),typeof e.destroy=="function"&&(this._destroy=e.destroy),typeof e.final=="function"&&(this._final=e.final)),Hs.call(this)}ie.prototype.pipe=function(){Mt(this,new eh)};function ah(e,t){var r=new nh;Mt(e,r),$.process.nextTick(t,r)}function sh(e,t,r,n){var i;return r===null?i=new rh:typeof r!="string"&&!t.objectMode&&(i=new Jd("chunk",["string","Buffer"],r)),i?(Mt(e,i),$.process.nextTick(n,i),!1):!0}ie.prototype.write=function(e,t,r){var n=this._writableState,i=!1,o=!n.objectMode&&Kd(e);return o&&!cn.isBuffer(e)&&(e=Vd(e)),typeof t=="function"&&(r=t,t=null),o?t="buffer":t||(t=n.defaultEncoding),typeof r!="function"&&(r=oh),n.ending?ah(this,r):(o||sh(this,n,e,r))&&(n.pendingcb++,i=uh(this,n,o,e,t,r)),i};ie.prototype.cork=function(){this._writableState.corked++};ie.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.bufferProcessing&&e.bufferedRequest&&Gs(this,e))};ie.prototype.setDefaultEncoding=function(t){if(typeof t=="string"&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new ih(t);return this._writableState.defaultEncoding=t,this};Object.defineProperty(ie.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function lh(e,t,r){return!e.objectMode&&e.decodeStrings!==!1&&typeof t=="string"&&(t=cn.from(t,r)),t}Object.defineProperty(ie.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function uh(e,t,r,n,i,o){if(!r){var a=lh(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var s=t.objectMode?1:n.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else ci(e,t,!1,s,n,i,o);return l}function ci(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new th("write")):r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function ch(e,t,r,n,i){--t.pendingcb,r?($.process.nextTick(i,n),$.process.nextTick(tr,e,t),e._writableState.errorEmitted=!0,Mt(e,n)):(i(n),e._writableState.errorEmitted=!0,Mt(e,n),tr(e,t))}function fh(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function dh(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(typeof i!="function")throw new Zd;if(fh(r),t)ch(e,r,n,t,i);else{var o=Vs(r)||e.destroyed;!o&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&Gs(e,r),n?$.process.nextTick(ea,e,r,o,i):ea(e,r,o,i)}}function ea(e,t,r,n){r||hh(e,t),t.pendingcb--,n(),tr(e,t)}function hh(e,t){t.length===0&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function Gs(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var a=0,s=!0;r;)i[a]=r,r.isBuf||(s=!1),r=r.next,a+=1;i.allBuffers=s,ci(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new Ws(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,u=r.encoding,c=r.callback,f=t.objectMode?1:l.length;if(ci(e,t,!1,f,l,u,c),r=r.next,t.bufferedRequestCount--,t.writing)break}r===null&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}ie.prototype._write=function(e,t,r){r(new Xd("_write()"))};ie.prototype._writev=null;ie.prototype.end=function(e,t,r){var n=this._writableState;return typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"&&(r=t,t=null),e!=null&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||gh(this,n,r),this};Object.defineProperty(ie.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Vs(e){return e.ending&&e.length===0&&e.bufferedRequest===null&&!e.finished&&!e.writing}function ph(e,t){e._final(function(r){t.pendingcb--,r&&Mt(e,r),t.prefinished=!0,e.emit("prefinish"),tr(e,t)})}function vh(e,t){!t.prefinished&&!t.finalCalled&&(typeof e._final=="function"&&!t.destroyed?(t.pendingcb++,t.finalCalled=!0,$.process.nextTick(ph,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function tr(e,t){var r=Vs(t);if(r&&(vh(e,t),t.pendingcb===0&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}function gh(e,t,r){t.ending=!0,tr(e,t),r&&(t.finished?$.process.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function yh(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}Object.defineProperty(ie.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(t){!this._writableState||(this._writableState.destroyed=t)}});ie.prototype.destroy=qi.destroy;ie.prototype._undestroy=qi.undestroy;ie.prototype._destroy=function(e,t){t(e)};var mh=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},Dt=xe,Ks=Ys,fi=Us;Fe.exports(xe,Ks);for(var ta=mh(fi.prototype),Nn=0;Nn<ta.length;Nn++){var Mn=ta[Nn];xe.prototype[Mn]||(xe.prototype[Mn]=fi.prototype[Mn])}function xe(e){if(!(this instanceof xe))return new xe(e);Ks.call(this,e),fi.call(this,e),this.allowHalfOpen=!0,e&&(e.readable===!1&&(this.readable=!1),e.writable===!1&&(this.writable=!1),e.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",bh)))}Object.defineProperty(xe.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(xe.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(xe.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function bh(){this._writableState.ended||$.process.nextTick(wh,this)}function wh(e){e.end()}Object.defineProperty(xe.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(t){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=t,this._writableState.destroyed=t)}});var xi={},di={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(e,t){var r=rn,n=r.Buffer;function i(a,s){for(var l in a)s[l]=a[l]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=o);function o(a,s,l){return n(a,s,l)}o.prototype=Object.create(n.prototype),i(n,o),o.from=function(a,s,l){if(typeof a=="number")throw new TypeError("Argument must not be a number");return n(a,s,l)},o.alloc=function(a,s,l){if(typeof a!="number")throw new TypeError("Argument must be a number");var u=n(a);return s!==void 0?typeof l=="string"?u.fill(s,l):u.fill(s):u.fill(0),u},o.allocUnsafe=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return n(a)},o.allocUnsafeSlow=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return r.SlowBuffer(a)}})(di,di.exports);var Di=di.exports.Buffer,ra=Di.isEncoding||function(e){switch(e=""+e,e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Sh(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function kh(e){var t=Sh(e);if(typeof t!="string"&&(Di.isEncoding===ra||!ra(e)))throw new Error("Unknown encoding: "+e);return t||e}xi.StringDecoder=pr;function pr(e){this.encoding=kh(e);var t;switch(this.encoding){case"utf16le":this.text=Ph,this.end=Th,t=4;break;case"utf8":this.fillLast=Ah,t=4;break;case"base64":this.text=jh,this.end=Ch,t=3;break;default:this.write=Nh,this.end=Mh;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Di.allocUnsafe(t)}pr.prototype.write=function(e){if(e.length===0)return"";var t,r;if(this.lastNeed){if(t=this.fillLast(e),t===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""};pr.prototype.end=Oh;pr.prototype.text=Rh;pr.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length};function $n(e){return e<=127?0:e>>5===6?2:e>>4===14?3:e>>3===30?4:e>>6===2?-1:-2}function _h(e,t,r){var n=t.length-1;if(n<r)return 0;var i=$n(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||i===-2?0:(i=$n(t[n]),i>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||i===-2?0:(i=$n(t[n]),i>=0?(i>0&&(i===2?i=0:e.lastNeed=i-3),i):0))}function Eh(e,t,r){if((t[0]&192)!==128)return e.lastNeed=0,"\uFFFD";if(e.lastNeed>1&&t.length>1){if((t[1]&192)!==128)return e.lastNeed=1,"\uFFFD";if(e.lastNeed>2&&t.length>2&&(t[2]&192)!==128)return e.lastNeed=2,"\uFFFD"}}function Ah(e){var t=this.lastTotal-this.lastNeed,r=Eh(this,e);if(r!==void 0)return r;if(this.lastNeed<=e.length)return e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length}function Rh(e,t){var r=_h(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function Oh(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\uFFFD":t}function Ph(e,t){if((e.length-t)%2===0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function Th(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function jh(e,t){var r=(e.length-t)%3;return r===0?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function Ch(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function Nh(e){return e.toString(this.encoding)}function Mh(e){return e&&e.length?this.write(e):""}var na=vt.codes.ERR_STREAM_PREMATURE_CLOSE;function $h(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}function qh(){}function xh(e){return e.setHeader&&typeof e.abort=="function"}function Qs(e,t,r){if(typeof t=="function")return Qs(e,null,t);t||(t={}),r=$h(r||qh);var n=t.readable||t.readable!==!1&&e.readable,i=t.writable||t.writable!==!1&&e.writable,o=function(){e.writable||s()},a=e._writableState&&e._writableState.finished,s=function(){i=!1,a=!0,n||r.call(e)},l=e._readableState&&e._readableState.endEmitted,u=function(){n=!1,l=!0,i||r.call(e)},c=function(v){r.call(e,v)},f=function(){var v;if(n&&!l)return(!e._readableState||!e._readableState.ended)&&(v=new na),r.call(e,v);if(i&&!a)return(!e._writableState||!e._writableState.ended)&&(v=new na),r.call(e,v)},p=function(){e.req.on("finish",s)};return xh(e)?(e.on("complete",s),e.on("abort",f),e.req?p():e.on("request",p)):i&&!e._writableState&&(e.on("end",o),e.on("close",o)),e.on("end",u),e.on("finish",s),t.error!==!1&&e.on("error",c),e.on("close",f),function(){e.removeListener("complete",s),e.removeListener("abort",f),e.removeListener("request",p),e.req&&e.req.removeListener("finish",s),e.removeListener("end",o),e.removeListener("close",o),e.removeListener("finish",s),e.removeListener("end",u),e.removeListener("error",c),e.removeListener("close",f)}}var Ii=Qs,Ar;function Ue(e,t,r){return t=Dh(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dh(e){var t=Ih(e,"string");return typeof t=="symbol"?t:String(t)}function Ih(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Lh=Ii,We=Symbol("lastResolve"),rt=Symbol("lastReject"),Vt=Symbol("error"),Xr=Symbol("ended"),it=Symbol("lastPromise"),Li=Symbol("handlePromise"),ot=Symbol("stream");function Ge(e,t){return{value:e,done:t}}function Fh(e){var t=e[We];if(t!==null){var r=e[ot].read();r!==null&&(e[it]=null,e[We]=null,e[rt]=null,t(Ge(r,!1)))}}function Bh(e){$.process.nextTick(Fh,e)}function zh(e,t){return function(r,n){e.then(function(){if(t[Xr]){r(Ge(void 0,!0));return}t[Li](r,n)},n)}}var Uh=Object.getPrototypeOf(function(){}),Wh=Object.setPrototypeOf((Ar={get stream(){return this[ot]},next:function(){var t=this,r=this[Vt];if(r!==null)return Promise.reject(r);if(this[Xr])return Promise.resolve(Ge(void 0,!0));if(this[ot].destroyed)return new Promise(function(a,s){$.process.nextTick(function(){t[Vt]?s(t[Vt]):a(Ge(void 0,!0))})});var n=this[it],i;if(n)i=new Promise(zh(n,this));else{var o=this[ot].read();if(o!==null)return Promise.resolve(Ge(o,!1));i=new Promise(this[Li])}return this[it]=i,i}},Ue(Ar,Symbol.asyncIterator,function(){return this}),Ue(Ar,"return",function(){var t=this;return new Promise(function(r,n){t[ot].destroy(null,function(i){if(i){n(i);return}r(Ge(void 0,!0))})})}),Ar),Uh),Hh=function(t){var r,n=Object.create(Wh,(r={},Ue(r,ot,{value:t,writable:!0}),Ue(r,We,{value:null,writable:!0}),Ue(r,rt,{value:null,writable:!0}),Ue(r,Vt,{value:null,writable:!0}),Ue(r,Xr,{value:t._readableState.endEmitted,writable:!0}),Ue(r,Li,{value:function(o,a){var s=n[ot].read();s?(n[it]=null,n[We]=null,n[rt]=null,o(Ge(s,!1))):(n[We]=o,n[rt]=a)},writable:!0}),r));return n[it]=null,Lh(t,function(i){if(i&&i.code!=="ERR_STREAM_PREMATURE_CLOSE"){var o=n[rt];o!==null&&(n[it]=null,n[We]=null,n[rt]=null,o(i)),n[Vt]=i;return}var a=n[We];a!==null&&(n[it]=null,n[We]=null,n[rt]=null,a(Ge(void 0,!0))),n[Xr]=!0}),t.on("readable",Bh.bind(null,n)),n},Gh=Hh,Vh=function(){throw new Error("Readable.from is not available in the browser")},Ys=V,Ot;V.ReadableState=Xs;dr.exports.EventEmitter;var Js=function(t,r){return t.listeners(r).length},vr=Is,fn=rn.Buffer,Kh=(typeof Qe!="undefined"?Qe:typeof window!="undefined"?window:typeof self!="undefined"?self:{}).Uint8Array||function(){};function Qh(e){return fn.from(e)}function Yh(e){return fn.isBuffer(e)||e instanceof Kh}var qn=Ce,z;qn&&qn.debuglog?z=qn.debuglog("stream"):z=function(){};var Jh=Nd,Fi=Fs,Xh=zs,Zh=Xh.getHighWaterMark,dn=vt.codes,ep=dn.ERR_INVALID_ARG_TYPE,tp=dn.ERR_STREAM_PUSH_AFTER_EOF,rp=dn.ERR_METHOD_NOT_IMPLEMENTED,np=dn.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,Pt,xn,Dn;Fe.exports(V,vr);var Kt=Fi.errorOrDestroy,In=["error","close","destroy","pause","resume"];function ip(e,t,r){if(typeof e.prependListener=="function")return e.prependListener(t,r);!e._events||!e._events[t]?e.on(t,r):Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]}function Xs(e,t,r){Ot=Ot||Dt,e=e||{},typeof r!="boolean"&&(r=t instanceof Ot),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=Zh(this,e,"readableHighWaterMark",r),this.buffer=new Jh,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(Pt||(Pt=xi.StringDecoder),this.decoder=new Pt(e.encoding),this.encoding=e.encoding)}function V(e){if(Ot=Ot||Dt,!(this instanceof V))return new V(e);var t=this instanceof Ot;this._readableState=new Xs(e,this,t),this.readable=!0,e&&(typeof e.read=="function"&&(this._read=e.read),typeof e.destroy=="function"&&(this._destroy=e.destroy)),vr.call(this)}Object.defineProperty(V.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(t){!this._readableState||(this._readableState.destroyed=t)}});V.prototype.destroy=Fi.destroy;V.prototype._undestroy=Fi.undestroy;V.prototype._destroy=function(e,t){t(e)};V.prototype.push=function(e,t){var r=this._readableState,n;return r.objectMode?n=!0:typeof e=="string"&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=fn.from(e,t),t=""),n=!0),Zs(this,e,t,!1,n)};V.prototype.unshift=function(e){return Zs(this,e,null,!0,!1)};function Zs(e,t,r,n,i){z("readableAddChunk",t);var o=e._readableState;if(t===null)o.reading=!1,sp(e,o);else{var a;if(i||(a=op(o,t)),a)Kt(e,a);else if(o.objectMode||t&&t.length>0)if(typeof t!="string"&&!o.objectMode&&Object.getPrototypeOf(t)!==fn.prototype&&(t=Qh(t)),n)o.endEmitted?Kt(e,new np):Ln(e,o,t,!0);else if(o.ended)Kt(e,new tp);else{if(o.destroyed)return!1;o.reading=!1,o.decoder&&!r?(t=o.decoder.write(t),o.objectMode||t.length!==0?Ln(e,o,t,!1):hi(e,o)):Ln(e,o,t,!1)}else n||(o.reading=!1,hi(e,o))}return!o.ended&&(o.length<o.highWaterMark||o.length===0)}function Ln(e,t,r,n){t.flowing&&t.length===0&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&hn(e)),hi(e,t)}function op(e,t){var r;return!Yh(t)&&typeof t!="string"&&t!==void 0&&!e.objectMode&&(r=new ep("chunk",["string","Buffer","Uint8Array"],t)),r}V.prototype.isPaused=function(){return this._readableState.flowing===!1};V.prototype.setEncoding=function(e){Pt||(Pt=xi.StringDecoder);var t=new Pt(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";r!==null;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var ia=1073741824;function ap(e){return e>=ia?e=ia:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function oa(e,t){return e<=0||t.length===0&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=ap(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}V.prototype.read=function(e){z("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(e!==0&&(t.emittedReadable=!1),e===0&&t.needReadable&&((t.highWaterMark!==0?t.length>=t.highWaterMark:t.length>0)||t.ended))return z("read: emitReadable",t.length,t.ended),t.length===0&&t.ended?Fn(this):hn(this),null;if(e=oa(e,t),e===0&&t.ended)return t.length===0&&Fn(this),null;var n=t.needReadable;z("need readable",n),(t.length===0||t.length-e<t.highWaterMark)&&(n=!0,z("length less than watermark",n)),t.ended||t.reading?(n=!1,z("reading or ended",n)):n&&(z("do read"),t.reading=!0,t.sync=!0,t.length===0&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=oa(r,t)));var i;return e>0?i=rl(e,t):i=null,i===null?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),t.length===0&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&Fn(this)),i!==null&&this.emit("data",i),i};function sp(e,t){if(z("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?hn(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,el(e)))}}function hn(e){var t=e._readableState;z("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(z("emitReadable",t.flowing),t.emittedReadable=!0,$.process.nextTick(el,e))}function el(e){var t=e._readableState;z("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,Bi(e)}function hi(e,t){t.readingMore||(t.readingMore=!0,$.process.nextTick(lp,e,t))}function lp(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&t.length===0);){var r=t.length;if(z("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}V.prototype._read=function(e){Kt(this,new rp("_read()"))};V.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e);break}n.pipesCount+=1,z("pipe count=%d opts=%j",n.pipesCount,t);var i=(!t||t.end!==!1)&&e!==$.process.stdout&&e!==$.process.stderr,o=i?s:b;n.endEmitted?$.process.nextTick(o):r.once("end",o),e.on("unpipe",a);function a(E,P){z("onunpipe"),E===r&&P&&P.hasUnpiped===!1&&(P.hasUnpiped=!0,c())}function s(){z("onend"),e.end()}var l=up(r);e.on("drain",l);var u=!1;function c(){z("cleanup"),e.removeListener("close",h),e.removeListener("finish",v),e.removeListener("drain",l),e.removeListener("error",p),e.removeListener("unpipe",a),r.removeListener("end",s),r.removeListener("end",b),r.removeListener("data",f),u=!0,n.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&l()}r.on("data",f);function f(E){z("ondata");var P=e.write(E);z("dest.write",P),P===!1&&((n.pipesCount===1&&n.pipes===e||n.pipesCount>1&&nl(n.pipes,e)!==-1)&&!u&&(z("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function p(E){z("onerror",E),b(),e.removeListener("error",p),Js(e,"error")===0&&Kt(e,E)}ip(e,"error",p);function h(){e.removeListener("finish",v),b()}e.once("close",h);function v(){z("onfinish"),e.removeListener("close",h),b()}e.once("finish",v);function b(){z("unpipe"),r.unpipe(e)}return e.emit("pipe",r),n.flowing||(z("pipe resume"),r.resume()),e};function up(e){return function(){var r=e._readableState;z("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&Js(e,"data")&&(r.flowing=!0,Bi(e))}}V.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(t.pipesCount===0)return this;if(t.pipesCount===1)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,{hasUnpiped:!1});return this}var a=nl(t.pipes,e);return a===-1?this:(t.pipes.splice(a,1),t.pipesCount-=1,t.pipesCount===1&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)};V.prototype.on=function(e,t){var r=vr.prototype.on.call(this,e,t),n=this._readableState;return e==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):e==="readable"&&!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,z("on readable",n.length,n.reading),n.length?hn(this):n.reading||$.process.nextTick(cp,this)),r};V.prototype.addListener=V.prototype.on;V.prototype.removeListener=function(e,t){var r=vr.prototype.removeListener.call(this,e,t);return e==="readable"&&$.process.nextTick(tl,this),r};V.prototype.removeAllListeners=function(e){var t=vr.prototype.removeAllListeners.apply(this,arguments);return(e==="readable"||e===void 0)&&$.process.nextTick(tl,this),t};function tl(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function cp(e){z("readable nexttick read 0"),e.read(0)}V.prototype.resume=function(){var e=this._readableState;return e.flowing||(z("resume"),e.flowing=!e.readableListening,fp(this,e)),e.paused=!1,this};function fp(e,t){t.resumeScheduled||(t.resumeScheduled=!0,$.process.nextTick(dp,e,t))}function dp(e,t){z("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),Bi(e),t.flowing&&!t.reading&&e.read(0)}V.prototype.pause=function(){return z("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(z("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Bi(e){var t=e._readableState;for(z("flow",t.flowing);t.flowing&&e.read()!==null;);}V.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;e.on("end",function(){if(z("wrapped end"),r.decoder&&!r.ended){var a=r.decoder.end();a&&a.length&&t.push(a)}t.push(null)}),e.on("data",function(a){if(z("wrapped data"),r.decoder&&(a=r.decoder.write(a)),!(r.objectMode&&a==null)&&!(!r.objectMode&&(!a||!a.length))){var s=t.push(a);s||(n=!0,e.pause())}});for(var i in e)this[i]===void 0&&typeof e[i]=="function"&&(this[i]=function(s){return function(){return e[s].apply(e,arguments)}}(i));for(var o=0;o<In.length;o++)e.on(In[o],this.emit.bind(this,In[o]));return this._read=function(a){z("wrapped _read",a),n&&(n=!1,e.resume())},this};typeof Symbol=="function"&&(V.prototype[Symbol.asyncIterator]=function(){return xn===void 0&&(xn=Gh),xn(this)});Object.defineProperty(V.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(V.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(V.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}});V._fromList=rl;Object.defineProperty(V.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function rl(e,t){if(t.length===0)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(t.decoder?r=t.buffer.join(""):t.buffer.length===1?r=t.buffer.first():r=t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r}function Fn(e){var t=e._readableState;z("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,$.process.nextTick(hp,t,e))}function hp(e,t){if(z("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&e.length===0&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}typeof Symbol=="function"&&(V.from=function(e,t){return Dn===void 0&&(Dn=Vh),Dn(V,e,t)});function nl(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}var il=Be,pn=vt.codes,pp=pn.ERR_METHOD_NOT_IMPLEMENTED,vp=pn.ERR_MULTIPLE_CALLBACK,gp=pn.ERR_TRANSFORM_ALREADY_TRANSFORMING,yp=pn.ERR_TRANSFORM_WITH_LENGTH_0,vn=Dt;Fe.exports(Be,vn);function mp(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new vp);r.writechunk=null,r.writecb=null,t!=null&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Be(e){if(!(this instanceof Be))return new Be(e);vn.call(this,e),this._transformState={afterTransform:mp.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",bp)}function bp(){var e=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(t,r){aa(e,t,r)}):aa(this,null,null)}Be.prototype.push=function(e,t){return this._transformState.needTransform=!1,vn.prototype.push.call(this,e,t)};Be.prototype._transform=function(e,t,r){r(new pp("_transform()"))};Be.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};Be.prototype._read=function(e){var t=this._transformState;t.writechunk!==null&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0};Be.prototype._destroy=function(e,t){vn.prototype._destroy.call(this,e,function(r){t(r)})};function aa(e,t,r){if(t)return e.emit("error",t);if(r!=null&&e.push(r),e._writableState.length)throw new yp;if(e._transformState.transforming)throw new gp;return e.push(null)}var wp=rr,ol=il;Fe.exports(rr,ol);function rr(e){if(!(this instanceof rr))return new rr(e);ol.call(this,e)}rr.prototype._transform=function(e,t,r){r(null,e)};var Bn;function Sp(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}var al=vt.codes,kp=al.ERR_MISSING_ARGS,_p=al.ERR_STREAM_DESTROYED;function sa(e){if(e)throw e}function Ep(e){return e.setHeader&&typeof e.abort=="function"}function Ap(e,t,r,n){n=Sp(n);var i=!1;e.on("close",function(){i=!0}),Bn===void 0&&(Bn=Ii),Bn(e,{readable:t,writable:r},function(a){if(a)return n(a);i=!0,n()});var o=!1;return function(a){if(!i&&!o){if(o=!0,Ep(e))return e.abort();if(typeof e.destroy=="function")return e.destroy();n(a||new _p("pipe"))}}}function la(e){e()}function Rp(e,t){return e.pipe(t)}function Op(e){return!e.length||typeof e[e.length-1]!="function"?sa:e.pop()}function Pp(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=Op(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new kp("streams");var i,o=t.map(function(a,s){var l=s<t.length-1,u=s>0;return Ap(a,l,u,function(c){i||(i=c),c&&o.forEach(la),!l&&(o.forEach(la),n(i))})});return t.reduce(Rp)}var Tp=Pp,jp=Ae,zi=dr.exports.EventEmitter,Cp=Fe.exports;Cp(Ae,zi);Ae.Readable=Ys;Ae.Writable=Us;Ae.Duplex=Dt;Ae.Transform=il;Ae.PassThrough=wp;Ae.finished=Ii;Ae.pipeline=Tp;Ae.Stream=Ae;function Ae(){zi.call(this)}Ae.prototype.pipe=function(e,t){var r=this;function n(c){e.writable&&e.write(c)===!1&&r.pause&&r.pause()}r.on("data",n);function i(){r.readable&&r.resume&&r.resume()}e.on("drain",i),!e._isStdio&&(!t||t.end!==!1)&&(r.on("end",a),r.on("close",s));var o=!1;function a(){o||(o=!0,e.end())}function s(){o||(o=!0,typeof e.destroy=="function"&&e.destroy())}function l(c){if(u(),zi.listenerCount(this,"error")===0)throw c}r.on("error",l),e.on("error",l);function u(){r.removeListener("data",n),e.removeListener("drain",i),r.removeListener("end",a),r.removeListener("close",s),r.removeListener("error",l),e.removeListener("error",l),r.removeListener("end",u),r.removeListener("close",u),e.removeListener("close",u)}return r.on("end",u),r.on("close",u),e.on("close",u),e.emit("pipe",r),e};var zr=or.exports,Np=jp.Stream,Mp=Ce,$p=/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/;function zn(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ze(e,t,r,n,i){throw new zr.AssertionError({message:Mp.format("%s (%s) is required",e,t),actual:i===void 0?typeof n:i(n),expected:t,operator:r||"===",stackStartFunction:ze.caller})}function Un(e){return Object.prototype.toString.call(e).slice(8,-1)}function bt(){}var Ft={bool:{check:function(e){return typeof e=="boolean"}},func:{check:function(e){return typeof e=="function"}},string:{check:function(e){return typeof e=="string"}},object:{check:function(e){return typeof e=="object"&&e!==null}},number:{check:function(e){return typeof e=="number"&&!isNaN(e)}},finite:{check:function(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}},buffer:{check:function(e){return $.Buffer.isBuffer(e)},operator:"Buffer.isBuffer"},array:{check:function(e){return Array.isArray(e)},operator:"Array.isArray"},stream:{check:function(e){return e instanceof Np},operator:"instanceof",actual:Un},date:{check:function(e){return e instanceof Date},operator:"instanceof",actual:Un},regexp:{check:function(e){return e instanceof RegExp},operator:"instanceof",actual:Un},uuid:{check:function(e){return typeof e=="string"&&$p.test(e)},operator:"isUUID"}};function sl(e){var t=Object.keys(Ft),r;return{}.NODE_NDEBUG?r=bt:r=function(n,i){n||ze(i,"true",n)},t.forEach(function(n){if(e){r[n]=bt;return}var i=Ft[n];r[n]=function(o,a){i.check(o)||ze(a,n,i.operator,o,i.actual)}}),t.forEach(function(n){var i="optional"+zn(n);if(e){r[i]=bt;return}var o=Ft[n];r[i]=function(a,s){a!=null&&(o.check(a)||ze(s,n,o.operator,a,o.actual))}}),t.forEach(function(n){var i="arrayOf"+zn(n);if(e){r[i]=bt;return}var o=Ft[n],a="["+n+"]";r[i]=function(s,l){Array.isArray(s)||ze(l,a,o.operator,s,o.actual);var u;for(u=0;u<s.length;u++)o.check(s[u])||ze(l,a,o.operator,s,o.actual)}}),t.forEach(function(n){var i="optionalArrayOf"+zn(n);if(e){r[i]=bt;return}var o=Ft[n],a="["+n+"]";r[i]=function(s,l){if(s!=null){Array.isArray(s)||ze(l,a,o.operator,s,o.actual);var u;for(u=0;u<s.length;u++)o.check(s[u])||ze(l,a,o.operator,s,o.actual)}}}),Object.keys(zr).forEach(function(n){if(n==="AssertionError"){r[n]=zr[n];return}if(e){r[n]=bt;return}r[n]=zr[n]}),r._setExports=sl,r}var qp=sl({}.NODE_NDEBUG),gn={},Ut=or.exports,xp=Ce;gn.sprintf=Ui;gn.printf=Dp;gn.fprintf=ll;function Ui(e){var t=["([^%]*)","%","(['\\-+ #0]*?)","([1-9]\\d*)?","(\\.([1-9]\\d*))?","[lhjztL]*?","([diouxXfFeEgGaAcCsSp%jr])"].join(""),r=new RegExp(t),n=Array.prototype.slice.call(arguments,1),i=e,o,a,s,l,u,c,f,p,h,v="",b=1,E=0,P,M;for(Ut.equal("string",typeof i,"first argument must be a format string");(h=r.exec(i))!==null;){if(v+=h[1],i=i.substring(h[0].length),M=h[0].substring(h[1].length),P=E+h[1].length+1,E+=h[0].length,o=h[2]||"",a=h[3]||0,s=h[4]||"",l=h[6],u=!1,f=!1,c=" ",l=="%"){v+="%";continue}if(n.length===0)throw Bt(e,P,M,"has no matching argument (too few arguments passed)");if(p=n.shift(),b++,o.match(/[\' #]/))throw Bt(e,P,M,"uses unsupported flags");if(s.length>0)throw Bt(e,P,M,"uses non-zero precision (not supported)");switch(o.match(/-/)&&(u=!0),o.match(/0/)&&(c="0"),o.match(/\+/)&&(f=!0),l){case"s":if(p==null)throw Bt(e,P,M,"attempted to print undefined or null as a string (argument "+b+" to sprintf)");v+=Wn(c,a,u,p.toString());break;case"d":p=Math.floor(p);case"f":f=f&&p>0?"+":"",v+=f+Wn(c,a,u,p.toString());break;case"x":v+=Wn(c,a,u,p.toString(16));break;case"j":a===0&&(a=10),v+=xp.inspect(p,!1,a);break;case"r":v+=ul(p);break;default:throw Bt(e,P,M,"is not supported")}}return v+=i,v}function Bt(e,t,r,n){return Ut.equal(typeof e,"string"),Ut.equal(typeof r,"string"),Ut.equal(typeof t,"number"),Ut.equal(typeof n,"string"),new Error('format string "'+e+'": conversion specifier "'+r+'" at character '+t+" "+n)}function Dp(){var e=Array.prototype.slice.call(arguments);e.unshift($.process.stdout),ll.apply(null,e)}function ll(e){var t=Array.prototype.slice.call(arguments,1);return e.write(Ui.apply(this,t))}function Wn(e,t,r,n){for(var i=n;i.length<t;)r?i+=e:i=e+i;return i}function ul(e){var t;if(!(e instanceof Error))throw new Error(Ui("invalid type for %%r: %j",e));if(t="EXCEPTION: "+e.constructor.name+": "+e.stack,e.cause&&typeof e.cause=="function"){var r=e.cause();r&&(t+=`
Caused by: `+ul(r))}return t}var ye={};function Ip(e){return Array.isArray?Array.isArray(e):yn(e)==="[object Array]"}ye.isArray=Ip;function Lp(e){return typeof e=="boolean"}ye.isBoolean=Lp;function Fp(e){return e===null}ye.isNull=Fp;function Bp(e){return e==null}ye.isNullOrUndefined=Bp;function zp(e){return typeof e=="number"}ye.isNumber=zp;function Up(e){return typeof e=="string"}ye.isString=Up;function Wp(e){return typeof e=="symbol"}ye.isSymbol=Wp;function Hp(e){return e===void 0}ye.isUndefined=Hp;function Gp(e){return yn(e)==="[object RegExp]"}ye.isRegExp=Gp;function Vp(e){return typeof e=="object"&&e!==null}ye.isObject=Vp;function Kp(e){return yn(e)==="[object Date]"}ye.isDate=Kp;function Qp(e){return yn(e)==="[object Error]"||e instanceof Error}ye.isError=Qp;function Yp(e){return typeof e=="function"}ye.isFunction=Yp;function Jp(e){return e===null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||typeof e=="symbol"||typeof e=="undefined"}ye.isPrimitive=Jp;ye.isBuffer=$.Buffer.isBuffer;function yn(e){return Object.prototype.toString.call(e)}var ue=qp,mn=Ce,Xp=gn,je=ye.isError,Zp=Xp.sprintf,ae=G;G.VError=G;G.SError=Qt;G.WError=Ke;G.MultiError=It;function Wi(e){var t,r,n,i,o;if(ue.object(e,"args"),ue.bool(e.strict,"args.strict"),ue.array(e.argv,"args.argv"),t=e.argv,t.length===0)r={},n=[];else if(je(t[0]))r={cause:t[0]},n=t.slice(1);else if(typeof t[0]=="object"){r={};for(o in t[0])r[o]=t[0][o];n=t.slice(1)}else ue.string(t[0],"first argument to VError, SError, or WError constructor must be a string, object, or Error"),r={},n=t;return ue.object(r),!r.strict&&!e.strict&&(n=n.map(function(a){return a===null?"null":a===void 0?"undefined":a})),n.length===0?i="":i=Zp.apply(null,n),{options:r,shortmessage:i}}function G(){var e,t,r,n,i,o,a;if(e=Array.prototype.slice.call(arguments,0),!(this instanceof G))return t=Object.create(G.prototype),G.apply(t,arguments),t;if(r=Wi({argv:e,strict:!1}),r.options.name&&(ue.string(r.options.name,`error's "name" must be a string`),this.name=r.options.name),this.jse_shortmsg=r.shortmessage,o=r.shortmessage,n=r.options.cause,n&&(ue.ok(je(n),"cause is not an Error"),this.jse_cause=n,r.options.skipCauseMessage||(o+=": "+n.message)),this.jse_info={},r.options.info)for(a in r.options.info)this.jse_info[a]=r.options.info[a];return this.message=o,Error.call(this,o),Error.captureStackTrace&&(i=r.options.constructorOpt||this.constructor,Error.captureStackTrace(this,i)),this}mn.inherits(G,Error);G.prototype.name="VError";G.prototype.toString=function(){var t=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(t+=": "+this.message),t};G.prototype.cause=function(){var t=G.cause(this);return t===null?void 0:t};G.cause=function(e){return ue.ok(je(e),"err must be an Error"),je(e.jse_cause)?e.jse_cause:null};G.info=function(e){var t,r,n;if(ue.ok(je(e),"err must be an Error"),r=G.cause(e),r!==null?t=G.info(r):t={},typeof e.jse_info=="object"&&e.jse_info!==null)for(n in e.jse_info)t[n]=e.jse_info[n];return t};G.findCauseByName=function(e,t){var r;for(ue.ok(je(e),"err must be an Error"),ue.string(t,"name"),ue.ok(t.length>0,"name cannot be empty"),r=e;r!==null;r=G.cause(r))if(ue.ok(je(r)),r.name==t)return r;return null};G.hasCauseWithName=function(e,t){return G.findCauseByName(e,t)!==null};G.fullStack=function(e){ue.ok(je(e),"err must be an Error");var t=G.cause(e);return t?e.stack+`
caused by: `+G.fullStack(t):e.stack};G.errorFromList=function(e){return ue.arrayOfObject(e,"errors"),e.length===0?null:(e.forEach(function(t){ue.ok(je(t))}),e.length==1?e[0]:new It(e))};G.errorForEach=function(e,t){ue.ok(je(e),"err must be an Error"),ue.func(t,"func"),e instanceof It?e.errors().forEach(function(n){t(n)}):t(e)};function Qt(){var e,t,r,n;return e=Array.prototype.slice.call(arguments,0),this instanceof Qt?(r=Wi({argv:e,strict:!0}),n=r.options,G.call(this,n,"%s",r.shortmessage),this):(t=Object.create(Qt.prototype),Qt.apply(t,arguments),t)}mn.inherits(Qt,G);function It(e){ue.array(e,"list of errors"),ue.ok(e.length>0,"must be at least one error"),this.ase_errors=e,G.call(this,{cause:e[0]},"first of %d error%s",e.length,e.length==1?"":"s")}mn.inherits(It,G);It.prototype.name="MultiError";It.prototype.errors=function(){return this.ase_errors.slice(0)};function Ke(){var e,t,r,n;return e=Array.prototype.slice.call(arguments,0),this instanceof Ke?(r=Wi({argv:e,strict:!1}),n=r.options,n.skipCauseMessage=!0,G.call(this,n,"%s",r.shortmessage),this):(t=Object.create(Ke.prototype),Ke.apply(t,e),t)}mn.inherits(Ke,G);Ke.prototype.name="WError";Ke.prototype.toString=function(){var t=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(t+=": "+this.message),this.jse_cause&&this.jse_cause.message&&(t+="; caused by "+this.jse_cause.toString()),t};Ke.prototype.cause=function(t){return je(t)&&(this.jse_cause=t),this.jse_cause};class _{constructor(t,r){this.x=t,this.y=r}clone(){return new _(this.x,this.y)}}const cl=e=>{switch(e){case"a":return 1;case"b":return 2;case"c":return 3;case"d":return 4;case"e":return 5;case"f":return 6;case"g":return 7;case"h":return 8;default:throw new ae(`Cannot map file "${e}" to number`)}},$t=e=>{switch(e){case 1:return"a";case 2:return"b";case 3:return"c";case 4:return"d";case 5:return"e";case 6:return"f";case 7:return"g";case 8:return"h";default:throw new ae(`Cannot map "${e}" to file`)}},ev=e=>["B","K","N","Q","R"].includes(e),tv=e=>["b","k","n","q","r"].includes(e),rv=e=>["a","b","c","d","e","f","g","h"].includes(e),nv=e=>typeof e=="number"&&e>0&&e<=8,H=(e,t)=>e&&t&&e.file===t.file&&e.rank===t.rank,iv=e=>{let t="";return t+=$t(e.file),t+=e.rank,t},X=e=>e===$e.Black||e==$e.DarkGrey?"black":"white",nr=e=>({file:e%8+1,rank:8-Math.floor(e/8)}),ua=e=>(9-e.rank-1)*8+(e.file-1),Le=(e,t)=>e.rank===(t==="white"?8:1),ov={White:"white",Black:"black",Draw:"draw",Forfeit:"forfeit",ForfeitWhite:"forfeit-white",ForfeitBlack:"forfeit-black"};class ca{constructor(){this.files=[],this.ranks=[],this.pieces=[],this.tokens=[]}isEmpty(){return!this.moveType&&this.files.length===0&&this.ranks.length===0&&this.pieces.length===0&&!this.castleSide&&typeof this.isDrawOffer=="undefined"&&typeof this.isGameOver=="undefined"}toNode(){if(this.isDrawOffer)return{sources:this.tokens,kind:"draw-offer"};if(this.isGameOver)return{sources:this.tokens,kind:"game-over",outcome:this.outcome};const t={from:{},to:{}};if(this.pieces[0]&&this.moveType!=="promotion"&&(t.piece=this.pieces[0]),t.kind="move",this.files.length===2)t.from.file=this.files[0],t.to.file=this.files[1];else if(this.files.length===1)t.to.file=this.files[0];else if(this.files.length!==0)throw new ae(`Parsed ${this.files.length} columns for a single move`);if(this.ranks.length===2)t.from.rank=this.ranks[0],t.to.rank=this.ranks[1];else if(this.ranks.length===1)t.to.rank=this.ranks[0];else if(this.ranks.length!==0)throw new ae(`Parsed ${this.ranks.length} ranks for a single move`);return this.moveType==="allegiance"?{...t,type:"allegiance",sources:this.tokens}:this.moveType==="capture"?{...t,type:"capture",sources:this.tokens}:this.moveType==="castle"?{...t,type:"castle",side:this.castleSide,sources:this.tokens}:this.moveType==="en-passant"?{...t,type:"en-passant",sources:this.tokens}:this.moveType==="promotion"?{...t,piece:null,type:"promotion",promotionTo:this.pieces[0],sources:this.tokens}:{...t,sources:this.tokens}}}const fl=e=>{var c,f,p;let t=0;const r=["castle","draw-offer","piece","step-number","game-over","file","move-separator"],n=["step-number","move-separator"],i=new Set(r),o=(...h)=>{i.clear(),h.forEach(v=>i.add(v))};for(;t<e.length;){const h=e[t];if(!i.has(h.kind))throw new ae(`Parse error on line ${(c=h.source)==null?void 0:c.row} column ${(f=h.source)==null?void 0:f.column}: Token kind "${h.kind}" was not expected after "${(p=e[t-1])==null?void 0:p.kind}"`);switch(h.kind){case"move-separator":o(...r,"step-number","capture");break;case"step-number":o(...r,"move-separator");break;case"promotion":o("piece");break;case"allegiance":case"capture":o("file");break;case"castle":case"double-check":case"check":case"en-passant":o(...r);break;case"checkmate":o("game-over","move-separator");break;case"file":o("rank","capture","allegiance","file");break;case"draw-offer":o(...r,"game-over");break;case"game-over":o("move-separator");break;case"rank":o(...r,"allegiance","capture","check","checkmate","double-check","en-passant","promotion");break;case"piece":o("capture","allegiance","check","checkmate","game-over","file","double-check","en-passant","promotion");break}t++}t=0;const a={kind:"root",children:[]};let s=new ca;const l=()=>{s.isEmpty()||(a.children.push(s.toNode()),s=new ca)},u=()=>{var h;return(h=e[t+1])==null?void 0:h.kind};for(;t<e.length;){const h=e[t];switch(n.includes(h.kind)||s.tokens.push(h),h.kind){case"move-separator":u()!=="en-passant"&&l();break;case"piece":s.pieces.push(h.value);break;case"allegiance":s.moveType="allegiance";break;case"capture":s.moveType="capture";break;case"castle":s.moveType="castle",s.castleSide=h.side,u()!=="move-separator"&&l();break;case"check":case"double-check":s.causesCheck=!0,s.isMate=!1,u()!=="move-separator"&&l();break;case"checkmate":s.causesCheck=!0,s.isMate=!0,u()!=="move-separator"&&l();break;case"file":s.files.push(h.value);break;case"rank":s.ranks.push(h.value),u()||l();break;case"draw-offer":s.isDrawOffer=!0,u()!=="move-separator"&&l();break;case"en-passant":s.moveType="en-passant",u()!=="move-separator"&&l();break;case"promotion":s.moveType="promotion";break;case"game-over":s.isGameOver=!0,s.outcome=h.outcome,u()!=="move-separator"&&l();break}t++}return a},dl=e=>{const t=e.replace(/[]/gu,"-");let r=1,n=1,i=0;const o=[];for(;i<t.length;){const a=t[i],s=c=>t.substring(i,i+c.length)===c,l=c=>{let f="",p=i;for(;;){const h=t[p];if(p>=t.length||c(h)){p--;break}f+=h,p++}return f},u=(c,f)=>{o.push({...f,source:{column:n,row:r,length:c}}),i+=c,n+=c};if(a===`
`){r++,n=1,u(1,{kind:"move-separator"});continue}if(a==="\r"){n=1,i++;continue}if(s("e.p.")||s(" e.p.")){u(a===" "?5:4,{kind:"en-passant"});continue}if(a===" "||a===";"){u(1,{kind:"move-separator"});continue}if(s("O-O-O")||s("0-0-0")){u(5,{kind:"castle",side:"queen"});continue}if(s("O-O")||s("0-0")){u(3,{kind:"castle",side:"king"});continue}if(a==="+"||a==="\u2020"){u(1,{kind:"check"});continue}if(s("ch")){u(2,{kind:"check"});continue}if(/[#X]/gu.test(a)){u(1,{kind:"checkmate"});continue}if(s("mate")){u(4,{kind:"checkmate"});continue}if(s("dbl ch")){u(6,{kind:"double-check"});continue}if(s("++")){u(2,{kind:"double-check"});continue}if(s("0-1")){u(3,{kind:"game-over",outcome:"black"});continue}if(s("1-0")){u(3,{kind:"game-over",outcome:"white"});continue}if(s("\xBD-\xBD")){u(3,{kind:"game-over",outcome:"draw"});continue}if(s("1/2-1/2")){u(7,{kind:"game-over",outcome:"draw"});continue}if(s("0-0")){u(3,{kind:"game-over",outcome:"forfeit"});continue}if(s("\xBD-0")){u(3,{kind:"game-over",outcome:"forfeit-white"});continue}if(s("1/2-0")){u(5,{kind:"game-over",outcome:"forfeit-white"});continue}if(s("0-\xBD")){u(3,{kind:"game-over",outcome:"forfeit-black"});continue}if(s("0-1/2")){u(5,{kind:"game-over",outcome:"forfeit-black"});continue}if(/[\d]/gu.test(a)){const c=l(p=>!/[\d]/gu.test(p));if(t[i+c.length]==="."){u(c.length+1,{kind:"step-number",value:Number.parseInt(c,10)});continue}}if(/[1-8]/gu.test(a)){u(1,{kind:"rank",value:Number.parseInt(a,10)});continue}if(/[a-h]/gu.test(a)){u(1,{kind:"file",value:cl(a)});continue}if(/[KQRBN]/gu.test(a)){u(1,{kind:"piece",value:a});continue}if(/[x:]/gu.test(a)){u(1,{kind:"capture"});continue}if(s("(=)")){u(3,{kind:"draw-offer"});continue}if(a==="="||a==="/"){u(1,{kind:"promotion"});continue}if(a==="("||a===")"){u(1,{kind:"promotion",bracket:a==="("?"open":"close"});continue}if(a===">"){u(1,{kind:"allegiance"});continue}throw new ae(`Unsupported character at line ${r} column ${n}: "${a}"`)}return o},Hi=e=>{switch(e.kind){case"draw-offer":return"(=)";case"game-over":{switch(e.outcome){case"black":return"0-1";case"white":return"1-0";case"draw":return"1/2-1/2";case"forfeit":return"0-0";case"forfeit-black":return"0-1/2";case"forfeit-white":return"1/2-0"}break}case"move":{const t=(r,n)=>{let i="";return e.piece&&(i+=e.piece),e.from.file&&(i+=`${$t(e.from.file)}`),e.from.rank&&(i+=`${e.from.rank}`),i+=r,e.type==="promotion"&&e.promotionTo&&(i+=`${e.promotionTo}`),e.to.file&&(i+=`${$t(e.to.file)}`),e.to.rank&&(i+=`${e.to.rank}`),n&&(i+=n),i};switch(e.type){case"allegiance":return t(">");case"capture":return t("x");case"castle":return e.side==="king"?"O-O":"O-O-O";case"en-passant":return t("x"," e.p.");case"promotion":return t("=");default:return t("")}}}},hl=e=>{const t=[];return e.children.forEach((r,n)=>{const i=n%2===0;(a=>{i?t.push(a):t[t.length-1]+=` ${a}`})(Hi(r))}),t.filter(Boolean).map((r,n)=>`${n+1}. ${r}`).join(`
`).trim()};var fa=Object.freeze(Object.defineProperty({__proto__:null,GameOutcome:ov,parse:fl,tokenize:dl,writeNode:Hi,write:hl},Symbol.toStringTag,{value:"Module"})),pl=(e=>(e[e.Ranks=0]="Ranks",e[e.ActiveColour=1]="ActiveColour",e[e.CastlingRights=2]="CastlingRights",e[e.EnPassantTargets=3]="EnPassantTargets",e[e.HalfmoveClock=4]="HalfmoveClock",e[e.FullmoveNumber=5]="FullmoveNumber",e))(pl||{});class da{constructor(){this.allegianceMark=!1,this.castlingRights=[]}canSetPieceSide(){return!this.pieceSide}setPieceSide(t){if(!this.canSetPieceSide())throw new ae("Cannot set piece side on WipNode, because it's already set");this.pieceSide=t}canSetPiece(){return!this.piece&&this.piece!==null}setPiece(t){if(!this.canSetPiece())throw new ae("Cannot set piece on WipNode, because there is already one set");this.piece=t}canSetAllegianceMark(){return!this.allegianceMark}addAllegianceMark(){if(!this.canSetAllegianceMark())throw new ae("Allegiance mark already set");this.allegianceMark=!0}pieceDataReady(){return!this.canSetPiece()&&!this.canSetPieceSide()}setActiveColour(t){this.activeColour=t}hasCastlingRights(){return this.castlingRights.length!==0}addCastlingRight(t){this.castlingRights.push(t)}canSetEnPassantFile(){return!this.enPassantFile}setEnPassantFile(t){if(!this.canSetEnPassantFile())throw new ae("Cannot set en passant file on WipNode, because there is already one set");this.enPassantFile=t}canSetEnPassantRank(){return!this.enPassantRank}setEnPassantRank(t){if(!this.canSetEnPassantRank())throw new ae("Cannot set en passant rank on WipNode, because there is already one set");this.enPassantRank=t}canSetHalfmoveClock(){return typeof this.halfmoveClock!="number"}setHalfmoveClock(t){this.halfmoveClock=t}canSetFullmoveNumber(){return typeof this.fullmoveNumber!="number"}setFullmoveNumber(t){this.fullmoveNumber=t}isEnPassantType(){return!!(this.enPassantFile&&this.enPassantRank)}toNode(){if(this.piece||this.piece===null)return this.pieceSide==="white"?{kind:"piece",value:{allegiance:this.allegianceMark?$e.LightGrey:$e.White,piece:this.piece?this.piece.toUpperCase():null}}:{kind:"piece",value:{allegiance:this.allegianceMark?$e.DarkGrey:$e.Black,piece:this.piece?this.piece.toUpperCase():null}};if(this.activeColour)return{kind:"active-colour",value:this.activeColour};if(this.castlingRights.length>0){const t=[],r=[];return this.castlingRights.includes("K")&&r.push("king"),this.castlingRights.includes("Q")&&r.push("queen"),this.castlingRights.includes("k")&&t.push("king"),this.castlingRights.includes("q")&&t.push("queen"),{kind:"castling-rights",value:{black:t,white:r}}}if(this.enPassantFile&&this.enPassantRank)return{kind:"en-passant-targets",value:{file:this.enPassantFile,rank:this.enPassantRank}};if(typeof this.halfmoveClock=="number")return{kind:"halfmove-clock",value:this.halfmoveClock};if(typeof this.fullmoveNumber=="number")return{kind:"fullmove-number",value:this.fullmoveNumber};throw new ae(`Cannot create Node from WipNode, ${JSON.stringify({...this},null,2)}`)}}const av=e=>{const t={kind:"ast",children:[]};let r=0,n=0,i=new da;const o=l=>{t.children.push(l),r++},a=()=>{t.children.push(i.toNode()),i=new da},s=l=>{n=l,r++};for(;r<e.length;){const l=e[r],u=e[r+1];if(n===0){if((l.kind==="char"||l.kind==="number"||l.kind==="separator"||l.kind==="space")&&i.pieceDataReady()&&a(),l.kind==="char"&&tv(l.value)){i.setPieceSide("black"),i.setPiece(l.value),u||a(),r++;continue}if(l.kind==="char"&&ev(l.value)){i.setPieceSide("white"),i.setPiece(l.value),u||a(),r++;continue}if(l.kind==="char"&&l.value==="p"){i.setPieceSide("black"),i.setPiece(null),u||a(),r++;continue}if(l.kind==="char"&&l.value==="P"){i.setPieceSide("white"),i.setPiece(null),u||a(),r++;continue}if(l.kind==="allegiance"){i.addAllegianceMark(),r++,u||a();continue}if(l.kind==="number"&&l.value>0&&l.value<=8){o({kind:"skip",value:l.value});continue}}switch(n){case 0:{if(l.kind==="separator"){r++;continue}if(l.kind==="space"){n=1,r++;continue}break}case 1:{if(l.kind==="char"&&l.value==="w"){i.setActiveColour("white"),r++;continue}if(l.kind==="char"&&l.value==="b"){i.setActiveColour("black"),r++;continue}if(l.kind==="space"){a(),s(2);continue}break}case 2:{if(l.kind==="char"&&(l.value==="q"||l.value==="Q"||l.value==="k"||l.value==="K")){i.addCastlingRight(l.value),r++;continue}if(l.kind==="hyphen"){r++;continue}if(l.kind==="space"){i.hasCastlingRights()&&a(),s(3);continue}break}case 3:{if(l.kind==="hyphen"){r++;continue}if(l.kind==="char"&&rv(l.value)){i.setEnPassantFile(cl(l.value)),r++;continue}if(l.kind==="number"&&nv(l.value)){i.setEnPassantRank(l.value),r++;continue}if(l.kind==="space"){i.isEnPassantType()&&a(),s(4);continue}break}case 4:{if(l.kind==="number"){i.setHalfmoveClock(l.value),r++;continue}if(l.kind==="space"){a(),s(5);continue}break}case 5:{l.kind==="number"&&(i.setFullmoveNumber(l.value),r++,a());continue}}throw new ae(`Unhandled token: ${l.kind}, cursor ${r}, state: ${pl[n]}`)}return t},sv=e=>{let t=0;const r=[],n=(o,a)=>{r.push(a),t+=o},i=o=>{let a="",s=t;for(;;){const l=e[s];if(s>=e.length||o(l)){s--;break}a+=l,s++}return a};for(;t<e.length;){const o=e[t];if(o===">"){n(1,{kind:"allegiance"});continue}if(o==="/"){n(1,{kind:"separator"});continue}if(/\d/gu.test(o)){const a=i(s=>!/[\d]/gu.test(s));n(a.length,{kind:"number",value:Number.parseInt(a,10)});continue}if(o===" "){n(1,{kind:"space"});continue}if(o==="-"||o==="\u2013"){n(1,{kind:"hyphen"});continue}n(1,{kind:"char",value:o})}return r},Gi={sections:["positions","active-colour","castlig-rights","en-passant-targets","halfmove-clock","fullmove-number"]},lv=(e,t=Gi)=>{let r="",n=0;e.children.forEach(b=>{var E;switch(b.kind){case"piece":{n>=8&&(r+="/",n=0);const P=X(b.value.allegiance),M=(E=b.value.piece)!=null?E:"p";r+=P==="white"?M.toUpperCase():M.toLowerCase(),(b.value.allegiance===$e.DarkGrey||b.value.allegiance===$e.LightGrey)&&(r+=">"),n++;break}case"skip":{n>=8&&(r+="/",n=0),r+=b.value,n+=b.value;break}}});const i=e.children.find(b=>b.kind==="active-colour");let o="";i?o=i.value==="white"?"w":"b":o="w";const a=e.children.find(b=>b.kind==="castling-rights");let s="";a?(a.value.white.includes("king")&&(s+="K"),a.value.white.includes("queen")&&(s+="Q"),a.value.black.includes("king")&&(s+="k"),a.value.black.includes("queen")&&(s+="q")):s="-";const l=e.children.find(b=>b.kind==="en-passant-targets");let u="";l?u=iv(l.value):u="-";const c=e.children.find(b=>b.kind==="halfmove-clock");let f="0";c&&(f=String(c.value));const p=e.children.find(b=>b.kind==="fullmove-number");let h="0";return p&&(h=String(p.value)),[t.sections.includes("positions")&&r,t.sections.includes("active-colour")&&o,t.sections.includes("castlig-rights")&&s,t.sections.includes("en-passant-targets")&&u,t.sections.includes("halfmove-clock")&&f,t.sections.includes("fullmove-number")&&h].filter(Boolean).join(" ")};class Vi{clone(){const t=new Vi;return t.memory=[...this.memory],t.activeColour=this.activeColour,t.enPassantTarget=this.enPassantTarget?{...this.enPassantTarget}:null,t._castlingRights=[...this._castlingRights],t.halfmoveClock=this.halfmoveClock,t.fullmoveNumber=this.fullmoveNumber,t.moveHistory={kind:"root",children:[...this.moveHistory.children]},t}removeCastlingRights(t,r){const n=this._castlingRights.findIndex(i=>i.colour===t&&i.side===r);n!==-1&&this._castlingRights.splice(n,1)}castlingRights(t){return this._castlingRights.filter(r=>r.colour===t).map(r=>r.side)}clear(){this.activeColour="white",this.enPassantTarget=null,this._castlingRights=[],this.halfmoveClock=0,this.fullmoveNumber=0,this.moveHistory={kind:"root",children:[]},this.memory=Array.from({length:64}).fill(null)}constructor(){this.clear()}dump(){const t=this.getSquares(),r=Array.from({length:8}).map(()=>Array.from({length:8}).map(()=>"."));let n="";t.filter(Boolean).forEach(i=>{var o,a,s,l;r[i.rank-1][i.file-1]=X(i.allegiance)==="white"?(a=(o=i.piece)==null?void 0:o.toUpperCase())!=null?a:"P":(l=(s=i.piece)==null?void 0:s.toLowerCase())!=null?l:"p"});for(let i=7;i>=0;i--)n+=`${i+1} `,n+=r[i].map(o=>o).join(" "),n+=`
`;return n+=`  ${r[0].map((i,o)=>$t(o+1)).join(" ")}`,n+=`
${this.activeColour} ${this.enPassantTarget&&`${$t(this.enPassantTarget.file)}${this.enPassantTarget.rank}`} ${this.halfmoveClock} ${this.fullmoveNumber}`,n}getSquares(){return this.memory.map((t,r)=>t?{...t,...nr(r)}:null)}getSquare(t){if(!t)throw new ae.VError("Attempted to get square with no coordinates");return this.memory[ua(t)]}setSquare(t,r){this.memory[ua(t)]=r}toAFEN(t=Gi){const r={kind:"ast",children:[]};let n=0;if(t.sections.includes("positions")){for(let i=0;i<this.memory.length;i++)this.memory[i]?(n&&(r.children.push({kind:"skip",value:n}),n=0),r.children.push({kind:"piece",value:this.memory[i]})):n++,(i+1)%8===0&&n&&(r.children.push({kind:"skip",value:n}),n=0);n&&r.children.push({kind:"skip",value:n})}if(t.sections.includes("active-colour")&&r.children.push({kind:"active-colour",value:this.activeColour}),t.sections.includes("castlig-rights")){const i={kind:"castling-rights",value:{black:[],white:[]}},o=this.castlingRights("white"),a=this.castlingRights("black");o.includes("king")&&i.value.white.push("king"),o.includes("queen")&&i.value.white.push("queen"),a.includes("king")&&i.value.black.push("king"),a.includes("queen")&&i.value.black.push("queen"),(i.value.white.length>0||i.value.black.length>0)&&r.children.push(i)}return t.sections.includes("en-passant-targets")&&this.enPassantTarget&&r.children.push({kind:"en-passant-targets",value:this.enPassantTarget}),t.sections.includes("halfmove-clock")&&r.children.push({kind:"halfmove-clock",value:this.halfmoveClock}),t.sections.includes("fullmove-number")&&r.children.push({kind:"fullmove-number",value:this.fullmoveNumber}),r}fromAFEN(t){var n;this.clear();let r=0;for(const i of t.children){if(i.kind==="skip"){r+=i.value;continue}if(i.kind==="piece"){this.memory[r]=i.value,r++;continue}if(i.kind==="en-passant-targets"){this.enPassantTarget=i.value;continue}if(i.kind==="castling-rights"){i.value.black.forEach(o=>{this._castlingRights.push({colour:"black",side:o})}),i.value.white.forEach(o=>{this._castlingRights.push({colour:"white",side:o})});continue}if(i.kind==="active-colour"){this.activeColour=i.value;continue}if(i.kind==="fullmove-number"){this.fullmoveNumber=i.value;continue}if(i.kind==="halfmove-clock"){this.halfmoveClock=i.value;continue}throw new ae.VError(`Unhandled node while importing AFEN: ${(n=i.kind)!=null?n:JSON.stringify(i,null,2)}`)}}}const ha={VanillaDefault:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 0",GreyDefault:"r>n>b>q>kb>n>r>/p>p>p>p>p>p>p>p>/8/8/8/8/P>P>P>P>P>P>P>P>/R>N>B>Q>KB>N>R> w KQkq - 0 0"},$e={Black:0,DarkGrey:1,LightGrey:2,White:3},uv=["B","N","Q","R"];class C{clear(){this.memory.clear()}clone(){const t=new C;return t.memory=this.memory.clone(),t}dump(){return this.memory.dump()}importAFEN(t){this.memory.fromAFEN(av(sv(t)))}importMoveHistory(t){const r=fl(dl(t)),n=new C;n.importAFEN(ha.VanillaDefault),r.children.forEach(i=>{const o=n.getValidMoves(),a=C.findMoveIndex(o,i);if(a===-1)throw new ae(`Move ${Hi(i)} is not valid on this board`);const s=n.executeMoveIndex(a);this.memory.moveHistory.children.push(s)})}toAFEN(t=Gi){return lv(this.memory.toAFEN(t))}getSquares(){return this.memory.getSquares()}get enPassantTarget(){return this.memory.enPassantTarget}get activeColour(){return this.memory.activeColour}get halfmoveClock(){return this.memory.halfmoveClock}get fullmoveNumber(){return this.memory.fullmoveNumber}get castlingRights(){return{black:this.memory.castlingRights("black"),white:this.memory.castlingRights("white")}}getMoveHistory(){return hl(this.memory.moveHistory)}getMoveHistoryAst(){return this.memory.moveHistory}constructor(){this.memory=new Vi}getPositionCount(){const t=this.memory.moveHistory.children,r=new Map,n=new C;n.importAFEN(ha.VanillaDefault);for(const i of t){n.executeNode(i);const o=n.toAFEN({sections:["positions"]}),a=r.get(o);a?r.set(o,a+1):r.set(o,1)}return r}executeAllegianceMoveNode(t){this.memory.setSquare(t.node.to,{allegiance:t.fromSide==="white"?t.to.allegiance+1:t.to.allegiance-1,piece:t.to.piece})}executeCaptureMoveNode(t){this.memory.setSquare(t.node.to,t.from),this.memory.setSquare(t.node.from,null)}executeCastleMoveNode(t){const r=t.node.from,n=t.node.to,i=t.from;if(t.to)throw new ae(`Castling cannot cause a capture on ${JSON.stringify(t.node.to)}`);this.memory.setSquare(n,i),this.memory.setSquare(r,null);const a=t.fromSide==="white"?1:8,s=t.node.side==="king"?{file:8,rank:a}:{file:1,rank:a},l=t.node.side==="king"?{file:6,rank:a}:{file:4,rank:a};this.memory.setSquare(l,this.memory.getSquare(s)),this.memory.setSquare(s,null)}executeEnPassantMoveNode(t){this.memory.setSquare({rank:t.fromSide==="white"?t.node.to.rank-1:t.node.to.rank+1,file:t.node.to.file},null),this.memory.setSquare(t.node.to,t.from),this.memory.setSquare(t.node.from,null)}executePromotionMoveNode(t){this.memory.setSquare(t.node.to,{allegiance:t.from.allegiance,piece:t.node.promotionTo}),this.memory.setSquare(t.node.from,null)}executeDefaultMoveNode(t){this.memory.setSquare(t.node.from,null),this.memory.setSquare(t.node.to,t.from),t.node.piece===null&&Math.abs(t.node.from.rank-t.node.to.rank)===2&&(this.memory.enPassantTarget={file:t.node.from.file,rank:t.fromSide==="white"?t.node.from.rank+1:t.node.from.rank-1})}executeMoveNode(t){if(!t.from.file)throw new ae(`Cannot execute node without "from.file": ${JSON.stringify(t,null,2)}`);const r=this.memory.getSquare(t.from),n=this.memory.getSquare(t.to);if(!r)throw new ae(`There is no piece on file ${t.from.file} rank ${t.from.rank}`);r.piece==="K"&&(this.memory.removeCastlingRights(this.activeColour,"king"),this.memory.removeCastlingRights(this.activeColour,"queen")),r.piece==="R"&&t.from.file===8&&this.memory.removeCastlingRights(this.activeColour,"king"),r.piece==="R"&&t.from.file===1&&this.memory.removeCastlingRights(this.activeColour,"queen"),this.memory.enPassantTarget=null;const i=X(r.allegiance),o=n?X(n.allegiance):null;switch(t.type){case"allegiance":this.executeAllegianceMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"capture":this.executeCaptureMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"castle":this.executeCastleMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"en-passant":this.executeEnPassantMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"promotion":this.executePromotionMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;default:this.executeDefaultMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break}switch(t.type){case"capture":case"en-passant":{this.memory.halfmoveClock=0;break}case null:case void 0:{t.piece?this.memory.halfmoveClock++:this.memory.halfmoveClock=0;break}default:{this.memory.halfmoveClock++;break}}this.memory.activeColour==="black"&&this.memory.fullmoveNumber++,this.memory.activeColour=this.memory.activeColour==="white"?"black":"white"}executeNode(t){switch(t.kind){case"move":{this.executeMoveNode(t);break}default:return}this.memory.moveHistory.children.push(t)}executeMoveIndex(t){if(t<0)throw new ae(`Move index must be positive, got ${t}`);const n=this.getValidMoves().at(t);if(!n)throw new ae(`Move with index ${t} does not exist`);return this.executeNode(n),n}getSquare(t){return this.memory.getSquare(t)}static findMoveIndex(t,r){let n=t;return r.kind==="draw-offer"&&(n=n.filter(i=>i.kind==="draw-offer")),r.kind==="game-over"&&(n=n.filter(i=>i.kind==="game-over"&&i.outcome===r.outcome)),r.kind==="move"&&(r.to&&Object.keys(r.to).length===2&&(n=n.filter(i=>i.kind==="move"&&H(i.to,r.to))),r.from&&Object.keys(r.from).length===2&&(n=n.filter(i=>i.kind==="move"&&H(i.from,r.from))),r.type&&(n=n.filter(i=>"type"in i&&i.type===r.type)),r.piece||r.piece===null?n=n.filter(i=>i.kind==="move"&&i.piece===r.piece):n.length>1&&!r.piece&&(n=n.filter(i=>i.kind==="move"&&i.piece===null)),r.type==="promotion"&&(n=n.filter(i=>"promotionTo"in i&&i.promotionTo===r.promotionTo&&H(i.to,r.to)&&H(i.from,r.from)))),n.length===1?t.indexOf(n[0]):-1}static getCoordsRelative(t,r){const n={file:t.file+r.x,rank:t.rank+r.y};return n.file>8||n.file<=0||n.rank>8||n.rank<=0?null:n}traceCaptureSteps(t,r){const n=this.memory.getSquare(t);if(!n)return[];const i=[],o=new _(Math.sign(r.x),Math.sign(r.y));let a=t;for(;a=C.getCoordsRelative(a,o),!!a;){const s=this.memory.getSquare(a);if(!s){i.push({...a});continue}if(X(s.allegiance)===X(n.allegiance))break;if(X(s.allegiance)!==X(n.allegiance)){i.push({...a});break}i.push({...a})}return i}getAttackedCoordsBySide(t){const r=this.memory.getSquares().filter(i=>i&&X(i.allegiance)===t),n=[];return r.forEach(i=>{n.push(...this.getAttackedCoordsByCoords(i))}),n}getAttackedCoordsByCoords(t){const r=[],n=this.memory.getSquare(t);if(!n)return r;const i=X(n.allegiance);if(n.piece===null){const o=C.getCoordsRelative(t,new _(i==="white"?-1:1,i==="white"?1:-1)),a=C.getCoordsRelative(t,new _(i==="white"?1:-1,i==="white"?1:-1));return[o,a]}return n.piece==="R"?[...this.traceCaptureSteps(t,new _(1,0)),...this.traceCaptureSteps(t,new _(-1,0)),...this.traceCaptureSteps(t,new _(0,1)),...this.traceCaptureSteps(t,new _(0,-1))].filter(Boolean):n.piece==="N"?[C.getCoordsRelative(t,new _(1,2)),C.getCoordsRelative(t,new _(2,1)),C.getCoordsRelative(t,new _(2,-1)),C.getCoordsRelative(t,new _(1,-2)),C.getCoordsRelative(t,new _(-1,-2)),C.getCoordsRelative(t,new _(-2,-1)),C.getCoordsRelative(t,new _(-2,1)),C.getCoordsRelative(t,new _(-1,2))].filter(Boolean):n.piece==="B"?[...this.traceCaptureSteps(t,new _(1,1)),...this.traceCaptureSteps(t,new _(1,-1)),...this.traceCaptureSteps(t,new _(-1,-1)),...this.traceCaptureSteps(t,new _(-1,1))].filter(Boolean):n.piece==="Q"?[...this.traceCaptureSteps(t,new _(1,0)),...this.traceCaptureSteps(t,new _(-1,0)),...this.traceCaptureSteps(t,new _(0,1)),...this.traceCaptureSteps(t,new _(0,-1)),...this.traceCaptureSteps(t,new _(1,1)),...this.traceCaptureSteps(t,new _(1,-1)),...this.traceCaptureSteps(t,new _(-1,-1)),...this.traceCaptureSteps(t,new _(-1,1))].filter(Boolean):n.piece==="K"?[C.getCoordsRelative(t,new _(0,1)),C.getCoordsRelative(t,new _(1,1)),C.getCoordsRelative(t,new _(1,0)),C.getCoordsRelative(t,new _(1,-1)),C.getCoordsRelative(t,new _(0,-1)),C.getCoordsRelative(t,new _(-1,-1)),C.getCoordsRelative(t,new _(-1,0)),C.getCoordsRelative(t,new _(-1,1))].filter(Boolean):r}getPossibleMoves(){const t=[],r=this.memory.getSquares(),n=this.getAttackedCoordsBySide(this.activeColour==="white"?"black":"white");return this.memory.moveHistory.children.some(o=>o.kind==="game-over")?[]:(r.forEach(o=>{if(!o)return;const a=X(o.allegiance);if(o.piece===null){const s=C.getCoordsRelative(o,new _(0,a==="white"?1:-1)),l=C.getCoordsRelative(o,new _(a==="white"?-1:1,a==="white"?1:-1)),u=C.getCoordsRelative(o,new _(a==="white"?1:-1,a==="white"?1:-1)),c=f=>uv.map(p=>({kind:"move",type:"promotion",from:o,to:f,piece:this.memory.getSquare(o).piece,promotionTo:p}));if(this.memory.enPassantTarget&&l&&H(this.memory.enPassantTarget,l)&&!Le(l,a)&&t.push({kind:"move",type:"en-passant",from:o,to:this.memory.enPassantTarget,piece:this.memory.getSquare(o).piece}),this.memory.enPassantTarget&&u&&H(this.memory.enPassantTarget,u)&&!Le(u,a)&&t.push({kind:"move",type:"en-passant",from:o,to:this.memory.enPassantTarget,piece:this.memory.getSquare(o).piece}),s&&!this.memory.getSquare(s)&&!Le(s,a)&&t.push({kind:"move",type:null,piece:this.memory.getSquare(o).piece,from:o,to:s}),l){const f=this.memory.getSquare(l);f&&X(f.allegiance)!==a&&(Le(l,a)?t.push(...c(l)):t.push({kind:"move",type:"capture",from:o,to:l,piece:this.memory.getSquare(o).piece},{kind:"move",type:"allegiance",from:o,to:l,piece:this.memory.getSquare(o).piece}))}if(u){const f=this.memory.getSquare(u);f&&X(f.allegiance)!==a&&(Le(u,a)?t.push(...c(u)):t.push({kind:"move",type:"capture",from:o,to:u,piece:this.memory.getSquare(o).piece},{kind:"move",type:"allegiance",from:o,to:u,piece:this.memory.getSquare(o).piece}))}if(o.rank===2&&a==="white"||o.rank===7&&a==="black"){const f=C.getCoordsRelative(o,new _(0,a==="white"?2:-2));!this.memory.getSquare(s)&&!this.memory.getSquare(f)&&t.push({kind:"move",type:null,from:o,to:f,piece:this.memory.getSquare(o).piece})}!this.getSquare(s)&&Le(s,a)&&t.push(...c(s))}if(o.piece==="R"){const s=[...this.traceCaptureSteps(o,new _(1,0)),...this.traceCaptureSteps(o,new _(-1,0)),...this.traceCaptureSteps(o,new _(0,1)),...this.traceCaptureSteps(o,new _(0,-1))];t.push(...s.map(l=>{const u=this.memory.getSquare(l);return{kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}}),...s.map(l=>this.memory.getSquare(l)?{kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}:null).filter(Boolean))}if(o.piece==="N"&&[C.getCoordsRelative(o,new _(1,2)),C.getCoordsRelative(o,new _(2,1)),C.getCoordsRelative(o,new _(2,-1)),C.getCoordsRelative(o,new _(1,-2)),C.getCoordsRelative(o,new _(-1,-2)),C.getCoordsRelative(o,new _(-2,-1)),C.getCoordsRelative(o,new _(-2,1)),C.getCoordsRelative(o,new _(-1,2))].filter(Boolean).forEach(l=>{const u=this.memory.getSquare(l);u&&X(u.allegiance)===a||(t.push({kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}),u&&t.push({kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}))}),o.piece==="B"){const s=[...this.traceCaptureSteps(o,new _(1,1)),...this.traceCaptureSteps(o,new _(1,-1)),...this.traceCaptureSteps(o,new _(-1,-1)),...this.traceCaptureSteps(o,new _(-1,1))];t.push(...s.map(l=>{const u=this.memory.getSquare(l);return{kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}}),...s.map(l=>this.memory.getSquare(l)?{kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}:null).filter(Boolean))}if(o.piece==="Q"){const s=[...this.traceCaptureSteps(o,new _(1,0)),...this.traceCaptureSteps(o,new _(-1,0)),...this.traceCaptureSteps(o,new _(0,1)),...this.traceCaptureSteps(o,new _(0,-1)),...this.traceCaptureSteps(o,new _(1,1)),...this.traceCaptureSteps(o,new _(1,-1)),...this.traceCaptureSteps(o,new _(-1,-1)),...this.traceCaptureSteps(o,new _(-1,1))];t.push(...s.map(l=>{const u=this.memory.getSquare(l);return{kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}}),...s.map(l=>this.memory.getSquare(l)?{kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}:null).filter(Boolean))}if(o.piece==="K"){[C.getCoordsRelative(o,new _(0,1)),C.getCoordsRelative(o,new _(1,1)),C.getCoordsRelative(o,new _(1,0)),C.getCoordsRelative(o,new _(1,-1)),C.getCoordsRelative(o,new _(0,-1)),C.getCoordsRelative(o,new _(-1,-1)),C.getCoordsRelative(o,new _(-1,0)),C.getCoordsRelative(o,new _(-1,1))].filter(Boolean).forEach(f=>{const p=this.memory.getSquare(f);p&&X(p.allegiance)===a||(t.push({kind:"move",type:p?"capture":null,from:o,to:f,piece:o.piece}),p&&t.push({kind:"move",type:"allegiance",from:o,to:f,piece:o.piece}))});const l=this.memory.castlingRights("white"),u=n.some(f=>H(o,f));if(this.activeColour==="white"&&l.length>0){const f=this.memory.getSquare({file:1,rank:1}),p=this.memory.getSquare({file:2,rank:1}),h=this.memory.getSquare({file:3,rank:1}),v=this.memory.getSquare({file:4,rank:1}),b=this.memory.getSquare({file:6,rank:1}),E=this.memory.getSquare({file:7,rank:1}),P=this.memory.getSquare({file:8,rank:1}),M=n.some(w=>H(w,{file:2,rank:1})),j=n.some(w=>H(w,{file:3,rank:1})),S=n.some(w=>H(w,{file:4,rank:1})),k=n.some(w=>H(w,{file:6,rank:1})),T=n.some(w=>H(w,{file:7,rank:1}));l.forEach(w=>{w==="king"&&!u&&!b&&!E&&P&&P.piece==="R"&&X(P.allegiance)==="white"&&!k&&!T&&t.push({kind:"move",type:"castle",from:o,to:C.getCoordsRelative(o,new _(2,0)),piece:this.memory.getSquare(o).piece,side:"king"}),w==="queen"&&!u&&!p&&!h&&!v&&f&&f.piece==="R"&&X(f.allegiance)==="white"&&!M&&!j&&!S&&t.push({kind:"move",type:"castle",from:o,to:C.getCoordsRelative(o,new _(-2,0)),piece:this.memory.getSquare(o).piece,side:"queen"})})}const c=this.memory.castlingRights("black");if(this.activeColour==="black"&&c.length>0){const f=this.memory.getSquare({file:1,rank:8}),p=this.memory.getSquare({file:2,rank:8}),h=this.memory.getSquare({file:3,rank:8}),v=this.memory.getSquare({file:4,rank:8}),b=this.memory.getSquare({file:6,rank:8}),E=this.memory.getSquare({file:7,rank:8}),P=this.memory.getSquare({file:8,rank:8}),M=n.some(w=>H(w,{file:2,rank:8})),j=n.some(w=>H(w,{file:3,rank:8})),S=n.some(w=>H(w,{file:4,rank:8})),k=n.some(w=>H(w,{file:6,rank:8})),T=n.some(w=>H(w,{file:7,rank:8}));c.forEach(w=>{w==="king"&&!u&&!b&&!E&&P&&P.piece==="R"&&X(P.allegiance)==="black"&&!k&&!T&&t.push({kind:"move",type:"castle",from:o,to:C.getCoordsRelative(o,new _(2,0)),piece:this.memory.getSquare(o).piece,side:"king"}),w==="queen"&&!u&&!p&&!h&&!v&&f&&f.piece==="R"&&X(f.allegiance)==="black"&&!M&&!j&&!S&&t.push({kind:"move",type:"castle",from:o,to:C.getCoordsRelative(o,new _(-2,0)),piece:this.memory.getSquare(o).piece,side:"queen"})})}}}),t)}getGameOverNode(t,r){const n=this.getCheckMovesFromList(t),i=this.getSquares().filter(Boolean),o=this.activeColour,a=this.activeColour==="white"?"black":"white",s=(v,b)=>i.reduce((E,P)=>!b&&b!==null&&X(P.allegiance)===v||P.piece===b&&X(P.allegiance)===v?E+1:E,0),l=n.some(v=>{const b=this.memory.getSquare(v.to);return X(b.allegiance)===o});if(l&&r.length===0)return{kind:"game-over",outcome:a,reason:"Checkmate"};if(!l&&r.length===0)return{kind:"game-over",outcome:"draw",reason:"Stalemate"};const u=s(o),c=s(a);if(u===1&&c===1){const v=i.find(E=>X(E.allegiance)===a);if(i.find(E=>X(E.allegiance)===o).piece==="K"&&v.piece==="K")return{kind:"game-over",outcome:"draw",reason:"Insufficient material (king vs king)"}}if(u<=2&&c<=2){const v=i.find(M=>X(M.allegiance)===a&&M.piece==="K"),b=i.find(M=>X(M.allegiance)===a&&M.piece!=="K"),E=i.find(M=>X(M.allegiance)===o&&M.piece==="K"),P=i.find(M=>X(M.allegiance)===o&&M.piece!=="K");if(E&&v&&(!P||P.piece==="N"||P.piece==="B")&&(!b||b.piece==="N"||b.piece==="B"))return{kind:"game-over",outcome:"draw",reason:"Insufficient material (king + minor vs king + minor)"}}if(this.halfmoveClock>=100)return{kind:"game-over",outcome:"draw",reason:"50 move-rule"};const f=this.getPositionCount(),p=this.toAFEN({sections:["positions"]});if((f.get(p)||0)>=3)return{kind:"game-over",outcome:"draw",reason:"Repetition"}}getCheckMoves(){const t=this.getPossibleMoves();return this.getCheckMovesFromList(t)}getCheckMovesFromList(t){return t.filter(r=>{if(r.kind!=="move"||!r.to)return;const n=this.memory.getSquare(r.to);return n&&n.piece==="K"})}getValidMovesFromList(t,r){const n=t.filter(o=>{if(o.kind!=="move")return!0;if(r.from&&!H(r.from,o.from))return!1;const a=this.memory.getSquare(o.from);if(X(a.allegiance)!==this.activeColour)return!1;const s=this.clone();s.executeNode(o);const l=s.getPossibleMoves();return s.getCheckMovesFromList(l).every(c=>{const f=s.getSquare(c.to);return X(f.allegiance)!==this.activeColour})}),i=this.getGameOverNode(t,n);return i?[i]:n}getValidMoves(t){const r=this.getPossibleMoves();return this.getValidMovesFromList(r,{from:t,side:this.activeColour})}}const cv={key:0,class:"absolute absolute-bottom-right q-px-sm"},fv={key:1,class:"absolute absolute-top-left q-pa-xs"},dv=De({__name:"background-layer",props:{ranks:{},files:{},perspective:{},loading:{type:Boolean}},setup(e){const t=gi();return(r,n)=>(D(),ne("div",{class:Ve([{loading:r.loading},"row column full-width full-height no-pointer-events background-layer"]),"data-testid":"background"},[(D(!0),ne(dt,null,ht(r.ranks,(i,o)=>(D(),ne("div",{class:"rank col row full-width",key:o},[(D(!0),ne(dt,null,ht(r.files,(a,s)=>(D(),ne("div",{key:s,class:Ve(["file col relative-position",{"text-h6 text-bold":se(t).screen.gt.sm,"text-subtitle1 text-bold":se(t).screen.sm,"text-subtitle2":se(t).screen.lt.sm}])},[o===7?(D(),ne("span",cv,kt(se($t)(r.perspective==="white"?9-(8-s):8-s)),1)):ce("",!0),s===0?(D(),ne("span",fv,kt(r.perspective==="white"?8-o:9-(8-o)),1)):ce("",!0)],2))),128))]))),128))],2))}});var hv=Xe(dv,[["__scopeId","data-v-7bbfc6bd"]]);const pv={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function vv({showing:e,avoidEmit:t,configureAnchorEl:r}){const{props:n,proxy:i,emit:o}=xt(),a=B(null);let s=null;function l(h){return a.value===null?!1:h===void 0||h.touches===void 0||h.touches.length<=1}const u={};r===void 0&&(Object.assign(u,{hide(h){i.hide(h)},toggle(h){i.toggle(h),h.qAnchorHandled=!0},toggleKey(h){yi(h,13)===!0&&u.toggle(h)},contextClick(h){i.hide(h),Yi(h),Oa(()=>{i.show(h),h.qAnchorHandled=!0})},prevent:Yi,mobileTouch(h){if(u.mobileCleanup(h),l(h)!==!0)return;i.hide(h),a.value.classList.add("non-selectable");const v=h.target;Ji(u,"anchor",[[v,"touchmove","mobileCleanup","passive"],[v,"touchend","mobileCleanup","passive"],[v,"touchcancel","mobileCleanup","passive"],[a.value,"contextmenu","prevent","notPassive"]]),s=setTimeout(()=>{s=null,i.show(h),h.qAnchorHandled=!0},300)},mobileCleanup(h){a.value.classList.remove("non-selectable"),s!==null&&(clearTimeout(s),s=null),e.value===!0&&h!==void 0&&Ql()}}),r=function(h=n.contextMenu){if(n.noParentEvent===!0||a.value===null)return;let v;h===!0?i.$q.platform.is.mobile===!0?v=[[a.value,"touchstart","mobileTouch","passive"]]:v=[[a.value,"mousedown","hide","passive"],[a.value,"contextmenu","contextClick","notPassive"]]:v=[[a.value,"click","toggle","passive"],[a.value,"keyup","toggleKey","passive"]],Ji(u,"anchor",v)});function c(){Tl(u,"anchor")}function f(h){for(a.value=h;a.value.classList.contains("q-anchor--skip");)a.value=a.value.parentNode;r()}function p(){if(n.target===!1||n.target===""||i.$el.parentNode===null)a.value=null;else if(n.target===!0)f(i.$el.parentNode);else{let h=n.target;if(typeof n.target=="string")try{h=document.querySelector(n.target)}catch{h=void 0}h!=null?(a.value=h.$el||h,r()):(a.value=null,console.error(`Anchor: target "${n.target}" not found`))}}return qe(()=>n.contextMenu,h=>{a.value!==null&&(c(),r(h))}),qe(()=>n.target,()=>{a.value!==null&&c(),p()}),qe(()=>n.noParentEvent,h=>{a.value!==null&&(h===!0?c():r())}),mi(()=>{p(),t!==!0&&n.modelValue===!0&&a.value===null&&o("update:modelValue",!1)}),pt(()=>{s!==null&&clearTimeout(s),c()}),{anchorEl:a,canShow:l,anchorEvents:u}}function gv(e,t){const r=B(null);let n;function i(s,l){const u=`${l!==void 0?"add":"remove"}EventListener`,c=l!==void 0?l:n;s!==window&&s[u]("scroll",c,Vn.passive),window[u]("scroll",c,Vn.passive),n=l}function o(){r.value!==null&&(i(r.value),r.value=null)}const a=qe(()=>e.noParentEvent,()=>{r.value!==null&&(o(),t())});return pt(a),{localScrollTarget:r,unconfigureScrollTarget:o,changeScrollEvent:i}}const Tt=[];function yv(e){return Tt.find(t=>t.contentEl!==null&&t.contentEl.contains(e))}function vl(e,t){do{if(e.$options.name==="QMenu"){if(e.hide(t),e.$props.separateClosePopup===!0)return Pr(e)}else if(e.__qPortal===!0){const r=Pr(e);return r!==void 0&&r.$options.name==="QPopupProxy"?(e.hide(t),r):e}e=Pr(e)}while(e!=null)}function mv(e,t,r){for(;r!==0&&e!==void 0&&e!==null;){if(e.__qPortal===!0){if(r--,e.$options.name==="QMenu"){e=vl(e,t);continue}e.hide(t)}e=Pr(e)}}function bv(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function gl(e,t,r,n){const i=B(!1),o=B(!1);let a=null;const s={},l=n==="dialog"&&bv(e);function u(f){if(f===!0){ro(s),o.value=!0;return}o.value=!1,i.value===!1&&(l===!1&&a===null&&(a=Ml(!1,n)),i.value=!0,Tt.push(e.proxy),tu(s))}function c(f){if(o.value=!1,f!==!0)return;ro(s),i.value=!1;const p=Tt.indexOf(e.proxy);p!==-1&&Tt.splice(p,1),a!==null&&($l(a),a=null)}return jl(()=>{c(!0)}),e.proxy.__qPortal=!0,Cl(e.proxy,"contentEl",()=>t.value),{showPortal:u,hidePortal:c,portalIsActive:i,portalIsAccessible:o,renderPortal:()=>l===!0?r():i.value===!0?[te(Nl,{to:a},r())]:void 0}}const yl={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function ml(e,t=()=>{},r=()=>{}){return{transitionProps:x(()=>{const n=`q-transition--${e.transitionShow||t()}`,i=`q-transition--${e.transitionHide||r()}`;return{appear:!0,enterFromClass:`${n}-enter-from`,enterActiveClass:`${n}-enter-active`,enterToClass:`${n}-enter-to`,leaveFromClass:`${i}-leave-from`,leaveActiveClass:`${i}-leave-active`,leaveToClass:`${i}-leave-to`}}),transitionStyle:x(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}function bl(){let e;const t=xt();function r(){e=void 0}return Pa(r),pt(r),{removeTick:r,registerTick(n){e=n,Oa(()=>{e===n&&(ql(t)===!1&&e(),e=void 0)})}}}const ut=[];let qt;function wv(e){qt=e.keyCode===27}function Sv(){qt===!0&&(qt=!1)}function kv(e){qt===!0&&(qt=!1,yi(e,27)===!0&&ut[ut.length-1](e))}function wl(e){window[e]("keydown",wv),window[e]("blur",Sv),window[e]("keyup",kv),qt=!1}function Sl(e){bi.is.desktop===!0&&(ut.push(e),ut.length===1&&wl("addEventListener"))}function Zr(e){const t=ut.indexOf(e);t>-1&&(ut.splice(t,1),ut.length===0&&wl("removeEventListener"))}const ct=[];function kl(e){ct[ct.length-1](e)}function _l(e){bi.is.desktop===!0&&(ct.push(e),ct.length===1&&document.body.addEventListener("focusin",kl))}function pi(e){const t=ct.indexOf(e);t>-1&&(ct.splice(t,1),ct.length===0&&document.body.removeEventListener("focusin",kl))}const{notPassiveCapture:en}=Vn,ft=[];function tn(e){const t=e.target;if(t===void 0||t.nodeType===8||t.classList.contains("no-pointer-events")===!0)return;let r=Tt.length-1;for(;r>=0;){const n=Tt[r].$;if(n.type.name==="QTooltip"){r--;continue}if(n.type.name!=="QDialog")break;if(n.props.seamless!==!0)return;r--}for(let n=ft.length-1;n>=0;n--){const i=ft[n];if((i.anchorEl.value===null||i.anchorEl.value.contains(t)===!1)&&(t===document.body||i.innerRef.value!==null&&i.innerRef.value.contains(t)===!1))e.qClickOutside=!0,i.onClickOutside(e);else return}}function _v(e){ft.push(e),ft.length===1&&(document.addEventListener("mousedown",tn,en),document.addEventListener("touchstart",tn,en))}function pa(e){const t=ft.findIndex(r=>r===e);t>-1&&(ft.splice(t,1),ft.length===0&&(document.removeEventListener("mousedown",tn,en),document.removeEventListener("touchstart",tn,en)))}let va,ga;function ya(e){const t=e.split(" ");return t.length!==2?!1:["top","center","bottom"].includes(t[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(t[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function Ev(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const vi={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{vi[`${e}#ltr`]=e,vi[`${e}#rtl`]=e});function ma(e,t){const r=e.split(" ");return{vertical:r[0],horizontal:vi[`${r[1]}#${t===!0?"rtl":"ltr"}`]}}function Av(e,t){let{top:r,left:n,right:i,bottom:o,width:a,height:s}=e.getBoundingClientRect();return t!==void 0&&(r-=t[1],n-=t[0],o+=t[1],i+=t[0],a+=t[0],s+=t[1]),{top:r,bottom:o,height:s,left:n,right:i,width:a,middle:n+(i-n)/2,center:r+(o-r)/2}}function Rv(e,t,r){let{top:n,left:i}=e.getBoundingClientRect();return n+=t.top,i+=t.left,r!==void 0&&(n+=r[1],i+=r[0]),{top:n,bottom:n+1,height:1,left:i,right:i+1,width:1,middle:i,center:n}}function Ov(e,t){return{top:0,center:t/2,bottom:t,left:0,middle:e/2,right:e}}function ba(e,t,r,n){return{top:e[r.vertical]-t[n.vertical],left:e[r.horizontal]-t[n.horizontal]}}function El(e,t=0){if(e.targetEl===null||e.anchorEl===null||t>5)return;if(e.targetEl.offsetHeight===0||e.targetEl.offsetWidth===0){setTimeout(()=>{El(e,t+1)},10);return}const{targetEl:r,offset:n,anchorEl:i,anchorOrigin:o,selfOrigin:a,absoluteOffset:s,fit:l,cover:u,maxHeight:c,maxWidth:f}=e;if(bi.is.ios===!0&&window.visualViewport!==void 0){const T=document.body.style,{offsetLeft:w,offsetTop:U}=window.visualViewport;w!==va&&(T.setProperty("--q-pe-left",w+"px"),va=w),U!==ga&&(T.setProperty("--q-pe-top",U+"px"),ga=U)}const{scrollLeft:p,scrollTop:h}=r,v=s===void 0?Av(i,u===!0?[0,0]:n):Rv(i,s,n);Object.assign(r.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:f||"100vw",maxHeight:c||"100vh",visibility:"visible"});const{offsetWidth:b,offsetHeight:E}=r,{elWidth:P,elHeight:M}=l===!0||u===!0?{elWidth:Math.max(v.width,b),elHeight:u===!0?Math.max(v.height,E):E}:{elWidth:b,elHeight:E};let j={maxWidth:f,maxHeight:c};(l===!0||u===!0)&&(j.minWidth=v.width+"px",u===!0&&(j.minHeight=v.height+"px")),Object.assign(r.style,j);const S=Ov(P,M);let k=ba(v,S,o,a);if(s===void 0||n===void 0)Hn(k,v,S,o,a);else{const{top:T,left:w}=k;Hn(k,v,S,o,a);let U=!1;if(k.top!==T){U=!0;const K=2*n[1];v.center=v.top-=K,v.bottom-=K+2}if(k.left!==w){U=!0;const K=2*n[0];v.middle=v.left-=K,v.right-=K+2}U===!0&&(k=ba(v,S,o,a),Hn(k,v,S,o,a))}j={top:k.top+"px",left:k.left+"px"},k.maxHeight!==void 0&&(j.maxHeight=k.maxHeight+"px",v.height>k.maxHeight&&(j.minHeight=j.maxHeight)),k.maxWidth!==void 0&&(j.maxWidth=k.maxWidth+"px",v.width>k.maxWidth&&(j.minWidth=j.maxWidth)),Object.assign(r.style,j),r.scrollTop!==h&&(r.scrollTop=h),r.scrollLeft!==p&&(r.scrollLeft=p)}function Hn(e,t,r,n,i){const o=r.bottom,a=r.right,s=Yl(),l=window.innerHeight-s,u=document.body.clientWidth;if(e.top<0||e.top+o>l)if(i.vertical==="center")e.top=t[n.vertical]>l/2?Math.max(0,l-o):0,e.maxHeight=Math.min(o,l);else if(t[n.vertical]>l/2){const c=Math.min(l,n.vertical==="center"?t.center:n.vertical===i.vertical?t.bottom:t.top);e.maxHeight=Math.min(o,c),e.top=Math.max(0,c-o)}else e.top=Math.max(0,n.vertical==="center"?t.center:n.vertical===i.vertical?t.top:t.bottom),e.maxHeight=Math.min(o,l-e.top);if(e.left<0||e.left+a>u)if(e.maxWidth=Math.min(a,u),i.horizontal==="middle")e.left=t[n.horizontal]>u/2?Math.max(0,u-a):0;else if(t[n.horizontal]>u/2){const c=Math.min(u,n.horizontal==="middle"?t.middle:n.horizontal===i.horizontal?t.right:t.left);e.maxWidth=Math.min(a,c),e.left=Math.max(0,c-e.maxWidth)}else e.left=Math.max(0,n.horizontal==="middle"?t.middle:n.horizontal===i.horizontal?t.left:t.right),e.maxWidth=Math.min(a,u-e.left)}var Al=ir({name:"QMenu",inheritAttrs:!1,props:{...pv,...Na,...ki,...yl,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:ya},self:{type:String,validator:ya},offset:{type:Array,validator:Ev},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...Ma,"click","escapeKey"],setup(e,{slots:t,emit:r,attrs:n}){let i=null,o,a,s;const l=xt(),{proxy:u}=l,{$q:c}=u,f=B(null),p=B(!1),h=x(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),v=_i(e,c),{registerTick:b,removeTick:E}=bl(),{registerTimeout:P}=$a(),{transitionProps:M,transitionStyle:j}=ml(e),{localScrollTarget:S,changeScrollEvent:k,unconfigureScrollTarget:T}=gv(e,g),{anchorEl:w,canShow:U}=vv({showing:p}),{hide:K}=qa({showing:p,canShow:U,handleShow:he,handleHide:Me,hideOnRouteChange:h,processOnMount:!0}),{showPortal:de,hidePortal:le,renderPortal:ve}=gl(l,f,I,"menu"),Oe={anchorEl:w,innerRef:f,onClickOutside(O){if(e.persistent!==!0&&p.value===!0)return K(O),(O.type==="touchstart"||O.target.classList.contains("q-dialog__backdrop"))&&ja(O),!0}},me=x(()=>ma(e.anchor||(e.cover===!0?"center middle":"bottom start"),c.lang.rtl)),we=x(()=>e.cover===!0?me.value:ma(e.self||"top start",c.lang.rtl)),R=x(()=>(e.square===!0?" q-menu--square":"")+(v.value===!0?" q-menu--dark q-dark":"")),q=x(()=>e.autoClose===!0?{onClick:m}:{}),L=x(()=>p.value===!0&&e.persistent!==!0);qe(L,O=>{O===!0?(Sl(N),_v(Oe)):(Zr(N),pa(Oe))});function re(){xa(()=>{let O=f.value;O&&O.contains(document.activeElement)!==!0&&(O=O.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||O.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||O.querySelector("[autofocus], [data-autofocus]")||O,O.focus({preventScroll:!0}))})}function he(O){if(i=e.noRefocus===!1?document.activeElement:null,_l(A),de(),g(),o=void 0,O!==void 0&&(e.touchPosition||e.contextMenu)){const J=xl(O);if(J.left!==void 0){const{top:ge,left:Ie}=w.value.getBoundingClientRect();o={left:J.left-Ie,top:J.top-ge}}}a===void 0&&(a=qe(()=>c.screen.width+"|"+c.screen.height+"|"+e.self+"|"+e.anchor+"|"+c.lang.rtl,F)),e.noFocus!==!0&&document.activeElement.blur(),b(()=>{F(),e.noFocus!==!0&&re()}),P(()=>{c.platform.is.ios===!0&&(s=e.autoClose,f.value.click()),F(),de(!0),r("show",O)},e.transitionDuration)}function Me(O){E(),le(),d(!0),i!==null&&(O===void 0||O.qClickOutside!==!0)&&(((O&&O.type.indexOf("key")===0?i.closest('[tabindex]:not([tabindex^="-"])'):void 0)||i).focus(),i=null),P(()=>{le(!0),r("hide",O)},e.transitionDuration)}function d(O){o=void 0,a!==void 0&&(a(),a=void 0),(O===!0||p.value===!0)&&(pi(A),T(),pa(Oe),Zr(N)),O!==!0&&(i=null)}function g(){(w.value!==null||e.scrollTarget!==void 0)&&(S.value=Jl(w.value,e.scrollTarget),k(S.value,F))}function m(O){s!==!0?(vl(u,O),r("click",O)):s=!1}function A(O){L.value===!0&&e.noFocus!==!0&&Ta(f.value,O.target)!==!0&&re()}function N(O){r("escapeKey"),K(O)}function F(){El({targetEl:f.value,offset:e.offset,anchorEl:w.value,anchorOrigin:me.value,selfOrigin:we.value,absoluteOffset:o,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function I(){return te(Yt,M.value,()=>p.value===!0?te("div",{role:"menu",...n,ref:f,tabindex:-1,class:["q-menu q-position-engine scroll"+R.value,n.class],style:[n.style,j.value],...q.value},wi(t.default)):null)}return pt(d),Object.assign(u,{focus:re,updatePosition:F}),ve}});const Pv=De({__name:"promotion-selector",props:{modelValue:{type:Boolean},allegiance:{}},emits:["click","dismiss"],setup(e,{emit:t}){const r=["Q","N","R","B"],n=()=>{t("dismiss")};return(i,o)=>(D(),oe(Al,{cover:"","model-value":i.modelValue,"onUpdate:modelValue":n},{default:Q(()=>[Y(Ca,null,{default:Q(()=>[(D(),ne(dt,null,ht(r,a=>Y(Ur,{clickable:"",key:a,class:"q-pa-sm",onClick:s=>t("click",a)},{default:Q(()=>[Y(Xt,{class:"promotion-piece items-center"},{default:Q(()=>[Y(jt,{allegiance:i.allegiance,piece:a,size:92},null,8,["allegiance","piece"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1},8,["model-value"]))}});var Tv=Xe(Pv,[["__scopeId","data-v-370c2c26"]]);const jv=De({__name:"capture-selector",props:{modelValue:{type:Boolean},moves:{}},emits:["click","dismiss"],setup(e,{emit:t}){const r=()=>{t("dismiss")};return(n,i)=>(D(),oe(Al,{cover:"","model-value":n.modelValue,"onUpdate:modelValue":r},{default:Q(()=>[Y(Ca,null,{default:Q(()=>[n.moves.includes("x")?(D(),oe(Ur,{key:0,clickable:"",onClick:i[0]||(i[0]=o=>t("click","capture")),class:"q-py-lg"},{default:Q(()=>[Y(Xt,{class:"items-center"},{default:Q(()=>[Y(at,{size:"72px",name:"close"})]),_:1})]),_:1})):ce("",!0),n.moves.includes(">")?(D(),oe(Ur,{key:1,clickable:"",onClick:i[1]||(i[1]=o=>t("click","challenge")),class:"q-py-lg"},{default:Q(()=>[Y(Xt,{class:"items-center"},{default:Q(()=>[Y(at,{size:"64px",name:"arrow_forward_ios"})]),_:1})]),_:1})):ce("",!0)]),_:1})]),_:1},8,["model-value"]))}});const Cv={class:"relative-position full-width full-height interaction-layer row wrap"},Nv=["onClick"],Mv=De({__name:"interaction-layer",props:{enPassantTarget:{},squares:{},ranks:{},files:{},perspective:{},pieceFocus:{},validMoves:{},activeColour:{}},emits:["execute-node-index","update-piece-focus","update-highlights"],setup(e,{emit:t}){const r=e,n=B(null),i=B(null),o=B(null),a=S=>r.squares.find(k=>H(k,S)),s=x(()=>r.pieceFocus?a(r.pieceFocus):null),l=x(()=>r.pieceFocus?r.validMoves.filter(T=>T.kind==="move"&&H(r.pieceFocus,T.from)).map(T=>T.kind!=="move"?null:T.to).filter(Boolean):[]),u=S=>{const k=r.squares.find(T=>H(T,S));return k?X(k.allegiance)!==r.perspective:!1},c=S=>l.value.some(k=>k&&H(S,k)),f=(S,k)=>{var w,U;if(k.stopPropagation(),k.preventDefault(),c(S)&&r.pieceFocus&&s.value){if(r.enPassantTarget&&H(r.enPassantTarget,S))t("execute-node-index",C.findMoveIndex(r.validMoves,{kind:"move",type:"en-passant",from:r.pieceFocus,to:S})),t("update-piece-focus",null);else if(Le(S,r.activeColour)&&s&&s.value.piece===null){i.value=S;const K=a(r.pieceFocus);o.value=(w=K==null?void 0:K.allegiance)!=null?w:null}else a(S)?n.value=S:((U=s.value)==null?void 0:U.piece)==="K"&&Math.abs(r.pieceFocus.file-S.file)>1?t("execute-node-index",C.findMoveIndex(r.validMoves,{kind:"move",type:"castle",side:S.file===7?"king":"queen",from:r.pieceFocus,to:S})):t("execute-node-index",C.findMoveIndex(r.validMoves,{kind:"move",from:r.pieceFocus,to:S}));return}if(u(S))return;const T=a(S);t("update-piece-focus",T?S:null)},p=(S,k)=>{if(!r.pieceFocus)return;i.value=null;const T=C.findMoveIndex(r.validMoves,{kind:"move",type:"promotion",from:r.pieceFocus,to:S,promotionTo:k});t("execute-node-index",T),t("update-piece-focus",null)},h=()=>{i.value=null,o.value=null},v=()=>{n.value=null},b=S=>{if(!r.pieceFocus||!n.value)return;const k=C.findMoveIndex(r.validMoves,{kind:"move",type:S==="capture"?"capture":"allegiance",from:r.pieceFocus,to:n.value});t("execute-node-index",k),n.value=null,t("update-piece-focus",null)},E=S=>!a(S),P=(S,k,T)=>r.validMoves.some(w=>w.kind==="move"&&H(w.to,T)&&H(w.from,k)&&w.type===S),M=x(()=>{const S=[];return!r.pieceFocus||!n.value||(P("allegiance",r.pieceFocus,n.value)&&S.push(">"),P("capture",r.pieceFocus,n.value)&&S.push("x")),S}),j=S=>r.perspective==="white"?nr(S):nr(63-S);return(S,k)=>(D(),ne("div",Cv,[(D(),ne(dt,null,ht(64,(T,w)=>{var U,K;return Jt(Se("div",{key:w,class:Ve(["relative-position interaction-square",{"cursor-pointer":!E(j(w))||c(j(w)),"cursor-not-allowed":u(j(w))&&!s.value}]),onClick:de=>f(j(w),de)},[n.value&&se(H)(n.value,j(w))?(D(),oe(jv,{key:0,moves:M.value,"model-value":(U=se(H)(n.value,j(w)))!=null?U:!1,onClick:b,onDismiss:v},null,8,["moves","model-value"])):ce("",!0),o.value!==null&&(se(Le)(j(w),"white")||se(Le)(j(w),"black"))?(D(),oe(Tv,{key:1,"model-value":(K=se(H)(i.value,j(w)))!=null?K:!1,allegiance:o.value,onClick:de=>p(j(w),de),onDismiss:h},null,8,["model-value","allegiance","onClick"])):ce("",!0)],10,Nv),[[Si,!E(j(w))&&!u(j(w))]])}),64))]))}});var $v=Xe(Mv,[["__scopeId","data-v-61e6cc90"]]);const qv={class:"relative-position full-width full-height row no-pointer-events indicators-layer"},xv=De({__name:"indicators-layer",props:{squares:{},checkMoves:{},validMoves:{},ranks:{},files:{},perspective:{},pieceFocus:{},lastMove:{}},setup(e){const t=e,r=x(()=>t.pieceFocus?t.validMoves.filter(u=>u.kind==="move"&&H(t.pieceFocus,u.from)).map(u=>u.kind!=="move"?null:u.to).filter(Boolean):[]),n=s=>r.value.some(l=>l&&H(s,l)),i=s=>!t.squares.find(l=>H(s,l)),o=s=>t.checkMoves.some(l=>l.kind==="move"&&H(l.to,s)),a=s=>t.perspective==="white"?nr(s):nr(63-s);return(s,l)=>(D(),ne("div",qv,[(D(),ne(dt,null,ht(64,(u,c)=>{var f,p;return Se("div",{key:c,class:Ve(["indicator-square move-placeholder",{even:(a(c).file+a(c).rank)%2!==0,focus:se(H)(s.pieceFocus,a(c)),show:n(a(c)),capture:!i(a(c)),target:i(a(c)),checked:o(a(c)),"last-from":((f=s.lastMove)==null?void 0:f.kind)==="move"&&se(H)(s.lastMove.from,a(c)),"last-to":((p=s.lastMove)==null?void 0:p.kind)==="move"&&se(H)(s.lastMove.to,a(c))}])},null,2)}),64))]))}});var Dv=Xe(xv,[["__scopeId","data-v-1f3d6516"]]);const Iv={class:"relative-position full-width full-height no-pointer-events pieces-layer row wrap"},Lv=De({__name:"pieces-layer",props:{modelValue:{},perspective:{}},setup(e){const t=e,r=gi(),n=i=>t.perspective==="white"?t.modelValue[i]:t.modelValue[63-i];return(i,o)=>(D(),ne("div",Iv,[(D(),ne(dt,null,ht(64,(a,s)=>Se("div",{key:s,class:"piece-square"},[n(s)?(D(),oe(jt,{key:0,"data-testid":"piece",class:Ve({"q-pa-xs":se(r).screen.sm||se(r).screen.md,"q-pa-sm":se(r).screen.gt.sm}),piece:n(s).piece,allegiance:n(s).allegiance},null,8,["class","piece","allegiance"])):ce("",!0)])),64))]))}});var Fv=Xe(Lv,[["__scopeId","data-v-20f57457"]]);const Bv={"data-testid":"chess-board",class:"relative-position column chess-board"},zv={class:"absolute full-width full-height"},Uv={class:"absolute full-width full-height"},Wv={class:"absolute full-width full-height"},Hv={class:"absolute full-width full-height"},Gv=De({__name:"chess-board",props:{squares:{},moveHistoryAst:{},checkMoves:{},perspective:{},playAs:{},validMoves:{},activeColour:{},enPassantTarget:{},loading:{type:Boolean}},emits:["execute-node-index"],setup(e,{emit:t}){const r=e,n=B(null),i=a=>{t("execute-node-index",a),n.value=null},o=x(()=>{var a;return(a=r.moveHistoryAst.children.at(-1))!=null?a:null});return(a,s)=>(D(),ne("div",Bv,[Se("div",zv,[Y(hv,{ranks:8,files:8,perspective:a.perspective,loading:a.loading},null,8,["perspective","loading"])]),Se("div",Uv,[Y(Dv,{"valid-moves":a.validMoves,"check-moves":a.checkMoves,squares:a.squares,files:8,ranks:8,perspective:a.perspective,"piece-focus":n.value,"last-move":o.value},null,8,["valid-moves","check-moves","squares","perspective","piece-focus","last-move"])]),Se("div",Wv,[Y(Fv,{"model-value":a.squares,perspective:r.perspective},null,8,["model-value","perspective"])]),Se("div",Hv,[Y($v,{onExecuteNodeIndex:i,onUpdatePieceFocus:s[0]||(s[0]=l=>n.value=l),"piece-focus":n.value,squares:a.squares,"en-passant-target":a.enPassantTarget,"active-colour":a.activeColour,files:8,ranks:8,perspective:a.perspective,"valid-moves":a.validMoves},null,8,["piece-focus","squares","en-passant-target","active-colour","perspective","valid-moves"])])]))}});var Ng=Xe(Gv,[["__scopeId","data-v-6551187e"]]);const Vv={xs:8,sm:10,md:14,lg:20,xl:24};var wa=ir({name:"QChip",props:{...ki,...Dl,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:t,emit:r}){const{proxy:{$q:n}}=xt(),i=_i(e,n),o=Il(e,Vv),a=x(()=>e.selected===!0||e.icon!==void 0),s=x(()=>e.selected===!0?e.iconSelected||n.iconSet.chip.selected:e.icon),l=x(()=>e.iconRemove||n.iconSet.chip.remove),u=x(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),c=x(()=>{const E=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(E?` text-${E} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(u.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(i.value===!0?" q-chip--dark q-dark":"")}),f=x(()=>{const E=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},P={...E,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||n.lang.label.remove};return{chip:E,remove:P}});function p(E){E.keyCode===13&&h(E)}function h(E){e.disable||(r("update:selected",!e.selected),r("click",E))}function v(E){(E.keyCode===void 0||E.keyCode===13)&&(ja(E),e.disable===!1&&(r("update:modelValue",!1),r("remove")))}function b(){const E=[];u.value===!0&&E.push(te("div",{class:"q-focus-helper"})),a.value===!0&&E.push(te(at,{class:"q-chip__icon q-chip__icon--left",name:s.value}));const P=e.label!==void 0?[te("div",{class:"ellipsis"},[e.label])]:void 0;return E.push(te("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},Fl(t.default,P))),e.iconRight&&E.push(te(at,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&E.push(te(at,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:l.value,...f.value.remove,onClick:v,onKeyup:v})),E}return()=>{if(e.modelValue===!1)return;const E={class:c.value,style:o.value};return u.value===!0&&Object.assign(E,f.value.chip,{onClick:h,onKeyup:p}),Ll("div",E,b(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[Si,e.ripple]])}}});const Sa=["vertical","horizontal"],Gn={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},ka={prevent:!0,mouse:!0,mouseAllDir:!0},_a=e=>e>=250?50:Math.ceil(e/5);var Kv=ir({name:"QScrollArea",props:{...ki,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:t,emit:r}){const n=B(!1),i=B(!1),o=B(!1),a={vertical:B(0),horizontal:B(0)},s={vertical:{ref:B(null),position:B(0),size:B(0)},horizontal:{ref:B(null),position:B(0),size:B(0)}},{proxy:l}=xt(),u=_i(e,l.$q);let c=null,f;const p=B(null),h=x(()=>"q-scrollarea"+(u.value===!0?" q-scrollarea--dark":""));s.vertical.percentage=x(()=>{const R=s.vertical.size.value-a.vertical.value;if(R<=0)return 0;const q=br(s.vertical.position.value/R,0,1);return Math.round(q*1e4)/1e4}),s.vertical.thumbHidden=x(()=>(e.visible===null?o.value:e.visible)!==!0&&n.value===!1&&i.value===!1||s.vertical.size.value<=a.vertical.value+1),s.vertical.thumbStart=x(()=>s.vertical.percentage.value*(a.vertical.value-s.vertical.thumbSize.value)),s.vertical.thumbSize=x(()=>Math.round(br(a.vertical.value*a.vertical.value/s.vertical.size.value,_a(a.vertical.value),a.vertical.value))),s.vertical.style=x(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${s.vertical.thumbStart.value}px`,height:`${s.vertical.thumbSize.value}px`})),s.vertical.thumbClass=x(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(s.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),s.vertical.barClass=x(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(s.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),s.horizontal.percentage=x(()=>{const R=s.horizontal.size.value-a.horizontal.value;if(R<=0)return 0;const q=br(Math.abs(s.horizontal.position.value)/R,0,1);return Math.round(q*1e4)/1e4}),s.horizontal.thumbHidden=x(()=>(e.visible===null?o.value:e.visible)!==!0&&n.value===!1&&i.value===!1||s.horizontal.size.value<=a.horizontal.value+1),s.horizontal.thumbStart=x(()=>s.horizontal.percentage.value*(a.horizontal.value-s.horizontal.thumbSize.value)),s.horizontal.thumbSize=x(()=>Math.round(br(a.horizontal.value*a.horizontal.value/s.horizontal.size.value,_a(a.horizontal.value),a.horizontal.value))),s.horizontal.style=x(()=>({...e.thumbStyle,...e.horizontalThumbStyle,[l.$q.lang.rtl===!0?"right":"left"]:`${s.horizontal.thumbStart.value}px`,width:`${s.horizontal.thumbSize.value}px`})),s.horizontal.thumbClass=x(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(s.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),s.horizontal.barClass=x(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(s.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const v=x(()=>s.vertical.thumbHidden.value===!0&&s.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),b=[[to,R=>{w(R,"vertical")},void 0,{vertical:!0,...ka}]],E=[[to,R=>{w(R,"horizontal")},void 0,{horizontal:!0,...ka}]];function P(){const R={};return Sa.forEach(q=>{const L=s[q];R[q+"Position"]=L.position.value,R[q+"Percentage"]=L.percentage.value,R[q+"Size"]=L.size.value,R[q+"ContainerSize"]=a[q].value}),R}const M=Bl(()=>{const R=P();R.ref=l,r("scroll",R)},0);function j(R,q,L){if(Sa.includes(R)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(R==="vertical"?eo:bn)(p.value,q,L)}function S({height:R,width:q}){let L=!1;a.vertical.value!==R&&(a.vertical.value=R,L=!0),a.horizontal.value!==q&&(a.horizontal.value=q,L=!0),L===!0&&le()}function k({position:R}){let q=!1;s.vertical.position.value!==R.top&&(s.vertical.position.value=R.top,q=!0),s.horizontal.position.value!==R.left&&(s.horizontal.position.value=R.left,q=!0),q===!0&&le()}function T({height:R,width:q}){s.horizontal.size.value!==q&&(s.horizontal.size.value=q,le()),s.vertical.size.value!==R&&(s.vertical.size.value=R,le())}function w(R,q){const L=s[q];if(R.isFirst===!0){if(L.thumbHidden.value===!0)return;f=L.position.value,i.value=!0}else if(i.value!==!0)return;R.isFinal===!0&&(i.value=!1);const re=Gn[q],he=a[q].value,Me=(L.size.value-he)/(he-L.thumbSize.value),d=R.distance[re.dist],g=f+(R.direction===re.dir?1:-1)*d*Me;ve(g,q)}function U(R,q){const L=s[q];if(L.thumbHidden.value!==!0){const re=R[Gn[q].offset];if(re<L.thumbStart.value||re>L.thumbStart.value+L.thumbSize.value){const he=re-L.thumbSize.value/2;ve(he/a[q].value*L.size.value,q)}L.ref.value!==null&&L.ref.value.dispatchEvent(new MouseEvent(R.type,R))}}function K(R){U(R,"vertical")}function de(R){U(R,"horizontal")}function le(){n.value=!0,c!==null&&clearTimeout(c),c=setTimeout(()=>{c=null,n.value=!1},e.delay),e.onScroll!==void 0&&M()}function ve(R,q){p.value[Gn[q].scroll]=R}function Oe(){o.value=!0}function me(){o.value=!1}let we=null;return qe(()=>l.$q.lang.rtl,R=>{p.value!==null&&bn(p.value,Math.abs(s.horizontal.position.value)*(R===!0?-1:1))}),Pa(()=>{we={top:s.vertical.position.value,left:s.horizontal.position.value}}),zl(()=>{if(we===null)return;const R=p.value;R!==null&&(bn(R,we.left),eo(R,we.top))}),pt(M.cancel),Object.assign(l,{getScrollTarget:()=>p.value,getScroll:P,getScrollPosition:()=>({top:s.vertical.position.value,left:s.horizontal.position.value}),getScrollPercentage:()=>({top:s.vertical.percentage.value,left:s.horizontal.percentage.value}),setScrollPosition:j,setScrollPercentage(R,q,L){j(R,q*(s[R].size.value-a[R].value)*(R==="horizontal"&&l.$q.lang.rtl===!0?-1:1),L)}}),()=>te("div",{class:h.value,onMouseenter:Oe,onMouseleave:me},[te("div",{ref:p,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[te("div",{class:"q-scrollarea__content absolute",style:v.value},Ul(t.default,[te(Zi,{debounce:0,onResize:T})])),te(Xl,{axis:"both",onScroll:k})]),te(Zi,{debounce:0,onResize:S}),te("div",{class:s.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:K}),te("div",{class:s.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:de}),Jt(te("div",{ref:s.vertical.ref,class:s.vertical.thumbClass.value,style:s.vertical.style.value,"aria-hidden":"true"}),b),Jt(te("div",{ref:s.horizontal.ref,class:s.horizontal.thumbClass.value,style:s.horizontal.style.value,"aria-hidden":"true"}),E)])}});const Ki=e=>(Wl("data-v-4d089925"),e=e(),Hl(),e),Qv=Ki(()=>Se("div",{class:"text-h6"},"Your turn!",-1)),Yv=Ki(()=>Se("div",{class:"text-h6"},"Waiting for opponent...",-1)),Jv=Ki(()=>Se("div",{class:"text-h6"},"Game over!",-1)),Xv={"data-testid":"afen"},Zv={"data-testid":"move-history",class:"col"},eg={key:0,class:"col-6"},tg={key:0,class:"col-6"},rg=De({__name:"game-sidebar",props:{moveHistory:{},activeColour:{},ownColour:{},afen:{},gameOver:{}},setup(e){const t=e,r=x(()=>{const a=[];return t.moveHistory.children.forEach(s=>{const l=a.at(-1);if(!l||l.length!==1){a.push([s]);return}l.push(s)}),a}),n=B(null);qe(r,()=>{!n.value||n.value.setScrollPosition("vertical",r.value.length*36,1e3)}),mi(()=>{!n.value||n.value.setScrollPosition("vertical",r.value.length*36,1e3)});const{notify:i}=ru(),o=()=>{if(!!t.afen)try{navigator.clipboard.writeText(t.afen),i({message:"AFEN copied to clipboard",icon:"content_copy"})}catch{i({message:"Could not write to clipboard",icon:"close",iconColor:"red"})}};return(a,s)=>(D(),oe(Ra,{flat:"",square:"",class:"column justify-between no-wrap full-height","data-testid":"game-sidebar"},{default:Q(()=>[Y(Yt,{mode:"out-in"},{default:Q(()=>[!a.gameOver&&a.activeColour===a.ownColour?(D(),oe(He,{key:0,class:"bg-primary text-white","data-testid":"your-turn-indicator"},{default:Q(()=>[Qv]),_:1})):a.gameOver?(D(),oe(He,{key:2,class:"bg-negative text-white q-mb-md","data-testid":"game-over-indicator"},{default:Q(()=>[Jv]),_:1})):(D(),oe(He,{key:1,"data-testid":"waiting-for-opponent-indicator",class:"bg-grey text-black"},{default:Q(()=>[Yv]),_:1}))]),_:1}),Or(a.$slots,"default",{},void 0,!0),Se("div",Xv,[Y(Kn),Jt((D(),oe(Ur,{clickable:"",onClick:o},{default:Q(()=>[Y(Xt,{class:"q-mt-sm q-mb-sm"},{default:Q(()=>[Y(no,null,{default:Q(()=>[mr("AFEN")]),_:1}),a.afen?(D(),oe(no,{key:0,caption:"",lines:"2"},{default:Q(()=>[mr(kt(a.afen),1)]),_:1})):ce("",!0)]),_:1}),Y(Xt,{side:""},{default:Q(()=>[Y(at,{name:"edit"})]),_:1})]),_:1})),[[Si]])]),Se("div",Zv,[Y(Kn),Y(se(Kv),{ref_key:"moveHistoryScrollArea",ref:n,class:"full-height"},{default:Q(()=>[(D(!0),ne(dt,null,ht(r.value,(l,u)=>(D(),oe(He,{key:u,horizontal:"",class:Ve(["row q-py-none q-mx-md",{"q-pt-md":u===0,"q-pb-md":u===r.value.length-1}])},{default:Q(()=>[l[0]?(D(),ne("div",eg,[Y(wa,{ripple:!1,class:Ve(["white-move",{highlight:l[0].kind!=="move"}])},{default:Q(()=>[l[0].kind==="move"&&l[0].piece?(D(),oe(jt,{key:0,piece:l[0].piece,allegiance:3,class:"chip-piece"},null,8,["piece"])):ce("",!0),mr(" "+kt(se(fa).writeNode(l[0])),1)]),_:2},1032,["class"])])):ce("",!0),Y(Yt,{mode:"out-in"},{default:Q(()=>[l[1]?(D(),ne("div",tg,[Y(wa,{ripple:!1,class:Ve(["black-move",{highlight:l[1].kind!=="move"}])},{default:Q(()=>[l[1].kind==="move"&&l[1].piece?(D(),oe(jt,{key:0,piece:l[1].piece,allegiance:0,class:"chip-piece"},null,8,["piece"])):ce("",!0),mr(" "+kt(se(fa).writeNode(l[1])),1)]),_:2},1032,["class"])])):ce("",!0)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1},512)])]),_:3}))}});var Mg=Xe(rg,[["__scopeId","data-v-4d089925"]]),ng=ir({name:"QCardActions",props:{...Gl,vertical:Boolean},setup(e,{slots:t}){const r=Vl(e),n=x(()=>`q-card__actions ${r.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>te("div",{class:n.value},wi(t.default))}});let Rr=0;const ig={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},Ea={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]};var og=ir({name:"QDialog",inheritAttrs:!1,props:{...Na,...yl,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,position:{type:String,default:"standard",validator:e=>e==="standard"||["top","bottom","left","right"].includes(e)}},emits:[...Ma,"shake","click","escapeKey"],setup(e,{slots:t,emit:r,attrs:n}){const i=xt(),o=B(null),a=B(!1),s=B(!1);let l=null,u=null,c,f;const p=x(()=>e.persistent!==!0&&e.noRouteDismiss!==!0&&e.seamless!==!0),{preventBodyScroll:h}=eu(),{registerTimeout:v}=$a(),{registerTick:b,removeTick:E}=bl(),{transitionProps:P,transitionStyle:M}=ml(e,()=>Ea[e.position][0],()=>Ea[e.position][1]),{showPortal:j,hidePortal:S,portalIsAccessible:k,renderPortal:T}=gl(i,o,m,"dialog"),{hide:w}=qa({showing:a,hideOnRouteChange:p,handleShow:me,handleHide:we,processOnMount:!0}),{addToHistory:U,removeFromHistory:K}=Zl(a,w,p),de=x(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${e.maximized===!0?"maximized":"minimized"} q-dialog__inner--${e.position} ${ig[e.position]}`+(s.value===!0?" q-dialog__inner--animating":"")+(e.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(e.fullHeight===!0?" q-dialog__inner--fullheight":"")+(e.square===!0?" q-dialog__inner--square":"")),le=x(()=>a.value===!0&&e.seamless!==!0),ve=x(()=>e.autoClose===!0?{onClick:Me}:{}),Oe=x(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${le.value===!0?"modal":"seamless"}`,n.class]);qe(()=>e.maximized,A=>{a.value===!0&&he(A)}),qe(le,A=>{h(A),A===!0?(_l(g),Sl(L)):(pi(g),Zr(L))});function me(A){U(),u=e.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,he(e.maximized),j(),s.value=!0,e.noFocus!==!0?(document.activeElement!==null&&document.activeElement.blur(),b(R)):E(),v(()=>{if(i.proxy.$q.platform.is.ios===!0){if(e.seamless!==!0&&document.activeElement){const{top:N,bottom:F}=document.activeElement.getBoundingClientRect(),{innerHeight:I}=window,O=window.visualViewport!==void 0?window.visualViewport.height:I;N>0&&F>O/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-O,F>=I?1/0:Math.ceil(document.scrollingElement.scrollTop+F-O/2))),document.activeElement.scrollIntoView()}f=!0,o.value.click(),f=!1}j(!0),s.value=!1,r("show",A)},e.transitionDuration)}function we(A){E(),K(),re(!0),s.value=!0,S(),u!==null&&(((A&&A.type.indexOf("key")===0?u.closest('[tabindex]:not([tabindex^="-"])'):void 0)||u).focus(),u=null),v(()=>{S(!0),s.value=!1,r("hide",A)},e.transitionDuration)}function R(A){xa(()=>{let N=o.value;N===null||N.contains(document.activeElement)===!0||(N=(A!==""?N.querySelector(A):null)||N.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||N.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||N.querySelector("[autofocus], [data-autofocus]")||N,N.focus({preventScroll:!0}))})}function q(A){A&&typeof A.focus=="function"?A.focus({preventScroll:!0}):R(),r("shake");const N=o.value;N!==null&&(N.classList.remove("q-animate--scale"),N.classList.add("q-animate--scale"),l!==null&&clearTimeout(l),l=setTimeout(()=>{l=null,o.value!==null&&(N.classList.remove("q-animate--scale"),R())},170))}function L(){e.seamless!==!0&&(e.persistent===!0||e.noEscDismiss===!0?e.maximized!==!0&&e.noShake!==!0&&q():(r("escapeKey"),w()))}function re(A){l!==null&&(clearTimeout(l),l=null),(A===!0||a.value===!0)&&(he(!1),e.seamless!==!0&&(h(!1),pi(g),Zr(L))),A!==!0&&(u=null)}function he(A){A===!0?c!==!0&&(Rr<1&&document.body.classList.add("q-body--dialog"),Rr++,c=!0):c===!0&&(Rr<2&&document.body.classList.remove("q-body--dialog"),Rr--,c=!1)}function Me(A){f!==!0&&(w(A),r("click",A))}function d(A){e.persistent!==!0&&e.noBackdropDismiss!==!0?w(A):e.noShake!==!0&&q()}function g(A){e.allowFocusOutside!==!0&&k.value===!0&&Ta(o.value,A.target)!==!0&&R('[tabindex]:not([tabindex="-1"])')}Object.assign(i.proxy,{focus:R,shake:q,__updateRefocusTarget(A){u=A||null}}),pt(re);function m(){return te("div",{role:"dialog","aria-modal":le.value===!0?"true":"false",...n,class:Oe.value},[te(Yt,{name:"q-transition--fade",appear:!0},()=>le.value===!0?te("div",{class:"q-dialog__backdrop fixed-full",style:M.value,"aria-hidden":"true",tabindex:-1,onClick:d}):null),te(Yt,P.value,()=>a.value===!0?te("div",{ref:o,class:de.value,style:M.value,tabindex:-1,...ve.value},wi(t.default)):null)])}return T}});function Aa(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}var ag=Kl({name:"close-popup",beforeMount(e,{value:t}){const r={depth:Aa(t),handler(n){r.depth!==0&&setTimeout(()=>{const i=yv(e);i!==void 0&&mv(i,n,r.depth)})},handlerKey(n){yi(n,13)===!0&&r.handler(n)}};e.__qclosepopup=r,e.addEventListener("click",r.handler),e.addEventListener("keyup",r.handlerKey)},updated(e,{value:t,oldValue:r}){t!==r&&(e.__qclosepopup.depth=Aa(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}});const sg={key:0},lg={key:1},ug={key:2},cg={key:0,class:"text-subtitle1 text-center"},fg=De({__name:"game-over-dialog",props:{node:{}},setup(e){return(t,r)=>(D(),oe(og,{"model-value":!0,persistent:"",position:"bottom"},{default:Q(()=>[Y(Ra,{class:"my-card game-over-dialog"},{default:Q(()=>[Y(He,{class:"bg-primary text-h5 row justify-between"},{default:Q(()=>[t.node.outcome==="white"?(D(),ne("span",sg,"White wins!")):ce("",!0),t.node.outcome==="black"?(D(),ne("span",lg,"Black wins!")):ce("",!0),t.node.outcome==="draw"?(D(),ne("span",ug,"Draw!")):ce("",!0),Jt(Y(Xi,{icon:"close",flat:"",round:"",dense:""},null,512),[[ag]])]),_:1}),Y(He,{class:"row justify-center"},{default:Q(()=>[t.node.outcome==="white"?(D(),oe(jt,{key:0,allegiance:se($e).White,piece:"K",size:96},null,8,["allegiance"])):ce("",!0),t.node.outcome==="black"?(D(),oe(jt,{key:1,allegiance:se($e).Black,piece:"K",size:96},null,8,["allegiance"])):ce("",!0),t.node.outcome==="draw"?(D(),oe(at,{key:2,name:"balance",size:"96px",color:"grey"})):ce("",!0)]),_:1}),Y(He,{class:"q-pt-none"},{default:Q(()=>[t.node.reason?(D(),ne("div",cg,kt(t.node.reason),1)):ce("",!0)]),_:1}),Y(Kn),Y(ng,{align:"right"},{default:Q(()=>[Y(Xi,{color:"secondary","text-color":"primary",label:"New game",to:"/play"})]),_:1})]),_:1})]),_:1}))}});var $g=Xe(fg,[["__scopeId","data-v-fc28b0e2"]]);function dg(){return new Worker("/assets/bot-worker.84ab8924.js",{type:"module"})}var hg="/assets/navigation_backward-selection-minimal.5c6fba09.ogg",pg="/assets/navigation_hover-tap.713baf32.ogg",vg="/assets/navigation-cancel.92012997.ogg",gg="/assets/ui_refresh-feed.44b5b5d7.ogg",yg="/assets/ui_tap-variant-01.21f59a16.ogg";const mg=()=>{if(typeof window=="undefined")return null;const e=new Audio(hg),t=new Audio(pg),r=new Audio(vg),n=new Audio(gg),i=new Audio(yg);return{playNode:async a=>{try{if(a.kind==="game-over")return await e.play();if(a.kind!=="move")return;switch(a.type){default:return await i.play();case"capture":case"en-passant":return await r.play();case"allegiance":return await t.play();case"castle":case"promotion":return await n.play()}}catch(s){s instanceof Error&&nu({level:"log",extra:{...s},message:"Cannot play audio",type:"replay_event"})}}}},qg=e=>{const t=B(),r=B(!1),n=B(!0),i=B(""),o=B(""),a=B("white"),s=B(0),l=B([]),u=B([]),c=B(null),f=B({kind:"root",children:[]}),p=B([]),h=mg(),v=x(()=>{if(l.value.length!==1)return null;const S=l.value.at(0);return!S||S.kind!=="game-over"?null:S}),b=S=>{var T;const k=S.data;switch(k.type){case"board-update":o.value=k.moveHistory,i.value=k.afen,a.value=k.activeColour,s.value=k.boardScore,l.value=k.validMoves,u.value=k.checkMoves,c.value=k.enPassantTarget,f.value=k.moveHistoryAst,p.value=k.squares,n.value=!1;break;case"node-execution":h==null||h.playNode(k.node);break;case"ready":r.value=!0;break}k.type==="board-update"&&e.autoplayFor.includes(k.activeColour)&&!v.value&&(n.value=!0,(T=t.value)==null||T.postMessage({type:"bot-move"}))};return mi(()=>{t.value=new dg,t.value.addEventListener("message",b)}),pt(()=>{var k,T;(k=t.value)==null||k.removeEventListener("message",b);const S={type:"reset"};(T=t.value)==null||T.postMessage(S)}),{ready:r,loading:n,afen:i,moveHistory:o,moveHistoryAst:f,activeColour:a,boardScore:s,validMoves:l,checkMoves:u,enPassantTarget:c,squares:p,gameOver:v,executeMoveIndex:S=>{var T;n.value=!0;const k={type:"execute-move-index",index:S};(T=t.value)==null||T.postMessage(k)},importAfen:S=>{var T;n.value=!0;const k={type:"import-afen",afen:S};(T=t.value)==null||T.postMessage(k)},importMoveHistory:S=>{var T;n.value=!0;const k={type:"import-move-history",history:S};(T=t.value)==null||T.postMessage(k)},reset:()=>{var k;n.value=!0;const S={type:"reset"};(k=t.value)==null||k.postMessage(S)}}};export{Ng as C,Mg as G,Cg as _,$g as a,qg as u};
//# sourceMappingURL=board-worker.44673822.js.map
