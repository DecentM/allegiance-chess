{"version":3,"file":"pen-pal-game.0ef7d665.js","sources":["../../../../../src/pages/play/pen-pal-game.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { useRoute, useRouter } from 'vue-router'\nimport { AfenPreset, Board, Notation } from '@decentm/allegiance-chess-core'\n\nimport ChessBoard from '../../components/chess-board.vue'\nimport GameSidebar from '../../components/game-sidebar.vue'\nimport GameOverDialog from '../../components/game-over-dialog.vue'\n\nimport { computed } from 'vue'\nimport { Hex } from '../../lib/hex'\nimport { useQuasar } from 'quasar'\nimport { useBoardAudio } from '../../hooks/board-audio'\nimport { useGameover } from '../../hooks/game-over'\n\nconst route = useRoute()\nconst router = useRouter()\n\nconst afen = computed(() => {\n  const hex = Array.isArray(route.params.state)\n    ? route.params.state[0]\n    : route.params.state\n\n  if (!hex) {\n    return AfenPreset.VanillaDefault\n  }\n\n  return Hex.hexToUtf8(hex)\n})\n\nconst moveHistory = computed(() => {\n  const hex = Array.isArray(route.params.history)\n    ? route.params.history[0]\n    : route.params.history\n\n  if (!hex) {\n    return ''\n  }\n\n  return Hex.hexToUtf8(hex)\n})\n\nconst board = computed(() => {\n  const b = new Board()\n\n  if (afen.value) b.importAFEN(afen.value)\n  if (moveHistory.value) b.importMoveHistory(moveHistory.value)\n\n  return b\n})\n\nconst audio = useBoardAudio()\n\nconst handleExecuteNode = (node: Partial<Notation.Node>) => {\n  const index = board.value.findMoveIndex(node)\n\n  if (index === -1) {\n    return\n  }\n\n  board.value.executeMoveIndex(index)\n\n  audio?.playNode(node)\n\n  router.push({\n    path: `/play/pen-pal/${Hex.utf8ToHex(board.value.toAFEN())}/${Hex.utf8ToHex(\n      board.value.getMoveHistory()\n    )}`,\n  })\n}\n\nconst { gameOver } = useGameover(board)\n\nconst q = useQuasar()\n\nconst size = computed(() => {\n  let result = q.screen.width\n\n  if (q.screen.gt.xs) {\n    result = q.screen.width - 65\n  }\n\n  if (q.screen.gt.sm) {\n    result = q.screen.sizes.sm\n  }\n\n  if (q.screen.gt.md) {\n    result = q.screen.sizes.md - 265\n  }\n\n  if (q.screen.gt.lg) {\n    result = q.screen.sizes.lg - 265\n  }\n\n  return Math.min(result, q.screen.height)\n})\n</script>\n\n<template>\n  <q-card flat class=\"full-width\">\n    <q-card-section\n      :horizontal=\"q.screen.gt.sm\"\n      :class=\"{ 'q-px-none': q.screen.lt.sm }\"\n    >\n      <q-card-section\n        :style=\"{ width: `${size}px` }\"\n        :class=\"{ 'q-px-none': q.screen.lt.sm }\"\n      >\n        <chess-board\n          @execute-node=\"handleExecuteNode\"\n          :board=\"board\"\n          :perspective=\"board.activeColour\"\n          :play-as=\"['white', 'black']\"\n          :width=\"size\"\n          :rounded-borders=\"q.screen.gt.xs\"\n        />\n      </q-card-section>\n\n      <q-card-section class=\"q-mb-md full-width\">\n        <game-sidebar\n          :move-history=\"board.getMoveHistoryAst()\"\n          :active-colour=\"board.activeColour\"\n          :own-colour=\"board.activeColour\"\n          :afen=\"board.toAFEN()\"\n        />\n      </q-card-section>\n    </q-card-section>\n\n    <game-over-dialog v-if=\"gameOver\" :node=\"gameOver\" />\n  </q-card>\n</template>\n"],"names":["route","useRoute","router","useRouter","afen","computed","hex","Hex","AfenPreset","moveHistory","board","b","Board","audio","useBoardAudio","handleExecuteNode","node","index","gameOver","useGameover","q","useQuasar","size","result"],"mappings":"0mBAcA,MAAMA,EAAQC,IACRC,EAASC,IAETC,EAAOC,EAAS,IAAM,CAC1B,MAAMC,EAAM,MAAM,QAAQN,EAAM,OAAO,KAAK,EACxCA,EAAM,OAAO,MAAM,GACnBA,EAAM,OAAO,MAEjB,OAAKM,EAIEC,EAAI,UAAUD,CAAG,EAHfE,EAAW,cAGI,CACzB,EAEKC,EAAcJ,EAAS,IAAM,CACjC,MAAMC,EAAM,MAAM,QAAQN,EAAM,OAAO,OAAO,EAC1CA,EAAM,OAAO,QAAQ,GACrBA,EAAM,OAAO,QAEjB,OAAKM,EAIEC,EAAI,UAAUD,CAAG,EAHf,EAGe,CACzB,EAEKI,EAAQL,EAAS,IAAM,CACrB,MAAAM,EAAI,IAAIC,EAEd,OAAIR,EAAK,OAASO,EAAA,WAAWP,EAAK,KAAK,EACnCK,EAAY,OAASE,EAAA,kBAAkBF,EAAY,KAAK,EAErDE,CAAA,CACR,EAEKE,EAAQC,IAERC,EAAqBC,GAAiC,CAC1D,MAAMC,EAAQP,EAAM,MAAM,cAAcM,CAAI,EAExCC,IAAU,KAIRP,EAAA,MAAM,iBAAiBO,CAAK,EAElCJ,GAAA,MAAAA,EAAO,SAASG,GAEhBd,EAAO,KAAK,CACV,KAAM,iBAAiBK,EAAI,UAAUG,EAAM,MAAM,OAAQ,CAAA,KAAKH,EAAI,UAChEG,EAAM,MAAM,eAAe,CAAA,GAC7B,CACD,EAAA,EAGG,CAAE,SAAAQ,CAAA,EAAaC,EAAYT,CAAK,EAEhCU,EAAIC,IAEJC,EAAOjB,EAAS,IAAM,CACtB,IAAAkB,EAASH,EAAE,OAAO,MAElB,OAAAA,EAAE,OAAO,GAAG,KACLG,EAAAH,EAAE,OAAO,MAAQ,IAGxBA,EAAE,OAAO,GAAG,KACLG,EAAAH,EAAE,OAAO,MAAM,IAGtBA,EAAE,OAAO,GAAG,KACLG,EAAAH,EAAE,OAAO,MAAM,GAAK,KAG3BA,EAAE,OAAO,GAAG,KACLG,EAAAH,EAAE,OAAO,MAAM,GAAK,KAGxB,KAAK,IAAIG,EAAQH,EAAE,OAAO,MAAM,CAAA,CACxC"}