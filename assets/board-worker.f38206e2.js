import{a as He,Q as Ta}from"./QCard.c16dec65.js";import{u as wi}from"./use-quasar.99f72ebc.js";import{A as Ie,B as I,C as ae,D as K,N as se,O as Se,ah as Pr,d as $,as as on,E as ne,J as pt,F as vt,R as Ve,_ as Xe,I as Et,P as ce,r as B,ag as Si,aa as Zi,n as ja,a8 as eo,w as xe,k as ki,o as gt,j as It,ad as jl,W as Qn,at as Tr,z as Cl,an as Nl,h as te,au as Ml,av as $l,aw as xl,a as q,a3 as Ca,a4 as ql,a0 as _i,c as or,ac as Il,e as Ei,T as Jt,ax as Na,a1 as Ma,G as Y,u as st,m as Xt,ay as Ai,az as Dl,aA as Ll,p as Fl,aB as Bl,am as zl,ap as Ul,s as Wl,H as br,aj as Hl,ak as Gl,aC as Vl,aD as Kl,a6 as Ql,Q as to}from"./index.fe3eab49.js";import{b as Wr,a as Zt,Q as $a}from"./QList.9ea54519.js";import{i as Yl,g as Jl,u as xa,a as qa,b as Ia,c as Da,j as Xl,e as wr,Q as ro,h as Zl,s as no,k as Sn,T as io,d as eu,f as tu}from"./QScrollObserver.5bde1185.js";import{u as Ri,a as Oi}from"./use-dark.5e6dfafa.js";import{b as oo,c as ru,a as La}from"./focus-manager.202af5b7.js";import{_ as Nt,Q as ao}from"./chess-piece.4b496144.js";import{Q as Yn}from"./QSeparator.d0546d37.js";import{u as nu}from"./notify.f41eb723.js";import{a4 as iu}from"./exports.305f64b8.js";var Qe=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};const ou={class:"col-sm col-xs-12"},au={class:"col-xl-2 col-lg-3 col-sm-5 col-xs-12"},Ng=Ie({__name:"game-layout",setup(e){const t=wi();return(r,n)=>(I(),ae(He,{horizontal:se(t).screen.gt.sm,class:"q-gutter-md q-pa-none col row"},{default:K(()=>[Se("div",ou,[Pr(r.$slots,"board")]),Se("div",au,[Pr(r.$slots,"sidebar")]),Pr(r.$slots,"default")]),_:3},8,["horizontal"]))}});var ar={exports:{}},Pi={},Ce={},Fa={},Ti=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[r]=i;for(r in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,r);if(a.value!==i||a.enumerable!==!0)return!1}return!0},su=Ti,ji=function(){return su()&&!!Symbol.toStringTag},so=typeof Symbol!="undefined"&&Symbol,lu=Ti,uu=function(){return typeof so!="function"||typeof Symbol!="function"||typeof so("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:lu()},lo={foo:{}},cu=Object,fu=function(){return{__proto__:lo}.foo===lo.foo&&!({__proto__:null}instanceof cu)},du="Function.prototype.bind called on incompatible ",kn=Array.prototype.slice,hu=Object.prototype.toString,pu="[object Function]",vu=function(t){var r=this;if(typeof r!="function"||hu.call(r)!==pu)throw new TypeError(du+r);for(var n=kn.call(arguments,1),i,o=function(){if(this instanceof i){var c=r.apply(this,n.concat(kn.call(arguments)));return Object(c)===c?c:this}else return r.apply(t,n.concat(kn.call(arguments)))},a=Math.max(0,r.length-n.length),s=[],l=0;l<a;l++)s.push("$"+l);if(i=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")(o),r.prototype){var u=function(){};u.prototype=r.prototype,i.prototype=new u,u.prototype=null}return i},gu=vu,Ci=Function.prototype.bind||gu,mu=Ci,yu=mu.call(Function.call,Object.prototype.hasOwnProperty),W,Mt=SyntaxError,Ba=Function,At=TypeError,_n=function(e){try{return Ba('"use strict"; return ('+e+").constructor;")()}catch{}},lt=Object.getOwnPropertyDescriptor;if(lt)try{lt({},"")}catch{lt=null}var En=function(){throw new At},bu=lt?function(){try{return arguments.callee,En}catch{try{return lt(arguments,"callee").get}catch{return En}}}():En,bt=uu(),wu=fu(),fe=Object.getPrototypeOf||(wu?function(e){return e.__proto__}:null),kt={},Su=typeof Uint8Array=="undefined"||!fe?W:fe(Uint8Array),ut={"%AggregateError%":typeof AggregateError=="undefined"?W:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer=="undefined"?W:ArrayBuffer,"%ArrayIteratorPrototype%":bt&&fe?fe([][Symbol.iterator]()):W,"%AsyncFromSyncIteratorPrototype%":W,"%AsyncFunction%":kt,"%AsyncGenerator%":kt,"%AsyncGeneratorFunction%":kt,"%AsyncIteratorPrototype%":kt,"%Atomics%":typeof Atomics=="undefined"?W:Atomics,"%BigInt%":typeof BigInt=="undefined"?W:BigInt,"%BigInt64Array%":typeof BigInt64Array=="undefined"?W:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array=="undefined"?W:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView=="undefined"?W:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array=="undefined"?W:Float32Array,"%Float64Array%":typeof Float64Array=="undefined"?W:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry=="undefined"?W:FinalizationRegistry,"%Function%":Ba,"%GeneratorFunction%":kt,"%Int8Array%":typeof Int8Array=="undefined"?W:Int8Array,"%Int16Array%":typeof Int16Array=="undefined"?W:Int16Array,"%Int32Array%":typeof Int32Array=="undefined"?W:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":bt&&fe?fe(fe([][Symbol.iterator]())):W,"%JSON%":typeof JSON=="object"?JSON:W,"%Map%":typeof Map=="undefined"?W:Map,"%MapIteratorPrototype%":typeof Map=="undefined"||!bt||!fe?W:fe(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise=="undefined"?W:Promise,"%Proxy%":typeof Proxy=="undefined"?W:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect=="undefined"?W:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set=="undefined"?W:Set,"%SetIteratorPrototype%":typeof Set=="undefined"||!bt||!fe?W:fe(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer=="undefined"?W:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":bt&&fe?fe(""[Symbol.iterator]()):W,"%Symbol%":bt?Symbol:W,"%SyntaxError%":Mt,"%ThrowTypeError%":bu,"%TypedArray%":Su,"%TypeError%":At,"%Uint8Array%":typeof Uint8Array=="undefined"?W:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray=="undefined"?W:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array=="undefined"?W:Uint16Array,"%Uint32Array%":typeof Uint32Array=="undefined"?W:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap=="undefined"?W:WeakMap,"%WeakRef%":typeof WeakRef=="undefined"?W:WeakRef,"%WeakSet%":typeof WeakSet=="undefined"?W:WeakSet};if(fe)try{null.error}catch(e){var ku=fe(fe(e));ut["%Error.prototype%"]=ku}var _u=function e(t){var r;if(t==="%AsyncFunction%")r=_n("async function () {}");else if(t==="%GeneratorFunction%")r=_n("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=_n("async function* () {}");else if(t==="%AsyncGenerator%"){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var i=e("%AsyncGenerator%");i&&fe&&(r=fe(i.prototype))}return ut[t]=r,r},uo={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},sr=Ci,Hr=yu,Eu=sr.call(Function.call,Array.prototype.concat),Au=sr.call(Function.apply,Array.prototype.splice),co=sr.call(Function.call,String.prototype.replace),Gr=sr.call(Function.call,String.prototype.slice),Ru=sr.call(Function.call,RegExp.prototype.exec),Ou=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Pu=/\\(\\)?/g,Tu=function(t){var r=Gr(t,0,1),n=Gr(t,-1);if(r==="%"&&n!=="%")throw new Mt("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new Mt("invalid intrinsic syntax, expected opening `%`");var i=[];return co(t,Ou,function(o,a,s,l){i[i.length]=s?co(l,Pu,"$1"):a||o}),i},ju=function(t,r){var n=t,i;if(Hr(uo,n)&&(i=uo[n],n="%"+i[0]+"%"),Hr(ut,n)){var o=ut[n];if(o===kt&&(o=_u(n)),typeof o=="undefined"&&!r)throw new At("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:o}}throw new Mt("intrinsic "+t+" does not exist!")},lr=function(t,r){if(typeof t!="string"||t.length===0)throw new At("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new At('"allowMissing" argument must be a boolean');if(Ru(/^%?[^%]*%?$/,t)===null)throw new Mt("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=Tu(t),i=n.length>0?n[0]:"",o=ju("%"+i+"%",r),a=o.name,s=o.value,l=!1,u=o.alias;u&&(i=u[0],Au(n,Eu([0,1],u)));for(var c=1,f=!0;c<n.length;c+=1){var p=n[c],v=Gr(p,0,1),h=Gr(p,-1);if((v==='"'||v==="'"||v==="`"||h==='"'||h==="'"||h==="`")&&v!==h)throw new Mt("property names with quotes must have matching quotes");if((p==="constructor"||!f)&&(l=!0),i+="."+p,a="%"+i+"%",Hr(ut,a))s=ut[a];else if(s!=null){if(!(p in s)){if(!r)throw new At("base intrinsic for "+t+" exists, but the property is not available.");return}if(lt&&c+1>=n.length){var w=lt(s,p);f=!!w,f&&"get"in w&&!("originalValue"in w.get)?s=w.get:s=s[p]}else f=Hr(s,p),s=s[p];f&&!l&&(ut[a]=s)}}return s},ur={exports:{}};(function(e){var t=Ci,r=lr,n=r("%Function.prototype.apply%"),i=r("%Function.prototype.call%"),o=r("%Reflect.apply%",!0)||t.call(i,n),a=r("%Object.getOwnPropertyDescriptor%",!0),s=r("%Object.defineProperty%",!0),l=r("%Math.max%");if(s)try{s({},"a",{value:1})}catch{s=null}e.exports=function(f){var p=o(t,i,arguments);if(a&&s){var v=a(p,"length");v.configurable&&s(p,"length",{value:1+l(0,f.length-(arguments.length-1))})}return p};var u=function(){return o(t,n,arguments)};s?s(e.exports,"apply",{value:u}):e.exports.apply=u})(ur);var za=lr,Ua=ur.exports,Cu=Ua(za("String.prototype.indexOf")),an=function(t,r){var n=za(t,!!r);return typeof n=="function"&&Cu(t,".prototype.")>-1?Ua(n):n},Nu=ji(),Mu=an,Jn=Mu("Object.prototype.toString"),sn=function(t){return Nu&&t&&typeof t=="object"&&Symbol.toStringTag in t?!1:Jn(t)==="[object Arguments]"},Wa=function(t){return sn(t)?!0:t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Jn(t)!=="[object Array]"&&Jn(t.callee)==="[object Function]"},$u=function(){return sn(arguments)}();sn.isLegacyArguments=Wa;var xu=$u?sn:Wa,qu=Object.prototype.toString,Iu=Function.prototype.toString,Du=/^\s*(?:function)?\*/,Ha=ji(),An=Object.getPrototypeOf,Lu=function(){if(!Ha)return!1;try{return Function("return function*() {}")()}catch{}},Rn,Fu=function(t){if(typeof t!="function")return!1;if(Du.test(Iu.call(t)))return!0;if(!Ha){var r=qu.call(t);return r==="[object GeneratorFunction]"}if(!An)return!1;if(typeof Rn=="undefined"){var n=Lu();Rn=n?An(n):!1}return An(t)===Rn},Ga=Function.prototype.toString,_t=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Xn,jr;if(typeof _t=="function"&&typeof Object.defineProperty=="function")try{Xn=Object.defineProperty({},"length",{get:function(){throw jr}}),jr={},_t(function(){throw 42},null,Xn)}catch(e){e!==jr&&(_t=null)}else _t=null;var Bu=/^\s*class\b/,Zn=function(t){try{var r=Ga.call(t);return Bu.test(r)}catch{return!1}},On=function(t){try{return Zn(t)?!1:(Ga.call(t),!0)}catch{return!1}},Cr=Object.prototype.toString,zu="[object Object]",Uu="[object Function]",Wu="[object GeneratorFunction]",Hu="[object HTMLAllCollection]",Gu="[object HTML document.all class]",Vu="[object HTMLCollection]",Ku=typeof Symbol=="function"&&!!Symbol.toStringTag,Qu=!(0 in[,]),ei=function(){return!1};if(typeof document=="object"){var Yu=document.all;Cr.call(Yu)===Cr.call(document.all)&&(ei=function(t){if((Qu||!t)&&(typeof t=="undefined"||typeof t=="object"))try{var r=Cr.call(t);return(r===Hu||r===Gu||r===Vu||r===zu)&&t("")==null}catch{}return!1})}var Ju=_t?function(t){if(ei(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{_t(t,null,Xn)}catch(r){if(r!==jr)return!1}return!Zn(t)&&On(t)}:function(t){if(ei(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(Ku)return On(t);if(Zn(t))return!1;var r=Cr.call(t);return r!==Uu&&r!==Wu&&!/^\[object HTML/.test(r)?!1:On(t)},Xu=Ju,Zu=Object.prototype.toString,Va=Object.prototype.hasOwnProperty,ec=function(t,r,n){for(var i=0,o=t.length;i<o;i++)Va.call(t,i)&&(n==null?r(t[i],i,t):r.call(n,t[i],i,t))},tc=function(t,r,n){for(var i=0,o=t.length;i<o;i++)n==null?r(t.charAt(i),i,t):r.call(n,t.charAt(i),i,t)},rc=function(t,r,n){for(var i in t)Va.call(t,i)&&(n==null?r(t[i],i,t):r.call(n,t[i],i,t))},nc=function(t,r,n){if(!Xu(r))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=n),Zu.call(t)==="[object Array]"?ec(t,r,i):typeof t=="string"?tc(t,r,i):rc(t,r,i)},ic=nc,Pn=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],oc=typeof globalThis=="undefined"?Qe:globalThis,ac=function(){for(var t=[],r=0;r<Pn.length;r++)typeof oc[Pn[r]]=="function"&&(t[t.length]=Pn[r]);return t},sc=lr,Nr=sc("%Object.getOwnPropertyDescriptor%",!0);if(Nr)try{Nr([],"length")}catch{Nr=null}var Ka=Nr,Vr=ic,lc=ac,fo=ur.exports,Ni=an,Mr=Ka,uc=Ni("Object.prototype.toString"),Qa=ji(),ho=typeof globalThis=="undefined"?Qe:globalThis,ti=lc(),Mi=Ni("String.prototype.slice"),Tn=Object.getPrototypeOf,cc=Ni("Array.prototype.indexOf",!0)||function(t,r){for(var n=0;n<t.length;n+=1)if(t[n]===r)return n;return-1},Kr={__proto__:null};Qa&&Mr&&Tn?Vr(ti,function(e){var t=new ho[e];if(Symbol.toStringTag in t){var r=Tn(t),n=Mr(r,Symbol.toStringTag);if(!n){var i=Tn(r);n=Mr(i,Symbol.toStringTag)}Kr["$"+e]=fo(n.get)}}):Vr(ti,function(e){var t=new ho[e];Kr["$"+e]=fo(t.slice)});var fc=function(t){var r=!1;return Vr(Kr,function(n,i){if(!r)try{"$"+n(t)===i&&(r=Mi(i,1))}catch{}}),r},dc=function(t){var r=!1;return Vr(Kr,function(n,i){if(!r)try{n(t),r=Mi(i,1)}catch{}}),r},Ya=function(t){if(!t||typeof t!="object")return!1;if(!Qa){var r=Mi(uc(t),8,-1);return cc(ti,r)>-1?r:r!=="Object"?!1:dc(t)}return Mr?fc(t):null},hc=Ya,pc=function(t){return!!hc(t)};(function(e){var t=xu,r=Fu,n=Ya,i=pc;function o(m){return m.call.bind(m)}var a=typeof BigInt!="undefined",s=typeof Symbol!="undefined",l=o(Object.prototype.toString),u=o(Number.prototype.valueOf),c=o(String.prototype.valueOf),f=o(Boolean.prototype.valueOf);if(a)var p=o(BigInt.prototype.valueOf);if(s)var v=o(Symbol.prototype.valueOf);function h(m,Tl){if(typeof m!="object")return!1;try{return Tl(m),!0}catch{return!1}}e.isArgumentsObject=t,e.isGeneratorFunction=r,e.isTypedArray=i;function w(m){return typeof Promise!="undefined"&&m instanceof Promise||m!==null&&typeof m=="object"&&typeof m.then=="function"&&typeof m.catch=="function"}e.isPromise=w;function S(m){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(m):i(m)||g(m)}e.isArrayBufferView=S;function T(m){return n(m)==="Uint8Array"}e.isUint8Array=T;function M(m){return n(m)==="Uint8ClampedArray"}e.isUint8ClampedArray=M;function C(m){return n(m)==="Uint16Array"}e.isUint16Array=C;function P(m){return n(m)==="Uint32Array"}e.isUint32Array=P;function O(m){return n(m)==="Int8Array"}e.isInt8Array=O;function R(m){return n(m)==="Int16Array"}e.isInt16Array=R;function y(m){return n(m)==="Int32Array"}e.isInt32Array=y;function U(m){return n(m)==="Float32Array"}e.isFloat32Array=U;function V(m){return n(m)==="Float64Array"}e.isFloat64Array=V;function de(m){return n(m)==="BigInt64Array"}e.isBigInt64Array=de;function le(m){return n(m)==="BigUint64Array"}e.isBigUint64Array=le;function ve(m){return l(m)==="[object Map]"}ve.working=typeof Map!="undefined"&&ve(new Map);function Oe(m){return typeof Map=="undefined"?!1:ve.working?ve(m):m instanceof Map}e.isMap=Oe;function ye(m){return l(m)==="[object Set]"}ye.working=typeof Set!="undefined"&&ye(new Set);function we(m){return typeof Set=="undefined"?!1:ye.working?ye(m):m instanceof Set}e.isSet=we;function E(m){return l(m)==="[object WeakMap]"}E.working=typeof WeakMap!="undefined"&&E(new WeakMap);function x(m){return typeof WeakMap=="undefined"?!1:E.working?E(m):m instanceof WeakMap}e.isWeakMap=x;function L(m){return l(m)==="[object WeakSet]"}L.working=typeof WeakSet!="undefined"&&L(new WeakSet);function re(m){return L(m)}e.isWeakSet=re;function he(m){return l(m)==="[object ArrayBuffer]"}he.working=typeof ArrayBuffer!="undefined"&&he(new ArrayBuffer);function Me(m){return typeof ArrayBuffer=="undefined"?!1:he.working?he(m):m instanceof ArrayBuffer}e.isArrayBuffer=Me;function d(m){return l(m)==="[object DataView]"}d.working=typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined"&&d(new DataView(new ArrayBuffer(1),0,1));function g(m){return typeof DataView=="undefined"?!1:d.working?d(m):m instanceof DataView}e.isDataView=g;var b=typeof SharedArrayBuffer!="undefined"?SharedArrayBuffer:void 0;function _(m){return l(m)==="[object SharedArrayBuffer]"}function N(m){return typeof b=="undefined"?!1:(typeof _.working=="undefined"&&(_.working=_(new b)),_.working?_(m):m instanceof b)}e.isSharedArrayBuffer=N;function F(m){return l(m)==="[object AsyncFunction]"}e.isAsyncFunction=F;function D(m){return l(m)==="[object Map Iterator]"}e.isMapIterator=D;function A(m){return l(m)==="[object Set Iterator]"}e.isSetIterator=A;function J(m){return l(m)==="[object Generator]"}e.isGeneratorObject=J;function ge(m){return l(m)==="[object WebAssembly.Module]"}e.isWebAssemblyCompiledModule=ge;function De(m){return h(m,u)}e.isNumberObject=De;function mr(m){return h(m,c)}e.isStringObject=mr;function yt(m){return h(m,f)}e.isBooleanObject=yt;function yr(m){return a&&h(m,p)}e.isBigIntObject=yr;function Xi(m){return s&&h(m,v)}e.isSymbolObject=Xi;function Ol(m){return De(m)||mr(m)||yt(m)||yr(m)||Xi(m)}e.isBoxedPrimitive=Ol;function Pl(m){return typeof Uint8Array!="undefined"&&(Me(m)||N(m))}e.isAnyArrayBuffer=Pl,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(m){Object.defineProperty(e,m,{enumerable:!1,value:function(){throw new Error(m+" is not supported in userland")}})})})(Fa);var vc=function(t){return t instanceof $.Buffer},Fe={exports:{}};typeof Object.create=="function"?Fe.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Fe.exports=function(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}};(function(e){var t=Object.getOwnPropertyDescriptors||function(g){for(var b=Object.keys(g),_={},N=0;N<b.length;N++)_[b[N]]=Object.getOwnPropertyDescriptor(g,b[N]);return _},r=/%[sdj%]/g;e.format=function(d){if(!O(d)){for(var g=[],b=0;b<arguments.length;b++)g.push(a(arguments[b]));return g.join(" ")}for(var b=1,_=arguments,N=_.length,F=String(d).replace(r,function(A){if(A==="%%")return"%";if(b>=N)return A;switch(A){case"%s":return String(_[b++]);case"%d":return Number(_[b++]);case"%j":try{return JSON.stringify(_[b++])}catch{return"[Circular]"}default:return A}}),D=_[b];b<N;D=_[++b])M(D)||!V(D)?F+=" "+D:F+=" "+a(D);return F},e.deprecate=function(d,g){if(typeof $.process!="undefined"&&$.process.noDeprecation===!0)return d;if(typeof $.process=="undefined")return function(){return e.deprecate(d,g).apply(this,arguments)};var b=!1;function _(){if(!b){if($.process.throwDeprecation)throw new Error(g);$.process.traceDeprecation?console.trace(g):console.error(g),b=!0}return d.apply(this,arguments)}return _};var n={},i=/^$/;if({}.NODE_DEBUG){var o={}.NODE_DEBUG;o=o.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),i=new RegExp("^"+o+"$","i")}e.debuglog=function(d){if(d=d.toUpperCase(),!n[d])if(i.test(d)){var g=$.process.pid;n[d]=function(){var b=e.format.apply(e,arguments);console.error("%s %d: %s",d,g,b)}}else n[d]=function(){};return n[d]};function a(d,g){var b={seen:[],stylize:l};return arguments.length>=3&&(b.depth=arguments[2]),arguments.length>=4&&(b.colors=arguments[3]),T(g)?b.showHidden=g:g&&e._extend(b,g),y(b.showHidden)&&(b.showHidden=!1),y(b.depth)&&(b.depth=2),y(b.colors)&&(b.colors=!1),y(b.customInspect)&&(b.customInspect=!0),b.colors&&(b.stylize=s),c(b,d,b.depth)}e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function s(d,g){var b=a.styles[g];return b?"\x1B["+a.colors[b][0]+"m"+d+"\x1B["+a.colors[b][1]+"m":d}function l(d,g){return d}function u(d){var g={};return d.forEach(function(b,_){g[b]=!0}),g}function c(d,g,b){if(d.customInspect&&g&&ve(g.inspect)&&g.inspect!==e.inspect&&!(g.constructor&&g.constructor.prototype===g)){var _=g.inspect(b,d);return O(_)||(_=c(d,_,b)),_}var N=f(d,g);if(N)return N;var F=Object.keys(g),D=u(F);if(d.showHidden&&(F=Object.getOwnPropertyNames(g)),le(g)&&(F.indexOf("message")>=0||F.indexOf("description")>=0))return p(g);if(F.length===0){if(ve(g)){var A=g.name?": "+g.name:"";return d.stylize("[Function"+A+"]","special")}if(U(g))return d.stylize(RegExp.prototype.toString.call(g),"regexp");if(de(g))return d.stylize(Date.prototype.toString.call(g),"date");if(le(g))return p(g)}var J="",ge=!1,De=["{","}"];if(S(g)&&(ge=!0,De=["[","]"]),ve(g)){var mr=g.name?": "+g.name:"";J=" [Function"+mr+"]"}if(U(g)&&(J=" "+RegExp.prototype.toString.call(g)),de(g)&&(J=" "+Date.prototype.toUTCString.call(g)),le(g)&&(J=" "+p(g)),F.length===0&&(!ge||g.length==0))return De[0]+J+De[1];if(b<0)return U(g)?d.stylize(RegExp.prototype.toString.call(g),"regexp"):d.stylize("[Object]","special");d.seen.push(g);var yt;return ge?yt=v(d,g,b,D,F):yt=F.map(function(yr){return h(d,g,b,D,yr,ge)}),d.seen.pop(),w(yt,J,De)}function f(d,g){if(y(g))return d.stylize("undefined","undefined");if(O(g)){var b="'"+JSON.stringify(g).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return d.stylize(b,"string")}if(P(g))return d.stylize(""+g,"number");if(T(g))return d.stylize(""+g,"boolean");if(M(g))return d.stylize("null","null")}function p(d){return"["+Error.prototype.toString.call(d)+"]"}function v(d,g,b,_,N){for(var F=[],D=0,A=g.length;D<A;++D)L(g,String(D))?F.push(h(d,g,b,_,String(D),!0)):F.push("");return N.forEach(function(J){J.match(/^\d+$/)||F.push(h(d,g,b,_,J,!0))}),F}function h(d,g,b,_,N,F){var D,A,J;if(J=Object.getOwnPropertyDescriptor(g,N)||{value:g[N]},J.get?J.set?A=d.stylize("[Getter/Setter]","special"):A=d.stylize("[Getter]","special"):J.set&&(A=d.stylize("[Setter]","special")),L(_,N)||(D="["+N+"]"),A||(d.seen.indexOf(J.value)<0?(M(b)?A=c(d,J.value,null):A=c(d,J.value,b-1),A.indexOf(`
`)>-1&&(F?A=A.split(`
`).map(function(ge){return"  "+ge}).join(`
`).slice(2):A=`
`+A.split(`
`).map(function(ge){return"   "+ge}).join(`
`))):A=d.stylize("[Circular]","special")),y(D)){if(F&&N.match(/^\d+$/))return A;D=JSON.stringify(""+N),D.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(D=D.slice(1,-1),D=d.stylize(D,"name")):(D=D.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),D=d.stylize(D,"string"))}return D+": "+A}function w(d,g,b){var _=d.reduce(function(N,F){return F.indexOf(`
`)>=0,N+F.replace(/\u001b\[\d\d?m/g,"").length+1},0);return _>60?b[0]+(g===""?"":g+`
 `)+" "+d.join(`,
  `)+" "+b[1]:b[0]+g+" "+d.join(", ")+" "+b[1]}e.types=Fa;function S(d){return Array.isArray(d)}e.isArray=S;function T(d){return typeof d=="boolean"}e.isBoolean=T;function M(d){return d===null}e.isNull=M;function C(d){return d==null}e.isNullOrUndefined=C;function P(d){return typeof d=="number"}e.isNumber=P;function O(d){return typeof d=="string"}e.isString=O;function R(d){return typeof d=="symbol"}e.isSymbol=R;function y(d){return d===void 0}e.isUndefined=y;function U(d){return V(d)&&ye(d)==="[object RegExp]"}e.isRegExp=U,e.types.isRegExp=U;function V(d){return typeof d=="object"&&d!==null}e.isObject=V;function de(d){return V(d)&&ye(d)==="[object Date]"}e.isDate=de,e.types.isDate=de;function le(d){return V(d)&&(ye(d)==="[object Error]"||d instanceof Error)}e.isError=le,e.types.isNativeError=le;function ve(d){return typeof d=="function"}e.isFunction=ve;function Oe(d){return d===null||typeof d=="boolean"||typeof d=="number"||typeof d=="string"||typeof d=="symbol"||typeof d=="undefined"}e.isPrimitive=Oe,e.isBuffer=vc;function ye(d){return Object.prototype.toString.call(d)}function we(d){return d<10?"0"+d.toString(10):d.toString(10)}var E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function x(){var d=new Date,g=[we(d.getHours()),we(d.getMinutes()),we(d.getSeconds())].join(":");return[d.getDate(),E[d.getMonth()],g].join(" ")}e.log=function(){console.log("%s - %s",x(),e.format.apply(e,arguments))},e.inherits=Fe.exports,e._extend=function(d,g){if(!g||!V(g))return d;for(var b=Object.keys(g),_=b.length;_--;)d[b[_]]=g[b[_]];return d};function L(d,g){return Object.prototype.hasOwnProperty.call(d,g)}var re=typeof Symbol!="undefined"?Symbol("util.promisify.custom"):void 0;e.promisify=function(g){if(typeof g!="function")throw new TypeError('The "original" argument must be of type Function');if(re&&g[re]){var b=g[re];if(typeof b!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(b,re,{value:b,enumerable:!1,writable:!1,configurable:!0}),b}function b(){for(var _,N,F=new Promise(function(J,ge){_=J,N=ge}),D=[],A=0;A<arguments.length;A++)D.push(arguments[A]);D.push(function(J,ge){J?N(J):_(ge)});try{g.apply(this,D)}catch(J){N(J)}return F}return Object.setPrototypeOf(b,Object.getPrototypeOf(g)),re&&Object.defineProperty(b,re,{value:b,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(b,t(g))},e.promisify.custom=re;function he(d,g){if(!d){var b=new Error("Promise was rejected with a falsy value");b.reason=d,d=b}return g(d)}function Me(d){if(typeof d!="function")throw new TypeError('The "original" argument must be of type Function');function g(){for(var b=[],_=0;_<arguments.length;_++)b.push(arguments[_]);var N=b.pop();if(typeof N!="function")throw new TypeError("The last argument must be of type Function");var F=this,D=function(){return N.apply(F,arguments)};d.apply(this,b).then(function(A){$.process.nextTick(D.bind(null,null,A))},function(A){$.process.nextTick(he.bind(null,A,D))})}return Object.setPrototypeOf(g,Object.getPrototypeOf(d)),Object.defineProperties(g,t(d)),g}e.callbackify=Me})(Ce);function Ye(e){return Ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ye(e)}function po(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mc(n.key),n)}}function gc(e,t,r){return t&&po(e.prototype,t),r&&po(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function mc(e){var t=yc(e,"string");return Ye(t)==="symbol"?t:String(t)}function yc(e,t){if(Ye(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Ye(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wc(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ri(e,t)}function ri(e,t){return ri=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},ri(e,t)}function Sc(e){var t=Ec();return function(){var n=Qr(e),i;if(t){var o=Qr(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return kc(this,i)}}function kc(e,t){if(t&&(Ye(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _c(e)}function _c(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ec(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Qr(e){return Qr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Qr(e)}var Ja={},Rt,jn;function cr(e,t,r){r||(r=Error);function n(o,a,s){return typeof t=="string"?t:t(o,a,s)}var i=function(o){wc(s,o);var a=Sc(s);function s(l,u,c){var f;return bc(this,s),f=a.call(this,n(l,u,c)),f.code=e,f}return gc(s)}(r);Ja[e]=i}function vo(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(n){return String(n)}),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:r===2?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}else return"of ".concat(t," ").concat(String(e))}function Ac(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function Rc(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function Oc(e,t,r){return typeof r!="number"&&(r=0),r+t.length>e.length?!1:e.indexOf(t,r)!==-1}cr("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError);cr("ERR_INVALID_ARG_TYPE",function(e,t,r){Rt===void 0&&(Rt=ar.exports),Rt(typeof e=="string","'name' must be a string");var n;typeof t=="string"&&Ac(t,"not ")?(n="must not be",t=t.replace(/^not /,"")):n="must be";var i;if(Rc(e," argument"))i="The ".concat(e," ").concat(n," ").concat(vo(t,"type"));else{var o=Oc(e,".")?"property":"argument";i='The "'.concat(e,'" ').concat(o," ").concat(n," ").concat(vo(t,"type"))}return i+=". Received type ".concat(Ye(r)),i},TypeError);cr("ERR_INVALID_ARG_VALUE",function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"is invalid";jn===void 0&&(jn=Ce);var n=jn.inspect(t);return n.length>128&&(n="".concat(n.slice(0,128),"...")),"The argument '".concat(e,"' ").concat(r,". Received ").concat(n)},TypeError);cr("ERR_INVALID_RETURN_VALUE",function(e,t,r){var n;return r&&r.constructor&&r.constructor.name?n="instance of ".concat(r.constructor.name):n="type ".concat(Ye(r)),"Expected ".concat(e,' to be returned from the "').concat(t,'"')+" function but got ".concat(n,".")},TypeError);cr("ERR_MISSING_ARGS",function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Rt===void 0&&(Rt=ar.exports),Rt(t.length>0,"At least one arg needs to be specified");var n="The ",i=t.length;switch(t=t.map(function(o){return'"'.concat(o,'"')}),i){case 1:n+="".concat(t[0]," argument");break;case 2:n+="".concat(t[0]," and ").concat(t[1]," arguments");break;default:n+=t.slice(0,i-1).join(", "),n+=", and ".concat(t[i-1]," arguments");break}return"".concat(n," must be specified")},TypeError);Pi.codes=Ja;function go(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function mo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?go(Object(r),!0).forEach(function(n){Pc(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):go(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pc(e,t,r){return t=Xa(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Tc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Xa(n.key),n)}}function jc(e,t,r){return t&&yo(e.prototype,t),r&&yo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Xa(e){var t=Cc(e,"string");return ke(t)==="symbol"?t:String(t)}function Cc(e,t){if(ke(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ke(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Nc(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&er(e,t)}function Mc(e){var t=es();return function(){var n=tr(e),i;if(t){var o=tr(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Za(this,i)}}function Za(e,t){if(t&&(ke(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ni(e)}function ni(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ii(e){var t=typeof Map=="function"?new Map:void 0;return ii=function(n){if(n===null||!$c(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t!="undefined"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return $r(n,arguments,tr(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),er(i,n)},ii(e)}function $r(e,t,r){return es()?$r=Reflect.construct.bind():$r=function(i,o,a){var s=[null];s.push.apply(s,o);var l=Function.bind.apply(i,s),u=new l;return a&&er(u,a.prototype),u},$r.apply(null,arguments)}function es(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function $c(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function er(e,t){return er=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},er(e,t)}function tr(e){return tr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},tr(e)}function ke(e){return ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ke(e)}var xc=Ce,oi=xc.inspect,qc=Pi,Ic=qc.codes.ERR_INVALID_ARG_TYPE;function bo(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function Dc(e,t){if(t=Math.floor(t),e.length==0||t==0)return"";var r=e.length*t;for(t=Math.floor(Math.log(t)/Math.log(2));t;)e+=e,t--;return e+=e.substring(0,r-e.length),e}var Pe="",Ht="",Gt="",pe="",it={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"},Lc=10;function wo(e){var t=Object.keys(e),r=Object.create(Object.getPrototypeOf(e));return t.forEach(function(n){r[n]=e[n]}),Object.defineProperty(r,"message",{value:e.message}),r}function Vt(e){return oi(e,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}function Fc(e,t,r){var n="",i="",o=0,a="",s=!1,l=Vt(e),u=l.split(`
`),c=Vt(t).split(`
`),f=0,p="";if(r==="strictEqual"&&ke(e)==="object"&&ke(t)==="object"&&e!==null&&t!==null&&(r="strictEqualObject"),u.length===1&&c.length===1&&u[0]!==c[0]){var v=u[0].length+c[0].length;if(v<=Lc){if((ke(e)!=="object"||e===null)&&(ke(t)!=="object"||t===null)&&(e!==0||t!==0))return"".concat(it[r],`

`)+"".concat(u[0]," !== ").concat(c[0],`
`)}else if(r!=="strictEqualObject"){var h=$.process.stderr&&$.process.stderr.isTTY?$.process.stderr.columns:80;if(v<h){for(;u[0][f]===c[0][f];)f++;f>2&&(p=`
  `.concat(Dc(" ",f),"^"),f=0)}}}for(var w=u[u.length-1],S=c[c.length-1];w===S&&(f++<2?a=`
  `.concat(w).concat(a):n=w,u.pop(),c.pop(),!(u.length===0||c.length===0));)w=u[u.length-1],S=c[c.length-1];var T=Math.max(u.length,c.length);if(T===0){var M=l.split(`
`);if(M.length>30)for(M[26]="".concat(Pe,"...").concat(pe);M.length>27;)M.pop();return"".concat(it.notIdentical,`

`).concat(M.join(`
`),`
`)}f>3&&(a=`
`.concat(Pe,"...").concat(pe).concat(a),s=!0),n!==""&&(a=`
  `.concat(n).concat(a),n="");var C=0,P=it[r]+`
`.concat(Ht,"+ actual").concat(pe," ").concat(Gt,"- expected").concat(pe),O=" ".concat(Pe,"...").concat(pe," Lines skipped");for(f=0;f<T;f++){var R=f-o;if(u.length<f+1)R>1&&f>2&&(R>4?(i+=`
`.concat(Pe,"...").concat(pe),s=!0):R>3&&(i+=`
  `.concat(c[f-2]),C++),i+=`
  `.concat(c[f-1]),C++),o=f,n+=`
`.concat(Gt,"-").concat(pe," ").concat(c[f]),C++;else if(c.length<f+1)R>1&&f>2&&(R>4?(i+=`
`.concat(Pe,"...").concat(pe),s=!0):R>3&&(i+=`
  `.concat(u[f-2]),C++),i+=`
  `.concat(u[f-1]),C++),o=f,i+=`
`.concat(Ht,"+").concat(pe," ").concat(u[f]),C++;else{var y=c[f],U=u[f],V=U!==y&&(!bo(U,",")||U.slice(0,-1)!==y);V&&bo(y,",")&&y.slice(0,-1)===U&&(V=!1,U+=","),V?(R>1&&f>2&&(R>4?(i+=`
`.concat(Pe,"...").concat(pe),s=!0):R>3&&(i+=`
  `.concat(u[f-2]),C++),i+=`
  `.concat(u[f-1]),C++),o=f,i+=`
`.concat(Ht,"+").concat(pe," ").concat(U),n+=`
`.concat(Gt,"-").concat(pe," ").concat(y),C+=2):(i+=n,n="",(R===1||f===0)&&(i+=`
  `.concat(U),C++))}if(C>20&&f<T-2)return"".concat(P).concat(O,`
`).concat(i,`
`).concat(Pe,"...").concat(pe).concat(n,`
`)+"".concat(Pe,"...").concat(pe)}return"".concat(P).concat(s?O:"",`
`).concat(i).concat(n).concat(a).concat(p)}var Bc=function(e,t){Nc(n,e);var r=Mc(n);function n(i){var o;if(Tc(this,n),ke(i)!=="object"||i===null)throw new Ic("options","Object",i);var a=i.message,s=i.operator,l=i.stackStartFn,u=i.actual,c=i.expected,f=Error.stackTraceLimit;if(Error.stackTraceLimit=0,a!=null)o=r.call(this,String(a));else if($.process.stderr&&$.process.stderr.isTTY&&($.process.stderr&&$.process.stderr.getColorDepth&&$.process.stderr.getColorDepth()!==1?(Pe="\x1B[34m",Ht="\x1B[32m",pe="\x1B[39m",Gt="\x1B[31m"):(Pe="",Ht="",pe="",Gt="")),ke(u)==="object"&&u!==null&&ke(c)==="object"&&c!==null&&"stack"in u&&u instanceof Error&&"stack"in c&&c instanceof Error&&(u=wo(u),c=wo(c)),s==="deepStrictEqual"||s==="strictEqual")o=r.call(this,Fc(u,c,s));else if(s==="notDeepStrictEqual"||s==="notStrictEqual"){var p=it[s],v=Vt(u).split(`
`);if(s==="notStrictEqual"&&ke(u)==="object"&&u!==null&&(p=it.notStrictEqualObject),v.length>30)for(v[26]="".concat(Pe,"...").concat(pe);v.length>27;)v.pop();v.length===1?o=r.call(this,"".concat(p," ").concat(v[0])):o=r.call(this,"".concat(p,`

`).concat(v.join(`
`),`
`))}else{var h=Vt(u),w="",S=it[s];s==="notDeepEqual"||s==="notEqual"?(h="".concat(it[s],`

`).concat(h),h.length>1024&&(h="".concat(h.slice(0,1021),"..."))):(w="".concat(Vt(c)),h.length>512&&(h="".concat(h.slice(0,509),"...")),w.length>512&&(w="".concat(w.slice(0,509),"...")),s==="deepEqual"||s==="equal"?h="".concat(S,`

`).concat(h,`

should equal

`):w=" ".concat(s," ").concat(w)),o=r.call(this,"".concat(h).concat(w))}return Error.stackTraceLimit=f,o.generatedMessage=!a,Object.defineProperty(ni(o),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),o.code="ERR_ASSERTION",o.actual=u,o.expected=c,o.operator=s,Error.captureStackTrace&&Error.captureStackTrace(ni(o),l),o.stack,o.name="AssertionError",Za(o)}return jc(n,[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:t,value:function(o,a){return oi(this,mo(mo({},a),{},{customInspect:!1,depth:0}))}}]),n}(ii(Error),oi.custom),zc=Bc,So=Object.prototype.toString,ts=function(t){var r=So.call(t),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&So.call(t.callee)==="[object Function]"),n},rs;if(!Object.keys){var Sr=Object.prototype.hasOwnProperty,ko=Object.prototype.toString,Uc=ts,_o=Object.prototype.propertyIsEnumerable,Wc=!_o.call({toString:null},"toString"),Hc=_o.call(function(){},"prototype"),kr=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Cn=function(e){var t=e.constructor;return t&&t.prototype===e},Gc={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Vc=function(){if(typeof window=="undefined")return!1;for(var e in window)try{if(!Gc["$"+e]&&Sr.call(window,e)&&window[e]!==null&&typeof window[e]=="object")try{Cn(window[e])}catch{return!0}}catch{return!0}return!1}(),Kc=function(e){if(typeof window=="undefined"||!Vc)return Cn(e);try{return Cn(e)}catch{return!1}};rs=function(t){var r=t!==null&&typeof t=="object",n=ko.call(t)==="[object Function]",i=Uc(t),o=r&&ko.call(t)==="[object String]",a=[];if(!r&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var s=Hc&&n;if(o&&t.length>0&&!Sr.call(t,0))for(var l=0;l<t.length;++l)a.push(String(l));if(i&&t.length>0)for(var u=0;u<t.length;++u)a.push(String(u));else for(var c in t)!(s&&c==="prototype")&&Sr.call(t,c)&&a.push(String(c));if(Wc)for(var f=Kc(t),p=0;p<kr.length;++p)!(f&&kr[p]==="constructor")&&Sr.call(t,kr[p])&&a.push(kr[p]);return a}}var Qc=rs,Yc=Array.prototype.slice,Jc=ts,Eo=Object.keys,xr=Eo?function(t){return Eo(t)}:Qc,Ao=Object.keys;xr.shim=function(){if(Object.keys){var t=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);t||(Object.keys=function(n){return Jc(n)?Ao(Yc.call(n)):Ao(n)})}else Object.keys=xr;return Object.keys||xr};var ns=xr,Xc=ns,is=Ti(),os=an,Ro=Object,Zc=os("Array.prototype.push"),Oo=os("Object.prototype.propertyIsEnumerable"),ef=is?Object.getOwnPropertySymbols:null,tf=function(t,r){if(t==null)throw new TypeError("target must be an object");var n=Ro(t);if(arguments.length===1)return n;for(var i=1;i<arguments.length;++i){var o=Ro(arguments[i]),a=Xc(o),s=is&&(Object.getOwnPropertySymbols||ef);if(s)for(var l=s(o),u=0;u<l.length;++u){var c=l[u];Oo(o,c)&&Zc(a,c)}for(var f=0;f<a.length;++f){var p=a[f];if(Oo(o,p)){var v=o[p];n[p]=v}}}return n},Nn=tf,rf=function(){if(!Object.assign)return!1;for(var e="abcdefghijklmnopqrst",t=e.split(""),r={},n=0;n<t.length;++n)r[t[n]]=t[n];var i=Object.assign({},r),o="";for(var a in i)o+=a;return e!==o},nf=function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch{return e[1]==="y"}return!1},of=function(){return!Object.assign||rf()||nf()?Nn:Object.assign},Po=function(e){return e!==e},as=function(t,r){return t===0&&r===0?1/t===1/r:!!(t===r||Po(t)&&Po(r))},af=as,$i=function(){return typeof Object.is=="function"?Object.is:af},sf=lr,ai=sf("%Object.defineProperty%",!0),si=function(){if(ai)try{return ai({},"a",{value:1}),!0}catch{return!1}return!1};si.hasArrayLengthDefineBug=function(){if(!si())return null;try{return ai([],"length",{value:1}).length!==1}catch{return!0}};var ss=si,lf=ss(),xi=lr,To=lf&&xi("%Object.defineProperty%",!0),uf=xi("%SyntaxError%"),wt=xi("%TypeError%"),jo=Ka,cf=function(t,r,n){if(!t||typeof t!="object"&&typeof t!="function")throw new wt("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new wt("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new wt("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new wt("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new wt("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new wt("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,l=!!jo&&jo(t,r);if(To)To(t,r,{configurable:a===null&&l?l.configurable:!a,enumerable:i===null&&l?l.enumerable:!i,value:n,writable:o===null&&l?l.writable:!o});else if(s||!i&&!o&&!a)t[r]=n;else throw new uf("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},ff=ns,df=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",hf=Object.prototype.toString,pf=Array.prototype.concat,Co=cf,vf=function(e){return typeof e=="function"&&hf.call(e)==="[object Function]"},ls=ss(),gf=function(e,t,r,n){if(t in e){if(n===!0){if(e[t]===r)return}else if(!vf(n)||!n())return}ls?Co(e,t,r,!0):Co(e,t,r)},us=function(e,t){var r=arguments.length>2?arguments[2]:{},n=ff(t);df&&(n=pf.call(n,Object.getOwnPropertySymbols(t)));for(var i=0;i<n.length;i+=1)gf(e,n[i],t[n[i]],r[n[i]])};us.supportsDescriptors=!!ls;var ln=us,mf=$i,yf=ln,bf=function(){var t=mf();return yf(Object,{is:t},{is:function(){return Object.is!==t}}),t},wf=ln,Sf=ur.exports,kf=as,cs=$i,_f=bf,fs=Sf(cs(),Object);wf(fs,{getPolyfill:cs,implementation:kf,shim:_f});var Ef=fs,ds=function(t){return t!==t},Af=ds,hs=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:Af},Rf=ln,Of=hs,Pf=function(){var t=Of();return Rf(Number,{isNaN:t},{isNaN:function(){return Number.isNaN!==t}}),t},Tf=ur.exports,jf=ln,Cf=ds,ps=hs,Nf=Pf,vs=Tf(ps(),Number);jf(vs,{getPolyfill:ps,implementation:Cf,shim:Nf});var Mf=vs;function No(e,t){return If(e)||qf(e,t)||xf(e,t)||$f()}function $f(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xf(e,t){if(!!e){if(typeof e=="string")return Mo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mo(e,t)}}function Mo(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qf(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,a,s=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}function If(e){if(Array.isArray(e))return e}function _e(e){return _e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_e(e)}var Df=/a/g.flags!==void 0,Yr=function(t){var r=[];return t.forEach(function(n){return r.push(n)}),r},$o=function(t){var r=[];return t.forEach(function(n,i){return r.push([i,n])}),r},gs=Object.is?Object.is:Ef,qr=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},li=Number.isNaN?Number.isNaN:Mf;function qi(e){return e.call.bind(e)}var Ut=qi(Object.prototype.hasOwnProperty),Ir=qi(Object.prototype.propertyIsEnumerable),xo=qi(Object.prototype.toString),be=Ce.types,Lf=be.isAnyArrayBuffer,Ff=be.isArrayBufferView,qo=be.isDate,_r=be.isMap,Io=be.isRegExp,Er=be.isSet,Bf=be.isNativeError,zf=be.isBoxedPrimitive,Do=be.isNumberObject,Lo=be.isStringObject,Fo=be.isBooleanObject,Bo=be.isBigIntObject,Uf=be.isSymbolObject,Wf=be.isFloat32Array,Hf=be.isFloat64Array;function Gf(e){if(e.length===0||e.length>10)return!0;for(var t=0;t<e.length;t++){var r=e.charCodeAt(t);if(r<48||r>57)return!0}return e.length===10&&e>=Math.pow(2,32)}function Ar(e){return Object.keys(e).filter(Gf).concat(qr(e).filter(Object.prototype.propertyIsEnumerable.bind(e)))}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function ms(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}var Vf=!0,Kf=!1,ui=0,Ii=1,ys=2,bs=3;function Qf(e,t){return Df?e.source===t.source&&e.flags===t.flags:RegExp.prototype.toString.call(e)===RegExp.prototype.toString.call(t)}function Yf(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Jf(e,t){return e.byteLength!==t.byteLength?!1:ms(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))===0}function Xf(e,t){return e.byteLength===t.byteLength&&ms(new Uint8Array(e),new Uint8Array(t))===0}function Zf(e,t){return Do(e)?Do(t)&&gs(Number.prototype.valueOf.call(e),Number.prototype.valueOf.call(t)):Lo(e)?Lo(t)&&String.prototype.valueOf.call(e)===String.prototype.valueOf.call(t):Fo(e)?Fo(t)&&Boolean.prototype.valueOf.call(e)===Boolean.prototype.valueOf.call(t):Bo(e)?Bo(t)&&BigInt.prototype.valueOf.call(e)===BigInt.prototype.valueOf.call(t):Uf(t)&&Symbol.prototype.valueOf.call(e)===Symbol.prototype.valueOf.call(t)}function Ee(e,t,r,n){if(e===t)return e!==0?!0:r?gs(e,t):!0;if(r){if(_e(e)!=="object")return typeof e=="number"&&li(e)&&li(t);if(_e(t)!=="object"||e===null||t===null||Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1}else{if(e===null||_e(e)!=="object")return t===null||_e(t)!=="object"?e==t:!1;if(t===null||_e(t)!=="object")return!1}var i=xo(e),o=xo(t);if(i!==o)return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;var a=Ar(e),s=Ar(t);return a.length!==s.length?!1:Ft(e,t,r,n,Ii,a)}if(i==="[object Object]"&&(!_r(e)&&_r(t)||!Er(e)&&Er(t)))return!1;if(qo(e)){if(!qo(t)||Date.prototype.getTime.call(e)!==Date.prototype.getTime.call(t))return!1}else if(Io(e)){if(!Io(t)||!Qf(e,t))return!1}else if(Bf(e)||e instanceof Error){if(e.message!==t.message||e.name!==t.name)return!1}else if(Ff(e)){if(!r&&(Wf(e)||Hf(e))){if(!Yf(e,t))return!1}else if(!Jf(e,t))return!1;var l=Ar(e),u=Ar(t);return l.length!==u.length?!1:Ft(e,t,r,n,ui,l)}else{if(Er(e))return!Er(t)||e.size!==t.size?!1:Ft(e,t,r,n,ys);if(_r(e))return!_r(t)||e.size!==t.size?!1:Ft(e,t,r,n,bs);if(Lf(e)){if(!Xf(e,t))return!1}else if(zf(e)&&!Zf(e,t))return!1}return Ft(e,t,r,n,ui)}function zo(e,t){return t.filter(function(r){return Ir(e,r)})}function Ft(e,t,r,n,i,o){if(arguments.length===5){o=Object.keys(e);var a=Object.keys(t);if(o.length!==a.length)return!1}for(var s=0;s<o.length;s++)if(!Ut(t,o[s]))return!1;if(r&&arguments.length===5){var l=qr(e);if(l.length!==0){var u=0;for(s=0;s<l.length;s++){var c=l[s];if(Ir(e,c)){if(!Ir(t,c))return!1;o.push(c),u++}else if(Ir(t,c))return!1}var f=qr(t);if(l.length!==f.length&&zo(t,f).length!==u)return!1}else{var p=qr(t);if(p.length!==0&&zo(t,p).length!==0)return!1}}if(o.length===0&&(i===ui||i===Ii&&e.length===0||e.size===0))return!0;if(n===void 0)n={val1:new Map,val2:new Map,position:0};else{var v=n.val1.get(e);if(v!==void 0){var h=n.val2.get(t);if(h!==void 0)return v===h}n.position++}n.val1.set(e,n.position),n.val2.set(t,n.position);var w=id(e,t,r,o,n,i);return n.val1.delete(e),n.val2.delete(t),w}function Uo(e,t,r,n){for(var i=Yr(e),o=0;o<i.length;o++){var a=i[o];if(Ee(t,a,r,n))return e.delete(a),!0}return!1}function ws(e){switch(_e(e)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":e=+e;case"number":if(li(e))return!1}return!0}function ed(e,t,r){var n=ws(r);return n!=null?n:t.has(n)&&!e.has(n)}function td(e,t,r,n,i){var o=ws(r);if(o!=null)return o;var a=t.get(o);return a===void 0&&!t.has(o)||!Ee(n,a,!1,i)?!1:!e.has(o)&&Ee(n,a,!1,i)}function rd(e,t,r,n){for(var i=null,o=Yr(e),a=0;a<o.length;a++){var s=o[a];if(_e(s)==="object"&&s!==null)i===null&&(i=new Set),i.add(s);else if(!t.has(s)){if(r||!ed(e,t,s))return!1;i===null&&(i=new Set),i.add(s)}}if(i!==null){for(var l=Yr(t),u=0;u<l.length;u++){var c=l[u];if(_e(c)==="object"&&c!==null){if(!Uo(i,c,r,n))return!1}else if(!r&&!e.has(c)&&!Uo(i,c,r,n))return!1}return i.size===0}return!0}function Wo(e,t,r,n,i,o){for(var a=Yr(e),s=0;s<a.length;s++){var l=a[s];if(Ee(r,l,i,o)&&Ee(n,t.get(l),i,o))return e.delete(l),!0}return!1}function nd(e,t,r,n){for(var i=null,o=$o(e),a=0;a<o.length;a++){var s=No(o[a],2),l=s[0],u=s[1];if(_e(l)==="object"&&l!==null)i===null&&(i=new Set),i.add(l);else{var c=t.get(l);if(c===void 0&&!t.has(l)||!Ee(u,c,r,n)){if(r||!td(e,t,l,u,n))return!1;i===null&&(i=new Set),i.add(l)}}}if(i!==null){for(var f=$o(t),p=0;p<f.length;p++){var v=No(f[p],2),h=v[0],w=v[1];if(_e(h)==="object"&&h!==null){if(!Wo(i,e,h,w,r,n))return!1}else if(!r&&(!e.has(h)||!Ee(e.get(h),w,!1,n))&&!Wo(i,e,h,w,!1,n))return!1}return i.size===0}return!0}function id(e,t,r,n,i,o){var a=0;if(o===ys){if(!rd(e,t,r,i))return!1}else if(o===bs){if(!nd(e,t,r,i))return!1}else if(o===Ii)for(;a<e.length;a++)if(Ut(e,a)){if(!Ut(t,a)||!Ee(e[a],t[a],r,i))return!1}else{if(Ut(t,a))return!1;for(var s=Object.keys(e);a<s.length;a++){var l=s[a];if(!Ut(t,l)||!Ee(e[l],t[l],r,i))return!1}return s.length===Object.keys(t).length}for(a=0;a<n.length;a++){var u=n[a];if(!Ee(e[u],t[u],r,i))return!1}return!0}function od(e,t){return Ee(e,t,Kf)}function ad(e,t){return Ee(e,t,Vf)}var sd={isDeepEqual:od,isDeepStrictEqual:ad};function Te(e){return Te=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Te(e)}function Ho(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ud(n.key),n)}}function ld(e,t,r){return t&&Ho(e.prototype,t),r&&Ho(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function ud(e){var t=cd(e,"string");return Te(t)==="symbol"?t:String(t)}function cd(e,t){if(Te(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Te(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function fd(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var dd=Pi,fr=dd.codes,Go=fr.ERR_AMBIGUOUS_ARGUMENT,$t=fr.ERR_INVALID_ARG_TYPE,hd=fr.ERR_INVALID_ARG_VALUE,pd=fr.ERR_INVALID_RETURN_VALUE,Ze=fr.ERR_MISSING_ARGS,et=zc,vd=Ce,Dr=vd.inspect,Ss=Ce.types,gd=Ss.isPromise,Jr=Ss.isRegExp,md=of(),ks=$i(),Xr=an("RegExp.prototype.test"),Je,un;function dr(){var e=sd;Je=e.isDeepEqual,un=e.isDeepStrictEqual}var Vo=!1,ee=ar.exports=Di,cn={};function Ne(e){throw e.message instanceof Error?e.message:new et(e)}function _s(e,t,r,n,i){var o=arguments.length,a;if(o===0)a="Failed";else if(o===1)r=e,e=void 0;else{if(Vo===!1){Vo=!0;var s=$.process.emitWarning?$.process.emitWarning:console.warn.bind(console);s("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")}o===2&&(n="!=")}if(r instanceof Error)throw r;var l={actual:e,expected:t,operator:n===void 0?"fail":n,stackStartFn:i||_s};r!==void 0&&(l.message=r);var u=new et(l);throw a&&(u.message=a,u.generatedMessage=!0),u}ee.fail=_s;ee.AssertionError=et;function Es(e,t,r,n){if(!r){var i=!1;if(t===0)i=!0,n="No value argument passed to `assert.ok()`";else if(n instanceof Error)throw n;var o=new et({actual:r,expected:!0,message:n,operator:"==",stackStartFn:e});throw o.generatedMessage=i,o}}function Di(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Es.apply(void 0,[Di,t.length].concat(t))}ee.ok=Di;ee.equal=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");t!=r&&Ne({actual:t,expected:r,message:n,operator:"==",stackStartFn:e})};ee.notEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");t==r&&Ne({actual:t,expected:r,message:n,operator:"!=",stackStartFn:e})};ee.deepEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");Je===void 0&&dr(),Je(t,r)||Ne({actual:t,expected:r,message:n,operator:"deepEqual",stackStartFn:e})};ee.notDeepEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");Je===void 0&&dr(),Je(t,r)&&Ne({actual:t,expected:r,message:n,operator:"notDeepEqual",stackStartFn:e})};ee.deepStrictEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");Je===void 0&&dr(),un(t,r)||Ne({actual:t,expected:r,message:n,operator:"deepStrictEqual",stackStartFn:e})};ee.notDeepStrictEqual=As;function As(e,t,r){if(arguments.length<2)throw new Ze("actual","expected");Je===void 0&&dr(),un(e,t)&&Ne({actual:e,expected:t,message:r,operator:"notDeepStrictEqual",stackStartFn:As})}ee.strictEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");ks(t,r)||Ne({actual:t,expected:r,message:n,operator:"strictEqual",stackStartFn:e})};ee.notStrictEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");ks(t,r)&&Ne({actual:t,expected:r,message:n,operator:"notStrictEqual",stackStartFn:e})};var Ko=ld(function e(t,r,n){var i=this;fd(this,e),r.forEach(function(o){o in t&&(n!==void 0&&typeof n[o]=="string"&&Jr(t[o])&&Xr(t[o],n[o])?i[o]=n[o]:i[o]=t[o])})});function yd(e,t,r,n,i,o){if(!(r in e)||!un(e[r],t[r])){if(!n){var a=new Ko(e,i),s=new Ko(t,i,e),l=new et({actual:a,expected:s,operator:"deepStrictEqual",stackStartFn:o});throw l.actual=e,l.expected=t,l.operator=o.name,l}Ne({actual:e,expected:t,message:n,operator:o.name,stackStartFn:o})}}function Rs(e,t,r,n){if(typeof t!="function"){if(Jr(t))return Xr(t,e);if(arguments.length===2)throw new $t("expected",["Function","RegExp"],t);if(Te(e)!=="object"||e===null){var i=new et({actual:e,expected:t,message:r,operator:"deepStrictEqual",stackStartFn:n});throw i.operator=n.name,i}var o=Object.keys(t);if(t instanceof Error)o.push("name","message");else if(o.length===0)throw new hd("error",t,"may not be an empty object");return Je===void 0&&dr(),o.forEach(function(a){typeof e[a]=="string"&&Jr(t[a])&&Xr(t[a],e[a])||yd(e,t,a,r,o,n)}),!0}return t.prototype!==void 0&&e instanceof t?!0:Error.isPrototypeOf(t)?!1:t.call({},e)===!0}function Os(e){if(typeof e!="function")throw new $t("fn","Function",e);try{e()}catch(t){return t}return cn}function Qo(e){return gd(e)||e!==null&&Te(e)==="object"&&typeof e.then=="function"&&typeof e.catch=="function"}function Ps(e){return Promise.resolve().then(function(){var t;if(typeof e=="function"){if(t=e(),!Qo(t))throw new pd("instance of Promise","promiseFn",t)}else if(Qo(e))t=e;else throw new $t("promiseFn",["Function","Promise"],e);return Promise.resolve().then(function(){return t}).then(function(){return cn}).catch(function(r){return r})})}function Ts(e,t,r,n){if(typeof r=="string"){if(arguments.length===4)throw new $t("error",["Object","Error","Function","RegExp"],r);if(Te(t)==="object"&&t!==null){if(t.message===r)throw new Go("error/message",'The error message "'.concat(t.message,'" is identical to the message.'))}else if(t===r)throw new Go("error/message",'The error "'.concat(t,'" is identical to the message.'));n=r,r=void 0}else if(r!=null&&Te(r)!=="object"&&typeof r!="function")throw new $t("error",["Object","Error","Function","RegExp"],r);if(t===cn){var i="";r&&r.name&&(i+=" (".concat(r.name,")")),i+=n?": ".concat(n):".";var o=e.name==="rejects"?"rejection":"exception";Ne({actual:void 0,expected:r,operator:e.name,message:"Missing expected ".concat(o).concat(i),stackStartFn:e})}if(r&&!Rs(t,r,n,e))throw t}function js(e,t,r,n){if(t!==cn){if(typeof r=="string"&&(n=r,r=void 0),!r||Rs(t,r)){var i=n?": ".concat(n):".",o=e.name==="doesNotReject"?"rejection":"exception";Ne({actual:t,expected:r,operator:e.name,message:"Got unwanted ".concat(o).concat(i,`
`)+'Actual message: "'.concat(t&&t.message,'"'),stackStartFn:e})}throw t}}ee.throws=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];Ts.apply(void 0,[e,Os(t)].concat(n))};ee.rejects=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return Ps(t).then(function(o){return Ts.apply(void 0,[e,o].concat(n))})};ee.doesNotThrow=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];js.apply(void 0,[e,Os(t)].concat(n))};ee.doesNotReject=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return Ps(t).then(function(o){return js.apply(void 0,[e,o].concat(n))})};ee.ifError=function e(t){if(t!=null){var r="ifError got unwanted exception: ";Te(t)==="object"&&typeof t.message=="string"?t.message.length===0&&t.constructor?r+=t.constructor.name:r+=t.message:r+=Dr(t);var n=new et({actual:t,expected:null,operator:"ifError",message:r,stackStartFn:e}),i=t.stack;if(typeof i=="string"){var o=i.split(`
`);o.shift();for(var a=n.stack.split(`
`),s=0;s<o.length;s++){var l=a.indexOf(o[s]);if(l!==-1){a=a.slice(0,l);break}}n.stack="".concat(a.join(`
`),`
`).concat(o.join(`
`))}throw n}};function Cs(e,t,r,n,i){if(!Jr(t))throw new $t("regexp","RegExp",t);var o=i==="match";if(typeof e!="string"||Xr(t,e)!==o){if(r instanceof Error)throw r;var a=!r;r=r||(typeof e!="string"?'The "string" argument must be of type string. Received type '+"".concat(Te(e)," (").concat(Dr(e),")"):(o?"The input did not match the regular expression ":"The input was expected to not match the regular expression ")+"".concat(Dr(t),`. Input:

`).concat(Dr(e),`
`));var s=new et({actual:e,expected:t,message:r,operator:i,stackStartFn:n});throw s.generatedMessage=a,s}}ee.match=function e(t,r,n){Cs(t,r,n,e,"match")};ee.doesNotMatch=function e(t,r,n){Cs(t,r,n,e,"doesNotMatch")};function Ns(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Es.apply(void 0,[Ns,t.length].concat(t))}ee.strict=md(Ns,ee,{equal:ee.strictEqual,deepEqual:ee.deepStrictEqual,notEqual:ee.notStrictEqual,notDeepEqual:ee.notDeepStrictEqual});ee.strict.strict=ee.strict;var hr={exports:{}},Ot=typeof Reflect=="object"?Reflect:null,Yo=Ot&&typeof Ot.apply=="function"?Ot.apply:function(t,r,n){return Function.prototype.apply.call(t,r,n)},Lr;Ot&&typeof Ot.ownKeys=="function"?Lr=Ot.ownKeys:Object.getOwnPropertySymbols?Lr=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Lr=function(t){return Object.getOwnPropertyNames(t)};function bd(e){console&&console.warn&&console.warn(e)}var Ms=Number.isNaN||function(t){return t!==t};function Z(){Z.init.call(this)}hr.exports=Z;hr.exports.once=_d;Z.EventEmitter=Z;Z.prototype._events=void 0;Z.prototype._eventsCount=0;Z.prototype._maxListeners=void 0;var Jo=10;function fn(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(Z,"defaultMaxListeners",{enumerable:!0,get:function(){return Jo},set:function(e){if(typeof e!="number"||e<0||Ms(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Jo=e}});Z.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Z.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Ms(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function $s(e){return e._maxListeners===void 0?Z.defaultMaxListeners:e._maxListeners}Z.prototype.getMaxListeners=function(){return $s(this)};Z.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=t==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var a;if(r.length>0&&(a=r[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=o[t];if(l===void 0)return!1;if(typeof l=="function")Yo(l,this,r);else for(var u=l.length,c=Ls(l,u),n=0;n<u;++n)Yo(c[n],this,r);return!0};function xs(e,t,r,n){var i,o,a;if(fn(r),o=e._events,o===void 0?(o=e._events=Object.create(null),e._eventsCount=0):(o.newListener!==void 0&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),a===void 0)a=o[t]=r,++e._eventsCount;else if(typeof a=="function"?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),i=$s(e),i>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,bd(s)}return e}Z.prototype.addListener=function(t,r){return xs(this,t,r,!1)};Z.prototype.on=Z.prototype.addListener;Z.prototype.prependListener=function(t,r){return xs(this,t,r,!0)};function wd(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function qs(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=wd.bind(n);return i.listener=r,n.wrapFn=i,i}Z.prototype.once=function(t,r){return fn(r),this.on(t,qs(this,t,r)),this};Z.prototype.prependOnceListener=function(t,r){return fn(r),this.prependListener(t,qs(this,t,r)),this};Z.prototype.removeListener=function(t,r){var n,i,o,a,s;if(fn(r),i=this._events,i===void 0)return this;if(n=i[t],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||r));else if(typeof n!="function"){for(o=-1,a=n.length-1;a>=0;a--)if(n[a]===r||n[a].listener===r){s=n[a].listener,o=a;break}if(o<0)return this;o===0?n.shift():Sd(n,o),n.length===1&&(i[t]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",t,s||r)}return this};Z.prototype.off=Z.prototype.removeListener;Z.prototype.removeAllListeners=function(t){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var o=Object.keys(n),a;for(i=0;i<o.length;++i)a=o[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(t,r[i]);return this};function Is(e,t,r){var n=e._events;if(n===void 0)return[];var i=n[t];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?kd(i):Ls(i,i.length)}Z.prototype.listeners=function(t){return Is(this,t,!0)};Z.prototype.rawListeners=function(t){return Is(this,t,!1)};Z.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):Ds.call(e,t)};Z.prototype.listenerCount=Ds;function Ds(e){var t=this._events;if(t!==void 0){var r=t[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Z.prototype.eventNames=function(){return this._eventsCount>0?Lr(this._events):[]};function Ls(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function Sd(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function kd(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function _d(e,t){return new Promise(function(r,n){function i(a){e.removeListener(t,o),n(a)}function o(){typeof e.removeListener=="function"&&e.removeListener("error",i),r([].slice.call(arguments))}Fs(e,t,o,{once:!0}),t!=="error"&&Ed(e,i,{once:!0})})}function Ed(e,t,r){typeof e.on=="function"&&Fs(e,"error",t,r)}function Fs(e,t,r,n){if(typeof e.on=="function")n.once?e.once(t,r):e.on(t,r);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(o){n.once&&e.removeEventListener(t,i),r(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var Bs=hr.exports.EventEmitter;function Xo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Zo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Xo(Object(r),!0).forEach(function(n){Ad(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ad(e,t,r){return t=zs(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Rd(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ea(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,zs(n.key),n)}}function Od(e,t,r){return t&&ea(e.prototype,t),r&&ea(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function zs(e){var t=Pd(e,"string");return typeof t=="symbol"?t:String(t)}function Pd(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Td=on,Fr=Td.Buffer,jd=Ce,ci=jd.inspect,Cd=ci&&ci.custom||"inspect";function Nd(e,t,r){Fr.prototype.copy.call(e,t,r)}var Md=function(){function e(){Rd(this,e),this.head=null,this.tail=null,this.length=0}return Od(e,[{key:"push",value:function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length!==0){var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=r+n.data;return i}},{key:"concat",value:function(r){if(this.length===0)return Fr.alloc(0);for(var n=Fr.allocUnsafe(r>>>0),i=this.head,o=0;i;)Nd(i.data,n,o),o+=i.data.length,i=i.next;return n}},{key:"consume",value:function(r,n){var i;return r<this.head.data.length?(i=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?i=this.shift():i=n?this._getString(r):this._getBuffer(r),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var n=this.head,i=1,o=n.data;for(r-=o.length;n=n.next;){var a=n.data,s=r>a.length?a.length:r;if(s===a.length?o+=a:o+=a.slice(0,r),r-=s,r===0){s===a.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=a.slice(s));break}++i}return this.length-=i,o}},{key:"_getBuffer",value:function(r){var n=Fr.allocUnsafe(r),i=this.head,o=1;for(i.data.copy(n),r-=i.data.length;i=i.next;){var a=i.data,s=r>a.length?a.length:r;if(a.copy(n,n.length-r,0,s),r-=s,r===0){s===a.length?(++o,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=a.slice(s));break}++o}return this.length-=o,n}},{key:Cd,value:function(r,n){return ci(this,Zo(Zo({},n),{},{depth:0,customInspect:!1}))}}]),e}();function $d(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,$.process.nextTick(fi,this,e)):$.process.nextTick(fi,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(o){!t&&o?r._writableState?r._writableState.errorEmitted?$.process.nextTick(Br,r):(r._writableState.errorEmitted=!0,$.process.nextTick(ta,r,o)):$.process.nextTick(ta,r,o):t?($.process.nextTick(Br,r),t(o)):$.process.nextTick(Br,r)}),this)}function ta(e,t){fi(e,t),Br(e)}function Br(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function xd(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function fi(e,t){e.emit("error",t)}function qd(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}var Us={destroy:$d,undestroy:xd,errorOrDestroy:qd},mt={};function Id(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Ws={};function Re(e,t,r){r||(r=Error);function n(o,a,s){return typeof t=="string"?t:t(o,a,s)}var i=function(o){Id(a,o);function a(s,l,u){return o.call(this,n(s,l,u))||this}return a}(r);i.prototype.name=r.name,i.prototype.code=e,Ws[e]=i}function ra(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(n){return String(n)}),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:r===2?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}else return"of ".concat(t," ").concat(String(e))}function Dd(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function Ld(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function Fd(e,t,r){return typeof r!="number"&&(r=0),r+t.length>e.length?!1:e.indexOf(t,r)!==-1}Re("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError);Re("ERR_INVALID_ARG_TYPE",function(e,t,r){var n;typeof t=="string"&&Dd(t,"not ")?(n="must not be",t=t.replace(/^not /,"")):n="must be";var i;if(Ld(e," argument"))i="The ".concat(e," ").concat(n," ").concat(ra(t,"type"));else{var o=Fd(e,".")?"property":"argument";i='The "'.concat(e,'" ').concat(o," ").concat(n," ").concat(ra(t,"type"))}return i+=". Received type ".concat(typeof r),i},TypeError);Re("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");Re("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"});Re("ERR_STREAM_PREMATURE_CLOSE","Premature close");Re("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"});Re("ERR_MULTIPLE_CALLBACK","Callback called multiple times");Re("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");Re("ERR_STREAM_WRITE_AFTER_END","write after end");Re("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);Re("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError);Re("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");mt.codes=Ws;var Bd=mt.codes.ERR_INVALID_OPT_VALUE;function zd(e,t,r){return e.highWaterMark!=null?e.highWaterMark:t?e[r]:null}function Ud(e,t,r,n){var i=zd(t,n,r);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var o=n?r:"highWaterMark";throw new Bd(o,i)}return Math.floor(i)}return e.objectMode?16:16*1024}var Hs={getHighWaterMark:Ud},Wd=Hd;function Hd(e,t){if(Mn("noDeprecation"))return e;var r=!1;function n(){if(!r){if(Mn("throwDeprecation"))throw new Error(t);Mn("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}return n}function Mn(e){try{if(!Qe.localStorage)return!1}catch{return!1}var t=Qe.localStorage[e];return t==null?!1:String(t).toLowerCase()==="true"}var Gs=oe;function Vs(e){var t=this;this.next=null,this.entry=null,this.finish=function(){yh(t,e)}}var Pt;oe.WritableState=pr;var Gd={deprecate:Wd},Ks=Bs,dn=on.Buffer,Vd=(typeof Qe!="undefined"?Qe:typeof window!="undefined"?window:typeof self!="undefined"?self:{}).Uint8Array||function(){};function Kd(e){return dn.from(e)}function Qd(e){return dn.isBuffer(e)||e instanceof Vd}var Li=Us,Yd=Hs,Jd=Yd.getHighWaterMark,tt=mt.codes,Xd=tt.ERR_INVALID_ARG_TYPE,Zd=tt.ERR_METHOD_NOT_IMPLEMENTED,eh=tt.ERR_MULTIPLE_CALLBACK,th=tt.ERR_STREAM_CANNOT_PIPE,rh=tt.ERR_STREAM_DESTROYED,nh=tt.ERR_STREAM_NULL_VALUES,ih=tt.ERR_STREAM_WRITE_AFTER_END,oh=tt.ERR_UNKNOWN_ENCODING,xt=Li.errorOrDestroy;Fe.exports(oe,Ks);function ah(){}function pr(e,t,r){Pt=Pt||Dt,e=e||{},typeof r!="boolean"&&(r=t instanceof Pt),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=Jd(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=e.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(i){hh(t,i)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new Vs(this)}pr.prototype.getBuffer=function(){for(var t=this.bufferedRequest,r=[];t;)r.push(t),t=t.next;return r};(function(){try{Object.defineProperty(pr.prototype,"buffer",{get:Gd.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var zr;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(zr=Function.prototype[Symbol.hasInstance],Object.defineProperty(oe,Symbol.hasInstance,{value:function(t){return zr.call(this,t)?!0:this!==oe?!1:t&&t._writableState instanceof pr}})):zr=function(t){return t instanceof this};function oe(e){Pt=Pt||Dt;var t=this instanceof Pt;if(!t&&!zr.call(oe,this))return new oe(e);this._writableState=new pr(e,this,t),this.writable=!0,e&&(typeof e.write=="function"&&(this._write=e.write),typeof e.writev=="function"&&(this._writev=e.writev),typeof e.destroy=="function"&&(this._destroy=e.destroy),typeof e.final=="function"&&(this._final=e.final)),Ks.call(this)}oe.prototype.pipe=function(){xt(this,new th)};function sh(e,t){var r=new ih;xt(e,r),$.process.nextTick(t,r)}function lh(e,t,r,n){var i;return r===null?i=new nh:typeof r!="string"&&!t.objectMode&&(i=new Xd("chunk",["string","Buffer"],r)),i?(xt(e,i),$.process.nextTick(n,i),!1):!0}oe.prototype.write=function(e,t,r){var n=this._writableState,i=!1,o=!n.objectMode&&Qd(e);return o&&!dn.isBuffer(e)&&(e=Kd(e)),typeof t=="function"&&(r=t,t=null),o?t="buffer":t||(t=n.defaultEncoding),typeof r!="function"&&(r=ah),n.ending?sh(this,r):(o||lh(this,n,e,r))&&(n.pendingcb++,i=ch(this,n,o,e,t,r)),i};oe.prototype.cork=function(){this._writableState.corked++};oe.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.bufferProcessing&&e.bufferedRequest&&Qs(this,e))};oe.prototype.setDefaultEncoding=function(t){if(typeof t=="string"&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new oh(t);return this._writableState.defaultEncoding=t,this};Object.defineProperty(oe.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function uh(e,t,r){return!e.objectMode&&e.decodeStrings!==!1&&typeof t=="string"&&(t=dn.from(t,r)),t}Object.defineProperty(oe.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function ch(e,t,r,n,i,o){if(!r){var a=uh(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var s=t.objectMode?1:n.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else di(e,t,!1,s,n,i,o);return l}function di(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new rh("write")):r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function fh(e,t,r,n,i){--t.pendingcb,r?($.process.nextTick(i,n),$.process.nextTick(rr,e,t),e._writableState.errorEmitted=!0,xt(e,n)):(i(n),e._writableState.errorEmitted=!0,xt(e,n),rr(e,t))}function dh(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function hh(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(typeof i!="function")throw new eh;if(dh(r),t)fh(e,r,n,t,i);else{var o=Ys(r)||e.destroyed;!o&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&Qs(e,r),n?$.process.nextTick(na,e,r,o,i):na(e,r,o,i)}}function na(e,t,r,n){r||ph(e,t),t.pendingcb--,n(),rr(e,t)}function ph(e,t){t.length===0&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function Qs(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var a=0,s=!0;r;)i[a]=r,r.isBuf||(s=!1),r=r.next,a+=1;i.allBuffers=s,di(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new Vs(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,u=r.encoding,c=r.callback,f=t.objectMode?1:l.length;if(di(e,t,!1,f,l,u,c),r=r.next,t.bufferedRequestCount--,t.writing)break}r===null&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}oe.prototype._write=function(e,t,r){r(new Zd("_write()"))};oe.prototype._writev=null;oe.prototype.end=function(e,t,r){var n=this._writableState;return typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"&&(r=t,t=null),e!=null&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||mh(this,n,r),this};Object.defineProperty(oe.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Ys(e){return e.ending&&e.length===0&&e.bufferedRequest===null&&!e.finished&&!e.writing}function vh(e,t){e._final(function(r){t.pendingcb--,r&&xt(e,r),t.prefinished=!0,e.emit("prefinish"),rr(e,t)})}function gh(e,t){!t.prefinished&&!t.finalCalled&&(typeof e._final=="function"&&!t.destroyed?(t.pendingcb++,t.finalCalled=!0,$.process.nextTick(vh,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function rr(e,t){var r=Ys(t);if(r&&(gh(e,t),t.pendingcb===0&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}function mh(e,t,r){t.ending=!0,rr(e,t),r&&(t.finished?$.process.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function yh(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}Object.defineProperty(oe.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(t){!this._writableState||(this._writableState.destroyed=t)}});oe.prototype.destroy=Li.destroy;oe.prototype._undestroy=Li.undestroy;oe.prototype._destroy=function(e,t){t(e)};var bh=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},Dt=qe,Js=Zs,hi=Gs;Fe.exports(qe,Js);for(var ia=bh(hi.prototype),$n=0;$n<ia.length;$n++){var xn=ia[$n];qe.prototype[xn]||(qe.prototype[xn]=hi.prototype[xn])}function qe(e){if(!(this instanceof qe))return new qe(e);Js.call(this,e),hi.call(this,e),this.allowHalfOpen=!0,e&&(e.readable===!1&&(this.readable=!1),e.writable===!1&&(this.writable=!1),e.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",wh)))}Object.defineProperty(qe.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(qe.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(qe.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function wh(){this._writableState.ended||$.process.nextTick(Sh,this)}function Sh(e){e.end()}Object.defineProperty(qe.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(t){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=t,this._writableState.destroyed=t)}});var Fi={},pi={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(e,t){var r=on,n=r.Buffer;function i(a,s){for(var l in a)s[l]=a[l]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=o);function o(a,s,l){return n(a,s,l)}o.prototype=Object.create(n.prototype),i(n,o),o.from=function(a,s,l){if(typeof a=="number")throw new TypeError("Argument must not be a number");return n(a,s,l)},o.alloc=function(a,s,l){if(typeof a!="number")throw new TypeError("Argument must be a number");var u=n(a);return s!==void 0?typeof l=="string"?u.fill(s,l):u.fill(s):u.fill(0),u},o.allocUnsafe=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return n(a)},o.allocUnsafeSlow=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return r.SlowBuffer(a)}})(pi,pi.exports);var Bi=pi.exports.Buffer,oa=Bi.isEncoding||function(e){switch(e=""+e,e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function kh(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function _h(e){var t=kh(e);if(typeof t!="string"&&(Bi.isEncoding===oa||!oa(e)))throw new Error("Unknown encoding: "+e);return t||e}Fi.StringDecoder=vr;function vr(e){this.encoding=_h(e);var t;switch(this.encoding){case"utf16le":this.text=Th,this.end=jh,t=4;break;case"utf8":this.fillLast=Rh,t=4;break;case"base64":this.text=Ch,this.end=Nh,t=3;break;default:this.write=Mh,this.end=$h;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Bi.allocUnsafe(t)}vr.prototype.write=function(e){if(e.length===0)return"";var t,r;if(this.lastNeed){if(t=this.fillLast(e),t===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""};vr.prototype.end=Ph;vr.prototype.text=Oh;vr.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length};function qn(e){return e<=127?0:e>>5===6?2:e>>4===14?3:e>>3===30?4:e>>6===2?-1:-2}function Eh(e,t,r){var n=t.length-1;if(n<r)return 0;var i=qn(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||i===-2?0:(i=qn(t[n]),i>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||i===-2?0:(i=qn(t[n]),i>=0?(i>0&&(i===2?i=0:e.lastNeed=i-3),i):0))}function Ah(e,t,r){if((t[0]&192)!==128)return e.lastNeed=0,"\uFFFD";if(e.lastNeed>1&&t.length>1){if((t[1]&192)!==128)return e.lastNeed=1,"\uFFFD";if(e.lastNeed>2&&t.length>2&&(t[2]&192)!==128)return e.lastNeed=2,"\uFFFD"}}function Rh(e){var t=this.lastTotal-this.lastNeed,r=Ah(this,e);if(r!==void 0)return r;if(this.lastNeed<=e.length)return e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length}function Oh(e,t){var r=Eh(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function Ph(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\uFFFD":t}function Th(e,t){if((e.length-t)%2===0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function jh(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function Ch(e,t){var r=(e.length-t)%3;return r===0?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function Nh(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function Mh(e){return e.toString(this.encoding)}function $h(e){return e&&e.length?this.write(e):""}var aa=mt.codes.ERR_STREAM_PREMATURE_CLOSE;function xh(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}function qh(){}function Ih(e){return e.setHeader&&typeof e.abort=="function"}function Xs(e,t,r){if(typeof t=="function")return Xs(e,null,t);t||(t={}),r=xh(r||qh);var n=t.readable||t.readable!==!1&&e.readable,i=t.writable||t.writable!==!1&&e.writable,o=function(){e.writable||s()},a=e._writableState&&e._writableState.finished,s=function(){i=!1,a=!0,n||r.call(e)},l=e._readableState&&e._readableState.endEmitted,u=function(){n=!1,l=!0,i||r.call(e)},c=function(h){r.call(e,h)},f=function(){var h;if(n&&!l)return(!e._readableState||!e._readableState.ended)&&(h=new aa),r.call(e,h);if(i&&!a)return(!e._writableState||!e._writableState.ended)&&(h=new aa),r.call(e,h)},p=function(){e.req.on("finish",s)};return Ih(e)?(e.on("complete",s),e.on("abort",f),e.req?p():e.on("request",p)):i&&!e._writableState&&(e.on("end",o),e.on("close",o)),e.on("end",u),e.on("finish",s),t.error!==!1&&e.on("error",c),e.on("close",f),function(){e.removeListener("complete",s),e.removeListener("abort",f),e.removeListener("request",p),e.req&&e.req.removeListener("finish",s),e.removeListener("end",o),e.removeListener("close",o),e.removeListener("finish",s),e.removeListener("end",u),e.removeListener("error",c),e.removeListener("close",f)}}var zi=Xs,Rr;function Ue(e,t,r){return t=Dh(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dh(e){var t=Lh(e,"string");return typeof t=="symbol"?t:String(t)}function Lh(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Fh=zi,We=Symbol("lastResolve"),rt=Symbol("lastReject"),Kt=Symbol("error"),Zr=Symbol("ended"),ot=Symbol("lastPromise"),Ui=Symbol("handlePromise"),at=Symbol("stream");function Ge(e,t){return{value:e,done:t}}function Bh(e){var t=e[We];if(t!==null){var r=e[at].read();r!==null&&(e[ot]=null,e[We]=null,e[rt]=null,t(Ge(r,!1)))}}function zh(e){$.process.nextTick(Bh,e)}function Uh(e,t){return function(r,n){e.then(function(){if(t[Zr]){r(Ge(void 0,!0));return}t[Ui](r,n)},n)}}var Wh=Object.getPrototypeOf(function(){}),Hh=Object.setPrototypeOf((Rr={get stream(){return this[at]},next:function(){var t=this,r=this[Kt];if(r!==null)return Promise.reject(r);if(this[Zr])return Promise.resolve(Ge(void 0,!0));if(this[at].destroyed)return new Promise(function(a,s){$.process.nextTick(function(){t[Kt]?s(t[Kt]):a(Ge(void 0,!0))})});var n=this[ot],i;if(n)i=new Promise(Uh(n,this));else{var o=this[at].read();if(o!==null)return Promise.resolve(Ge(o,!1));i=new Promise(this[Ui])}return this[ot]=i,i}},Ue(Rr,Symbol.asyncIterator,function(){return this}),Ue(Rr,"return",function(){var t=this;return new Promise(function(r,n){t[at].destroy(null,function(i){if(i){n(i);return}r(Ge(void 0,!0))})})}),Rr),Wh),Gh=function(t){var r,n=Object.create(Hh,(r={},Ue(r,at,{value:t,writable:!0}),Ue(r,We,{value:null,writable:!0}),Ue(r,rt,{value:null,writable:!0}),Ue(r,Kt,{value:null,writable:!0}),Ue(r,Zr,{value:t._readableState.endEmitted,writable:!0}),Ue(r,Ui,{value:function(o,a){var s=n[at].read();s?(n[ot]=null,n[We]=null,n[rt]=null,o(Ge(s,!1))):(n[We]=o,n[rt]=a)},writable:!0}),r));return n[ot]=null,Fh(t,function(i){if(i&&i.code!=="ERR_STREAM_PREMATURE_CLOSE"){var o=n[rt];o!==null&&(n[ot]=null,n[We]=null,n[rt]=null,o(i)),n[Kt]=i;return}var a=n[We];a!==null&&(n[ot]=null,n[We]=null,n[rt]=null,a(Ge(void 0,!0))),n[Zr]=!0}),t.on("readable",zh.bind(null,n)),n},Vh=Gh,Kh=function(){throw new Error("Readable.from is not available in the browser")},Zs=G,Tt;G.ReadableState=tl;hr.exports.EventEmitter;var el=function(t,r){return t.listeners(r).length},gr=Bs,hn=on.Buffer,Qh=(typeof Qe!="undefined"?Qe:typeof window!="undefined"?window:typeof self!="undefined"?self:{}).Uint8Array||function(){};function Yh(e){return hn.from(e)}function Jh(e){return hn.isBuffer(e)||e instanceof Qh}var In=Ce,z;In&&In.debuglog?z=In.debuglog("stream"):z=function(){};var Xh=Md,Wi=Us,Zh=Hs,ep=Zh.getHighWaterMark,pn=mt.codes,tp=pn.ERR_INVALID_ARG_TYPE,rp=pn.ERR_STREAM_PUSH_AFTER_EOF,np=pn.ERR_METHOD_NOT_IMPLEMENTED,ip=pn.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,jt,Dn,Ln;Fe.exports(G,gr);var Qt=Wi.errorOrDestroy,Fn=["error","close","destroy","pause","resume"];function op(e,t,r){if(typeof e.prependListener=="function")return e.prependListener(t,r);!e._events||!e._events[t]?e.on(t,r):Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]}function tl(e,t,r){Tt=Tt||Dt,e=e||{},typeof r!="boolean"&&(r=t instanceof Tt),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=ep(this,e,"readableHighWaterMark",r),this.buffer=new Xh,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(jt||(jt=Fi.StringDecoder),this.decoder=new jt(e.encoding),this.encoding=e.encoding)}function G(e){if(Tt=Tt||Dt,!(this instanceof G))return new G(e);var t=this instanceof Tt;this._readableState=new tl(e,this,t),this.readable=!0,e&&(typeof e.read=="function"&&(this._read=e.read),typeof e.destroy=="function"&&(this._destroy=e.destroy)),gr.call(this)}Object.defineProperty(G.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(t){!this._readableState||(this._readableState.destroyed=t)}});G.prototype.destroy=Wi.destroy;G.prototype._undestroy=Wi.undestroy;G.prototype._destroy=function(e,t){t(e)};G.prototype.push=function(e,t){var r=this._readableState,n;return r.objectMode?n=!0:typeof e=="string"&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=hn.from(e,t),t=""),n=!0),rl(this,e,t,!1,n)};G.prototype.unshift=function(e){return rl(this,e,null,!0,!1)};function rl(e,t,r,n,i){z("readableAddChunk",t);var o=e._readableState;if(t===null)o.reading=!1,lp(e,o);else{var a;if(i||(a=ap(o,t)),a)Qt(e,a);else if(o.objectMode||t&&t.length>0)if(typeof t!="string"&&!o.objectMode&&Object.getPrototypeOf(t)!==hn.prototype&&(t=Yh(t)),n)o.endEmitted?Qt(e,new ip):Bn(e,o,t,!0);else if(o.ended)Qt(e,new rp);else{if(o.destroyed)return!1;o.reading=!1,o.decoder&&!r?(t=o.decoder.write(t),o.objectMode||t.length!==0?Bn(e,o,t,!1):vi(e,o)):Bn(e,o,t,!1)}else n||(o.reading=!1,vi(e,o))}return!o.ended&&(o.length<o.highWaterMark||o.length===0)}function Bn(e,t,r,n){t.flowing&&t.length===0&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&vn(e)),vi(e,t)}function ap(e,t){var r;return!Jh(t)&&typeof t!="string"&&t!==void 0&&!e.objectMode&&(r=new tp("chunk",["string","Buffer","Uint8Array"],t)),r}G.prototype.isPaused=function(){return this._readableState.flowing===!1};G.prototype.setEncoding=function(e){jt||(jt=Fi.StringDecoder);var t=new jt(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";r!==null;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var sa=1073741824;function sp(e){return e>=sa?e=sa:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function la(e,t){return e<=0||t.length===0&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=sp(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}G.prototype.read=function(e){z("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(e!==0&&(t.emittedReadable=!1),e===0&&t.needReadable&&((t.highWaterMark!==0?t.length>=t.highWaterMark:t.length>0)||t.ended))return z("read: emitReadable",t.length,t.ended),t.length===0&&t.ended?zn(this):vn(this),null;if(e=la(e,t),e===0&&t.ended)return t.length===0&&zn(this),null;var n=t.needReadable;z("need readable",n),(t.length===0||t.length-e<t.highWaterMark)&&(n=!0,z("length less than watermark",n)),t.ended||t.reading?(n=!1,z("reading or ended",n)):n&&(z("do read"),t.reading=!0,t.sync=!0,t.length===0&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=la(r,t)));var i;return e>0?i=ol(e,t):i=null,i===null?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),t.length===0&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&zn(this)),i!==null&&this.emit("data",i),i};function lp(e,t){if(z("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?vn(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,nl(e)))}}function vn(e){var t=e._readableState;z("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(z("emitReadable",t.flowing),t.emittedReadable=!0,$.process.nextTick(nl,e))}function nl(e){var t=e._readableState;z("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,Hi(e)}function vi(e,t){t.readingMore||(t.readingMore=!0,$.process.nextTick(up,e,t))}function up(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&t.length===0);){var r=t.length;if(z("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}G.prototype._read=function(e){Qt(this,new np("_read()"))};G.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e);break}n.pipesCount+=1,z("pipe count=%d opts=%j",n.pipesCount,t);var i=(!t||t.end!==!1)&&e!==$.process.stdout&&e!==$.process.stderr,o=i?s:w;n.endEmitted?$.process.nextTick(o):r.once("end",o),e.on("unpipe",a);function a(S,T){z("onunpipe"),S===r&&T&&T.hasUnpiped===!1&&(T.hasUnpiped=!0,c())}function s(){z("onend"),e.end()}var l=cp(r);e.on("drain",l);var u=!1;function c(){z("cleanup"),e.removeListener("close",v),e.removeListener("finish",h),e.removeListener("drain",l),e.removeListener("error",p),e.removeListener("unpipe",a),r.removeListener("end",s),r.removeListener("end",w),r.removeListener("data",f),u=!0,n.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&l()}r.on("data",f);function f(S){z("ondata");var T=e.write(S);z("dest.write",T),T===!1&&((n.pipesCount===1&&n.pipes===e||n.pipesCount>1&&al(n.pipes,e)!==-1)&&!u&&(z("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function p(S){z("onerror",S),w(),e.removeListener("error",p),el(e,"error")===0&&Qt(e,S)}op(e,"error",p);function v(){e.removeListener("finish",h),w()}e.once("close",v);function h(){z("onfinish"),e.removeListener("close",v),w()}e.once("finish",h);function w(){z("unpipe"),r.unpipe(e)}return e.emit("pipe",r),n.flowing||(z("pipe resume"),r.resume()),e};function cp(e){return function(){var r=e._readableState;z("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&el(e,"data")&&(r.flowing=!0,Hi(e))}}G.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(t.pipesCount===0)return this;if(t.pipesCount===1)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,{hasUnpiped:!1});return this}var a=al(t.pipes,e);return a===-1?this:(t.pipes.splice(a,1),t.pipesCount-=1,t.pipesCount===1&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)};G.prototype.on=function(e,t){var r=gr.prototype.on.call(this,e,t),n=this._readableState;return e==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):e==="readable"&&!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,z("on readable",n.length,n.reading),n.length?vn(this):n.reading||$.process.nextTick(fp,this)),r};G.prototype.addListener=G.prototype.on;G.prototype.removeListener=function(e,t){var r=gr.prototype.removeListener.call(this,e,t);return e==="readable"&&$.process.nextTick(il,this),r};G.prototype.removeAllListeners=function(e){var t=gr.prototype.removeAllListeners.apply(this,arguments);return(e==="readable"||e===void 0)&&$.process.nextTick(il,this),t};function il(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function fp(e){z("readable nexttick read 0"),e.read(0)}G.prototype.resume=function(){var e=this._readableState;return e.flowing||(z("resume"),e.flowing=!e.readableListening,dp(this,e)),e.paused=!1,this};function dp(e,t){t.resumeScheduled||(t.resumeScheduled=!0,$.process.nextTick(hp,e,t))}function hp(e,t){z("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),Hi(e),t.flowing&&!t.reading&&e.read(0)}G.prototype.pause=function(){return z("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(z("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Hi(e){var t=e._readableState;for(z("flow",t.flowing);t.flowing&&e.read()!==null;);}G.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;e.on("end",function(){if(z("wrapped end"),r.decoder&&!r.ended){var a=r.decoder.end();a&&a.length&&t.push(a)}t.push(null)}),e.on("data",function(a){if(z("wrapped data"),r.decoder&&(a=r.decoder.write(a)),!(r.objectMode&&a==null)&&!(!r.objectMode&&(!a||!a.length))){var s=t.push(a);s||(n=!0,e.pause())}});for(var i in e)this[i]===void 0&&typeof e[i]=="function"&&(this[i]=function(s){return function(){return e[s].apply(e,arguments)}}(i));for(var o=0;o<Fn.length;o++)e.on(Fn[o],this.emit.bind(this,Fn[o]));return this._read=function(a){z("wrapped _read",a),n&&(n=!1,e.resume())},this};typeof Symbol=="function"&&(G.prototype[Symbol.asyncIterator]=function(){return Dn===void 0&&(Dn=Vh),Dn(this)});Object.defineProperty(G.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(G.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(G.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}});G._fromList=ol;Object.defineProperty(G.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function ol(e,t){if(t.length===0)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(t.decoder?r=t.buffer.join(""):t.buffer.length===1?r=t.buffer.first():r=t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r}function zn(e){var t=e._readableState;z("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,$.process.nextTick(pp,t,e))}function pp(e,t){if(z("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&e.length===0&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}typeof Symbol=="function"&&(G.from=function(e,t){return Ln===void 0&&(Ln=Kh),Ln(G,e,t)});function al(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}var sl=Be,gn=mt.codes,vp=gn.ERR_METHOD_NOT_IMPLEMENTED,gp=gn.ERR_MULTIPLE_CALLBACK,mp=gn.ERR_TRANSFORM_ALREADY_TRANSFORMING,yp=gn.ERR_TRANSFORM_WITH_LENGTH_0,mn=Dt;Fe.exports(Be,mn);function bp(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new gp);r.writechunk=null,r.writecb=null,t!=null&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Be(e){if(!(this instanceof Be))return new Be(e);mn.call(this,e),this._transformState={afterTransform:bp.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",wp)}function wp(){var e=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(t,r){ua(e,t,r)}):ua(this,null,null)}Be.prototype.push=function(e,t){return this._transformState.needTransform=!1,mn.prototype.push.call(this,e,t)};Be.prototype._transform=function(e,t,r){r(new vp("_transform()"))};Be.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};Be.prototype._read=function(e){var t=this._transformState;t.writechunk!==null&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0};Be.prototype._destroy=function(e,t){mn.prototype._destroy.call(this,e,function(r){t(r)})};function ua(e,t,r){if(t)return e.emit("error",t);if(r!=null&&e.push(r),e._writableState.length)throw new yp;if(e._transformState.transforming)throw new mp;return e.push(null)}var Sp=nr,ll=sl;Fe.exports(nr,ll);function nr(e){if(!(this instanceof nr))return new nr(e);ll.call(this,e)}nr.prototype._transform=function(e,t,r){r(null,e)};var Un;function kp(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}var ul=mt.codes,_p=ul.ERR_MISSING_ARGS,Ep=ul.ERR_STREAM_DESTROYED;function ca(e){if(e)throw e}function Ap(e){return e.setHeader&&typeof e.abort=="function"}function Rp(e,t,r,n){n=kp(n);var i=!1;e.on("close",function(){i=!0}),Un===void 0&&(Un=zi),Un(e,{readable:t,writable:r},function(a){if(a)return n(a);i=!0,n()});var o=!1;return function(a){if(!i&&!o){if(o=!0,Ap(e))return e.abort();if(typeof e.destroy=="function")return e.destroy();n(a||new Ep("pipe"))}}}function fa(e){e()}function Op(e,t){return e.pipe(t)}function Pp(e){return!e.length||typeof e[e.length-1]!="function"?ca:e.pop()}function Tp(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=Pp(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new _p("streams");var i,o=t.map(function(a,s){var l=s<t.length-1,u=s>0;return Rp(a,l,u,function(c){i||(i=c),c&&o.forEach(fa),!l&&(o.forEach(fa),n(i))})});return t.reduce(Op)}var jp=Tp,Cp=Ae,Gi=hr.exports.EventEmitter,Np=Fe.exports;Np(Ae,Gi);Ae.Readable=Zs;Ae.Writable=Gs;Ae.Duplex=Dt;Ae.Transform=sl;Ae.PassThrough=Sp;Ae.finished=zi;Ae.pipeline=jp;Ae.Stream=Ae;function Ae(){Gi.call(this)}Ae.prototype.pipe=function(e,t){var r=this;function n(c){e.writable&&e.write(c)===!1&&r.pause&&r.pause()}r.on("data",n);function i(){r.readable&&r.resume&&r.resume()}e.on("drain",i),!e._isStdio&&(!t||t.end!==!1)&&(r.on("end",a),r.on("close",s));var o=!1;function a(){o||(o=!0,e.end())}function s(){o||(o=!0,typeof e.destroy=="function"&&e.destroy())}function l(c){if(u(),Gi.listenerCount(this,"error")===0)throw c}r.on("error",l),e.on("error",l);function u(){r.removeListener("data",n),e.removeListener("drain",i),r.removeListener("end",a),r.removeListener("close",s),r.removeListener("error",l),e.removeListener("error",l),r.removeListener("end",u),r.removeListener("close",u),e.removeListener("close",u)}return r.on("end",u),r.on("close",u),e.on("close",u),e.emit("pipe",r),e};var Ur=ar.exports,Mp=Cp.Stream,$p=Ce,xp=/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/;function Wn(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ze(e,t,r,n,i){throw new Ur.AssertionError({message:$p.format("%s (%s) is required",e,t),actual:i===void 0?typeof n:i(n),expected:t,operator:r||"===",stackStartFunction:ze.caller})}function Hn(e){return Object.prototype.toString.call(e).slice(8,-1)}function St(){}var Bt={bool:{check:function(e){return typeof e=="boolean"}},func:{check:function(e){return typeof e=="function"}},string:{check:function(e){return typeof e=="string"}},object:{check:function(e){return typeof e=="object"&&e!==null}},number:{check:function(e){return typeof e=="number"&&!isNaN(e)}},finite:{check:function(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}},buffer:{check:function(e){return $.Buffer.isBuffer(e)},operator:"Buffer.isBuffer"},array:{check:function(e){return Array.isArray(e)},operator:"Array.isArray"},stream:{check:function(e){return e instanceof Mp},operator:"instanceof",actual:Hn},date:{check:function(e){return e instanceof Date},operator:"instanceof",actual:Hn},regexp:{check:function(e){return e instanceof RegExp},operator:"instanceof",actual:Hn},uuid:{check:function(e){return typeof e=="string"&&xp.test(e)},operator:"isUUID"}};function cl(e){var t=Object.keys(Bt),r;return{}.NODE_NDEBUG?r=St:r=function(n,i){n||ze(i,"true",n)},t.forEach(function(n){if(e){r[n]=St;return}var i=Bt[n];r[n]=function(o,a){i.check(o)||ze(a,n,i.operator,o,i.actual)}}),t.forEach(function(n){var i="optional"+Wn(n);if(e){r[i]=St;return}var o=Bt[n];r[i]=function(a,s){a!=null&&(o.check(a)||ze(s,n,o.operator,a,o.actual))}}),t.forEach(function(n){var i="arrayOf"+Wn(n);if(e){r[i]=St;return}var o=Bt[n],a="["+n+"]";r[i]=function(s,l){Array.isArray(s)||ze(l,a,o.operator,s,o.actual);var u;for(u=0;u<s.length;u++)o.check(s[u])||ze(l,a,o.operator,s,o.actual)}}),t.forEach(function(n){var i="optionalArrayOf"+Wn(n);if(e){r[i]=St;return}var o=Bt[n],a="["+n+"]";r[i]=function(s,l){if(s!=null){Array.isArray(s)||ze(l,a,o.operator,s,o.actual);var u;for(u=0;u<s.length;u++)o.check(s[u])||ze(l,a,o.operator,s,o.actual)}}}),Object.keys(Ur).forEach(function(n){if(n==="AssertionError"){r[n]=Ur[n];return}if(e){r[n]=St;return}r[n]=Ur[n]}),r._setExports=cl,r}var qp=cl({}.NODE_NDEBUG),yn={},Wt=ar.exports,Ip=Ce;yn.sprintf=Vi;yn.printf=Dp;yn.fprintf=fl;function Vi(e){var t=["([^%]*)","%","(['\\-+ #0]*?)","([1-9]\\d*)?","(\\.([1-9]\\d*))?","[lhjztL]*?","([diouxXfFeEgGaAcCsSp%jr])"].join(""),r=new RegExp(t),n=Array.prototype.slice.call(arguments,1),i=e,o,a,s,l,u,c,f,p,v,h="",w=1,S=0,T,M;for(Wt.equal("string",typeof i,"first argument must be a format string");(v=r.exec(i))!==null;){if(h+=v[1],i=i.substring(v[0].length),M=v[0].substring(v[1].length),T=S+v[1].length+1,S+=v[0].length,o=v[2]||"",a=v[3]||0,s=v[4]||"",l=v[6],u=!1,f=!1,c=" ",l=="%"){h+="%";continue}if(n.length===0)throw zt(e,T,M,"has no matching argument (too few arguments passed)");if(p=n.shift(),w++,o.match(/[\' #]/))throw zt(e,T,M,"uses unsupported flags");if(s.length>0)throw zt(e,T,M,"uses non-zero precision (not supported)");switch(o.match(/-/)&&(u=!0),o.match(/0/)&&(c="0"),o.match(/\+/)&&(f=!0),l){case"s":if(p==null)throw zt(e,T,M,"attempted to print undefined or null as a string (argument "+w+" to sprintf)");h+=Gn(c,a,u,p.toString());break;case"d":p=Math.floor(p);case"f":f=f&&p>0?"+":"",h+=f+Gn(c,a,u,p.toString());break;case"x":h+=Gn(c,a,u,p.toString(16));break;case"j":a===0&&(a=10),h+=Ip.inspect(p,!1,a);break;case"r":h+=dl(p);break;default:throw zt(e,T,M,"is not supported")}}return h+=i,h}function zt(e,t,r,n){return Wt.equal(typeof e,"string"),Wt.equal(typeof r,"string"),Wt.equal(typeof t,"number"),Wt.equal(typeof n,"string"),new Error('format string "'+e+'": conversion specifier "'+r+'" at character '+t+" "+n)}function Dp(){var e=Array.prototype.slice.call(arguments);e.unshift($.process.stdout),fl.apply(null,e)}function fl(e){var t=Array.prototype.slice.call(arguments,1);return e.write(Vi.apply(this,t))}function Gn(e,t,r,n){for(var i=n;i.length<t;)r?i+=e:i=e+i;return i}function dl(e){var t;if(!(e instanceof Error))throw new Error(Vi("invalid type for %%r: %j",e));if(t="EXCEPTION: "+e.constructor.name+": "+e.stack,e.cause&&typeof e.cause=="function"){var r=e.cause();r&&(t+=`
Caused by: `+dl(r))}return t}var me={};function Lp(e){return Array.isArray?Array.isArray(e):bn(e)==="[object Array]"}me.isArray=Lp;function Fp(e){return typeof e=="boolean"}me.isBoolean=Fp;function Bp(e){return e===null}me.isNull=Bp;function zp(e){return e==null}me.isNullOrUndefined=zp;function Up(e){return typeof e=="number"}me.isNumber=Up;function Wp(e){return typeof e=="string"}me.isString=Wp;function Hp(e){return typeof e=="symbol"}me.isSymbol=Hp;function Gp(e){return e===void 0}me.isUndefined=Gp;function Vp(e){return bn(e)==="[object RegExp]"}me.isRegExp=Vp;function Kp(e){return typeof e=="object"&&e!==null}me.isObject=Kp;function Qp(e){return bn(e)==="[object Date]"}me.isDate=Qp;function Yp(e){return bn(e)==="[object Error]"||e instanceof Error}me.isError=Yp;function Jp(e){return typeof e=="function"}me.isFunction=Jp;function Xp(e){return e===null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||typeof e=="symbol"||typeof e=="undefined"}me.isPrimitive=Xp;me.isBuffer=$.Buffer.isBuffer;function bn(e){return Object.prototype.toString.call(e)}var ue=qp,wn=Ce,Zp=yn,je=me.isError,ev=Zp.sprintf,ie=H;H.VError=H;H.SError=Yt;H.WError=Ke;H.MultiError=Lt;function Ki(e){var t,r,n,i,o;if(ue.object(e,"args"),ue.bool(e.strict,"args.strict"),ue.array(e.argv,"args.argv"),t=e.argv,t.length===0)r={},n=[];else if(je(t[0]))r={cause:t[0]},n=t.slice(1);else if(typeof t[0]=="object"){r={};for(o in t[0])r[o]=t[0][o];n=t.slice(1)}else ue.string(t[0],"first argument to VError, SError, or WError constructor must be a string, object, or Error"),r={},n=t;return ue.object(r),!r.strict&&!e.strict&&(n=n.map(function(a){return a===null?"null":a===void 0?"undefined":a})),n.length===0?i="":i=ev.apply(null,n),{options:r,shortmessage:i}}function H(){var e,t,r,n,i,o,a;if(e=Array.prototype.slice.call(arguments,0),!(this instanceof H))return t=Object.create(H.prototype),H.apply(t,arguments),t;if(r=Ki({argv:e,strict:!1}),r.options.name&&(ue.string(r.options.name,`error's "name" must be a string`),this.name=r.options.name),this.jse_shortmsg=r.shortmessage,o=r.shortmessage,n=r.options.cause,n&&(ue.ok(je(n),"cause is not an Error"),this.jse_cause=n,r.options.skipCauseMessage||(o+=": "+n.message)),this.jse_info={},r.options.info)for(a in r.options.info)this.jse_info[a]=r.options.info[a];return this.message=o,Error.call(this,o),Error.captureStackTrace&&(i=r.options.constructorOpt||this.constructor,Error.captureStackTrace(this,i)),this}wn.inherits(H,Error);H.prototype.name="VError";H.prototype.toString=function(){var t=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(t+=": "+this.message),t};H.prototype.cause=function(){var t=H.cause(this);return t===null?void 0:t};H.cause=function(e){return ue.ok(je(e),"err must be an Error"),je(e.jse_cause)?e.jse_cause:null};H.info=function(e){var t,r,n;if(ue.ok(je(e),"err must be an Error"),r=H.cause(e),r!==null?t=H.info(r):t={},typeof e.jse_info=="object"&&e.jse_info!==null)for(n in e.jse_info)t[n]=e.jse_info[n];return t};H.findCauseByName=function(e,t){var r;for(ue.ok(je(e),"err must be an Error"),ue.string(t,"name"),ue.ok(t.length>0,"name cannot be empty"),r=e;r!==null;r=H.cause(r))if(ue.ok(je(r)),r.name==t)return r;return null};H.hasCauseWithName=function(e,t){return H.findCauseByName(e,t)!==null};H.fullStack=function(e){ue.ok(je(e),"err must be an Error");var t=H.cause(e);return t?e.stack+`
caused by: `+H.fullStack(t):e.stack};H.errorFromList=function(e){return ue.arrayOfObject(e,"errors"),e.length===0?null:(e.forEach(function(t){ue.ok(je(t))}),e.length==1?e[0]:new Lt(e))};H.errorForEach=function(e,t){ue.ok(je(e),"err must be an Error"),ue.func(t,"func"),e instanceof Lt?e.errors().forEach(function(n){t(n)}):t(e)};function Yt(){var e,t,r,n;return e=Array.prototype.slice.call(arguments,0),this instanceof Yt?(r=Ki({argv:e,strict:!0}),n=r.options,H.call(this,n,"%s",r.shortmessage),this):(t=Object.create(Yt.prototype),Yt.apply(t,arguments),t)}wn.inherits(Yt,H);function Lt(e){ue.array(e,"list of errors"),ue.ok(e.length>0,"must be at least one error"),this.ase_errors=e,H.call(this,{cause:e[0]},"first of %d error%s",e.length,e.length==1?"":"s")}wn.inherits(Lt,H);Lt.prototype.name="MultiError";Lt.prototype.errors=function(){return this.ase_errors.slice(0)};function Ke(){var e,t,r,n;return e=Array.prototype.slice.call(arguments,0),this instanceof Ke?(r=Ki({argv:e,strict:!1}),n=r.options,n.skipCauseMessage=!0,H.call(this,n,"%s",r.shortmessage),this):(t=Object.create(Ke.prototype),Ke.apply(t,e),t)}wn.inherits(Ke,H);Ke.prototype.name="WError";Ke.prototype.toString=function(){var t=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(t+=": "+this.message),this.jse_cause&&this.jse_cause.message&&(t+="; caused by "+this.jse_cause.toString()),t};Ke.prototype.cause=function(t){return je(t)&&(this.jse_cause=t),this.jse_cause};class k{constructor(t,r){this.x=t,this.y=r}clone(){return new k(this.x,this.y)}}const hl=e=>{switch(e){case"a":return 1;case"b":return 2;case"c":return 3;case"d":return 4;case"e":return 5;case"f":return 6;case"g":return 7;case"h":return 8;default:throw new ie(`Cannot map file "${e}" to number`)}},ct=e=>{switch(e){case 1:return"a";case 2:return"b";case 3:return"c";case 4:return"d";case 5:return"e";case 6:return"f";case 7:return"g";case 8:return"h";default:throw new ie(`Cannot map "${e}" to file`)}},tv=e=>["B","K","N","Q","R"].includes(e),rv=e=>["b","k","n","q","r"].includes(e),nv=e=>["a","b","c","d","e","f","g","h"].includes(e),iv=e=>typeof e=="number"&&e>0&&e<=8,Q=(e,t)=>e&&t&&e.file===t.file&&e.rank===t.rank,ov=e=>{let t="";return t+=ct(e.file),t+=e.rank,t},X=e=>e===$e.Black||e==$e.DarkGrey?"black":"white",ir=e=>({file:e%8+1,rank:8-Math.floor(e/8)}),da=e=>(9-e.rank-1)*8+(e.file-1),Le=(e,t)=>e.rank===(t==="white"?8:1),av={White:"white",Black:"black",Draw:"draw",Forfeit:"forfeit",ForfeitWhite:"forfeit-white",ForfeitBlack:"forfeit-black"};class ha{constructor(){this.files=[],this.ranks=[],this.pieces=[],this.tokens=[]}isEmpty(){return!this.moveType&&this.files.length===0&&this.ranks.length===0&&this.pieces.length===0&&!this.castleSide&&typeof this.isDrawOffer=="undefined"&&typeof this.isGameOver=="undefined"}toNode(){if(this.isDrawOffer)return{sources:this.tokens,kind:"draw-offer"};if(this.isGameOver)return{sources:this.tokens,kind:"game-over",outcome:this.outcome};const t={from:{},to:{}};if(this.pieces[0]&&this.moveType!=="promotion"&&(t.piece=this.pieces[0]),t.kind="move",this.files.length===2)t.from.file=this.files[0],t.to.file=this.files[1];else if(this.files.length===1)t.to.file=this.files[0];else if(this.files.length!==0)throw new ie(`Parsed ${this.files.length} columns for a single move`);if(this.ranks.length===2)t.from.rank=this.ranks[0],t.to.rank=this.ranks[1];else if(this.ranks.length===1)t.to.rank=this.ranks[0];else if(this.ranks.length!==0)throw new ie(`Parsed ${this.ranks.length} ranks for a single move`);return this.moveType==="allegiance"?{...t,type:"allegiance",sources:this.tokens}:this.moveType==="capture"?{...t,type:"capture",sources:this.tokens}:this.moveType==="castle"?{...t,type:"castle",side:this.castleSide,sources:this.tokens}:this.moveType==="en-passant"?{...t,type:"en-passant",sources:this.tokens}:this.moveType==="promotion"?{...t,piece:null,type:"promotion",promotionTo:this.pieces[0],sources:this.tokens}:{...t,sources:this.tokens}}}const gi=e=>{var f,p,v;let t=0;const r=["castle","draw-offer","piece","step-number","game-over","file","move-separator"],n=["step-number","move-separator"],i=new Set(r),o=(...h)=>{i.clear(),h.forEach(w=>i.add(w)),i.add("comment"),i.add("annotation-symbol")};for(;t<e.length;){const h=e[t];if(!i.has(h.kind))throw new ie(`Parse error on line ${(f=h.source)==null?void 0:f.row} column ${(p=h.source)==null?void 0:p.column}: Token kind "${h.kind}" was not expected after "${(v=e[t-1])==null?void 0:v.kind}"`);switch(h.kind){case"move-separator":o(...r,"step-number","capture");break;case"step-number":o(...r,"move-separator");break;case"promotion":o("piece");break;case"allegiance":case"capture":o("file");break;case"castle":case"double-check":case"check":case"en-passant":o(...r,"check");break;case"checkmate":o("game-over","move-separator");break;case"file":o("rank","capture","allegiance","file");break;case"draw-offer":o(...r,"game-over");break;case"game-over":o("move-separator");break;case"rank":o(...r,"allegiance","capture","check","checkmate","double-check","en-passant","promotion");break;case"piece":o("capture","allegiance","check","checkmate","game-over","file","double-check","en-passant","promotion","move-separator","rank");break}t++}t=0;const a={kind:"root",children:[]};let s=new ha;const l=()=>{s.isEmpty()||(a.children.push(s.toNode()),s=new ha)},u=()=>e[t+1],c=()=>{var h;return(h=u())==null?void 0:h.kind};for(;t<e.length;){const h=e[t];switch(n.includes(h.kind)||s.tokens.push(h),h.kind){case"move-separator":{c()!=="en-passant"&&l();break}case"piece":s.pieces.push(h.value);break;case"allegiance":s.moveType="allegiance";break;case"capture":s.moveType="capture";break;case"castle":s.moveType="castle",s.castleSide=h.side,c()!=="move-separator"&&l();break;case"check":case"double-check":s.causesCheck=!0,s.isMate=!1,c()!=="move-separator"&&l();break;case"checkmate":s.causesCheck=!0,s.isMate=!0,c()!=="move-separator"&&l();break;case"file":s.files.push(h.value);break;case"rank":s.ranks.push(h.value),c()||l();break;case"draw-offer":s.isDrawOffer=!0,c()!=="move-separator"&&l();break;case"en-passant":s.moveType="en-passant",c()!=="move-separator"&&l();break;case"promotion":s.moveType="promotion";break;case"game-over":s.isGameOver=!0,s.outcome=h.outcome,c()!=="move-separator"&&l();break}t++}return s.moveType&&l(),a},nt={Blunder:"??",Mistake:"?",Dubious:"?!",Interesting:"!?",Good:"!",Brilliant:"!!"},mi=e=>{const t=e.replace(/[–]/gu,"-");let r=1,n=1,i=0;const o=[];for(;i<t.length;){const a=t[i],s=c=>t.substring(i,i+c.length)===c,l=c=>{let f="",p=i;for(;;){const v=t[p];if(p>=t.length||c(v)){p--;break}f+=v,p++}return f},u=(c,f)=>{o.push({...f,source:{column:n,row:r,length:c}}),i+=c,n+=c};if(a===`
`){r++,n=1,u(1,{kind:"move-separator"});continue}if(a==="\r"){n=1,i++;continue}if(a==="{"){const c=l(f=>f==="}");u(c.length+1,{kind:"comment",value:c.substring(1).trim()});continue}if(s("??")){u(2,{kind:"annotation-symbol",value:nt.Blunder});continue}if(s("?!")){u(2,{kind:"annotation-symbol",value:nt.Dubious});continue}if(s("!?")){u(2,{kind:"annotation-symbol",value:nt.Interesting});continue}if(s("!!")){u(2,{kind:"annotation-symbol",value:nt.Brilliant});continue}if(s("!")){u(1,{kind:"annotation-symbol",value:nt.Good});continue}if(s("?")){u(1,{kind:"annotation-symbol",value:nt.Mistake});continue}if(s("e.p.")||s(" e.p.")){u(a===" "?5:4,{kind:"en-passant"});continue}if(a===" "||a===";"){u(1,{kind:"move-separator"});continue}if(s("O-O-O")||s("0-0-0")){u(5,{kind:"castle",side:"queen"});continue}if(s("O-O")||s("0-0")){u(3,{kind:"castle",side:"king"});continue}if(a==="+"||a==="\u2020"){u(1,{kind:"check"});continue}if(s("ch")){u(2,{kind:"check"});continue}if(/[#‡≠X]/gu.test(a)){u(1,{kind:"checkmate"});continue}if(s("mate")){u(4,{kind:"checkmate"});continue}if(s("dbl ch")){u(6,{kind:"double-check"});continue}if(s("++")){u(2,{kind:"double-check"});continue}if(s("0-1")){u(3,{kind:"game-over",outcome:"black"});continue}if(s("1-0")){u(3,{kind:"game-over",outcome:"white"});continue}if(s("\xBD-\xBD")){u(3,{kind:"game-over",outcome:"draw"});continue}if(s("1/2-1/2")){u(7,{kind:"game-over",outcome:"draw"});continue}if(s("0-0")){u(3,{kind:"game-over",outcome:"forfeit"});continue}if(s("\xBD-0")){u(3,{kind:"game-over",outcome:"forfeit-white"});continue}if(s("1/2-0")){u(5,{kind:"game-over",outcome:"forfeit-white"});continue}if(s("0-\xBD")){u(3,{kind:"game-over",outcome:"forfeit-black"});continue}if(s("0-1/2")){u(5,{kind:"game-over",outcome:"forfeit-black"});continue}if(/[\d]/gu.test(a)){const c=l(p=>!/[.\d]/gu.test(p));if(c[c.length-1]==="."){u(c.length,{kind:"step-number",value:Number.parseInt(c.replace(/[.]/gu,""),10)});continue}}if(/[1-8]/gu.test(a)){u(1,{kind:"rank",value:Number.parseInt(a,10)});continue}if(/[a-h]/gu.test(a)){u(1,{kind:"file",value:hl(a)});continue}if(/[KQRBN]/gu.test(a)){u(1,{kind:"piece",value:a});continue}if(/[x:]/gu.test(a)){u(1,{kind:"capture"});continue}if(s("(=)")){u(3,{kind:"draw-offer"});continue}if(a==="="||a==="/"){u(1,{kind:"promotion"});continue}if(a==="("||a===")"){u(1,{kind:"promotion",bracket:a==="("?"open":"close"});continue}if(a===">"){u(1,{kind:"allegiance"});continue}throw new ie(`Unsupported character at line ${r} column ${n}: "${a}"`)}return o},en=e=>{switch(e.kind){case"draw-offer":return"(=)";case"game-over":{switch(e.outcome){case"black":return"0-1";case"white":return"1-0";case"draw":return"1/2-1/2";case"forfeit":return"0-0";case"forfeit-black":return"0-1/2";case"forfeit-white":return"1/2-0"}break}case"move":{const t=(r,n)=>{let i="";return e.piece&&(i+=e.piece),e.from.file&&(i+=`${ct(e.from.file)}`),e.from.rank&&(i+=`${e.from.rank}`),e.type==="promotion"&&e.to.file&&(i+=`${ct(e.to.file)}`),e.type==="promotion"&&e.to.rank&&(i+=`${e.to.rank}`),i+=r,e.type==="promotion"&&e.promotionTo&&(i+=`${e.promotionTo}`),e.type!=="promotion"&&e.to.file&&(i+=`${ct(e.to.file)}`),e.type!=="promotion"&&e.to.rank&&(i+=`${e.to.rank}`),n&&(i+=n),i};switch(e.type){case"allegiance":return t(">");case"capture":return t("x");case"castle":return e.side==="king"?"O-O":"O-O-O";case"en-passant":return t("x"," e.p.");case"promotion":return t("=");default:return t("")}}}},pl=e=>{const t=[];return e.children.forEach((r,n)=>{const i=n%2===0;(a=>{i?t.push(a):t[t.length-1]+=` ${a}`})(en(r))}),t.filter(Boolean).map((r,n)=>`${n+1}. ${r}`).join(`
`).trim()};var pa=Object.freeze(Object.defineProperty({__proto__:null,GameOutcome:av,parse:gi,AnnotationSymbol:nt,tokenize:mi,writeNode:en,write:pl},Symbol.toStringTag,{value:"Module"})),vl=(e=>(e[e.Ranks=0]="Ranks",e[e.ActiveColour=1]="ActiveColour",e[e.CastlingRights=2]="CastlingRights",e[e.EnPassantTargets=3]="EnPassantTargets",e[e.HalfmoveClock=4]="HalfmoveClock",e[e.FullmoveNumber=5]="FullmoveNumber",e))(vl||{});class va{constructor(){this.allegianceMark=!1,this.castlingRights=[]}canSetPieceSide(){return!this.pieceSide}setPieceSide(t){if(!this.canSetPieceSide())throw new ie("Cannot set piece side on WipNode, because it's already set");this.pieceSide=t}canSetPiece(){return!this.piece&&this.piece!==null}setPiece(t){if(!this.canSetPiece())throw new ie("Cannot set piece on WipNode, because there is already one set");this.piece=t}canSetAllegianceMark(){return!this.allegianceMark}addAllegianceMark(){if(!this.canSetAllegianceMark())throw new ie("Allegiance mark already set");this.allegianceMark=!0}pieceDataReady(){return!this.canSetPiece()&&!this.canSetPieceSide()}setActiveColour(t){this.activeColour=t}hasCastlingRights(){return this.castlingRights.length!==0}addCastlingRight(t){this.castlingRights.push(t)}canSetEnPassantFile(){return!this.enPassantFile}setEnPassantFile(t){if(!this.canSetEnPassantFile())throw new ie("Cannot set en passant file on WipNode, because there is already one set");this.enPassantFile=t}canSetEnPassantRank(){return!this.enPassantRank}setEnPassantRank(t){if(!this.canSetEnPassantRank())throw new ie("Cannot set en passant rank on WipNode, because there is already one set");this.enPassantRank=t}canSetHalfmoveClock(){return typeof this.halfmoveClock!="number"}setHalfmoveClock(t){this.halfmoveClock=t}canSetFullmoveNumber(){return typeof this.fullmoveNumber!="number"}setFullmoveNumber(t){this.fullmoveNumber=t}isEnPassantType(){return!!(this.enPassantFile&&this.enPassantRank)}toNode(){if(this.piece||this.piece===null)return this.pieceSide==="white"?{kind:"piece",value:{allegiance:this.allegianceMark?$e.LightGrey:$e.White,piece:this.piece?this.piece.toUpperCase():null}}:{kind:"piece",value:{allegiance:this.allegianceMark?$e.DarkGrey:$e.Black,piece:this.piece?this.piece.toUpperCase():null}};if(this.activeColour)return{kind:"active-colour",value:this.activeColour};if(this.castlingRights.length>0){const t=[],r=[];return this.castlingRights.includes("K")&&r.push("king"),this.castlingRights.includes("Q")&&r.push("queen"),this.castlingRights.includes("k")&&t.push("king"),this.castlingRights.includes("q")&&t.push("queen"),{kind:"castling-rights",value:{black:t,white:r}}}if(this.enPassantFile&&this.enPassantRank)return{kind:"en-passant-targets",value:{file:this.enPassantFile,rank:this.enPassantRank}};if(typeof this.halfmoveClock=="number")return{kind:"halfmove-clock",value:this.halfmoveClock};if(typeof this.fullmoveNumber=="number")return{kind:"fullmove-number",value:this.fullmoveNumber};throw new ie(`Cannot create Node from WipNode, ${JSON.stringify({...this},null,2)}`)}}const sv=e=>{const t={kind:"ast",children:[]};let r=0,n=0,i=new va;const o=l=>{t.children.push(l),r++},a=()=>{t.children.push(i.toNode()),i=new va},s=l=>{n=l,r++};for(;r<e.length;){const l=e[r],u=e[r+1];if(n===0){if((l.kind==="char"||l.kind==="number"||l.kind==="separator"||l.kind==="space")&&i.pieceDataReady()&&a(),l.kind==="char"&&rv(l.value)){i.setPieceSide("black"),i.setPiece(l.value),u||a(),r++;continue}if(l.kind==="char"&&tv(l.value)){i.setPieceSide("white"),i.setPiece(l.value),u||a(),r++;continue}if(l.kind==="char"&&l.value==="p"){i.setPieceSide("black"),i.setPiece(null),u||a(),r++;continue}if(l.kind==="char"&&l.value==="P"){i.setPieceSide("white"),i.setPiece(null),u||a(),r++;continue}if(l.kind==="allegiance"){i.addAllegianceMark(),r++,u||a();continue}if(l.kind==="number"&&l.value>0&&l.value<=8){o({kind:"skip",value:l.value});continue}}switch(n){case 0:{if(l.kind==="separator"){r++;continue}if(l.kind==="space"){n=1,r++;continue}break}case 1:{if(l.kind==="char"&&l.value==="w"){i.setActiveColour("white"),r++;continue}if(l.kind==="char"&&l.value==="b"){i.setActiveColour("black"),r++;continue}if(l.kind==="space"){a(),s(2);continue}break}case 2:{if(l.kind==="char"&&(l.value==="q"||l.value==="Q"||l.value==="k"||l.value==="K")){i.addCastlingRight(l.value),r++;continue}if(l.kind==="hyphen"){r++;continue}if(l.kind==="space"){i.hasCastlingRights()&&a(),s(3);continue}break}case 3:{if(l.kind==="hyphen"){r++;continue}if(l.kind==="char"&&nv(l.value)){i.setEnPassantFile(hl(l.value)),r++;continue}if(l.kind==="number"&&iv(l.value)){i.setEnPassantRank(l.value),r++;continue}if(l.kind==="space"){i.isEnPassantType()&&a(),s(4);continue}break}case 4:{if(l.kind==="number"){i.setHalfmoveClock(l.value),r++;continue}if(l.kind==="space"){a(),s(5);continue}break}case 5:{l.kind==="number"&&(i.setFullmoveNumber(l.value),r++,a());continue}}throw new ie(`Unhandled token: ${l.kind}, cursor ${r}, state: ${vl[n]}`)}return t},lv=e=>{let t=0;const r=[],n=(o,a)=>{r.push(a),t+=o},i=o=>{let a="",s=t;for(;;){const l=e[s];if(s>=e.length||o(l)){s--;break}a+=l,s++}return a};for(;t<e.length;){const o=e[t];if(o===">"){n(1,{kind:"allegiance"});continue}if(o==="/"){n(1,{kind:"separator"});continue}if(/\d/gu.test(o)){const a=i(s=>!/[\d]/gu.test(s));n(a.length,{kind:"number",value:Number.parseInt(a,10)});continue}if(o===" "){n(1,{kind:"space"});continue}if(o==="-"||o==="\u2013"){n(1,{kind:"hyphen"});continue}n(1,{kind:"char",value:o})}return r},Qi={sections:["positions","active-colour","castlig-rights","en-passant-targets","halfmove-clock","fullmove-number"]},uv=(e,t=Qi)=>{let r="",n=0;e.children.forEach(w=>{var S;switch(w.kind){case"piece":{n>=8&&(r+="/",n=0);const T=X(w.value.allegiance),M=(S=w.value.piece)!=null?S:"p";r+=T==="white"?M.toUpperCase():M.toLowerCase(),(w.value.allegiance===$e.DarkGrey||w.value.allegiance===$e.LightGrey)&&(r+=">"),n++;break}case"skip":{n>=8&&(r+="/",n=0),r+=w.value,n+=w.value;break}}});const i=e.children.find(w=>w.kind==="active-colour");let o="";i?o=i.value==="white"?"w":"b":o="w";const a=e.children.find(w=>w.kind==="castling-rights");let s="";a?(a.value.white.includes("king")&&(s+="K"),a.value.white.includes("queen")&&(s+="Q"),a.value.black.includes("king")&&(s+="k"),a.value.black.includes("queen")&&(s+="q")):s="-";const l=e.children.find(w=>w.kind==="en-passant-targets");let u="";l?u=ov(l.value):u="-";const c=e.children.find(w=>w.kind==="halfmove-clock");let f="0";c&&(f=String(c.value));const p=e.children.find(w=>w.kind==="fullmove-number");let v="0";return p&&(v=String(p.value)),[t.sections.includes("positions")&&r,t.sections.includes("active-colour")&&o,t.sections.includes("castlig-rights")&&s,t.sections.includes("en-passant-targets")&&u,t.sections.includes("halfmove-clock")&&f,t.sections.includes("fullmove-number")&&v].filter(Boolean).join(" ")};class Yi{clone(){const t=new Yi;return t.memory=[...this.memory],t.activeColour=this.activeColour,t.enPassantTarget=this.enPassantTarget?{...this.enPassantTarget}:null,t._castlingRights=[...this._castlingRights],t.halfmoveClock=this.halfmoveClock,t.fullmoveNumber=this.fullmoveNumber,t.moveHistory={kind:"root",children:[...this.moveHistory.children]},t}removeCastlingRights(t,r){const n=this._castlingRights.findIndex(i=>i.colour===t&&i.side===r);n!==-1&&this._castlingRights.splice(n,1)}castlingRights(t){return this._castlingRights.filter(r=>r.colour===t).map(r=>r.side)}clear(){this.activeColour="white",this.enPassantTarget=null,this._castlingRights=[],this.halfmoveClock=0,this.fullmoveNumber=0,this.moveHistory={kind:"root",children:[]},this.memory=Array.from({length:64}).fill(null)}constructor(){this.clear()}dump(){const t=this.getSquares(),r=Array.from({length:8}).map(()=>Array.from({length:8}).map(()=>"."));let n="";t.filter(Boolean).forEach(i=>{var o,a,s,l;r[i.rank-1][i.file-1]=X(i.allegiance)==="white"?(a=(o=i.piece)==null?void 0:o.toUpperCase())!=null?a:"P":(l=(s=i.piece)==null?void 0:s.toLowerCase())!=null?l:"p"});for(let i=7;i>=0;i--)n+=`${i+1} `,n+=r[i].map(o=>o).join(" "),n+=`
`;return n+=`  ${r[0].map((i,o)=>ct(o+1)).join(" ")}`,n+=`
${this.activeColour} ${this.enPassantTarget&&`${ct(this.enPassantTarget.file)}${this.enPassantTarget.rank}`} ${this.halfmoveClock} ${this.fullmoveNumber}`,n}getSquares(){return this.memory.map((t,r)=>t?{...t,...ir(r)}:null)}getSquare(t){if(!t)throw new ie.VError("Attempted to get square with no coordinates");return this.memory[da(t)]}setSquare(t,r){this.memory[da(t)]=r}toAFEN(t=Qi){const r={kind:"ast",children:[]};let n=0;if(t.sections.includes("positions")){for(let i=0;i<this.memory.length;i++)this.memory[i]?(n&&(r.children.push({kind:"skip",value:n}),n=0),r.children.push({kind:"piece",value:this.memory[i]})):n++,(i+1)%8===0&&n&&(r.children.push({kind:"skip",value:n}),n=0);n&&r.children.push({kind:"skip",value:n})}if(t.sections.includes("active-colour")&&r.children.push({kind:"active-colour",value:this.activeColour}),t.sections.includes("castlig-rights")){const i={kind:"castling-rights",value:{black:[],white:[]}},o=this.castlingRights("white"),a=this.castlingRights("black");o.includes("king")&&i.value.white.push("king"),o.includes("queen")&&i.value.white.push("queen"),a.includes("king")&&i.value.black.push("king"),a.includes("queen")&&i.value.black.push("queen"),(i.value.white.length>0||i.value.black.length>0)&&r.children.push(i)}return t.sections.includes("en-passant-targets")&&this.enPassantTarget&&r.children.push({kind:"en-passant-targets",value:this.enPassantTarget}),t.sections.includes("halfmove-clock")&&r.children.push({kind:"halfmove-clock",value:this.halfmoveClock}),t.sections.includes("fullmove-number")&&r.children.push({kind:"fullmove-number",value:this.fullmoveNumber}),r}fromAFEN(t){var n;this.clear();let r=0;for(const i of t.children){if(i.kind==="skip"){r+=i.value;continue}if(i.kind==="piece"){this.memory[r]=i.value,r++;continue}if(i.kind==="en-passant-targets"){this.enPassantTarget=i.value;continue}if(i.kind==="castling-rights"){i.value.black.forEach(o=>{this._castlingRights.push({colour:"black",side:o})}),i.value.white.forEach(o=>{this._castlingRights.push({colour:"white",side:o})});continue}if(i.kind==="active-colour"){this.activeColour=i.value;continue}if(i.kind==="fullmove-number"){this.fullmoveNumber=i.value;continue}if(i.kind==="halfmove-clock"){this.halfmoveClock=i.value;continue}throw new ie.VError(`Unhandled node while importing AFEN: ${(n=i.kind)!=null?n:JSON.stringify(i,null,2)}`)}}}const ga={VanillaDefault:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 0",GreyDefault:"r>n>b>q>kb>n>r>/p>p>p>p>p>p>p>p>/8/8/8/8/P>P>P>P>P>P>P>P>/R>N>B>Q>KB>N>R> w KQkq - 0 0"},$e={Black:0,DarkGrey:1,LightGrey:2,White:3},cv=["B","N","Q","R"];class j{clear(){this.memory.clear()}clone(){const t=new j;return t.memory=this.memory.clone(),t}dump(){return this.memory.dump()}importAFEN(t){this.memory.fromAFEN(sv(lv(t)))}importMoveHistory(t){const r=gi(mi(t)),n=new j;n.importAFEN(ga.VanillaDefault),r.children.forEach(i=>{const o=n.getValidMoves(),a=j.findMoveIndex(o,i);if(a===-1)throw new ie(`Move ${en(i)} is not valid on this board`);const s=n.executeMoveIndexFromList(a,o);this.memory.moveHistory.children.push(s)})}executeMoveHistory(t){gi(mi(t)).children.forEach(n=>{const i=this.getValidMoves(),o=j.findMoveIndex(i,n);if(o===-1)throw console.log(this.dump()),new ie(`Move ${en(n)} is not valid on this board`);this.executeMoveIndexFromList(o,i)}),this.importMoveHistory(t)}toAFEN(t=Qi){return uv(this.memory.toAFEN(t))}getSquares(){return this.memory.getSquares()}get enPassantTarget(){return this.memory.enPassantTarget}get activeColour(){return this.memory.activeColour}get halfmoveClock(){return this.memory.halfmoveClock}get fullmoveNumber(){return this.memory.fullmoveNumber}get castlingRights(){return{black:this.memory.castlingRights("black"),white:this.memory.castlingRights("white")}}getMoveHistory(){return pl(this.memory.moveHistory)}getMoveHistoryAst(){return this.memory.moveHistory}constructor(){this.memory=new Yi}getPositionCount(){const t=this.memory.moveHistory.children,r=new Map,n=new j;n.importAFEN(ga.VanillaDefault);for(const i of t){n.executeNode(i);const o=n.toAFEN({sections:["positions"]}),a=r.get(o);a?r.set(o,a+1):r.set(o,1)}return r}executeAllegianceMoveNode(t){this.memory.setSquare(t.node.to,{allegiance:t.fromSide==="white"?t.to.allegiance+1:t.to.allegiance-1,piece:t.to.piece})}executeCaptureMoveNode(t){this.memory.setSquare(t.node.to,t.from),this.memory.setSquare(t.node.from,null)}executeCastleMoveNode(t){const r=t.node.from,n=t.node.to,i=t.from;if(t.to)throw new ie(`Castling cannot cause a capture on ${JSON.stringify(t.node.to)}`);this.memory.setSquare(n,i),this.memory.setSquare(r,null);const a=t.fromSide==="white"?1:8,s=t.node.side==="king"?{file:8,rank:a}:{file:1,rank:a},l=t.node.side==="king"?{file:6,rank:a}:{file:4,rank:a};this.memory.setSquare(l,this.memory.getSquare(s)),this.memory.setSquare(s,null)}executeEnPassantMoveNode(t){this.memory.setSquare({rank:t.fromSide==="white"?t.node.to.rank-1:t.node.to.rank+1,file:t.node.to.file},null),this.memory.setSquare(t.node.to,t.from),this.memory.setSquare(t.node.from,null)}executePromotionMoveNode(t){this.memory.setSquare(t.node.to,{allegiance:t.from.allegiance,piece:t.node.promotionTo}),this.memory.setSquare(t.node.from,null)}executeDefaultMoveNode(t){this.memory.setSquare(t.node.from,null),this.memory.setSquare(t.node.to,t.from),t.node.piece===null&&Math.abs(t.node.from.rank-t.node.to.rank)===2&&(this.memory.enPassantTarget={file:t.node.from.file,rank:t.fromSide==="white"?t.node.from.rank+1:t.node.from.rank-1})}executeMoveNode(t){if(!t.from.file)throw new ie(`Cannot execute node without "from.file": ${JSON.stringify(t,null,2)}`);const r=this.memory.getSquare(t.from),n=this.memory.getSquare(t.to);if(!r)throw console.log(this.dump()),new ie(`There is no piece on file ${t.from.file} rank ${t.from.rank}`);r.piece==="K"&&(this.memory.removeCastlingRights(this.activeColour,"king"),this.memory.removeCastlingRights(this.activeColour,"queen")),r.piece==="R"&&t.from.file===8&&this.memory.removeCastlingRights(this.activeColour,"king"),r.piece==="R"&&t.from.file===1&&this.memory.removeCastlingRights(this.activeColour,"queen"),this.memory.enPassantTarget=null;const i=X(r.allegiance),o=n?X(n.allegiance):null;switch(t.type){case"allegiance":this.executeAllegianceMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"capture":this.executeCaptureMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"castle":this.executeCastleMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"en-passant":this.executeEnPassantMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"promotion":this.executePromotionMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;default:this.executeDefaultMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break}switch(t.type){case"capture":case"en-passant":{this.memory.halfmoveClock=0;break}case null:case void 0:{t.piece?this.memory.halfmoveClock++:this.memory.halfmoveClock=0;break}default:{this.memory.halfmoveClock++;break}}this.memory.activeColour==="black"&&this.memory.fullmoveNumber++,this.memory.activeColour=this.memory.activeColour==="white"?"black":"white"}executeNode(t){switch(t.kind){case"move":{this.executeMoveNode(t);break}default:return}this.memory.moveHistory.children.push(t)}executeMoveIndex(t){const r=this.getValidMoves();return this.executeMoveIndexFromList(t,r)}executeMoveIndexFromList(t,r){if(t<0)throw new ie(`Move index must be positive, got ${t}`);const n=r[t];if(!n)throw new ie(`Move with index ${t} does not exist`);return this.executeNode(n),n}getSquare(t){return this.memory.getSquare(t)}static findMoveIndex(t,r){let n=t;return r.kind==="draw-offer"&&(n=n.filter(i=>i.kind==="draw-offer")),r.kind==="game-over"&&(n=n.filter(i=>i.kind==="game-over"&&i.outcome===r.outcome)),r.kind==="move"&&(r.to&&r.to.file&&(n=n.filter(i=>i.kind==="move"&&i.to.file===r.to.file)),r.to&&r.to.rank&&(n=n.filter(i=>i.kind==="move"&&i.to.rank===r.to.rank)),r.from&&r.from.file&&(n=n.filter(i=>i.kind==="move"&&i.from.file===r.from.file)),r.from&&r.from.rank&&(n=n.filter(i=>i.kind==="move"&&i.from.rank===r.from.rank)),r.type&&r.type!=="capture"?n=n.filter(i=>"type"in i&&i.type===r.type):r.type&&(n=n.filter(i=>"type"in i&&(i.type==="capture"||i.type==="en-passant"))),r.type==="castle"&&(n=n.filter(i=>"side"in i&&i.side===r.side)),r.piece||r.piece===null?n=n.filter(i=>i.kind==="move"&&i.piece===r.piece):r.type!=="castle"&&n.length>1&&!r.piece&&(n=n.filter(i=>i.kind==="move"&&i.piece===null)),r.type==="promotion"&&(n=n.filter(i=>"promotionTo"in i&&i.promotionTo===r.promotionTo&&Q(i.to,r.to)))),n.length===1?t.indexOf(n[0]):-1}static getCoordsRelative(t,r){const n={file:t.file+r.x,rank:t.rank+r.y};return n.file>8||n.file<=0||n.rank>8||n.rank<=0?null:n}traceCaptureSteps(t,r){const n=this.memory.getSquare(t);if(!n)return[];const i=[],o=new k(Math.sign(r.x),Math.sign(r.y));let a=t;for(;a=j.getCoordsRelative(a,o),!!a;){const s=this.memory.getSquare(a);if(!s){i.push({...a});continue}if(X(s.allegiance)===X(n.allegiance))break;if(X(s.allegiance)!==X(n.allegiance)){i.push({...a});break}i.push({...a})}return i}getAttackedCoordsBySide(t){const r=this.memory.getSquares().filter(i=>i&&X(i.allegiance)===t),n=[];return r.forEach(i=>{n.push(...this.getAttackedCoordsByCoords(i))}),n}getAttackedCoordsByCoords(t){const r=[],n=this.memory.getSquare(t);if(!n)return r;const i=X(n.allegiance);if(n.piece===null){const o=j.getCoordsRelative(t,new k(i==="white"?-1:1,i==="white"?1:-1)),a=j.getCoordsRelative(t,new k(i==="white"?1:-1,i==="white"?1:-1));return[o,a]}return n.piece==="R"?[...this.traceCaptureSteps(t,new k(1,0)),...this.traceCaptureSteps(t,new k(-1,0)),...this.traceCaptureSteps(t,new k(0,1)),...this.traceCaptureSteps(t,new k(0,-1))].filter(Boolean):n.piece==="N"?[j.getCoordsRelative(t,new k(1,2)),j.getCoordsRelative(t,new k(2,1)),j.getCoordsRelative(t,new k(2,-1)),j.getCoordsRelative(t,new k(1,-2)),j.getCoordsRelative(t,new k(-1,-2)),j.getCoordsRelative(t,new k(-2,-1)),j.getCoordsRelative(t,new k(-2,1)),j.getCoordsRelative(t,new k(-1,2))].filter(Boolean):n.piece==="B"?[...this.traceCaptureSteps(t,new k(1,1)),...this.traceCaptureSteps(t,new k(1,-1)),...this.traceCaptureSteps(t,new k(-1,-1)),...this.traceCaptureSteps(t,new k(-1,1))].filter(Boolean):n.piece==="Q"?[...this.traceCaptureSteps(t,new k(1,0)),...this.traceCaptureSteps(t,new k(-1,0)),...this.traceCaptureSteps(t,new k(0,1)),...this.traceCaptureSteps(t,new k(0,-1)),...this.traceCaptureSteps(t,new k(1,1)),...this.traceCaptureSteps(t,new k(1,-1)),...this.traceCaptureSteps(t,new k(-1,-1)),...this.traceCaptureSteps(t,new k(-1,1))].filter(Boolean):n.piece==="K"?[j.getCoordsRelative(t,new k(0,1)),j.getCoordsRelative(t,new k(1,1)),j.getCoordsRelative(t,new k(1,0)),j.getCoordsRelative(t,new k(1,-1)),j.getCoordsRelative(t,new k(0,-1)),j.getCoordsRelative(t,new k(-1,-1)),j.getCoordsRelative(t,new k(-1,0)),j.getCoordsRelative(t,new k(-1,1))].filter(Boolean):r}getPossibleMoves(){const t=[],r=this.memory.getSquares(),n=this.getAttackedCoordsBySide(this.activeColour==="white"?"black":"white");return this.memory.moveHistory.children.some(o=>o.kind==="game-over")?[]:(r.forEach(o=>{if(!o)return;const a=X(o.allegiance);if(o.piece===null){const s=j.getCoordsRelative(o,new k(0,a==="white"?1:-1)),l=j.getCoordsRelative(o,new k(a==="white"?-1:1,a==="white"?1:-1)),u=j.getCoordsRelative(o,new k(a==="white"?1:-1,a==="white"?1:-1)),c=f=>cv.map(p=>({kind:"move",type:"promotion",from:o,to:f,piece:this.memory.getSquare(o).piece,promotionTo:p}));if(this.memory.enPassantTarget&&l&&Q(this.memory.enPassantTarget,l)&&!Le(l,a)&&t.push({kind:"move",type:"en-passant",from:o,to:this.memory.enPassantTarget,piece:this.memory.getSquare(o).piece}),this.memory.enPassantTarget&&u&&Q(this.memory.enPassantTarget,u)&&!Le(u,a)&&t.push({kind:"move",type:"en-passant",from:o,to:this.memory.enPassantTarget,piece:this.memory.getSquare(o).piece}),s&&!this.memory.getSquare(s)&&!Le(s,a)&&t.push({kind:"move",type:null,piece:this.memory.getSquare(o).piece,from:o,to:s}),l){const f=this.memory.getSquare(l);f&&X(f.allegiance)!==a&&(Le(l,a)?t.push(...c(l)):t.push({kind:"move",type:"capture",from:o,to:l,piece:this.memory.getSquare(o).piece},{kind:"move",type:"allegiance",from:o,to:l,piece:this.memory.getSquare(o).piece}))}if(u){const f=this.memory.getSquare(u);f&&X(f.allegiance)!==a&&(Le(u,a)?t.push(...c(u)):t.push({kind:"move",type:"capture",from:o,to:u,piece:this.memory.getSquare(o).piece},{kind:"move",type:"allegiance",from:o,to:u,piece:this.memory.getSquare(o).piece}))}if(o.rank===2&&a==="white"||o.rank===7&&a==="black"){const f=j.getCoordsRelative(o,new k(0,a==="white"?2:-2));!this.memory.getSquare(s)&&!this.memory.getSquare(f)&&t.push({kind:"move",type:null,from:o,to:f,piece:this.memory.getSquare(o).piece})}!this.getSquare(s)&&Le(s,a)&&t.push(...c(s))}if(o.piece==="R"){const s=[...this.traceCaptureSteps(o,new k(1,0)),...this.traceCaptureSteps(o,new k(-1,0)),...this.traceCaptureSteps(o,new k(0,1)),...this.traceCaptureSteps(o,new k(0,-1))];t.push(...s.map(l=>{const u=this.memory.getSquare(l);return{kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}}),...s.map(l=>this.memory.getSquare(l)?{kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}:null).filter(Boolean))}if(o.piece==="N"&&[j.getCoordsRelative(o,new k(1,2)),j.getCoordsRelative(o,new k(2,1)),j.getCoordsRelative(o,new k(2,-1)),j.getCoordsRelative(o,new k(1,-2)),j.getCoordsRelative(o,new k(-1,-2)),j.getCoordsRelative(o,new k(-2,-1)),j.getCoordsRelative(o,new k(-2,1)),j.getCoordsRelative(o,new k(-1,2))].filter(Boolean).forEach(l=>{const u=this.memory.getSquare(l);u&&X(u.allegiance)===a||(t.push({kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}),u&&t.push({kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}))}),o.piece==="B"){const s=[...this.traceCaptureSteps(o,new k(1,1)),...this.traceCaptureSteps(o,new k(1,-1)),...this.traceCaptureSteps(o,new k(-1,-1)),...this.traceCaptureSteps(o,new k(-1,1))];t.push(...s.map(l=>{const u=this.memory.getSquare(l);return{kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}}),...s.map(l=>this.memory.getSquare(l)?{kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}:null).filter(Boolean))}if(o.piece==="Q"){const s=[...this.traceCaptureSteps(o,new k(1,0)),...this.traceCaptureSteps(o,new k(-1,0)),...this.traceCaptureSteps(o,new k(0,1)),...this.traceCaptureSteps(o,new k(0,-1)),...this.traceCaptureSteps(o,new k(1,1)),...this.traceCaptureSteps(o,new k(1,-1)),...this.traceCaptureSteps(o,new k(-1,-1)),...this.traceCaptureSteps(o,new k(-1,1))];t.push(...s.map(l=>{const u=this.memory.getSquare(l);return{kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}}),...s.map(l=>this.memory.getSquare(l)?{kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}:null).filter(Boolean))}if(o.piece==="K"){[j.getCoordsRelative(o,new k(0,1)),j.getCoordsRelative(o,new k(1,1)),j.getCoordsRelative(o,new k(1,0)),j.getCoordsRelative(o,new k(1,-1)),j.getCoordsRelative(o,new k(0,-1)),j.getCoordsRelative(o,new k(-1,-1)),j.getCoordsRelative(o,new k(-1,0)),j.getCoordsRelative(o,new k(-1,1))].filter(Boolean).forEach(f=>{const p=this.memory.getSquare(f);p&&X(p.allegiance)===a||(t.push({kind:"move",type:p?"capture":null,from:o,to:f,piece:o.piece}),p&&t.push({kind:"move",type:"allegiance",from:o,to:f,piece:o.piece}))});const l=this.memory.castlingRights("white"),u=n.some(f=>Q(o,f));if(this.activeColour==="white"&&l.length>0){const f=this.memory.getSquare({file:1,rank:1}),p=this.memory.getSquare({file:2,rank:1}),v=this.memory.getSquare({file:3,rank:1}),h=this.memory.getSquare({file:4,rank:1}),w=this.memory.getSquare({file:6,rank:1}),S=this.memory.getSquare({file:7,rank:1}),T=this.memory.getSquare({file:8,rank:1}),M=n.some(y=>Q(y,{file:2,rank:1})),C=n.some(y=>Q(y,{file:3,rank:1})),P=n.some(y=>Q(y,{file:4,rank:1})),O=n.some(y=>Q(y,{file:6,rank:1})),R=n.some(y=>Q(y,{file:7,rank:1}));l.forEach(y=>{y==="king"&&!u&&!w&&!S&&T&&T.piece==="R"&&X(T.allegiance)==="white"&&!O&&!R&&t.push({kind:"move",type:"castle",from:o,to:j.getCoordsRelative(o,new k(2,0)),piece:this.memory.getSquare(o).piece,side:"king"}),y==="queen"&&!u&&!p&&!v&&!h&&f&&f.piece==="R"&&X(f.allegiance)==="white"&&!M&&!C&&!P&&t.push({kind:"move",type:"castle",from:o,to:j.getCoordsRelative(o,new k(-2,0)),piece:this.memory.getSquare(o).piece,side:"queen"})})}const c=this.memory.castlingRights("black");if(this.activeColour==="black"&&c.length>0){const f=this.memory.getSquare({file:1,rank:8}),p=this.memory.getSquare({file:2,rank:8}),v=this.memory.getSquare({file:3,rank:8}),h=this.memory.getSquare({file:4,rank:8}),w=this.memory.getSquare({file:6,rank:8}),S=this.memory.getSquare({file:7,rank:8}),T=this.memory.getSquare({file:8,rank:8}),M=n.some(y=>Q(y,{file:2,rank:8})),C=n.some(y=>Q(y,{file:3,rank:8})),P=n.some(y=>Q(y,{file:4,rank:8})),O=n.some(y=>Q(y,{file:6,rank:8})),R=n.some(y=>Q(y,{file:7,rank:8}));c.forEach(y=>{y==="king"&&!u&&!w&&!S&&T&&T.piece==="R"&&X(T.allegiance)==="black"&&!O&&!R&&t.push({kind:"move",type:"castle",from:o,to:j.getCoordsRelative(o,new k(2,0)),piece:this.memory.getSquare(o).piece,side:"king"}),y==="queen"&&!u&&!p&&!v&&!h&&f&&f.piece==="R"&&X(f.allegiance)==="black"&&!M&&!C&&!P&&t.push({kind:"move",type:"castle",from:o,to:j.getCoordsRelative(o,new k(-2,0)),piece:this.memory.getSquare(o).piece,side:"queen"})})}}}),t)}getGameOverNode(t,r){const n=this.getCheckMovesFromList(t),i=this.getSquares().filter(Boolean),o=this.activeColour,a=this.activeColour==="white"?"black":"white",s=(h,w)=>i.reduce((S,T)=>!w&&w!==null&&X(T.allegiance)===h||T.piece===w&&X(T.allegiance)===h?S+1:S,0),l=n.some(h=>{const w=this.memory.getSquare(h.to);return X(w.allegiance)===o});if(l&&r.length===0)return{kind:"game-over",outcome:a,reason:"Checkmate"};if(!l&&r.length===0)return{kind:"game-over",outcome:"draw",reason:"Stalemate"};const u=s(o),c=s(a);if(u===1&&c===1){const h=i.find(S=>X(S.allegiance)===a);if(i.find(S=>X(S.allegiance)===o).piece==="K"&&h.piece==="K")return{kind:"game-over",outcome:"draw",reason:"Insufficient material (king vs king)"}}if(u<=2&&c<=2){const h=i.find(M=>X(M.allegiance)===a&&M.piece==="K"),w=i.find(M=>X(M.allegiance)===a&&M.piece!=="K"),S=i.find(M=>X(M.allegiance)===o&&M.piece==="K"),T=i.find(M=>X(M.allegiance)===o&&M.piece!=="K");if(S&&h&&(!T||T.piece==="N"||T.piece==="B")&&(!w||w.piece==="N"||w.piece==="B"))return{kind:"game-over",outcome:"draw",reason:"Insufficient material (king + minor vs king + minor)"}}if(this.halfmoveClock>=100)return{kind:"game-over",outcome:"draw",reason:"50 move-rule"};const f=this.getPositionCount(),p=this.toAFEN({sections:["positions"]});if((f.get(p)||0)>=3)return{kind:"game-over",outcome:"draw",reason:"Repetition"}}getCheckMoves(){const t=this.getPossibleMoves();return this.getCheckMovesFromList(t)}getCheckMovesFromList(t){return t.filter(r=>{if(r.kind!=="move"||!r.to)return;const n=this.memory.getSquare(r.to);return n&&n.piece==="K"})}getValidMovesFromList(t,r){const n=t.filter(o=>{if(o.kind!=="move")return!0;if(r.from&&!Q(r.from,o.from))return!1;const a=this.memory.getSquare(o.from);if(X(a.allegiance)!==this.activeColour)return!1;const s=this.clone();s.executeNode(o);const l=s.getPossibleMoves();return s.getCheckMovesFromList(l).every(c=>{const f=s.getSquare(c.to);return X(f.allegiance)!==this.activeColour})}),i=this.getGameOverNode(t,n);return i?[i]:(n.push({kind:"draw-offer"},{kind:"game-over",outcome:"white",reason:"Resignation"},{kind:"game-over",outcome:"black",reason:"Resignation"}),n)}getValidMoves(t){const r=this.getPossibleMoves();return this.getValidMovesFromList(r,{from:t,side:this.activeColour})}}const fv={key:0,class:"absolute absolute-bottom-right q-px-sm"},dv={key:1,class:"absolute absolute-top-left q-pa-xs"},hv=Ie({__name:"background-layer",props:{ranks:{},files:{},perspective:{},loading:{type:Boolean}},setup(e){const t=wi();return(r,n)=>(I(),ne("div",{class:Ve([{loading:r.loading},"row column full-width full-height no-pointer-events background-layer"]),"data-testid":"background"},[(I(!0),ne(pt,null,vt(r.ranks,(i,o)=>(I(),ne("div",{class:"rank col row full-width",key:o},[(I(!0),ne(pt,null,vt(r.files,(a,s)=>(I(),ne("div",{key:s,class:Ve(["file col relative-position",{"text-h6 text-bold":se(t).screen.gt.sm,"text-subtitle1 text-bold":se(t).screen.sm,"text-subtitle2":se(t).screen.lt.sm}])},[o===7?(I(),ne("span",fv,Et(se(ct)(r.perspective==="white"?9-(8-s):8-s)),1)):ce("",!0),s===0?(I(),ne("span",dv,Et(r.perspective==="white"?8-o:9-(8-o)),1)):ce("",!0)],2))),128))]))),128))],2))}});var pv=Xe(hv,[["__scopeId","data-v-7bbfc6bd"]]);const vv={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function gv({showing:e,avoidEmit:t,configureAnchorEl:r}){const{props:n,proxy:i,emit:o}=It(),a=B(null);let s=null;function l(v){return a.value===null?!1:v===void 0||v.touches===void 0||v.touches.length<=1}const u={};r===void 0&&(Object.assign(u,{hide(v){i.hide(v)},toggle(v){i.toggle(v),v.qAnchorHandled=!0},toggleKey(v){Si(v,13)===!0&&u.toggle(v)},contextClick(v){i.hide(v),Zi(v),ja(()=>{i.show(v),v.qAnchorHandled=!0})},prevent:Zi,mobileTouch(v){if(u.mobileCleanup(v),l(v)!==!0)return;i.hide(v),a.value.classList.add("non-selectable");const h=v.target;eo(u,"anchor",[[h,"touchmove","mobileCleanup","passive"],[h,"touchend","mobileCleanup","passive"],[h,"touchcancel","mobileCleanup","passive"],[a.value,"contextmenu","prevent","notPassive"]]),s=setTimeout(()=>{s=null,i.show(v),v.qAnchorHandled=!0},300)},mobileCleanup(v){a.value.classList.remove("non-selectable"),s!==null&&(clearTimeout(s),s=null),e.value===!0&&v!==void 0&&Yl()}}),r=function(v=n.contextMenu){if(n.noParentEvent===!0||a.value===null)return;let h;v===!0?i.$q.platform.is.mobile===!0?h=[[a.value,"touchstart","mobileTouch","passive"]]:h=[[a.value,"mousedown","hide","passive"],[a.value,"contextmenu","contextClick","notPassive"]]:h=[[a.value,"click","toggle","passive"],[a.value,"keyup","toggleKey","passive"]],eo(u,"anchor",h)});function c(){jl(u,"anchor")}function f(v){for(a.value=v;a.value.classList.contains("q-anchor--skip");)a.value=a.value.parentNode;r()}function p(){if(n.target===!1||n.target===""||i.$el.parentNode===null)a.value=null;else if(n.target===!0)f(i.$el.parentNode);else{let v=n.target;if(typeof n.target=="string")try{v=document.querySelector(n.target)}catch{v=void 0}v!=null?(a.value=v.$el||v,r()):(a.value=null,console.error(`Anchor: target "${n.target}" not found`))}}return xe(()=>n.contextMenu,v=>{a.value!==null&&(c(),r(v))}),xe(()=>n.target,()=>{a.value!==null&&c(),p()}),xe(()=>n.noParentEvent,v=>{a.value!==null&&(v===!0?c():r())}),ki(()=>{p(),t!==!0&&n.modelValue===!0&&a.value===null&&o("update:modelValue",!1)}),gt(()=>{s!==null&&clearTimeout(s),c()}),{anchorEl:a,canShow:l,anchorEvents:u}}function mv(e,t){const r=B(null);let n;function i(s,l){const u=`${l!==void 0?"add":"remove"}EventListener`,c=l!==void 0?l:n;s!==window&&s[u]("scroll",c,Qn.passive),window[u]("scroll",c,Qn.passive),n=l}function o(){r.value!==null&&(i(r.value),r.value=null)}const a=xe(()=>e.noParentEvent,()=>{r.value!==null&&(o(),t())});return gt(a),{localScrollTarget:r,unconfigureScrollTarget:o,changeScrollEvent:i}}const Ct=[];function yv(e){return Ct.find(t=>t.contentEl!==null&&t.contentEl.contains(e))}function gl(e,t){do{if(e.$options.name==="QMenu"){if(e.hide(t),e.$props.separateClosePopup===!0)return Tr(e)}else if(e.__qPortal===!0){const r=Tr(e);return r!==void 0&&r.$options.name==="QPopupProxy"?(e.hide(t),r):e}e=Tr(e)}while(e!=null)}function bv(e,t,r){for(;r!==0&&e!==void 0&&e!==null;){if(e.__qPortal===!0){if(r--,e.$options.name==="QMenu"){e=gl(e,t);continue}e.hide(t)}e=Tr(e)}}function wv(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function ml(e,t,r,n){const i=B(!1),o=B(!1);let a=null;const s={},l=n==="dialog"&&wv(e);function u(f){if(f===!0){oo(s),o.value=!0;return}o.value=!1,i.value===!1&&(l===!1&&a===null&&(a=$l(!1,n)),i.value=!0,Ct.push(e.proxy),ru(s))}function c(f){if(o.value=!1,f!==!0)return;oo(s),i.value=!1;const p=Ct.indexOf(e.proxy);p!==-1&&Ct.splice(p,1),a!==null&&(xl(a),a=null)}return Cl(()=>{c(!0)}),e.proxy.__qPortal=!0,Nl(e.proxy,"contentEl",()=>t.value),{showPortal:u,hidePortal:c,portalIsActive:i,portalIsAccessible:o,renderPortal:()=>l===!0?r():i.value===!0?[te(Ml,{to:a},r())]:void 0}}const yl={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function bl(e,t=()=>{},r=()=>{}){return{transitionProps:q(()=>{const n=`q-transition--${e.transitionShow||t()}`,i=`q-transition--${e.transitionHide||r()}`;return{appear:!0,enterFromClass:`${n}-enter-from`,enterActiveClass:`${n}-enter-active`,enterToClass:`${n}-enter-to`,leaveFromClass:`${i}-leave-from`,leaveActiveClass:`${i}-leave-active`,leaveToClass:`${i}-leave-to`}}),transitionStyle:q(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}function wl(){let e;const t=It();function r(){e=void 0}return Ca(r),gt(r),{removeTick:r,registerTick(n){e=n,ja(()=>{e===n&&(ql(t)===!1&&e(),e=void 0)})}}}const ft=[];let qt;function Sv(e){qt=e.keyCode===27}function kv(){qt===!0&&(qt=!1)}function _v(e){qt===!0&&(qt=!1,Si(e,27)===!0&&ft[ft.length-1](e))}function Sl(e){window[e]("keydown",Sv),window[e]("blur",kv),window[e]("keyup",_v),qt=!1}function kl(e){_i.is.desktop===!0&&(ft.push(e),ft.length===1&&Sl("addEventListener"))}function tn(e){const t=ft.indexOf(e);t>-1&&(ft.splice(t,1),ft.length===0&&Sl("removeEventListener"))}const dt=[];function _l(e){dt[dt.length-1](e)}function El(e){_i.is.desktop===!0&&(dt.push(e),dt.length===1&&document.body.addEventListener("focusin",_l))}function yi(e){const t=dt.indexOf(e);t>-1&&(dt.splice(t,1),dt.length===0&&document.body.removeEventListener("focusin",_l))}const{notPassiveCapture:rn}=Qn,ht=[];function nn(e){const t=e.target;if(t===void 0||t.nodeType===8||t.classList.contains("no-pointer-events")===!0)return;let r=Ct.length-1;for(;r>=0;){const n=Ct[r].$;if(n.type.name==="QTooltip"){r--;continue}if(n.type.name!=="QDialog")break;if(n.props.seamless!==!0)return;r--}for(let n=ht.length-1;n>=0;n--){const i=ht[n];if((i.anchorEl.value===null||i.anchorEl.value.contains(t)===!1)&&(t===document.body||i.innerRef.value!==null&&i.innerRef.value.contains(t)===!1))e.qClickOutside=!0,i.onClickOutside(e);else return}}function Ev(e){ht.push(e),ht.length===1&&(document.addEventListener("mousedown",nn,rn),document.addEventListener("touchstart",nn,rn))}function ma(e){const t=ht.findIndex(r=>r===e);t>-1&&(ht.splice(t,1),ht.length===0&&(document.removeEventListener("mousedown",nn,rn),document.removeEventListener("touchstart",nn,rn)))}let ya,ba;function wa(e){const t=e.split(" ");return t.length!==2?!1:["top","center","bottom"].includes(t[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(t[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function Av(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const bi={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{bi[`${e}#ltr`]=e,bi[`${e}#rtl`]=e});function Sa(e,t){const r=e.split(" ");return{vertical:r[0],horizontal:bi[`${r[1]}#${t===!0?"rtl":"ltr"}`]}}function Rv(e,t){let{top:r,left:n,right:i,bottom:o,width:a,height:s}=e.getBoundingClientRect();return t!==void 0&&(r-=t[1],n-=t[0],o+=t[1],i+=t[0],a+=t[0],s+=t[1]),{top:r,bottom:o,height:s,left:n,right:i,width:a,middle:n+(i-n)/2,center:r+(o-r)/2}}function Ov(e,t,r){let{top:n,left:i}=e.getBoundingClientRect();return n+=t.top,i+=t.left,r!==void 0&&(n+=r[1],i+=r[0]),{top:n,bottom:n+1,height:1,left:i,right:i+1,width:1,middle:i,center:n}}function Pv(e,t){return{top:0,center:t/2,bottom:t,left:0,middle:e/2,right:e}}function ka(e,t,r,n){return{top:e[r.vertical]-t[n.vertical],left:e[r.horizontal]-t[n.horizontal]}}function Al(e,t=0){if(e.targetEl===null||e.anchorEl===null||t>5)return;if(e.targetEl.offsetHeight===0||e.targetEl.offsetWidth===0){setTimeout(()=>{Al(e,t+1)},10);return}const{targetEl:r,offset:n,anchorEl:i,anchorOrigin:o,selfOrigin:a,absoluteOffset:s,fit:l,cover:u,maxHeight:c,maxWidth:f}=e;if(_i.is.ios===!0&&window.visualViewport!==void 0){const R=document.body.style,{offsetLeft:y,offsetTop:U}=window.visualViewport;y!==ya&&(R.setProperty("--q-pe-left",y+"px"),ya=y),U!==ba&&(R.setProperty("--q-pe-top",U+"px"),ba=U)}const{scrollLeft:p,scrollTop:v}=r,h=s===void 0?Rv(i,u===!0?[0,0]:n):Ov(i,s,n);Object.assign(r.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:f||"100vw",maxHeight:c||"100vh",visibility:"visible"});const{offsetWidth:w,offsetHeight:S}=r,{elWidth:T,elHeight:M}=l===!0||u===!0?{elWidth:Math.max(h.width,w),elHeight:u===!0?Math.max(h.height,S):S}:{elWidth:w,elHeight:S};let C={maxWidth:f,maxHeight:c};(l===!0||u===!0)&&(C.minWidth=h.width+"px",u===!0&&(C.minHeight=h.height+"px")),Object.assign(r.style,C);const P=Pv(T,M);let O=ka(h,P,o,a);if(s===void 0||n===void 0)Vn(O,h,P,o,a);else{const{top:R,left:y}=O;Vn(O,h,P,o,a);let U=!1;if(O.top!==R){U=!0;const V=2*n[1];h.center=h.top-=V,h.bottom-=V+2}if(O.left!==y){U=!0;const V=2*n[0];h.middle=h.left-=V,h.right-=V+2}U===!0&&(O=ka(h,P,o,a),Vn(O,h,P,o,a))}C={top:O.top+"px",left:O.left+"px"},O.maxHeight!==void 0&&(C.maxHeight=O.maxHeight+"px",h.height>O.maxHeight&&(C.minHeight=C.maxHeight)),O.maxWidth!==void 0&&(C.maxWidth=O.maxWidth+"px",h.width>O.maxWidth&&(C.minWidth=C.maxWidth)),Object.assign(r.style,C),r.scrollTop!==v&&(r.scrollTop=v),r.scrollLeft!==p&&(r.scrollLeft=p)}function Vn(e,t,r,n,i){const o=r.bottom,a=r.right,s=Jl(),l=window.innerHeight-s,u=document.body.clientWidth;if(e.top<0||e.top+o>l)if(i.vertical==="center")e.top=t[n.vertical]>l/2?Math.max(0,l-o):0,e.maxHeight=Math.min(o,l);else if(t[n.vertical]>l/2){const c=Math.min(l,n.vertical==="center"?t.center:n.vertical===i.vertical?t.bottom:t.top);e.maxHeight=Math.min(o,c),e.top=Math.max(0,c-o)}else e.top=Math.max(0,n.vertical==="center"?t.center:n.vertical===i.vertical?t.top:t.bottom),e.maxHeight=Math.min(o,l-e.top);if(e.left<0||e.left+a>u)if(e.maxWidth=Math.min(a,u),i.horizontal==="middle")e.left=t[n.horizontal]>u/2?Math.max(0,u-a):0;else if(t[n.horizontal]>u/2){const c=Math.min(u,n.horizontal==="middle"?t.middle:n.horizontal===i.horizontal?t.right:t.left);e.maxWidth=Math.min(a,c),e.left=Math.max(0,c-e.maxWidth)}else e.left=Math.max(0,n.horizontal==="middle"?t.middle:n.horizontal===i.horizontal?t.left:t.right),e.maxWidth=Math.min(a,u-e.left)}var Rl=or({name:"QMenu",inheritAttrs:!1,props:{...vv,...xa,...Ri,...yl,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:wa},self:{type:String,validator:wa},offset:{type:Array,validator:Av},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...qa,"click","escapeKey"],setup(e,{slots:t,emit:r,attrs:n}){let i=null,o,a,s;const l=It(),{proxy:u}=l,{$q:c}=u,f=B(null),p=B(!1),v=q(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),h=Oi(e,c),{registerTick:w,removeTick:S}=wl(),{registerTimeout:T}=Ia(),{transitionProps:M,transitionStyle:C}=bl(e),{localScrollTarget:P,changeScrollEvent:O,unconfigureScrollTarget:R}=mv(e,g),{anchorEl:y,canShow:U}=gv({showing:p}),{hide:V}=Da({showing:p,canShow:U,handleShow:he,handleHide:Me,hideOnRouteChange:v,processOnMount:!0}),{showPortal:de,hidePortal:le,renderPortal:ve}=ml(l,f,D,"menu"),Oe={anchorEl:y,innerRef:f,onClickOutside(A){if(e.persistent!==!0&&p.value===!0)return V(A),(A.type==="touchstart"||A.target.classList.contains("q-dialog__backdrop"))&&Ma(A),!0}},ye=q(()=>Sa(e.anchor||(e.cover===!0?"center middle":"bottom start"),c.lang.rtl)),we=q(()=>e.cover===!0?ye.value:Sa(e.self||"top start",c.lang.rtl)),E=q(()=>(e.square===!0?" q-menu--square":"")+(h.value===!0?" q-menu--dark q-dark":"")),x=q(()=>e.autoClose===!0?{onClick:b}:{}),L=q(()=>p.value===!0&&e.persistent!==!0);xe(L,A=>{A===!0?(kl(N),Ev(Oe)):(tn(N),ma(Oe))});function re(){La(()=>{let A=f.value;A&&A.contains(document.activeElement)!==!0&&(A=A.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||A.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||A.querySelector("[autofocus], [data-autofocus]")||A,A.focus({preventScroll:!0}))})}function he(A){if(i=e.noRefocus===!1?document.activeElement:null,El(_),de(),g(),o=void 0,A!==void 0&&(e.touchPosition||e.contextMenu)){const J=Il(A);if(J.left!==void 0){const{top:ge,left:De}=y.value.getBoundingClientRect();o={left:J.left-De,top:J.top-ge}}}a===void 0&&(a=xe(()=>c.screen.width+"|"+c.screen.height+"|"+e.self+"|"+e.anchor+"|"+c.lang.rtl,F)),e.noFocus!==!0&&document.activeElement.blur(),w(()=>{F(),e.noFocus!==!0&&re()}),T(()=>{c.platform.is.ios===!0&&(s=e.autoClose,f.value.click()),F(),de(!0),r("show",A)},e.transitionDuration)}function Me(A){S(),le(),d(!0),i!==null&&(A===void 0||A.qClickOutside!==!0)&&(((A&&A.type.indexOf("key")===0?i.closest('[tabindex]:not([tabindex^="-"])'):void 0)||i).focus(),i=null),T(()=>{le(!0),r("hide",A)},e.transitionDuration)}function d(A){o=void 0,a!==void 0&&(a(),a=void 0),(A===!0||p.value===!0)&&(yi(_),R(),ma(Oe),tn(N)),A!==!0&&(i=null)}function g(){(y.value!==null||e.scrollTarget!==void 0)&&(P.value=Xl(y.value,e.scrollTarget),O(P.value,F))}function b(A){s!==!0?(gl(u,A),r("click",A)):s=!1}function _(A){L.value===!0&&e.noFocus!==!0&&Na(f.value,A.target)!==!0&&re()}function N(A){r("escapeKey"),V(A)}function F(){Al({targetEl:f.value,offset:e.offset,anchorEl:y.value,anchorOrigin:ye.value,selfOrigin:we.value,absoluteOffset:o,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function D(){return te(Jt,M.value,()=>p.value===!0?te("div",{role:"menu",...n,ref:f,tabindex:-1,class:["q-menu q-position-engine scroll"+E.value,n.class],style:[n.style,C.value],...x.value},Ei(t.default)):null)}return gt(d),Object.assign(u,{focus:re,updatePosition:F}),ve}});const Tv=Ie({__name:"promotion-selector",props:{modelValue:{type:Boolean},allegiance:{}},emits:["click","dismiss"],setup(e,{emit:t}){const r=["Q","N","R","B"],n=()=>{t("dismiss")};return(i,o)=>(I(),ae(Rl,{cover:"","model-value":i.modelValue,"onUpdate:modelValue":n},{default:K(()=>[Y($a,null,{default:K(()=>[(I(),ne(pt,null,vt(r,a=>Y(Wr,{clickable:"",key:a,class:"q-pa-sm",onClick:s=>t("click",a)},{default:K(()=>[Y(Zt,{class:"promotion-piece items-center"},{default:K(()=>[Y(Nt,{allegiance:i.allegiance,piece:a,size:92},null,8,["allegiance","piece"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1},8,["model-value"]))}});var jv=Xe(Tv,[["__scopeId","data-v-370c2c26"]]);const Cv=Ie({__name:"capture-selector",props:{modelValue:{type:Boolean},moves:{}},emits:["click","dismiss"],setup(e,{emit:t}){const r=()=>{t("dismiss")};return(n,i)=>(I(),ae(Rl,{cover:"","model-value":n.modelValue,"onUpdate:modelValue":r},{default:K(()=>[Y($a,null,{default:K(()=>[n.moves.includes("x")?(I(),ae(Wr,{key:0,clickable:"",onClick:i[0]||(i[0]=o=>t("click","capture")),class:"q-py-lg"},{default:K(()=>[Y(Zt,{class:"items-center"},{default:K(()=>[Y(st,{size:"72px",name:"close"})]),_:1})]),_:1})):ce("",!0),n.moves.includes(">")?(I(),ae(Wr,{key:1,clickable:"",onClick:i[1]||(i[1]=o=>t("click","challenge")),class:"q-py-lg"},{default:K(()=>[Y(Zt,{class:"items-center"},{default:K(()=>[Y(st,{size:"64px",name:"arrow_forward_ios"})]),_:1})]),_:1})):ce("",!0)]),_:1})]),_:1},8,["model-value"]))}});const Nv={class:"relative-position full-width full-height interaction-layer row wrap"},Mv=["onClick"],$v=Ie({__name:"interaction-layer",props:{enPassantTarget:{},squares:{},ranks:{},files:{},perspective:{},pieceFocus:{},validMoves:{},activeColour:{}},emits:["execute-node-index","update-piece-focus","update-highlights"],setup(e,{emit:t}){const r=e,n=B(null),i=B(null),o=B(null),a=P=>r.squares.find(O=>Q(O,P)),s=q(()=>r.pieceFocus?a(r.pieceFocus):null),l=q(()=>r.pieceFocus?r.validMoves.filter(R=>R.kind==="move"&&Q(r.pieceFocus,R.from)).map(R=>R.kind!=="move"?null:R.to).filter(Boolean):[]),u=P=>{const O=r.squares.find(R=>Q(R,P));return O?X(O.allegiance)!==r.perspective:!1},c=P=>l.value.some(O=>O&&Q(P,O)),f=(P,O)=>{var y,U;if(O.stopPropagation(),O.preventDefault(),c(P)&&r.pieceFocus&&s.value){if(r.enPassantTarget&&Q(r.enPassantTarget,P))t("execute-node-index",j.findMoveIndex(r.validMoves,{kind:"move",type:"en-passant",from:r.pieceFocus,to:P})),t("update-piece-focus",null);else if(Le(P,r.activeColour)&&s&&s.value.piece===null){i.value=P;const V=a(r.pieceFocus);o.value=(y=V==null?void 0:V.allegiance)!=null?y:null}else a(P)?n.value=P:((U=s.value)==null?void 0:U.piece)==="K"&&Math.abs(r.pieceFocus.file-P.file)>1?t("execute-node-index",j.findMoveIndex(r.validMoves,{kind:"move",type:"castle",side:P.file===7?"king":"queen",from:r.pieceFocus,to:P})):t("execute-node-index",j.findMoveIndex(r.validMoves,{kind:"move",from:r.pieceFocus,to:P}));return}if(u(P))return;const R=a(P);t("update-piece-focus",R?P:null)},p=(P,O)=>{if(!r.pieceFocus)return;i.value=null;const R=j.findMoveIndex(r.validMoves,{kind:"move",type:"promotion",from:r.pieceFocus,to:P,promotionTo:O});t("execute-node-index",R),t("update-piece-focus",null)},v=()=>{i.value=null,o.value=null},h=()=>{n.value=null},w=P=>{if(!r.pieceFocus||!n.value)return;const O=j.findMoveIndex(r.validMoves,{kind:"move",type:P==="capture"?"capture":"allegiance",from:r.pieceFocus,to:n.value});t("execute-node-index",O),n.value=null,t("update-piece-focus",null)},S=P=>!a(P),T=(P,O,R)=>r.validMoves.some(y=>y.kind==="move"&&Q(y.to,R)&&Q(y.from,O)&&y.type===P),M=q(()=>{const P=[];return!r.pieceFocus||!n.value||(T("allegiance",r.pieceFocus,n.value)&&P.push(">"),T("capture",r.pieceFocus,n.value)&&P.push("x")),P}),C=P=>r.perspective==="white"?ir(P):ir(63-P);return(P,O)=>(I(),ne("div",Nv,[(I(),ne(pt,null,vt(64,(R,y)=>{var U,V;return Xt(Se("div",{key:y,class:Ve(["relative-position interaction-square",{"cursor-pointer":!S(C(y))||c(C(y)),"cursor-not-allowed":u(C(y))&&!s.value}]),onClick:de=>f(C(y),de)},[n.value&&se(Q)(n.value,C(y))?(I(),ae(Cv,{key:0,moves:M.value,"model-value":(U=se(Q)(n.value,C(y)))!=null?U:!1,onClick:w,onDismiss:h},null,8,["moves","model-value"])):ce("",!0),o.value!==null&&(se(Le)(C(y),"white")||se(Le)(C(y),"black"))?(I(),ae(jv,{key:1,"model-value":(V=se(Q)(i.value,C(y)))!=null?V:!1,allegiance:o.value,onClick:de=>p(C(y),de),onDismiss:v},null,8,["model-value","allegiance","onClick"])):ce("",!0)],10,Mv),[[Ai,!S(C(y))&&!u(C(y))]])}),64))]))}});var xv=Xe($v,[["__scopeId","data-v-61e6cc90"]]);const qv={class:"relative-position full-width full-height row no-pointer-events indicators-layer"},Iv=Ie({__name:"indicators-layer",props:{squares:{},checkMoves:{},validMoves:{},ranks:{},files:{},perspective:{},pieceFocus:{},lastMove:{}},setup(e){const t=e,r=q(()=>t.pieceFocus?t.validMoves.filter(u=>u.kind==="move"&&Q(t.pieceFocus,u.from)).map(u=>u.kind!=="move"?null:u.to).filter(Boolean):[]),n=s=>r.value.some(l=>l&&Q(s,l)),i=s=>!t.squares.find(l=>Q(s,l)),o=s=>t.checkMoves.some(l=>l.kind==="move"&&Q(l.to,s)),a=s=>t.perspective==="white"?ir(s):ir(63-s);return(s,l)=>(I(),ne("div",qv,[(I(),ne(pt,null,vt(64,(u,c)=>{var f,p;return Se("div",{key:c,class:Ve(["indicator-square move-placeholder",{even:(a(c).file+a(c).rank)%2!==0,focus:se(Q)(s.pieceFocus,a(c)),show:n(a(c)),capture:!i(a(c)),target:i(a(c)),checked:o(a(c)),"last-from":((f=s.lastMove)==null?void 0:f.kind)==="move"&&se(Q)(s.lastMove.from,a(c)),"last-to":((p=s.lastMove)==null?void 0:p.kind)==="move"&&se(Q)(s.lastMove.to,a(c))}])},null,2)}),64))]))}});var Dv=Xe(Iv,[["__scopeId","data-v-1f3d6516"]]);const Lv={class:"relative-position full-width full-height no-pointer-events pieces-layer row wrap"},Fv=Ie({__name:"pieces-layer",props:{modelValue:{},perspective:{}},setup(e){const t=e,r=wi(),n=i=>t.perspective==="white"?t.modelValue[i]:t.modelValue[63-i];return(i,o)=>(I(),ne("div",Lv,[(I(),ne(pt,null,vt(64,(a,s)=>Se("div",{key:s,class:"piece-square"},[n(s)?(I(),ae(Nt,{key:0,"data-testid":"piece",class:Ve({"q-pa-xs":se(r).screen.sm||se(r).screen.md,"q-pa-sm":se(r).screen.gt.sm}),piece:n(s).piece,allegiance:n(s).allegiance},null,8,["class","piece","allegiance"])):ce("",!0)])),64))]))}});var Bv=Xe(Fv,[["__scopeId","data-v-20f57457"]]);const zv={"data-testid":"chess-board",class:"relative-position column chess-board"},Uv={class:"absolute full-width full-height"},Wv={class:"absolute full-width full-height"},Hv={class:"absolute full-width full-height"},Gv={class:"absolute full-width full-height"},Vv=Ie({__name:"chess-board",props:{squares:{},moveHistoryAst:{},checkMoves:{},perspective:{},playAs:{},validMoves:{},activeColour:{},enPassantTarget:{},loading:{type:Boolean}},emits:["execute-node-index"],setup(e,{emit:t}){const r=e,n=B(null),i=a=>{t("execute-node-index",a),n.value=null},o=q(()=>{var a;return(a=r.moveHistoryAst.children[r.moveHistoryAst.children.length-1])!=null?a:null});return(a,s)=>(I(),ne("div",zv,[Se("div",Uv,[Y(pv,{ranks:8,files:8,perspective:a.perspective,loading:a.loading},null,8,["perspective","loading"])]),Se("div",Wv,[Y(Dv,{"valid-moves":a.validMoves,"check-moves":a.checkMoves,squares:a.squares,files:8,ranks:8,perspective:a.perspective,"piece-focus":n.value,"last-move":o.value},null,8,["valid-moves","check-moves","squares","perspective","piece-focus","last-move"])]),Se("div",Hv,[Y(Bv,{"model-value":a.squares,perspective:r.perspective},null,8,["model-value","perspective"])]),Se("div",Gv,[Y(xv,{onExecuteNodeIndex:i,onUpdatePieceFocus:s[0]||(s[0]=l=>n.value=l),"piece-focus":n.value,squares:a.squares,"en-passant-target":a.enPassantTarget,"active-colour":a.activeColour,files:8,ranks:8,perspective:a.perspective,"valid-moves":a.validMoves},null,8,["piece-focus","squares","en-passant-target","active-colour","perspective","valid-moves"])])]))}});var Mg=Xe(Vv,[["__scopeId","data-v-384c9f82"]]);const Kv={xs:8,sm:10,md:14,lg:20,xl:24};var _a=or({name:"QChip",props:{...Ri,...Dl,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:t,emit:r}){const{proxy:{$q:n}}=It(),i=Oi(e,n),o=Ll(e,Kv),a=q(()=>e.selected===!0||e.icon!==void 0),s=q(()=>e.selected===!0?e.iconSelected||n.iconSet.chip.selected:e.icon),l=q(()=>e.iconRemove||n.iconSet.chip.remove),u=q(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),c=q(()=>{const S=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(S?` text-${S} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(u.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(i.value===!0?" q-chip--dark q-dark":"")}),f=q(()=>{const S=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},T={...S,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||n.lang.label.remove};return{chip:S,remove:T}});function p(S){S.keyCode===13&&v(S)}function v(S){e.disable||(r("update:selected",!e.selected),r("click",S))}function h(S){(S.keyCode===void 0||S.keyCode===13)&&(Ma(S),e.disable===!1&&(r("update:modelValue",!1),r("remove")))}function w(){const S=[];u.value===!0&&S.push(te("div",{class:"q-focus-helper"})),a.value===!0&&S.push(te(st,{class:"q-chip__icon q-chip__icon--left",name:s.value}));const T=e.label!==void 0?[te("div",{class:"ellipsis"},[e.label])]:void 0;return S.push(te("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},Bl(t.default,T))),e.iconRight&&S.push(te(st,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&S.push(te(st,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:l.value,...f.value.remove,onClick:h,onKeyup:h})),S}return()=>{if(e.modelValue===!1)return;const S={class:c.value,style:o.value};return u.value===!0&&Object.assign(S,f.value.chip,{onClick:v,onKeyup:p}),Fl("div",S,w(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[Ai,e.ripple]])}}});const Ea=["vertical","horizontal"],Kn={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},Aa={prevent:!0,mouse:!0,mouseAllDir:!0},Ra=e=>e>=250?50:Math.ceil(e/5);var Qv=or({name:"QScrollArea",props:{...Ri,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:t,emit:r}){const n=B(!1),i=B(!1),o=B(!1),a={vertical:B(0),horizontal:B(0)},s={vertical:{ref:B(null),position:B(0),size:B(0)},horizontal:{ref:B(null),position:B(0),size:B(0)}},{proxy:l}=It(),u=Oi(e,l.$q);let c=null,f;const p=B(null),v=q(()=>"q-scrollarea"+(u.value===!0?" q-scrollarea--dark":""));s.vertical.percentage=q(()=>{const E=s.vertical.size.value-a.vertical.value;if(E<=0)return 0;const x=wr(s.vertical.position.value/E,0,1);return Math.round(x*1e4)/1e4}),s.vertical.thumbHidden=q(()=>(e.visible===null?o.value:e.visible)!==!0&&n.value===!1&&i.value===!1||s.vertical.size.value<=a.vertical.value+1),s.vertical.thumbStart=q(()=>s.vertical.percentage.value*(a.vertical.value-s.vertical.thumbSize.value)),s.vertical.thumbSize=q(()=>Math.round(wr(a.vertical.value*a.vertical.value/s.vertical.size.value,Ra(a.vertical.value),a.vertical.value))),s.vertical.style=q(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${s.vertical.thumbStart.value}px`,height:`${s.vertical.thumbSize.value}px`})),s.vertical.thumbClass=q(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(s.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),s.vertical.barClass=q(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(s.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),s.horizontal.percentage=q(()=>{const E=s.horizontal.size.value-a.horizontal.value;if(E<=0)return 0;const x=wr(Math.abs(s.horizontal.position.value)/E,0,1);return Math.round(x*1e4)/1e4}),s.horizontal.thumbHidden=q(()=>(e.visible===null?o.value:e.visible)!==!0&&n.value===!1&&i.value===!1||s.horizontal.size.value<=a.horizontal.value+1),s.horizontal.thumbStart=q(()=>s.horizontal.percentage.value*(a.horizontal.value-s.horizontal.thumbSize.value)),s.horizontal.thumbSize=q(()=>Math.round(wr(a.horizontal.value*a.horizontal.value/s.horizontal.size.value,Ra(a.horizontal.value),a.horizontal.value))),s.horizontal.style=q(()=>({...e.thumbStyle,...e.horizontalThumbStyle,[l.$q.lang.rtl===!0?"right":"left"]:`${s.horizontal.thumbStart.value}px`,width:`${s.horizontal.thumbSize.value}px`})),s.horizontal.thumbClass=q(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(s.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),s.horizontal.barClass=q(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(s.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const h=q(()=>s.vertical.thumbHidden.value===!0&&s.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),w=[[io,E=>{y(E,"vertical")},void 0,{vertical:!0,...Aa}]],S=[[io,E=>{y(E,"horizontal")},void 0,{horizontal:!0,...Aa}]];function T(){const E={};return Ea.forEach(x=>{const L=s[x];E[x+"Position"]=L.position.value,E[x+"Percentage"]=L.percentage.value,E[x+"Size"]=L.size.value,E[x+"ContainerSize"]=a[x].value}),E}const M=zl(()=>{const E=T();E.ref=l,r("scroll",E)},0);function C(E,x,L){if(Ea.includes(E)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(E==="vertical"?no:Sn)(p.value,x,L)}function P({height:E,width:x}){let L=!1;a.vertical.value!==E&&(a.vertical.value=E,L=!0),a.horizontal.value!==x&&(a.horizontal.value=x,L=!0),L===!0&&le()}function O({position:E}){let x=!1;s.vertical.position.value!==E.top&&(s.vertical.position.value=E.top,x=!0),s.horizontal.position.value!==E.left&&(s.horizontal.position.value=E.left,x=!0),x===!0&&le()}function R({height:E,width:x}){s.horizontal.size.value!==x&&(s.horizontal.size.value=x,le()),s.vertical.size.value!==E&&(s.vertical.size.value=E,le())}function y(E,x){const L=s[x];if(E.isFirst===!0){if(L.thumbHidden.value===!0)return;f=L.position.value,i.value=!0}else if(i.value!==!0)return;E.isFinal===!0&&(i.value=!1);const re=Kn[x],he=a[x].value,Me=(L.size.value-he)/(he-L.thumbSize.value),d=E.distance[re.dist],g=f+(E.direction===re.dir?1:-1)*d*Me;ve(g,x)}function U(E,x){const L=s[x];if(L.thumbHidden.value!==!0){const re=E[Kn[x].offset];if(re<L.thumbStart.value||re>L.thumbStart.value+L.thumbSize.value){const he=re-L.thumbSize.value/2;ve(he/a[x].value*L.size.value,x)}L.ref.value!==null&&L.ref.value.dispatchEvent(new MouseEvent(E.type,E))}}function V(E){U(E,"vertical")}function de(E){U(E,"horizontal")}function le(){n.value=!0,c!==null&&clearTimeout(c),c=setTimeout(()=>{c=null,n.value=!1},e.delay),e.onScroll!==void 0&&M()}function ve(E,x){p.value[Kn[x].scroll]=E}function Oe(){o.value=!0}function ye(){o.value=!1}let we=null;return xe(()=>l.$q.lang.rtl,E=>{p.value!==null&&Sn(p.value,Math.abs(s.horizontal.position.value)*(E===!0?-1:1))}),Ca(()=>{we={top:s.vertical.position.value,left:s.horizontal.position.value}}),Ul(()=>{if(we===null)return;const E=p.value;E!==null&&(Sn(E,we.left),no(E,we.top))}),gt(M.cancel),Object.assign(l,{getScrollTarget:()=>p.value,getScroll:T,getScrollPosition:()=>({top:s.vertical.position.value,left:s.horizontal.position.value}),getScrollPercentage:()=>({top:s.vertical.percentage.value,left:s.horizontal.percentage.value}),setScrollPosition:C,setScrollPercentage(E,x,L){C(E,x*(s[E].size.value-a[E].value)*(E==="horizontal"&&l.$q.lang.rtl===!0?-1:1),L)}}),()=>te("div",{class:v.value,onMouseenter:Oe,onMouseleave:ye},[te("div",{ref:p,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[te("div",{class:"q-scrollarea__content absolute",style:h.value},Wl(t.default,[te(ro,{debounce:0,onResize:R})])),te(Zl,{axis:"both",onScroll:O})]),te(ro,{debounce:0,onResize:P}),te("div",{class:s.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:V}),te("div",{class:s.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:de}),Xt(te("div",{ref:s.vertical.ref,class:s.vertical.thumbClass.value,style:s.vertical.style.value,"aria-hidden":"true"}),w),Xt(te("div",{ref:s.horizontal.ref,class:s.horizontal.thumbClass.value,style:s.horizontal.style.value,"aria-hidden":"true"}),S)])}});const Ji=e=>(Hl("data-v-3dde9f4a"),e=e(),Gl(),e),Yv=Ji(()=>Se("div",{class:"text-h6"},"Your turn!",-1)),Jv=Ji(()=>Se("div",{class:"text-h6"},"Waiting for opponent...",-1)),Xv=Ji(()=>Se("div",{class:"text-h6"},"Game over!",-1)),Zv={"data-testid":"afen"},eg={"data-testid":"move-history",class:"col"},tg={key:0,class:"col-6"},rg={key:0,class:"col-6"},ng=Ie({__name:"game-sidebar",props:{moveHistory:{},activeColour:{},ownColour:{},afen:{},gameOver:{}},setup(e){const t=e,r=q(()=>{const a=[];return t.moveHistory.children.forEach(s=>{const l=a[a.length-1];if(!l||l.length!==1){a.push([s]);return}l.push(s)}),a}),n=B(null);xe(r,()=>{!n.value||n.value.setScrollPosition("vertical",r.value.length*36,1e3)}),ki(()=>{!n.value||n.value.setScrollPosition("vertical",r.value.length*36,1e3)});const{notify:i}=nu(),o=()=>{if(!!t.afen)try{navigator.clipboard.writeText(t.afen),i({message:"AFEN copied to clipboard",icon:"content_copy"})}catch{i({message:"Could not write to clipboard",icon:"close",iconColor:"red"})}};return(a,s)=>(I(),ae(Ta,{flat:"",square:"",class:"column justify-between no-wrap full-height","data-testid":"game-sidebar"},{default:K(()=>[Y(Jt,{mode:"out-in"},{default:K(()=>[!a.gameOver&&a.activeColour===a.ownColour?(I(),ae(He,{key:0,class:"bg-primary text-white","data-testid":"your-turn-indicator"},{default:K(()=>[Yv]),_:1})):a.gameOver?(I(),ae(He,{key:2,class:"bg-negative text-white q-mb-md","data-testid":"game-over-indicator"},{default:K(()=>[Xv]),_:1})):(I(),ae(He,{key:1,"data-testid":"waiting-for-opponent-indicator",class:"bg-grey text-black"},{default:K(()=>[Jv]),_:1}))]),_:1}),Pr(a.$slots,"default",{},void 0,!0),Se("div",Zv,[Y(Yn),Xt((I(),ae(Wr,{clickable:"",onClick:o},{default:K(()=>[Y(Zt,{class:"q-mt-sm q-mb-sm"},{default:K(()=>[Y(ao,null,{default:K(()=>[br("AFEN")]),_:1}),a.afen?(I(),ae(ao,{key:0,caption:"",lines:"2"},{default:K(()=>[br(Et(a.afen),1)]),_:1})):ce("",!0)]),_:1}),Y(Zt,{side:""},{default:K(()=>[Y(st,{name:"edit"})]),_:1})]),_:1})),[[Ai]])]),Se("div",eg,[Y(Yn),Y(se(Qv),{ref_key:"moveHistoryScrollArea",ref:n,class:"full-height"},{default:K(()=>[(I(!0),ne(pt,null,vt(r.value,(l,u)=>(I(),ae(He,{key:u,horizontal:"",class:Ve(["row q-py-none q-mx-md",{"q-pt-md":u===0,"q-pb-md":u===r.value.length-1}])},{default:K(()=>[l[0]?(I(),ne("div",tg,[Y(_a,{ripple:!1,class:Ve(["white-move",{highlight:l[0].kind!=="move"}])},{default:K(()=>[l[0].kind==="move"&&l[0].piece?(I(),ae(Nt,{key:0,piece:l[0].piece,allegiance:3,class:"chip-piece"},null,8,["piece"])):ce("",!0),br(" "+Et(se(pa).writeNode(l[0])),1)]),_:2},1032,["class"])])):ce("",!0),Y(Jt,{mode:"out-in"},{default:K(()=>[l[1]?(I(),ne("div",rg,[Y(_a,{ripple:!1,class:Ve(["black-move",{highlight:l[1].kind!=="move"}])},{default:K(()=>[l[1].kind==="move"&&l[1].piece?(I(),ae(Nt,{key:0,piece:l[1].piece,allegiance:0,class:"chip-piece"},null,8,["piece"])):ce("",!0),br(" "+Et(se(pa).writeNode(l[1])),1)]),_:2},1032,["class"])])):ce("",!0)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1},512)])]),_:3}))}});var $g=Xe(ng,[["__scopeId","data-v-3dde9f4a"]]),ig=or({name:"QCardActions",props:{...Vl,vertical:Boolean},setup(e,{slots:t}){const r=Kl(e),n=q(()=>`q-card__actions ${r.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>te("div",{class:n.value},Ei(t.default))}});let Or=0;const og={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},Oa={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]};var ag=or({name:"QDialog",inheritAttrs:!1,props:{...xa,...yl,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,position:{type:String,default:"standard",validator:e=>e==="standard"||["top","bottom","left","right"].includes(e)}},emits:[...qa,"shake","click","escapeKey"],setup(e,{slots:t,emit:r,attrs:n}){const i=It(),o=B(null),a=B(!1),s=B(!1);let l=null,u=null,c,f;const p=q(()=>e.persistent!==!0&&e.noRouteDismiss!==!0&&e.seamless!==!0),{preventBodyScroll:v}=tu(),{registerTimeout:h}=Ia(),{registerTick:w,removeTick:S}=wl(),{transitionProps:T,transitionStyle:M}=bl(e,()=>Oa[e.position][0],()=>Oa[e.position][1]),{showPortal:C,hidePortal:P,portalIsAccessible:O,renderPortal:R}=ml(i,o,b,"dialog"),{hide:y}=Da({showing:a,hideOnRouteChange:p,handleShow:ye,handleHide:we,processOnMount:!0}),{addToHistory:U,removeFromHistory:V}=eu(a,y,p),de=q(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${e.maximized===!0?"maximized":"minimized"} q-dialog__inner--${e.position} ${og[e.position]}`+(s.value===!0?" q-dialog__inner--animating":"")+(e.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(e.fullHeight===!0?" q-dialog__inner--fullheight":"")+(e.square===!0?" q-dialog__inner--square":"")),le=q(()=>a.value===!0&&e.seamless!==!0),ve=q(()=>e.autoClose===!0?{onClick:Me}:{}),Oe=q(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${le.value===!0?"modal":"seamless"}`,n.class]);xe(()=>e.maximized,_=>{a.value===!0&&he(_)}),xe(le,_=>{v(_),_===!0?(El(g),kl(L)):(yi(g),tn(L))});function ye(_){U(),u=e.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,he(e.maximized),C(),s.value=!0,e.noFocus!==!0?(document.activeElement!==null&&document.activeElement.blur(),w(E)):S(),h(()=>{if(i.proxy.$q.platform.is.ios===!0){if(e.seamless!==!0&&document.activeElement){const{top:N,bottom:F}=document.activeElement.getBoundingClientRect(),{innerHeight:D}=window,A=window.visualViewport!==void 0?window.visualViewport.height:D;N>0&&F>A/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-A,F>=D?1/0:Math.ceil(document.scrollingElement.scrollTop+F-A/2))),document.activeElement.scrollIntoView()}f=!0,o.value.click(),f=!1}C(!0),s.value=!1,r("show",_)},e.transitionDuration)}function we(_){S(),V(),re(!0),s.value=!0,P(),u!==null&&(((_&&_.type.indexOf("key")===0?u.closest('[tabindex]:not([tabindex^="-"])'):void 0)||u).focus(),u=null),h(()=>{P(!0),s.value=!1,r("hide",_)},e.transitionDuration)}function E(_){La(()=>{let N=o.value;N===null||N.contains(document.activeElement)===!0||(N=(_!==""?N.querySelector(_):null)||N.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||N.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||N.querySelector("[autofocus], [data-autofocus]")||N,N.focus({preventScroll:!0}))})}function x(_){_&&typeof _.focus=="function"?_.focus({preventScroll:!0}):E(),r("shake");const N=o.value;N!==null&&(N.classList.remove("q-animate--scale"),N.classList.add("q-animate--scale"),l!==null&&clearTimeout(l),l=setTimeout(()=>{l=null,o.value!==null&&(N.classList.remove("q-animate--scale"),E())},170))}function L(){e.seamless!==!0&&(e.persistent===!0||e.noEscDismiss===!0?e.maximized!==!0&&e.noShake!==!0&&x():(r("escapeKey"),y()))}function re(_){l!==null&&(clearTimeout(l),l=null),(_===!0||a.value===!0)&&(he(!1),e.seamless!==!0&&(v(!1),yi(g),tn(L))),_!==!0&&(u=null)}function he(_){_===!0?c!==!0&&(Or<1&&document.body.classList.add("q-body--dialog"),Or++,c=!0):c===!0&&(Or<2&&document.body.classList.remove("q-body--dialog"),Or--,c=!1)}function Me(_){f!==!0&&(y(_),r("click",_))}function d(_){e.persistent!==!0&&e.noBackdropDismiss!==!0?y(_):e.noShake!==!0&&x()}function g(_){e.allowFocusOutside!==!0&&O.value===!0&&Na(o.value,_.target)!==!0&&E('[tabindex]:not([tabindex="-1"])')}Object.assign(i.proxy,{focus:E,shake:x,__updateRefocusTarget(_){u=_||null}}),gt(re);function b(){return te("div",{role:"dialog","aria-modal":le.value===!0?"true":"false",...n,class:Oe.value},[te(Jt,{name:"q-transition--fade",appear:!0},()=>le.value===!0?te("div",{class:"q-dialog__backdrop fixed-full",style:M.value,"aria-hidden":"true",tabindex:-1,onClick:d}):null),te(Jt,T.value,()=>a.value===!0?te("div",{ref:o,class:de.value,style:M.value,tabindex:-1,...ve.value},Ei(t.default)):null)])}return R}});function Pa(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}var sg=Ql({name:"close-popup",beforeMount(e,{value:t}){const r={depth:Pa(t),handler(n){r.depth!==0&&setTimeout(()=>{const i=yv(e);i!==void 0&&bv(i,n,r.depth)})},handlerKey(n){Si(n,13)===!0&&r.handler(n)}};e.__qclosepopup=r,e.addEventListener("click",r.handler),e.addEventListener("keyup",r.handlerKey)},updated(e,{value:t,oldValue:r}){t!==r&&(e.__qclosepopup.depth=Pa(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}});const lg={key:0},ug={key:1},cg={key:2},fg={key:0,class:"text-subtitle1 text-center"},dg=Ie({__name:"game-over-dialog",props:{node:{}},setup(e){return(t,r)=>(I(),ae(ag,{"model-value":!0,persistent:"",position:"bottom"},{default:K(()=>[Y(Ta,{class:"my-card game-over-dialog"},{default:K(()=>[Y(He,{class:"bg-primary text-h5 row justify-between"},{default:K(()=>[t.node.outcome==="white"?(I(),ne("span",lg,"White wins!")):ce("",!0),t.node.outcome==="black"?(I(),ne("span",ug,"Black wins!")):ce("",!0),t.node.outcome==="draw"?(I(),ne("span",cg,"Draw!")):ce("",!0),Xt(Y(to,{icon:"close",flat:"",round:"",dense:""},null,512),[[sg]])]),_:1}),Y(He,{class:"row justify-center"},{default:K(()=>[t.node.outcome==="white"?(I(),ae(Nt,{key:0,allegiance:se($e).White,piece:"K",size:96},null,8,["allegiance"])):ce("",!0),t.node.outcome==="black"?(I(),ae(Nt,{key:1,allegiance:se($e).Black,piece:"K",size:96},null,8,["allegiance"])):ce("",!0),t.node.outcome==="draw"?(I(),ae(st,{key:2,name:"balance",size:"96px",color:"grey"})):ce("",!0)]),_:1}),Y(He,{class:"q-pt-none"},{default:K(()=>[t.node.reason?(I(),ne("div",fg,Et(t.node.reason),1)):ce("",!0)]),_:1}),Y(Yn),Y(ig,{align:"right"},{default:K(()=>[Y(to,{color:"secondary","text-color":"primary",label:"New game",to:"/play"})]),_:1})]),_:1})]),_:1}))}});var xg=Xe(dg,[["__scopeId","data-v-fc28b0e2"]]);function hg(){return new Worker("/assets/bot-worker.3735c325.js",{type:"module"})}var pg="/assets/navigation_backward-selection-minimal.5c6fba09.ogg",vg="/assets/navigation_hover-tap.713baf32.ogg",gg="/assets/navigation-cancel.92012997.ogg",mg="/assets/ui_refresh-feed.44b5b5d7.ogg",yg="/assets/ui_tap-variant-01.21f59a16.ogg";const bg=()=>{if(typeof window=="undefined")return null;const e=new Audio(pg),t=new Audio(vg),r=new Audio(gg),n=new Audio(mg),i=new Audio(yg);return{playNode:async a=>{try{if(a.kind==="game-over")return await e.play();if(a.kind!=="move")return;switch(a.type){default:return await i.play();case"capture":case"en-passant":return await r.play();case"allegiance":return await t.play();case"castle":case"promotion":return await n.play()}}catch(s){s instanceof Error&&iu({level:"log",extra:{...s},message:"Cannot play audio",type:"replay_event"})}}}},qg=e=>{const t=B(),r=B(!1),n=B(!0),i=B(""),o=B(""),a=B("white"),s=B(0),l=B([]),u=B([]),c=B(null),f=B({kind:"root",children:[]}),p=B([]),v=B(null),h=bg(),w=q(()=>{if(l.value.length!==1)return null;const O=l.value[0];return!O||O.kind!=="game-over"?null:O}),S=O=>{var y;const R=O.data;switch(R.type){case"board-update":o.value=R.moveHistory,i.value=R.afen,a.value=R.activeColour,s.value=R.boardScore,l.value=R.validMoves,u.value=R.checkMoves,c.value=R.enPassantTarget,f.value=R.moveHistoryAst,p.value=R.squares,R.openings.length===1&&!v.value&&(v.value=R.openings[0]),n.value=!1;break;case"node-execution":h==null||h.playNode(R.node);break;case"ready":r.value=!0;break}R.type==="board-update"&&e.autoplayFor.value.includes(R.activeColour)&&!w.value&&(n.value=!0,(y=t.value)==null||y.postMessage({type:"bot-move"}))};return ki(()=>{t.value=new hg,t.value.addEventListener("message",S)}),gt(()=>{var R,y;(R=t.value)==null||R.removeEventListener("message",S);const O={type:"reset"};(y=t.value)==null||y.postMessage(O)}),{ready:r,loading:n,afen:i,moveHistory:o,moveHistoryAst:f,activeColour:a,boardScore:s,validMoves:l,checkMoves:u,enPassantTarget:c,squares:p,gameOver:w,executeMoveIndex:O=>{var y;n.value=!0;const R={type:"execute-move-index",index:O};(y=t.value)==null||y.postMessage(R)},importAfen:O=>{var y;n.value=!0;const R={type:"import-afen",afen:O};(y=t.value)==null||y.postMessage(R)},importMoveHistory:O=>{var y;n.value=!0;const R={type:"import-move-history",history:O};(y=t.value)==null||y.postMessage(R)},reset:()=>{var R;n.value=!0;const O={type:"reset"};(R=t.value)==null||R.postMessage(O)},opening:v}};export{Mg as C,$g as G,Ng as _,xg as a,qg as u};
//# sourceMappingURL=board-worker.f38206e2.js.map
