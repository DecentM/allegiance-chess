import{a as J,Q as ue,b as St}from"./QCard.48cbf7da.js";import{G as zt,p as wt,t as kt,w as qt,b as Ct,c as R,i as qe,a as $t,f as Oe}from"./board.68ecb5dd.js";import{C as K,D as m,G as k,M as O,I as Q,_ as ne,r as M,a9 as nt,a3 as Qe,q as st,a1 as Re,w as Y,p as rt,o as fe,j as he,a6 as Pt,m as Te,as as Ce,A as Mt,an as Tt,h as F,at as Et,au as Ht,av as Ft,a as p,X as ut,Y as xt,k as Be,c as Ae,a5 as Bt,e as At,aa as Ee,aw as Lt,s as ct,E as D,F as P,J as $,Q as ce,S as U,ac as H,R as W,P as de,ae as L,K as ae,L as oe,ax as Dt,ay as Wt,u as Ot,az as Qt,aA as Rt,am as jt,ap as Vt,B as Nt,t as je,af as Kt,ag as Gt}from"./index.d8dd3e6c.js";import{b as He,a as Fe,Q as dt}from"./QList.912d51d6.js";import{j as Ut,f as Yt,u as Xt,b as Jt,c as Zt,d as It,k as el,e as be,Q as Ve,i as tl,s as Ne,l as $e,T as Ke}from"./QScrollObserver.fa50fdfe.js";import{u as Le,a as De}from"./use-dark.c02bd21a.js";import{b as Ge,c as ll,a as al}from"./focus-manager.202af5b7.js";import{C as ye}from"./chess-piece.f3528f6f.js";var Ue=Object.freeze(Object.defineProperty({__proto__:null,GameOutcome:zt,parse:wt,tokenize:kt,writeNode:qt,write:Ct},Symbol.toStringTag,{value:"Module"}));const ol={class:"row column full-width full-height no-pointer-events background-layer","data-testid":"background"},il=K({__name:"background-layer",props:{ranks:{},files:{}},setup(e){return(o,a)=>(m(),k("div",ol,[(m(!0),k(O,null,Q(o.ranks,(t,n)=>(m(),k("div",{class:"rank col row full-width",key:n},[(m(!0),k(O,null,Q(o.files,(s,i)=>(m(),k("div",{key:i,class:"file col"}))),128))]))),128))]))}});var nl=ne(il,[["__scopeId","data-v-482c5e27"]]);const sl={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function rl({showing:e,avoidEmit:o,configureAnchorEl:a}){const{props:t,proxy:n,emit:s}=he(),i=M(null);let l=null;function d(r){return i.value===null?!1:r===void 0||r.touches===void 0||r.touches.length<=1}const v={};a===void 0&&(Object.assign(v,{hide(r){n.hide(r)},toggle(r){n.toggle(r),r.qAnchorHandled=!0},toggleKey(r){nt(r,13)===!0&&v.toggle(r)},contextClick(r){n.hide(r),Qe(r),st(()=>{n.show(r),r.qAnchorHandled=!0})},prevent:Qe,mobileTouch(r){if(v.mobileCleanup(r),d(r)!==!0)return;n.hide(r),i.value.classList.add("non-selectable");const g=r.target;Re(v,"anchor",[[g,"touchmove","mobileCleanup","passive"],[g,"touchend","mobileCleanup","passive"],[g,"touchcancel","mobileCleanup","passive"],[i.value,"contextmenu","prevent","notPassive"]]),l=setTimeout(()=>{l=null,n.show(r),r.qAnchorHandled=!0},300)},mobileCleanup(r){i.value.classList.remove("non-selectable"),l!==null&&(clearTimeout(l),l=null),e.value===!0&&r!==void 0&&Ut()}}),a=function(r=t.contextMenu){if(t.noParentEvent===!0||i.value===null)return;let g;r===!0?n.$q.platform.is.mobile===!0?g=[[i.value,"touchstart","mobileTouch","passive"]]:g=[[i.value,"mousedown","hide","passive"],[i.value,"contextmenu","contextClick","notPassive"]]:g=[[i.value,"click","toggle","passive"],[i.value,"keyup","toggleKey","passive"]],Re(v,"anchor",g)});function h(){Pt(v,"anchor")}function y(r){for(i.value=r;i.value.classList.contains("q-anchor--skip");)i.value=i.value.parentNode;a()}function q(){if(t.target===!1||t.target===""||n.$el.parentNode===null)i.value=null;else if(t.target===!0)y(n.$el.parentNode);else{let r=t.target;if(typeof t.target=="string")try{r=document.querySelector(t.target)}catch{r=void 0}r!=null?(i.value=r.$el||r,a()):(i.value=null,console.error(`Anchor: target "${t.target}" not found`))}}return Y(()=>t.contextMenu,r=>{i.value!==null&&(h(),a(r))}),Y(()=>t.target,()=>{i.value!==null&&h(),q()}),Y(()=>t.noParentEvent,r=>{i.value!==null&&(r===!0?h():a())}),rt(()=>{q(),o!==!0&&t.modelValue===!0&&i.value===null&&s("update:modelValue",!1)}),fe(()=>{l!==null&&clearTimeout(l),h()}),{anchorEl:i,canShow:d,anchorEvents:v}}function ul(e,o){const a=M(null);let t;function n(l,d){const v=`${d!==void 0?"add":"remove"}EventListener`,h=d!==void 0?d:t;l!==window&&l[v]("scroll",h,Te.passive),window[v]("scroll",h,Te.passive),t=d}function s(){a.value!==null&&(n(a.value),a.value=null)}const i=Y(()=>e.noParentEvent,()=>{a.value!==null&&(s(),o())});return fe(i),{localScrollTarget:a,unconfigureScrollTarget:s,changeScrollEvent:n}}const ve=[];function cl(e,o){do{if(e.$options.name==="QMenu"){if(e.hide(o),e.$props.separateClosePopup===!0)return Ce(e)}else if(e.__qPortal===!0){const a=Ce(e);return a!==void 0&&a.$options.name==="QPopupProxy"?(e.hide(o),a):e}e=Ce(e)}while(e!=null)}function dl(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function vl(e,o,a,t){const n=M(!1),s=M(!1);let i=null;const l={},d=t==="dialog"&&dl(e);function v(y){if(y===!0){Ge(l),s.value=!0;return}s.value=!1,n.value===!1&&(d===!1&&i===null&&(i=Ht(!1,t)),n.value=!0,ve.push(e.proxy),ll(l))}function h(y){if(s.value=!1,y!==!0)return;Ge(l),n.value=!1;const q=ve.indexOf(e.proxy);q!==-1&&ve.splice(q,1),i!==null&&(Ft(i),i=null)}return Mt(()=>{h(!0)}),e.proxy.__qPortal=!0,Tt(e.proxy,"contentEl",()=>o.value),{showPortal:v,hidePortal:h,portalIsActive:n,portalIsAccessible:s,renderPortal:()=>d===!0?a():n.value===!0?[F(Et,{to:i},a())]:void 0}}const fl={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function hl(e,o=()=>{},a=()=>{}){return{transitionProps:p(()=>{const t=`q-transition--${e.transitionShow||o()}`,n=`q-transition--${e.transitionHide||a()}`;return{appear:!0,enterFromClass:`${t}-enter-from`,enterActiveClass:`${t}-enter-active`,enterToClass:`${t}-enter-to`,leaveFromClass:`${n}-leave-from`,leaveActiveClass:`${n}-leave-active`,leaveToClass:`${n}-leave-to`}}),transitionStyle:p(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}function ml(){let e;const o=he();function a(){e=void 0}return ut(a),fe(a),{removeTick:a,registerTick(t){e=t,st(()=>{e===t&&(xt(o)===!1&&e(),e=void 0)})}}}const Z=[];let ie;function pl(e){ie=e.keyCode===27}function gl(){ie===!0&&(ie=!1)}function bl(e){ie===!0&&(ie=!1,nt(e,27)===!0&&Z[Z.length-1](e))}function vt(e){window[e]("keydown",pl),window[e]("blur",gl),window[e]("keyup",bl),ie=!1}function yl(e){Be.is.desktop===!0&&(Z.push(e),Z.length===1&&vt("addEventListener"))}function Ye(e){const o=Z.indexOf(e);o>-1&&(Z.splice(o,1),Z.length===0&&vt("removeEventListener"))}const I=[];function ft(e){I[I.length-1](e)}function _l(e){Be.is.desktop===!0&&(I.push(e),I.length===1&&document.body.addEventListener("focusin",ft))}function Sl(e){const o=I.indexOf(e);o>-1&&(I.splice(o,1),I.length===0&&document.body.removeEventListener("focusin",ft))}const{notPassiveCapture:_e}=Te,ee=[];function Se(e){const o=e.target;if(o===void 0||o.nodeType===8||o.classList.contains("no-pointer-events")===!0)return;let a=ve.length-1;for(;a>=0;){const t=ve[a].$;if(t.type.name==="QTooltip"){a--;continue}if(t.type.name!=="QDialog")break;if(t.props.seamless!==!0)return;a--}for(let t=ee.length-1;t>=0;t--){const n=ee[t];if((n.anchorEl.value===null||n.anchorEl.value.contains(o)===!1)&&(o===document.body||n.innerRef.value!==null&&n.innerRef.value.contains(o)===!1))e.qClickOutside=!0,n.onClickOutside(e);else return}}function zl(e){ee.push(e),ee.length===1&&(document.addEventListener("mousedown",Se,_e),document.addEventListener("touchstart",Se,_e))}function Xe(e){const o=ee.findIndex(a=>a===e);o>-1&&(ee.splice(o,1),ee.length===0&&(document.removeEventListener("mousedown",Se,_e),document.removeEventListener("touchstart",Se,_e)))}let Je,Ze;function Ie(e){const o=e.split(" ");return o.length!==2?!1:["top","center","bottom"].includes(o[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(o[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function wl(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const xe={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{xe[`${e}#ltr`]=e,xe[`${e}#rtl`]=e});function et(e,o){const a=e.split(" ");return{vertical:a[0],horizontal:xe[`${a[1]}#${o===!0?"rtl":"ltr"}`]}}function kl(e,o){let{top:a,left:t,right:n,bottom:s,width:i,height:l}=e.getBoundingClientRect();return o!==void 0&&(a-=o[1],t-=o[0],s+=o[1],n+=o[0],i+=o[0],l+=o[1]),{top:a,bottom:s,height:l,left:t,right:n,width:i,middle:t+(n-t)/2,center:a+(s-a)/2}}function ql(e,o,a){let{top:t,left:n}=e.getBoundingClientRect();return t+=o.top,n+=o.left,a!==void 0&&(t+=a[1],n+=a[0]),{top:t,bottom:t+1,height:1,left:n,right:n+1,width:1,middle:n,center:t}}function Cl(e,o){return{top:0,center:o/2,bottom:o,left:0,middle:e/2,right:e}}function tt(e,o,a,t){return{top:e[a.vertical]-o[t.vertical],left:e[a.horizontal]-o[t.horizontal]}}function ht(e,o=0){if(e.targetEl===null||e.anchorEl===null||o>5)return;if(e.targetEl.offsetHeight===0||e.targetEl.offsetWidth===0){setTimeout(()=>{ht(e,o+1)},10);return}const{targetEl:a,offset:t,anchorEl:n,anchorOrigin:s,selfOrigin:i,absoluteOffset:l,fit:d,cover:v,maxHeight:h,maxWidth:y}=e;if(Be.is.ios===!0&&window.visualViewport!==void 0){const E=document.body.style,{offsetLeft:_,offsetTop:T}=window.visualViewport;_!==Je&&(E.setProperty("--q-pe-left",_+"px"),Je=_),T!==Ze&&(E.setProperty("--q-pe-top",T+"px"),Ze=T)}const{scrollLeft:q,scrollTop:r}=a,g=l===void 0?kl(n,v===!0?[0,0]:t):ql(n,l,t);Object.assign(a.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:y||"100vw",maxHeight:h||"100vh",visibility:"visible"});const{offsetWidth:B,offsetHeight:f}=a,{elWidth:A,elHeight:N}=d===!0||v===!0?{elWidth:Math.max(g.width,B),elHeight:v===!0?Math.max(g.height,f):f}:{elWidth:B,elHeight:f};let x={maxWidth:y,maxHeight:h};(d===!0||v===!0)&&(x.minWidth=g.width+"px",v===!0&&(x.minHeight=g.height+"px")),Object.assign(a.style,x);const c=Cl(A,N);let S=tt(g,c,s,i);if(l===void 0||t===void 0)Pe(S,g,c,s,i);else{const{top:E,left:_}=S;Pe(S,g,c,s,i);let T=!1;if(S.top!==E){T=!0;const w=2*t[1];g.center=g.top-=w,g.bottom-=w+2}if(S.left!==_){T=!0;const w=2*t[0];g.middle=g.left-=w,g.right-=w+2}T===!0&&(S=tt(g,c,s,i),Pe(S,g,c,s,i))}x={top:S.top+"px",left:S.left+"px"},S.maxHeight!==void 0&&(x.maxHeight=S.maxHeight+"px",g.height>S.maxHeight&&(x.minHeight=x.maxHeight)),S.maxWidth!==void 0&&(x.maxWidth=S.maxWidth+"px",g.width>S.maxWidth&&(x.minWidth=x.maxWidth)),Object.assign(a.style,x),a.scrollTop!==r&&(a.scrollTop=r),a.scrollLeft!==q&&(a.scrollLeft=q)}function Pe(e,o,a,t,n){const s=a.bottom,i=a.right,l=Yt(),d=window.innerHeight-l,v=document.body.clientWidth;if(e.top<0||e.top+s>d)if(n.vertical==="center")e.top=o[t.vertical]>d/2?Math.max(0,d-s):0,e.maxHeight=Math.min(s,d);else if(o[t.vertical]>d/2){const h=Math.min(d,t.vertical==="center"?o.center:t.vertical===n.vertical?o.bottom:o.top);e.maxHeight=Math.min(s,h),e.top=Math.max(0,h-s)}else e.top=Math.max(0,t.vertical==="center"?o.center:t.vertical===n.vertical?o.top:o.bottom),e.maxHeight=Math.min(s,d-e.top);if(e.left<0||e.left+i>v)if(e.maxWidth=Math.min(i,v),n.horizontal==="middle")e.left=o[t.horizontal]>v/2?Math.max(0,v-i):0;else if(o[t.horizontal]>v/2){const h=Math.min(v,t.horizontal==="middle"?o.middle:t.horizontal===n.horizontal?o.right:o.left);e.maxWidth=Math.min(i,h),e.left=Math.max(0,h-e.maxWidth)}else e.left=Math.max(0,t.horizontal==="middle"?o.middle:t.horizontal===n.horizontal?o.left:o.right),e.maxWidth=Math.min(i,v-e.left)}var mt=Ae({name:"QMenu",inheritAttrs:!1,props:{...sl,...Xt,...Le,...fl,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:Ie},self:{type:String,validator:Ie},offset:{type:Array,validator:wl},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...Jt,"click","escapeKey"],setup(e,{slots:o,emit:a,attrs:t}){let n=null,s,i,l;const d=he(),{proxy:v}=d,{$q:h}=v,y=M(null),q=M(!1),r=p(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),g=De(e,h),{registerTick:B,removeTick:f}=ml(),{registerTimeout:A}=Zt(),{transitionProps:N,transitionStyle:x}=hl(e),{localScrollTarget:c,changeScrollEvent:S,unconfigureScrollTarget:E}=ul(e,ge),{anchorEl:_,canShow:T}=rl({showing:q}),{hide:w}=It({showing:q,canShow:T,handleShow:le,handleHide:ze,hideOnRouteChange:r,processOnMount:!0}),{showPortal:X,hidePortal:V,renderPortal:G}=vl(d,y,bt,"menu"),se={anchorEl:_,innerRef:y,onClickOutside(z){if(e.persistent!==!0&&q.value===!0)return w(z),(z.type==="touchstart"||z.target.classList.contains("q-dialog__backdrop"))&&ct(z),!0}},me=p(()=>et(e.anchor||(e.cover===!0?"center middle":"bottom start"),h.lang.rtl)),te=p(()=>e.cover===!0?me.value:et(e.self||"top start",h.lang.rtl)),u=p(()=>(e.square===!0?" q-menu--square":"")+(g.value===!0?" q-menu--dark q-dark":"")),b=p(()=>e.autoClose===!0?{onClick:gt}:{}),C=p(()=>q.value===!0&&e.persistent!==!0);Y(C,z=>{z===!0?(yl(we),zl(se)):(Ye(we),Xe(se))});function j(){al(()=>{let z=y.value;z&&z.contains(document.activeElement)!==!0&&(z=z.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||z.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||z.querySelector("[autofocus], [data-autofocus]")||z,z.focus({preventScroll:!0}))})}function le(z){if(n=e.noRefocus===!1?document.activeElement:null,_l(We),X(),ge(),s=void 0,z!==void 0&&(e.touchPosition||e.contextMenu)){const ke=Bt(z);if(ke.left!==void 0){const{top:yt,left:_t}=_.value.getBoundingClientRect();s={left:ke.left-_t,top:ke.top-yt}}}i===void 0&&(i=Y(()=>h.screen.width+"|"+h.screen.height+"|"+e.self+"|"+e.anchor+"|"+h.lang.rtl,re)),e.noFocus!==!0&&document.activeElement.blur(),B(()=>{re(),e.noFocus!==!0&&j()}),A(()=>{h.platform.is.ios===!0&&(l=e.autoClose,y.value.click()),re(),X(!0),a("show",z)},e.transitionDuration)}function ze(z){f(),V(),pe(!0),n!==null&&(z===void 0||z.qClickOutside!==!0)&&(((z&&z.type.indexOf("key")===0?n.closest('[tabindex]:not([tabindex^="-"])'):void 0)||n).focus(),n=null),A(()=>{V(!0),a("hide",z)},e.transitionDuration)}function pe(z){s=void 0,i!==void 0&&(i(),i=void 0),(z===!0||q.value===!0)&&(Sl(We),E(),Xe(se),Ye(we)),z!==!0&&(n=null)}function ge(){(_.value!==null||e.scrollTarget!==void 0)&&(c.value=el(_.value,e.scrollTarget),S(c.value,re))}function gt(z){l!==!0?(cl(v,z),a("click",z)):l=!1}function We(z){C.value===!0&&e.noFocus!==!0&&Lt(y.value,z.target)!==!0&&j()}function we(z){a("escapeKey"),w(z)}function re(){ht({targetEl:y.value,offset:e.offset,anchorEl:_.value,anchorOrigin:me.value,selfOrigin:te.value,absoluteOffset:s,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function bt(){return F(Ee,N.value,()=>q.value===!0?F("div",{role:"menu",...t,ref:y,tabindex:-1,class:["q-menu q-position-engine scroll"+u.value,t.class],style:[t.style,x.value],...b.value},At(o.default)):null)}return fe(pe),Object.assign(v,{focus:j,updatePosition:re}),G}});const $l=K({__name:"promotion-selector",props:{modelValue:{type:Boolean},allegiance:{}},emits:["click","dismiss"],setup(e,{emit:o}){const a=["Q","N","R","B"],t=()=>{o("dismiss")};return(n,s)=>(m(),D(mt,{cover:"","model-value":n.modelValue,"onUpdate:modelValue":t},{default:P(()=>[$(dt,null,{default:P(()=>[(m(),k(O,null,Q(a,i=>$(He,{clickable:"",key:i,class:"q-pa-sm",onClick:l=>o("click",i)},{default:P(()=>[$(Fe,{class:"promotion-piece items-center"},{default:P(()=>[$(ye,{allegiance:n.allegiance,piece:i,size:92},null,8,["allegiance","piece"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1},8,["model-value"]))}});var Pl=ne($l,[["__scopeId","data-v-370c2c26"]]);const Ml=K({__name:"capture-selector",props:{modelValue:{type:Boolean},moves:{}},emits:["click","dismiss"],setup(e,{emit:o}){const a=()=>{o("dismiss")};return(t,n)=>(m(),D(mt,{cover:"","model-value":t.modelValue,"onUpdate:modelValue":a},{default:P(()=>[$(dt,null,{default:P(()=>[t.moves.includes("x")?(m(),D(He,{key:0,clickable:"",onClick:n[0]||(n[0]=s=>o("click","capture")),class:"q-py-lg"},{default:P(()=>[$(Fe,{class:"items-center"},{default:P(()=>[$(ce,{size:"72px",name:"close"})]),_:1})]),_:1})):U("",!0),t.moves.includes(">")?(m(),D(He,{key:1,clickable:"",onClick:n[1]||(n[1]=s=>o("click","challenge")),class:"q-py-lg"},{default:P(()=>[$(Fe,{class:"items-center"},{default:P(()=>[$(ce,{size:"64px",name:"arrow_forward_ios"})]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1},8,["model-value"]))}});const Tl={class:"relative-position full-width full-height interaction-layer"},El=["onClick"],Hl=K({__name:"interaction-layer",props:{board:{},squareSize:{},ranks:{},files:{},perspective:{},pieceFocus:{}},emits:["execute-node","update-piece-focus","update-highlights"],setup(e,{emit:o}){const a=e,t=M(null),n=p(()=>a.board.enPassantTarget),s=M(null),i=M(null),l=p(()=>a.pieceFocus?a.board.getSquare(a.pieceFocus):null),d=p(()=>a.pieceFocus?a.board.getValidMoves(a.pieceFocus).map(E=>E.kind!=="move"?null:E.to).filter(Boolean):[]),v=c=>{const S=a.board.getSquare(c);return S?$t(S.allegiance)!==a.perspective:!1},h=c=>d.value.some(S=>S&&R(c,S)),y=(c,S)=>{var _,T;if(S.stopPropagation(),S.preventDefault(),h(c)&&a.pieceFocus&&l.value){if(n.value&&R(n.value,c))o("execute-node",{kind:"move",type:"en-passant",from:a.pieceFocus,to:c}),o("update-piece-focus",null);else if(qe(c,a.board.activeColour)&&l&&l.value.piece===null){s.value=c;const w=a.board.getSquare(a.pieceFocus);i.value=(_=w==null?void 0:w.allegiance)!=null?_:null}else a.board.getSquare(c)?t.value=c:((T=l.value)==null?void 0:T.piece)==="K"&&Math.abs(a.pieceFocus.file-c.file)>1?o("execute-node",{kind:"move",type:"castle",side:c.file===7?"king":"queen",from:a.pieceFocus,to:c}):o("execute-node",{kind:"move",from:a.pieceFocus,to:c});return}if(v(c))return;const E=a.board.getSquare(c);o("update-piece-focus",E?c:null)},q=(c,S)=>{!a.pieceFocus||(s.value=null,o("execute-node",{kind:"move",type:"promotion",from:a.pieceFocus,to:c,promotionTo:S}),o("update-piece-focus",null))},r=()=>{s.value=null,i.value=null},g=()=>{t.value=null},B=c=>{!a.pieceFocus||!t.value||(c==="capture"?o("execute-node",{kind:"move",type:"capture",from:a.pieceFocus,to:t.value}):o("execute-node",{kind:"move",type:"allegiance",from:a.pieceFocus,to:t.value}),t.value=null,o("update-piece-focus",null))},f=(c,S)=>{const E=c+1,_=S+1;return a.perspective==="white"?{file:E,rank:9-_}:{file:9-E,rank:_}},A=c=>!a.board.getSquare(c),N=(c,S,E)=>a.board.getValidMoves().some(T=>T.kind==="move"&&R(T.to,E)&&R(T.from,S)&&T.type===c),x=p(()=>{const c=[];return!a.pieceFocus||!t.value||(N("allegiance",a.pieceFocus,t.value)&&c.push(">"),N("capture",a.pieceFocus,t.value)&&c.push("x")),c});return(c,S)=>(m(),k("div",Tl,[(m(!0),k(O,null,Q(c.ranks,(E,_)=>(m(),k("div",{class:"col column row full-width",key:_},[(m(!0),k(O,null,Q(c.files,(T,w)=>{var X,V;return m(),k("div",{key:w,class:"full-height"},[H("div",{class:de(["absolute",{"cursor-pointer":!A(f(w,_))||h(f(w,_)),"cursor-not-allowed":v(f(w,_))&&!l.value}]),onClick:G=>y(f(w,_),G),style:L(c.perspective==="white"?{width:`${c.squareSize}px`,height:`${c.squareSize}px`,left:`${(f(w,_).file-1)*c.squareSize}px`,bottom:`${(f(w,_).rank-1)*c.squareSize}px`}:{width:`${c.squareSize}px`,height:`${c.squareSize}px`,right:`${(f(w,_).file-1)*c.squareSize}px`,top:`${(f(w,_).rank-1)*c.squareSize}px`})},[t.value&&W(R)(t.value,f(w,_))?(m(),D(Ml,{key:0,moves:x.value,"model-value":(X=W(R)(t.value,f(w,_)))!=null?X:!1,size:c.squareSize,onClick:B,onDismiss:g},null,8,["moves","model-value","size"])):U("",!0),i.value!==null&&(W(qe)(f(w,_),"white")||W(qe)(f(w,_),"black"))?(m(),D(Pl,{key:1,"model-value":(V=W(R)(s.value,f(w,_)))!=null?V:!1,allegiance:i.value,size:c.squareSize,onClick:G=>q(f(w,_),G),onDismiss:r},null,8,["model-value","allegiance","size","onClick"])):U("",!0)],14,El)])}),128))]))),128))]))}});var Fl=ne(Hl,[["__scopeId","data-v-7c6505e4"]]);const xl={class:"relative-position full-width full-height column no-pointer-events indicators-layer"},Bl=K({__name:"indicators-layer",props:{board:{},ranks:{},files:{},squareSize:{},perspective:{},pieceFocus:{},lastMove:{}},setup(e){const o=e,a=p(()=>o.pieceFocus?o.board.getValidMoves(o.pieceFocus).map(h=>h.kind!=="move"?null:h.to).filter(Boolean):[]),t=d=>a.value.some(v=>v&&R(d,v)),n=d=>!o.board.getSquare(d),s=(d,v)=>{const h=d+1,y=v+1;return o.perspective==="white"?{file:h,rank:9-y}:{file:9-h,rank:y}},i=p(()=>o.board.getCheckMoves()),l=d=>i.value.some(v=>v.kind==="move"&&R(v.to,d));return(d,v)=>(m(),k("div",xl,[(m(!0),k(O,null,Q(d.ranks,(h,y)=>(m(),k("div",{class:"col column row full-width",key:y},[(m(!0),k(O,null,Q(d.files,(q,r)=>{var g,B;return m(),k("div",{key:r,class:de(["full-height move-placeholder",{even:y%2===0?r%2===0:r%2!==0,focus:W(R)(d.pieceFocus,s(r,y)),show:t(s(r,y)),capture:!n(s(r,y)),target:n(s(r,y)),checked:l(s(r,y)),"last-from":((g=d.lastMove)==null?void 0:g.kind)==="move"&&W(R)(d.lastMove.from,s(r,y)),"last-to":((B=d.lastMove)==null?void 0:B.kind)==="move"&&W(R)(d.lastMove.to,s(r,y))}])},null,2)}),128))]))),128))]))}});var Al=ne(Bl,[["__scopeId","data-v-b504cbe8"]]);const Ll={class:"relative-position full-width full-height no-pointer-events pieces-layer"},Dl=K({__name:"pieces-layer",props:{modelValue:{},squareSize:{},perspective:{}},setup(e){return(o,a)=>(m(),k("div",Ll,[(m(!0),k(O,null,Q(o.modelValue,(t,n)=>(m(),k("div",{key:n},[t?(m(),D(ye,{key:0,"data-testid":"piece",class:"absolute",piece:t.piece,allegiance:t.allegiance,size:o.squareSize,style:L(o.perspective==="white"?{left:`${(t.file-1)*o.squareSize}px`,bottom:`${(t.rank-1)*o.squareSize}px`}:{right:`${(t.file-1)*o.squareSize}px`,top:`${(t.rank-1)*o.squareSize}px`})},null,8,["piece","allegiance","size","style"])):(m(),k("div",{key:1,style:L({width:`${o.squareSize}px`,height:`${o.squareSize}px`})},null,4))]))),128))]))}});var Wl=ne(Dl,[["__scopeId","data-v-fc205e14"]]);const Ol={class:"absolute full-width full-height"},Ql={class:"absolute full-width full-height"},Rl={class:"absolute full-width full-height"},jl={class:"absolute full-width full-height"},Vl=K({__name:"board-table",props:{board:{},width:{},perspective:{},playAs:{}},emits:["execute-node"],setup(e,{emit:o}){const a=e,t=p(()=>a.width/8),n=M(null),s=l=>{o("execute-node",l),n.value=null},i=p(()=>{var d;return(d=a.board.getMoveHistoryAst().children.at(-1))!=null?d:null});return(l,d)=>(m(),k("div",{"data-testid":"chess-board",class:"relative-position column",style:L({width:a.width+"px",height:a.width+"px"})},[H("div",Ol,[$(nl,{ranks:8,files:8})]),H("div",Ql,[$(Al,{board:l.board,"square-size":t.value,files:8,ranks:8,perspective:l.perspective,"piece-focus":n.value,"last-move":i.value},null,8,["board","square-size","perspective","piece-focus","last-move"])]),H("div",Rl,[$(Wl,{"model-value":l.board.getSquares(),perspective:a.perspective,"square-size":t.value},null,8,["model-value","perspective","square-size"])]),H("div",jl,[$(Fl,{onExecuteNode:s,onUpdatePieceFocus:d[0]||(d[0]=v=>n.value=v),"piece-focus":n.value,board:l.board,"square-size":t.value,files:8,ranks:8,perspective:a.perspective},null,8,["piece-focus","board","square-size","perspective"])])],4))}}),Nl={class:"column"},Kl={class:"row"},Gl={class:"col"},ca=K({__name:"chess-board",props:{board:{},width:{},perspective:{},playAs:{}},emits:["execute-node"],setup(e,{emit:o}){const a=e,t=p(()=>a.width/8/2.5);return(n,s)=>(m(),k("div",{style:L({width:`${n.width}px`})},[H("div",Nl,[H("div",{class:"row",style:L({height:`${t.value}px`})},[H("div",{style:L({width:`${t.value}px`})},null,4),(m(),k(O,null,Q(8,(i,l)=>$(ue,{key:l,class:"col column full-height justify-center",flat:""},{default:P(()=>[$(J,{class:"text-center q-pa-none"},{default:P(()=>[ae(oe(W(Oe)(n.perspective==="white"?9-(8-l):8-l).toUpperCase()),1)]),_:2},1024)]),_:2},1024)),64)),H("div",{style:L({width:`${t.value}px`})},null,4)],4),H("div",Kl,[H("div",{class:"column",style:L({width:`${t.value}px`})},[(m(),k(O,null,Q(8,(i,l)=>$(ue,{key:l,class:"col column full-height justify-center text-center",flat:""},{default:P(()=>[$(J,{class:"q-pa-none"},{default:P(()=>[ae(oe(n.perspective==="white"?8-l:9-(8-l)),1)]),_:2},1024)]),_:2},1024)),64))],4),H("div",Gl,[$(Vl,{onExecuteNode:s[0]||(s[0]=i=>o("execute-node",i)),board:n.board,perspective:n.perspective,"play-as":n.playAs,width:n.width-t.value*2},null,8,["board","perspective","play-as","width"])]),H("div",{class:"column",style:L({width:`${t.value}px`})},[(m(),k(O,null,Q(8,(i,l)=>$(ue,{key:l,class:"col column full-height justify-center text-center",flat:""},{default:P(()=>[$(J,{class:"q-pa-none"},{default:P(()=>[ae(oe(n.perspective==="white"?8-l:9-(8-l)),1)]),_:2},1024)]),_:2},1024)),64))],4)]),H("div",{class:"row",style:L({height:`${t.value}px`})},[H("div",{style:L({width:`${t.value}px`})},null,4),(m(),k(O,null,Q(8,(i,l)=>$(ue,{key:l,class:"col column full-height justify-center",flat:""},{default:P(()=>[$(J,{class:"text-center q-pa-none"},{default:P(()=>[ae(oe(W(Oe)(n.perspective==="white"?9-(8-l):8-l).toUpperCase()),1)]),_:2},1024)]),_:2},1024)),64)),H("div",{style:L({width:`${t.value}px`})},null,4)],4)])],4))}}),Ul={xs:8,sm:10,md:14,lg:20,xl:24};var lt=Ae({name:"QChip",props:{...Le,...Dt,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:o,emit:a}){const{proxy:{$q:t}}=he(),n=De(e,t),s=Wt(e,Ul),i=p(()=>e.selected===!0||e.icon!==void 0),l=p(()=>e.selected===!0?e.iconSelected||t.iconSet.chip.selected:e.icon),d=p(()=>e.iconRemove||t.iconSet.chip.remove),v=p(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),h=p(()=>{const f=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(f?` text-${f} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(v.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(n.value===!0?" q-chip--dark q-dark":"")}),y=p(()=>{const f=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},A={...f,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||t.lang.label.remove};return{chip:f,remove:A}});function q(f){f.keyCode===13&&r(f)}function r(f){e.disable||(a("update:selected",!e.selected),a("click",f))}function g(f){(f.keyCode===void 0||f.keyCode===13)&&(ct(f),e.disable===!1&&(a("update:modelValue",!1),a("remove")))}function B(){const f=[];v.value===!0&&f.push(F("div",{class:"q-focus-helper"})),i.value===!0&&f.push(F(ce,{class:"q-chip__icon q-chip__icon--left",name:l.value}));const A=e.label!==void 0?[F("div",{class:"ellipsis"},[e.label])]:void 0;return f.push(F("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},Qt(o.default,A))),e.iconRight&&f.push(F(ce,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&f.push(F(ce,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:d.value,...y.value.remove,onClick:g,onKeyup:g})),f}return()=>{if(e.modelValue===!1)return;const f={class:h.value,style:s.value};return v.value===!0&&Object.assign(f,y.value.chip,{onClick:r,onKeyup:q}),Ot("div",f,B(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[Rt,e.ripple]])}}});const at=["vertical","horizontal"],Me={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},ot={prevent:!0,mouse:!0,mouseAllDir:!0},it=e=>e>=250?50:Math.ceil(e/5);var Yl=Ae({name:"QScrollArea",props:{...Le,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:o,emit:a}){const t=M(!1),n=M(!1),s=M(!1),i={vertical:M(0),horizontal:M(0)},l={vertical:{ref:M(null),position:M(0),size:M(0)},horizontal:{ref:M(null),position:M(0),size:M(0)}},{proxy:d}=he(),v=De(e,d.$q);let h=null,y;const q=M(null),r=p(()=>"q-scrollarea"+(v.value===!0?" q-scrollarea--dark":""));l.vertical.percentage=p(()=>{const u=l.vertical.size.value-i.vertical.value;if(u<=0)return 0;const b=be(l.vertical.position.value/u,0,1);return Math.round(b*1e4)/1e4}),l.vertical.thumbHidden=p(()=>(e.visible===null?s.value:e.visible)!==!0&&t.value===!1&&n.value===!1||l.vertical.size.value<=i.vertical.value+1),l.vertical.thumbStart=p(()=>l.vertical.percentage.value*(i.vertical.value-l.vertical.thumbSize.value)),l.vertical.thumbSize=p(()=>Math.round(be(i.vertical.value*i.vertical.value/l.vertical.size.value,it(i.vertical.value),i.vertical.value))),l.vertical.style=p(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${l.vertical.thumbStart.value}px`,height:`${l.vertical.thumbSize.value}px`})),l.vertical.thumbClass=p(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(l.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),l.vertical.barClass=p(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(l.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),l.horizontal.percentage=p(()=>{const u=l.horizontal.size.value-i.horizontal.value;if(u<=0)return 0;const b=be(Math.abs(l.horizontal.position.value)/u,0,1);return Math.round(b*1e4)/1e4}),l.horizontal.thumbHidden=p(()=>(e.visible===null?s.value:e.visible)!==!0&&t.value===!1&&n.value===!1||l.horizontal.size.value<=i.horizontal.value+1),l.horizontal.thumbStart=p(()=>l.horizontal.percentage.value*(i.horizontal.value-l.horizontal.thumbSize.value)),l.horizontal.thumbSize=p(()=>Math.round(be(i.horizontal.value*i.horizontal.value/l.horizontal.size.value,it(i.horizontal.value),i.horizontal.value))),l.horizontal.style=p(()=>({...e.thumbStyle,...e.horizontalThumbStyle,[d.$q.lang.rtl===!0?"right":"left"]:`${l.horizontal.thumbStart.value}px`,width:`${l.horizontal.thumbSize.value}px`})),l.horizontal.thumbClass=p(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(l.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),l.horizontal.barClass=p(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(l.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const g=p(()=>l.vertical.thumbHidden.value===!0&&l.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),B=[[Ke,u=>{_(u,"vertical")},void 0,{vertical:!0,...ot}]],f=[[Ke,u=>{_(u,"horizontal")},void 0,{horizontal:!0,...ot}]];function A(){const u={};return at.forEach(b=>{const C=l[b];u[b+"Position"]=C.position.value,u[b+"Percentage"]=C.percentage.value,u[b+"Size"]=C.size.value,u[b+"ContainerSize"]=i[b].value}),u}const N=jt(()=>{const u=A();u.ref=d,a("scroll",u)},0);function x(u,b,C){if(at.includes(u)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(u==="vertical"?Ne:$e)(q.value,b,C)}function c({height:u,width:b}){let C=!1;i.vertical.value!==u&&(i.vertical.value=u,C=!0),i.horizontal.value!==b&&(i.horizontal.value=b,C=!0),C===!0&&V()}function S({position:u}){let b=!1;l.vertical.position.value!==u.top&&(l.vertical.position.value=u.top,b=!0),l.horizontal.position.value!==u.left&&(l.horizontal.position.value=u.left,b=!0),b===!0&&V()}function E({height:u,width:b}){l.horizontal.size.value!==b&&(l.horizontal.size.value=b,V()),l.vertical.size.value!==u&&(l.vertical.size.value=u,V())}function _(u,b){const C=l[b];if(u.isFirst===!0){if(C.thumbHidden.value===!0)return;y=C.position.value,n.value=!0}else if(n.value!==!0)return;u.isFinal===!0&&(n.value=!1);const j=Me[b],le=i[b].value,ze=(C.size.value-le)/(le-C.thumbSize.value),pe=u.distance[j.dist],ge=y+(u.direction===j.dir?1:-1)*pe*ze;G(ge,b)}function T(u,b){const C=l[b];if(C.thumbHidden.value!==!0){const j=u[Me[b].offset];if(j<C.thumbStart.value||j>C.thumbStart.value+C.thumbSize.value){const le=j-C.thumbSize.value/2;G(le/i[b].value*C.size.value,b)}C.ref.value!==null&&C.ref.value.dispatchEvent(new MouseEvent(u.type,u))}}function w(u){T(u,"vertical")}function X(u){T(u,"horizontal")}function V(){t.value=!0,h!==null&&clearTimeout(h),h=setTimeout(()=>{h=null,t.value=!1},e.delay),e.onScroll!==void 0&&N()}function G(u,b){q.value[Me[b].scroll]=u}function se(){s.value=!0}function me(){s.value=!1}let te=null;return Y(()=>d.$q.lang.rtl,u=>{q.value!==null&&$e(q.value,Math.abs(l.horizontal.position.value)*(u===!0?-1:1))}),ut(()=>{te={top:l.vertical.position.value,left:l.horizontal.position.value}}),Vt(()=>{if(te===null)return;const u=q.value;u!==null&&($e(u,te.left),Ne(u,te.top))}),fe(N.cancel),Object.assign(d,{getScrollTarget:()=>q.value,getScroll:A,getScrollPosition:()=>({top:l.vertical.position.value,left:l.horizontal.position.value}),getScrollPercentage:()=>({top:l.vertical.percentage.value,left:l.horizontal.percentage.value}),setScrollPosition:x,setScrollPercentage(u,b,C){x(u,b*(l[u].size.value-i[u].value)*(u==="horizontal"&&d.$q.lang.rtl===!0?-1:1),C)}}),()=>F("div",{class:r.value,onMouseenter:se,onMouseleave:me},[F("div",{ref:q,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[F("div",{class:"q-scrollarea__content absolute",style:g.value},Nt(o.default,[F(Ve,{debounce:0,onResize:E})])),F(tl,{axis:"both",onScroll:S})]),F(Ve,{debounce:0,onResize:c}),F("div",{class:l.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:w}),F("div",{class:l.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:X}),je(F("div",{ref:l.vertical.ref,class:l.vertical.thumbClass.value,style:l.vertical.style.value,"aria-hidden":"true"}),B),je(F("div",{ref:l.horizontal.ref,class:l.horizontal.thumbClass.value,style:l.horizontal.style.value,"aria-hidden":"true"}),f)])}});const pt=e=>(Kt("data-v-5c2459c2"),e=e(),Gt(),e),Xl=pt(()=>H("div",{class:"text-h6"},"Your turn!",-1)),Jl=pt(()=>H("div",{class:"text-h6"},"Waiting for opponent...",-1)),Zl={"data-testid":""},Il={key:0,class:"col"},ea={key:0,class:"col"},ta=K({__name:"game-sidebar",props:{moveHistory:{},activeColour:{},ownColour:{}},setup(e){const o=e,a=p(()=>{const n=[];return o.moveHistory.children.forEach(s=>{const i=n.at(-1);if(!i||i.length!==1){n.push([s]);return}i.push(s)}),n}),t=M(null);return Y(a,()=>{!t.value||t.value.setScrollPosition("vertical",a.value.length*36,1e3)}),rt(()=>{!t.value||t.value.setScrollPosition("vertical",a.value.length*36,1e3)}),(n,s)=>(m(),D(ue,{flat:"",bordered:"",class:"q-ma-md full-height column justify-between"},{default:P(()=>[$(Ee,{mode:"out-in"},{default:P(()=>[n.activeColour===n.ownColour?(m(),D(J,{key:0,class:"bg-primary text-white q-mb-md"},{default:P(()=>[Xl]),_:1})):(m(),D(J,{key:1,class:"bg-grey text-black q-mb-md"},{default:P(()=>[Jl]),_:1}))]),_:1}),H("div",Zl,[$(St),$(W(Yl),{style:{height:"500px"},ref_key:"moveHistoryScrollArea",ref:t},{default:P(()=>[(m(!0),k(O,null,Q(a.value,(i,l)=>(m(),D(J,{key:l,horizontal:"",class:de(["row q-py-none q-mx-md",{"q-pt-md":l===0,"q-pb-md":l===a.value.length-1}])},{default:P(()=>[i[0]?(m(),k("div",Il,[$(lt,{ripple:!1,class:de(["white-move",{highlight:i[0].kind!=="move"}])},{default:P(()=>[i[0].kind==="move"&&i[0].piece?(m(),D(ye,{key:0,piece:i[0].piece,allegiance:3,size:24},null,8,["piece"])):U("",!0),ae(" "+oe(W(Ue).writeNode(i[0])),1)]),_:2},1032,["class"])])):U("",!0),$(Ee,{mode:"out-in"},{default:P(()=>[i[1]?(m(),k("div",ea,[$(lt,{ripple:!1,class:de(["black-move",{highlight:i[1].kind!=="move"}])},{default:P(()=>[i[1].kind==="move"&&i[1].piece?(m(),D(ye,{key:0,piece:i[1].piece,allegiance:0,size:24},null,8,["piece"])):U("",!0),ae(" "+oe(W(Ue).writeNode(i[1])),1)]),_:2},1032,["class"])])):U("",!0)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1},512)])]),_:1}))}});var da=ne(ta,[["__scopeId","data-v-5c2459c2"]]);export{da as G,ca as _};
//# sourceMappingURL=game-sidebar.3c0fefe1.js.map
