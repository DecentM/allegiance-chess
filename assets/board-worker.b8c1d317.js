import{u as rn}from"./use-quasar.3e6ad70c.js";import{d as $,at as nn,A as Ue,B as M,E as Z,J as xe,F as Be,_ as ht,P as Ke,M as le,I as kt,O as pe,r as U,ad as yi,a7 as Qi,n as Aa,a5 as Yi,w as qe,k as mi,o as pt,j as Dt,aa as Pl,T as Qn,au as Rr,z as Tl,ao as jl,h as re,av as Cl,aw as Nl,ax as Ml,a as L,a0 as Ra,a1 as $l,Y as bi,c as nr,a9 as ql,e as wi,ae as Yt,ay as Oa,Z as Pa,C as ce,D as X,G as V,u as st,m as Jt,az as Si,aj as zr,N as Pe,aA as Dl,aB as Fl,p as Ll,aC as xl,an as Bl,aq as Il,s as zl,ah as Ul,H as yr,ak as Wl,al as Hl,aD as Gl,aE as Vl,a3 as Kl,Q as Ji}from"./index.90ee8eaf.js";import{b as Ur,a as Xt,Q as Ta}from"./QList.f8fe278d.js";import{i as Ql,g as Yl,u as ja,a as Ca,b as Na,c as Ma,j as Jl,e as mr,Q as Xi,h as Xl,s as Zi,k as Sn,T as eo,d as Zl,f as eu}from"./QScrollObserver.43ca2596.js";import{u as ki,a as Ei}from"./use-dark.665573af.js";import{b as to,c as tu,a as $a}from"./focus-manager.202af5b7.js";import{C as jt,Q as ro}from"./chess-piece.2d3aa9e8.js";import{Q as qa,a as nt}from"./QCard.78fa8550.js";import{Q as Or}from"./QSeparator.e2862eb2.js";var Ye=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ir={exports:{}},_i={},Ce={},Da={},Ai=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[r]=i;for(r in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,r);if(a.value!==i||a.enumerable!==!0)return!1}return!0},ru=Ai,Ri=function(){return ru()&&!!Symbol.toStringTag},no=typeof Symbol!="undefined"&&Symbol,nu=Ai,iu=function(){return typeof no!="function"||typeof Symbol!="function"||typeof no("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:nu()},io={foo:{}},ou=Object,au=function(){return{__proto__:io}.foo===io.foo&&!({__proto__:null}instanceof ou)},su="Function.prototype.bind called on incompatible ",kn=Array.prototype.slice,lu=Object.prototype.toString,uu="[object Function]",cu=function(t){var r=this;if(typeof r!="function"||lu.call(r)!==uu)throw new TypeError(su+r);for(var n=kn.call(arguments,1),i,o=function(){if(this instanceof i){var c=r.apply(this,n.concat(kn.call(arguments)));return Object(c)===c?c:this}else return r.apply(t,n.concat(kn.call(arguments)))},a=Math.max(0,r.length-n.length),s=[],l=0;l<a;l++)s.push("$"+l);if(i=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")(o),r.prototype){var u=function(){};u.prototype=r.prototype,i.prototype=new u,u.prototype=null}return i},fu=cu,Oi=Function.prototype.bind||fu,du=Oi,hu=du.call(Function.call,Object.prototype.hasOwnProperty),W,Ct=SyntaxError,Fa=Function,Et=TypeError,En=function(e){try{return Fa('"use strict"; return ('+e+").constructor;")()}catch{}},lt=Object.getOwnPropertyDescriptor;if(lt)try{lt({},"")}catch{lt=null}var _n=function(){throw new Et},pu=lt?function(){try{return arguments.callee,_n}catch{try{return lt(arguments,"callee").get}catch{return _n}}}():_n,yt=iu(),vu=au(),fe=Object.getPrototypeOf||(vu?function(e){return e.__proto__}:null),wt={},gu=typeof Uint8Array=="undefined"||!fe?W:fe(Uint8Array),ut={"%AggregateError%":typeof AggregateError=="undefined"?W:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer=="undefined"?W:ArrayBuffer,"%ArrayIteratorPrototype%":yt&&fe?fe([][Symbol.iterator]()):W,"%AsyncFromSyncIteratorPrototype%":W,"%AsyncFunction%":wt,"%AsyncGenerator%":wt,"%AsyncGeneratorFunction%":wt,"%AsyncIteratorPrototype%":wt,"%Atomics%":typeof Atomics=="undefined"?W:Atomics,"%BigInt%":typeof BigInt=="undefined"?W:BigInt,"%BigInt64Array%":typeof BigInt64Array=="undefined"?W:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array=="undefined"?W:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView=="undefined"?W:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array=="undefined"?W:Float32Array,"%Float64Array%":typeof Float64Array=="undefined"?W:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry=="undefined"?W:FinalizationRegistry,"%Function%":Fa,"%GeneratorFunction%":wt,"%Int8Array%":typeof Int8Array=="undefined"?W:Int8Array,"%Int16Array%":typeof Int16Array=="undefined"?W:Int16Array,"%Int32Array%":typeof Int32Array=="undefined"?W:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":yt&&fe?fe(fe([][Symbol.iterator]())):W,"%JSON%":typeof JSON=="object"?JSON:W,"%Map%":typeof Map=="undefined"?W:Map,"%MapIteratorPrototype%":typeof Map=="undefined"||!yt||!fe?W:fe(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise=="undefined"?W:Promise,"%Proxy%":typeof Proxy=="undefined"?W:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect=="undefined"?W:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set=="undefined"?W:Set,"%SetIteratorPrototype%":typeof Set=="undefined"||!yt||!fe?W:fe(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer=="undefined"?W:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":yt&&fe?fe(""[Symbol.iterator]()):W,"%Symbol%":yt?Symbol:W,"%SyntaxError%":Ct,"%ThrowTypeError%":pu,"%TypedArray%":gu,"%TypeError%":Et,"%Uint8Array%":typeof Uint8Array=="undefined"?W:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray=="undefined"?W:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array=="undefined"?W:Uint16Array,"%Uint32Array%":typeof Uint32Array=="undefined"?W:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap=="undefined"?W:WeakMap,"%WeakRef%":typeof WeakRef=="undefined"?W:WeakRef,"%WeakSet%":typeof WeakSet=="undefined"?W:WeakSet};if(fe)try{null.error}catch(e){var yu=fe(fe(e));ut["%Error.prototype%"]=yu}var mu=function e(t){var r;if(t==="%AsyncFunction%")r=En("async function () {}");else if(t==="%GeneratorFunction%")r=En("function* () {}");else if(t==="%AsyncGeneratorFunction%")r=En("async function* () {}");else if(t==="%AsyncGenerator%"){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(t==="%AsyncIteratorPrototype%"){var i=e("%AsyncGenerator%");i&&fe&&(r=fe(i.prototype))}return ut[t]=r,r},oo={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},or=Oi,Wr=hu,bu=or.call(Function.call,Array.prototype.concat),wu=or.call(Function.apply,Array.prototype.splice),ao=or.call(Function.call,String.prototype.replace),Hr=or.call(Function.call,String.prototype.slice),Su=or.call(Function.call,RegExp.prototype.exec),ku=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Eu=/\\(\\)?/g,_u=function(t){var r=Hr(t,0,1),n=Hr(t,-1);if(r==="%"&&n!=="%")throw new Ct("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new Ct("invalid intrinsic syntax, expected opening `%`");var i=[];return ao(t,ku,function(o,a,s,l){i[i.length]=s?ao(l,Eu,"$1"):a||o}),i},Au=function(t,r){var n=t,i;if(Wr(oo,n)&&(i=oo[n],n="%"+i[0]+"%"),Wr(ut,n)){var o=ut[n];if(o===wt&&(o=mu(n)),typeof o=="undefined"&&!r)throw new Et("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:o}}throw new Ct("intrinsic "+t+" does not exist!")},ar=function(t,r){if(typeof t!="string"||t.length===0)throw new Et("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new Et('"allowMissing" argument must be a boolean');if(Su(/^%?[^%]*%?$/,t)===null)throw new Ct("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=_u(t),i=n.length>0?n[0]:"",o=Au("%"+i+"%",r),a=o.name,s=o.value,l=!1,u=o.alias;u&&(i=u[0],wu(n,bu([0,1],u)));for(var c=1,f=!0;c<n.length;c+=1){var p=n[c],d=Hr(p,0,1),v=Hr(p,-1);if((d==='"'||d==="'"||d==="`"||v==='"'||v==="'"||v==="`")&&d!==v)throw new Ct("property names with quotes must have matching quotes");if((p==="constructor"||!f)&&(l=!0),i+="."+p,a="%"+i+"%",Wr(ut,a))s=ut[a];else if(s!=null){if(!(p in s)){if(!r)throw new Et("base intrinsic for "+t+" exists, but the property is not available.");return}if(lt&&c+1>=n.length){var k=lt(s,p);f=!!k,f&&"get"in k&&!("originalValue"in k.get)?s=k.get:s=s[p]}else f=Wr(s,p),s=s[p];f&&!l&&(ut[a]=s)}}return s},sr={exports:{}};(function(e){var t=Oi,r=ar,n=r("%Function.prototype.apply%"),i=r("%Function.prototype.call%"),o=r("%Reflect.apply%",!0)||t.call(i,n),a=r("%Object.getOwnPropertyDescriptor%",!0),s=r("%Object.defineProperty%",!0),l=r("%Math.max%");if(s)try{s({},"a",{value:1})}catch{s=null}e.exports=function(f){var p=o(t,i,arguments);if(a&&s){var d=a(p,"length");d.configurable&&s(p,"length",{value:1+l(0,f.length-(arguments.length-1))})}return p};var u=function(){return o(t,n,arguments)};s?s(e.exports,"apply",{value:u}):e.exports.apply=u})(sr);var La=ar,xa=sr.exports,Ru=xa(La("String.prototype.indexOf")),on=function(t,r){var n=La(t,!!r);return typeof n=="function"&&Ru(t,".prototype.")>-1?xa(n):n},Ou=Ri(),Pu=on,Yn=Pu("Object.prototype.toString"),an=function(t){return Ou&&t&&typeof t=="object"&&Symbol.toStringTag in t?!1:Yn(t)==="[object Arguments]"},Ba=function(t){return an(t)?!0:t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Yn(t)!=="[object Array]"&&Yn(t.callee)==="[object Function]"},Tu=function(){return an(arguments)}();an.isLegacyArguments=Ba;var ju=Tu?an:Ba,Cu=Object.prototype.toString,Nu=Function.prototype.toString,Mu=/^\s*(?:function)?\*/,Ia=Ri(),An=Object.getPrototypeOf,$u=function(){if(!Ia)return!1;try{return Function("return function*() {}")()}catch{}},Rn,qu=function(t){if(typeof t!="function")return!1;if(Mu.test(Nu.call(t)))return!0;if(!Ia){var r=Cu.call(t);return r==="[object GeneratorFunction]"}if(!An)return!1;if(typeof Rn=="undefined"){var n=$u();Rn=n?An(n):!1}return An(t)===Rn},za=Function.prototype.toString,St=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Jn,Pr;if(typeof St=="function"&&typeof Object.defineProperty=="function")try{Jn=Object.defineProperty({},"length",{get:function(){throw Pr}}),Pr={},St(function(){throw 42},null,Jn)}catch(e){e!==Pr&&(St=null)}else St=null;var Du=/^\s*class\b/,Xn=function(t){try{var r=za.call(t);return Du.test(r)}catch{return!1}},On=function(t){try{return Xn(t)?!1:(za.call(t),!0)}catch{return!1}},Tr=Object.prototype.toString,Fu="[object Object]",Lu="[object Function]",xu="[object GeneratorFunction]",Bu="[object HTMLAllCollection]",Iu="[object HTML document.all class]",zu="[object HTMLCollection]",Uu=typeof Symbol=="function"&&!!Symbol.toStringTag,Wu=!(0 in[,]),Zn=function(){return!1};if(typeof document=="object"){var Hu=document.all;Tr.call(Hu)===Tr.call(document.all)&&(Zn=function(t){if((Wu||!t)&&(typeof t=="undefined"||typeof t=="object"))try{var r=Tr.call(t);return(r===Bu||r===Iu||r===zu||r===Fu)&&t("")==null}catch{}return!1})}var Gu=St?function(t){if(Zn(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{St(t,null,Jn)}catch(r){if(r!==Pr)return!1}return!Xn(t)&&On(t)}:function(t){if(Zn(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(Uu)return On(t);if(Xn(t))return!1;var r=Tr.call(t);return r!==Lu&&r!==xu&&!/^\[object HTML/.test(r)?!1:On(t)},Vu=Gu,Ku=Object.prototype.toString,Ua=Object.prototype.hasOwnProperty,Qu=function(t,r,n){for(var i=0,o=t.length;i<o;i++)Ua.call(t,i)&&(n==null?r(t[i],i,t):r.call(n,t[i],i,t))},Yu=function(t,r,n){for(var i=0,o=t.length;i<o;i++)n==null?r(t.charAt(i),i,t):r.call(n,t.charAt(i),i,t)},Ju=function(t,r,n){for(var i in t)Ua.call(t,i)&&(n==null?r(t[i],i,t):r.call(n,t[i],i,t))},Xu=function(t,r,n){if(!Vu(r))throw new TypeError("iterator must be a function");var i;arguments.length>=3&&(i=n),Ku.call(t)==="[object Array]"?Qu(t,r,i):typeof t=="string"?Yu(t,r,i):Ju(t,r,i)},Zu=Xu,Pn=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],ec=typeof globalThis=="undefined"?Ye:globalThis,tc=function(){for(var t=[],r=0;r<Pn.length;r++)typeof ec[Pn[r]]=="function"&&(t[t.length]=Pn[r]);return t},rc=ar,jr=rc("%Object.getOwnPropertyDescriptor%",!0);if(jr)try{jr([],"length")}catch{jr=null}var Wa=jr,Gr=Zu,nc=tc,so=sr.exports,Pi=on,Cr=Wa,ic=Pi("Object.prototype.toString"),Ha=Ri(),lo=typeof globalThis=="undefined"?Ye:globalThis,ei=nc(),Ti=Pi("String.prototype.slice"),Tn=Object.getPrototypeOf,oc=Pi("Array.prototype.indexOf",!0)||function(t,r){for(var n=0;n<t.length;n+=1)if(t[n]===r)return n;return-1},Vr={__proto__:null};Ha&&Cr&&Tn?Gr(ei,function(e){var t=new lo[e];if(Symbol.toStringTag in t){var r=Tn(t),n=Cr(r,Symbol.toStringTag);if(!n){var i=Tn(r);n=Cr(i,Symbol.toStringTag)}Vr["$"+e]=so(n.get)}}):Gr(ei,function(e){var t=new lo[e];Vr["$"+e]=so(t.slice)});var ac=function(t){var r=!1;return Gr(Vr,function(n,i){if(!r)try{"$"+n(t)===i&&(r=Ti(i,1))}catch{}}),r},sc=function(t){var r=!1;return Gr(Vr,function(n,i){if(!r)try{n(t),r=Ti(i,1)}catch{}}),r},Ga=function(t){if(!t||typeof t!="object")return!1;if(!Ha){var r=Ti(ic(t),8,-1);return oc(ei,r)>-1?r:r!=="Object"?!1:sc(t)}return Cr?ac(t):null},lc=Ga,uc=function(t){return!!lc(t)};(function(e){var t=ju,r=qu,n=Ga,i=uc;function o(y){return y.call.bind(y)}var a=typeof BigInt!="undefined",s=typeof Symbol!="undefined",l=o(Object.prototype.toString),u=o(Number.prototype.valueOf),c=o(String.prototype.valueOf),f=o(Boolean.prototype.valueOf);if(a)var p=o(BigInt.prototype.valueOf);if(s)var d=o(Symbol.prototype.valueOf);function v(y,Ol){if(typeof y!="object")return!1;try{return Ol(y),!0}catch{return!1}}e.isArgumentsObject=t,e.isGeneratorFunction=r,e.isTypedArray=i;function k(y){return typeof Promise!="undefined"&&y instanceof Promise||y!==null&&typeof y=="object"&&typeof y.then=="function"&&typeof y.catch=="function"}e.isPromise=k;function w(y){return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?ArrayBuffer.isView(y):i(y)||g(y)}e.isArrayBufferView=w;function P(y){return n(y)==="Uint8Array"}e.isUint8Array=P;function C(y){return n(y)==="Uint8ClampedArray"}e.isUint8ClampedArray=C;function T(y){return n(y)==="Uint16Array"}e.isUint16Array=T;function m(y){return n(y)==="Uint32Array"}e.isUint32Array=m;function O(y){return n(y)==="Int8Array"}e.isInt8Array=O;function q(y){return n(y)==="Int16Array"}e.isInt16Array=q;function S(y){return n(y)==="Int32Array"}e.isInt32Array=S;function G(y){return n(y)==="Float32Array"}e.isFloat32Array=G;function D(y){return n(y)==="Float64Array"}e.isFloat64Array=D;function ve(y){return n(y)==="BigInt64Array"}e.isBigInt64Array=ve;function ie(y){return n(y)==="BigUint64Array"}e.isBigUint64Array=ie;function se(y){return l(y)==="[object Map]"}se.working=typeof Map!="undefined"&&se(new Map);function Re(y){return typeof Map=="undefined"?!1:se.working?se(y):y instanceof Map}e.isMap=Re;function me(y){return l(y)==="[object Set]"}me.working=typeof Set!="undefined"&&me(new Set);function we(y){return typeof Set=="undefined"?!1:me.working?me(y):y instanceof Set}e.isSet=we;function A(y){return l(y)==="[object WeakMap]"}A.working=typeof WeakMap!="undefined"&&A(new WeakMap);function F(y){return typeof WeakMap=="undefined"?!1:A.working?A(y):y instanceof WeakMap}e.isWeakMap=F;function B(y){return l(y)==="[object WeakSet]"}B.working=typeof WeakSet!="undefined"&&B(new WeakSet);function ne(y){return B(y)}e.isWeakSet=ne;function de(y){return l(y)==="[object ArrayBuffer]"}de.working=typeof ArrayBuffer!="undefined"&&de(new ArrayBuffer);function Me(y){return typeof ArrayBuffer=="undefined"?!1:de.working?de(y):y instanceof ArrayBuffer}e.isArrayBuffer=Me;function h(y){return l(y)==="[object DataView]"}h.working=typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined"&&h(new DataView(new ArrayBuffer(1),0,1));function g(y){return typeof DataView=="undefined"?!1:h.working?h(y):y instanceof DataView}e.isDataView=g;var b=typeof SharedArrayBuffer!="undefined"?SharedArrayBuffer:void 0;function _(y){return l(y)==="[object SharedArrayBuffer]"}function N(y){return typeof b=="undefined"?!1:(typeof _.working=="undefined"&&(_.working=_(new b)),_.working?_(y):y instanceof b)}e.isSharedArrayBuffer=N;function I(y){return l(y)==="[object AsyncFunction]"}e.isAsyncFunction=I;function x(y){return l(y)==="[object Map Iterator]"}e.isMapIterator=x;function R(y){return l(y)==="[object Set Iterator]"}e.isSetIterator=R;function Y(y){return l(y)==="[object Generator]"}e.isGeneratorObject=Y;function ge(y){return l(y)==="[object WebAssembly.Module]"}e.isWebAssemblyCompiledModule=ge;function Fe(y){return v(y,u)}e.isNumberObject=Fe;function vr(y){return v(y,c)}e.isStringObject=vr;function gt(y){return v(y,f)}e.isBooleanObject=gt;function gr(y){return a&&v(y,p)}e.isBigIntObject=gr;function Ki(y){return s&&v(y,d)}e.isSymbolObject=Ki;function Al(y){return Fe(y)||vr(y)||gt(y)||gr(y)||Ki(y)}e.isBoxedPrimitive=Al;function Rl(y){return typeof Uint8Array!="undefined"&&(Me(y)||N(y))}e.isAnyArrayBuffer=Rl,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(y){Object.defineProperty(e,y,{enumerable:!1,value:function(){throw new Error(y+" is not supported in userland")}})})})(Da);var cc=function(t){return t instanceof $.Buffer},Ie={exports:{}};typeof Object.create=="function"?Ie.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:Ie.exports=function(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}};(function(e){var t=Object.getOwnPropertyDescriptors||function(g){for(var b=Object.keys(g),_={},N=0;N<b.length;N++)_[b[N]]=Object.getOwnPropertyDescriptor(g,b[N]);return _},r=/%[sdj%]/g;e.format=function(h){if(!O(h)){for(var g=[],b=0;b<arguments.length;b++)g.push(a(arguments[b]));return g.join(" ")}for(var b=1,_=arguments,N=_.length,I=String(h).replace(r,function(R){if(R==="%%")return"%";if(b>=N)return R;switch(R){case"%s":return String(_[b++]);case"%d":return Number(_[b++]);case"%j":try{return JSON.stringify(_[b++])}catch{return"[Circular]"}default:return R}}),x=_[b];b<N;x=_[++b])C(x)||!D(x)?I+=" "+x:I+=" "+a(x);return I},e.deprecate=function(h,g){if(typeof $.process!="undefined"&&$.process.noDeprecation===!0)return h;if(typeof $.process=="undefined")return function(){return e.deprecate(h,g).apply(this,arguments)};var b=!1;function _(){if(!b){if($.process.throwDeprecation)throw new Error(g);$.process.traceDeprecation?console.trace(g):console.error(g),b=!0}return h.apply(this,arguments)}return _};var n={},i=/^$/;if({}.NODE_DEBUG){var o={}.NODE_DEBUG;o=o.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),i=new RegExp("^"+o+"$","i")}e.debuglog=function(h){if(h=h.toUpperCase(),!n[h])if(i.test(h)){var g=$.process.pid;n[h]=function(){var b=e.format.apply(e,arguments);console.error("%s %d: %s",h,g,b)}}else n[h]=function(){};return n[h]};function a(h,g){var b={seen:[],stylize:l};return arguments.length>=3&&(b.depth=arguments[2]),arguments.length>=4&&(b.colors=arguments[3]),P(g)?b.showHidden=g:g&&e._extend(b,g),S(b.showHidden)&&(b.showHidden=!1),S(b.depth)&&(b.depth=2),S(b.colors)&&(b.colors=!1),S(b.customInspect)&&(b.customInspect=!0),b.colors&&(b.stylize=s),c(b,h,b.depth)}e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function s(h,g){var b=a.styles[g];return b?"\x1B["+a.colors[b][0]+"m"+h+"\x1B["+a.colors[b][1]+"m":h}function l(h,g){return h}function u(h){var g={};return h.forEach(function(b,_){g[b]=!0}),g}function c(h,g,b){if(h.customInspect&&g&&se(g.inspect)&&g.inspect!==e.inspect&&!(g.constructor&&g.constructor.prototype===g)){var _=g.inspect(b,h);return O(_)||(_=c(h,_,b)),_}var N=f(h,g);if(N)return N;var I=Object.keys(g),x=u(I);if(h.showHidden&&(I=Object.getOwnPropertyNames(g)),ie(g)&&(I.indexOf("message")>=0||I.indexOf("description")>=0))return p(g);if(I.length===0){if(se(g)){var R=g.name?": "+g.name:"";return h.stylize("[Function"+R+"]","special")}if(G(g))return h.stylize(RegExp.prototype.toString.call(g),"regexp");if(ve(g))return h.stylize(Date.prototype.toString.call(g),"date");if(ie(g))return p(g)}var Y="",ge=!1,Fe=["{","}"];if(w(g)&&(ge=!0,Fe=["[","]"]),se(g)){var vr=g.name?": "+g.name:"";Y=" [Function"+vr+"]"}if(G(g)&&(Y=" "+RegExp.prototype.toString.call(g)),ve(g)&&(Y=" "+Date.prototype.toUTCString.call(g)),ie(g)&&(Y=" "+p(g)),I.length===0&&(!ge||g.length==0))return Fe[0]+Y+Fe[1];if(b<0)return G(g)?h.stylize(RegExp.prototype.toString.call(g),"regexp"):h.stylize("[Object]","special");h.seen.push(g);var gt;return ge?gt=d(h,g,b,x,I):gt=I.map(function(gr){return v(h,g,b,x,gr,ge)}),h.seen.pop(),k(gt,Y,Fe)}function f(h,g){if(S(g))return h.stylize("undefined","undefined");if(O(g)){var b="'"+JSON.stringify(g).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return h.stylize(b,"string")}if(m(g))return h.stylize(""+g,"number");if(P(g))return h.stylize(""+g,"boolean");if(C(g))return h.stylize("null","null")}function p(h){return"["+Error.prototype.toString.call(h)+"]"}function d(h,g,b,_,N){for(var I=[],x=0,R=g.length;x<R;++x)B(g,String(x))?I.push(v(h,g,b,_,String(x),!0)):I.push("");return N.forEach(function(Y){Y.match(/^\d+$/)||I.push(v(h,g,b,_,Y,!0))}),I}function v(h,g,b,_,N,I){var x,R,Y;if(Y=Object.getOwnPropertyDescriptor(g,N)||{value:g[N]},Y.get?Y.set?R=h.stylize("[Getter/Setter]","special"):R=h.stylize("[Getter]","special"):Y.set&&(R=h.stylize("[Setter]","special")),B(_,N)||(x="["+N+"]"),R||(h.seen.indexOf(Y.value)<0?(C(b)?R=c(h,Y.value,null):R=c(h,Y.value,b-1),R.indexOf(`
`)>-1&&(I?R=R.split(`
`).map(function(ge){return"  "+ge}).join(`
`).slice(2):R=`
`+R.split(`
`).map(function(ge){return"   "+ge}).join(`
`))):R=h.stylize("[Circular]","special")),S(x)){if(I&&N.match(/^\d+$/))return R;x=JSON.stringify(""+N),x.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(x=x.slice(1,-1),x=h.stylize(x,"name")):(x=x.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),x=h.stylize(x,"string"))}return x+": "+R}function k(h,g,b){var _=h.reduce(function(N,I){return I.indexOf(`
`)>=0,N+I.replace(/\u001b\[\d\d?m/g,"").length+1},0);return _>60?b[0]+(g===""?"":g+`
 `)+" "+h.join(`,
  `)+" "+b[1]:b[0]+g+" "+h.join(", ")+" "+b[1]}e.types=Da;function w(h){return Array.isArray(h)}e.isArray=w;function P(h){return typeof h=="boolean"}e.isBoolean=P;function C(h){return h===null}e.isNull=C;function T(h){return h==null}e.isNullOrUndefined=T;function m(h){return typeof h=="number"}e.isNumber=m;function O(h){return typeof h=="string"}e.isString=O;function q(h){return typeof h=="symbol"}e.isSymbol=q;function S(h){return h===void 0}e.isUndefined=S;function G(h){return D(h)&&me(h)==="[object RegExp]"}e.isRegExp=G,e.types.isRegExp=G;function D(h){return typeof h=="object"&&h!==null}e.isObject=D;function ve(h){return D(h)&&me(h)==="[object Date]"}e.isDate=ve,e.types.isDate=ve;function ie(h){return D(h)&&(me(h)==="[object Error]"||h instanceof Error)}e.isError=ie,e.types.isNativeError=ie;function se(h){return typeof h=="function"}e.isFunction=se;function Re(h){return h===null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||typeof h=="symbol"||typeof h=="undefined"}e.isPrimitive=Re,e.isBuffer=cc;function me(h){return Object.prototype.toString.call(h)}function we(h){return h<10?"0"+h.toString(10):h.toString(10)}var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function F(){var h=new Date,g=[we(h.getHours()),we(h.getMinutes()),we(h.getSeconds())].join(":");return[h.getDate(),A[h.getMonth()],g].join(" ")}e.log=function(){console.log("%s - %s",F(),e.format.apply(e,arguments))},e.inherits=Ie.exports,e._extend=function(h,g){if(!g||!D(g))return h;for(var b=Object.keys(g),_=b.length;_--;)h[b[_]]=g[b[_]];return h};function B(h,g){return Object.prototype.hasOwnProperty.call(h,g)}var ne=typeof Symbol!="undefined"?Symbol("util.promisify.custom"):void 0;e.promisify=function(g){if(typeof g!="function")throw new TypeError('The "original" argument must be of type Function');if(ne&&g[ne]){var b=g[ne];if(typeof b!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(b,ne,{value:b,enumerable:!1,writable:!1,configurable:!0}),b}function b(){for(var _,N,I=new Promise(function(Y,ge){_=Y,N=ge}),x=[],R=0;R<arguments.length;R++)x.push(arguments[R]);x.push(function(Y,ge){Y?N(Y):_(ge)});try{g.apply(this,x)}catch(Y){N(Y)}return I}return Object.setPrototypeOf(b,Object.getPrototypeOf(g)),ne&&Object.defineProperty(b,ne,{value:b,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(b,t(g))},e.promisify.custom=ne;function de(h,g){if(!h){var b=new Error("Promise was rejected with a falsy value");b.reason=h,h=b}return g(h)}function Me(h){if(typeof h!="function")throw new TypeError('The "original" argument must be of type Function');function g(){for(var b=[],_=0;_<arguments.length;_++)b.push(arguments[_]);var N=b.pop();if(typeof N!="function")throw new TypeError("The last argument must be of type Function");var I=this,x=function(){return N.apply(I,arguments)};h.apply(this,b).then(function(R){$.process.nextTick(x.bind(null,null,R))},function(R){$.process.nextTick(de.bind(null,R,x))})}return Object.setPrototypeOf(g,Object.getPrototypeOf(h)),Object.defineProperties(g,t(h)),g}e.callbackify=Me})(Ce);function Je(e){return Je=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Je(e)}function uo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,dc(n.key),n)}}function fc(e,t,r){return t&&uo(e.prototype,t),r&&uo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function dc(e){var t=hc(e,"string");return Je(t)==="symbol"?t:String(t)}function hc(e,t){if(Je(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Je(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function pc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vc(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ti(e,t)}function ti(e,t){return ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},ti(e,t)}function gc(e){var t=bc();return function(){var n=Kr(e),i;if(t){var o=Kr(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return yc(this,i)}}function yc(e,t){if(t&&(Je(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mc(e)}function mc(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Kr(e){return Kr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Kr(e)}var Va={},_t,jn;function lr(e,t,r){r||(r=Error);function n(o,a,s){return typeof t=="string"?t:t(o,a,s)}var i=function(o){vc(s,o);var a=gc(s);function s(l,u,c){var f;return pc(this,s),f=a.call(this,n(l,u,c)),f.code=e,f}return fc(s)}(r);Va[e]=i}function co(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(n){return String(n)}),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:r===2?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}else return"of ".concat(t," ").concat(String(e))}function wc(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function Sc(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function kc(e,t,r){return typeof r!="number"&&(r=0),r+t.length>e.length?!1:e.indexOf(t,r)!==-1}lr("ERR_AMBIGUOUS_ARGUMENT",'The "%s" argument is ambiguous. %s',TypeError);lr("ERR_INVALID_ARG_TYPE",function(e,t,r){_t===void 0&&(_t=ir.exports),_t(typeof e=="string","'name' must be a string");var n;typeof t=="string"&&wc(t,"not ")?(n="must not be",t=t.replace(/^not /,"")):n="must be";var i;if(Sc(e," argument"))i="The ".concat(e," ").concat(n," ").concat(co(t,"type"));else{var o=kc(e,".")?"property":"argument";i='The "'.concat(e,'" ').concat(o," ").concat(n," ").concat(co(t,"type"))}return i+=". Received type ".concat(Je(r)),i},TypeError);lr("ERR_INVALID_ARG_VALUE",function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"is invalid";jn===void 0&&(jn=Ce);var n=jn.inspect(t);return n.length>128&&(n="".concat(n.slice(0,128),"...")),"The argument '".concat(e,"' ").concat(r,". Received ").concat(n)},TypeError);lr("ERR_INVALID_RETURN_VALUE",function(e,t,r){var n;return r&&r.constructor&&r.constructor.name?n="instance of ".concat(r.constructor.name):n="type ".concat(Je(r)),"Expected ".concat(e,' to be returned from the "').concat(t,'"')+" function but got ".concat(n,".")},TypeError);lr("ERR_MISSING_ARGS",function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];_t===void 0&&(_t=ir.exports),_t(t.length>0,"At least one arg needs to be specified");var n="The ",i=t.length;switch(t=t.map(function(o){return'"'.concat(o,'"')}),i){case 1:n+="".concat(t[0]," argument");break;case 2:n+="".concat(t[0]," and ").concat(t[1]," arguments");break;default:n+=t.slice(0,i-1).join(", "),n+=", and ".concat(t[i-1]," arguments");break}return"".concat(n," must be specified")},TypeError);_i.codes=Va;function fo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ho(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?fo(Object(r),!0).forEach(function(n){Ec(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ec(e,t,r){return t=Ka(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function po(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ka(n.key),n)}}function Ac(e,t,r){return t&&po(e.prototype,t),r&&po(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ka(e){var t=Rc(e,"string");return Se(t)==="symbol"?t:String(t)}function Rc(e,t){if(Se(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Se(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Oc(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zt(e,t)}function Pc(e){var t=Ya();return function(){var n=er(e),i;if(t){var o=er(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Qa(this,i)}}function Qa(e,t){if(t&&(Se(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ri(e)}function ri(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ni(e){var t=typeof Map=="function"?new Map:void 0;return ni=function(n){if(n===null||!Tc(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t!="undefined"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return Nr(n,arguments,er(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Zt(i,n)},ni(e)}function Nr(e,t,r){return Ya()?Nr=Reflect.construct.bind():Nr=function(i,o,a){var s=[null];s.push.apply(s,o);var l=Function.bind.apply(i,s),u=new l;return a&&Zt(u,a.prototype),u},Nr.apply(null,arguments)}function Ya(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Tc(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function Zt(e,t){return Zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Zt(e,t)}function er(e){return er=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},er(e)}function Se(e){return Se=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Se(e)}var jc=Ce,ii=jc.inspect,Cc=_i,Nc=Cc.codes.ERR_INVALID_ARG_TYPE;function vo(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function Mc(e,t){if(t=Math.floor(t),e.length==0||t==0)return"";var r=e.length*t;for(t=Math.floor(Math.log(t)/Math.log(2));t;)e+=e,t--;return e+=e.substring(0,r-e.length),e}var Oe="",Wt="",Ht="",he="",it={deepStrictEqual:"Expected values to be strictly deep-equal:",strictEqual:"Expected values to be strictly equal:",strictEqualObject:'Expected "actual" to be reference-equal to "expected":',deepEqual:"Expected values to be loosely deep-equal:",equal:"Expected values to be loosely equal:",notDeepStrictEqual:'Expected "actual" not to be strictly deep-equal to:',notStrictEqual:'Expected "actual" to be strictly unequal to:',notStrictEqualObject:'Expected "actual" not to be reference-equal to "expected":',notDeepEqual:'Expected "actual" not to be loosely deep-equal to:',notEqual:'Expected "actual" to be loosely unequal to:',notIdentical:"Values identical but not reference-equal:"},$c=10;function go(e){var t=Object.keys(e),r=Object.create(Object.getPrototypeOf(e));return t.forEach(function(n){r[n]=e[n]}),Object.defineProperty(r,"message",{value:e.message}),r}function Gt(e){return ii(e,{compact:!1,customInspect:!1,depth:1e3,maxArrayLength:1/0,showHidden:!1,breakLength:1/0,showProxy:!1,sorted:!0,getters:!0})}function qc(e,t,r){var n="",i="",o=0,a="",s=!1,l=Gt(e),u=l.split(`
`),c=Gt(t).split(`
`),f=0,p="";if(r==="strictEqual"&&Se(e)==="object"&&Se(t)==="object"&&e!==null&&t!==null&&(r="strictEqualObject"),u.length===1&&c.length===1&&u[0]!==c[0]){var d=u[0].length+c[0].length;if(d<=$c){if((Se(e)!=="object"||e===null)&&(Se(t)!=="object"||t===null)&&(e!==0||t!==0))return"".concat(it[r],`

`)+"".concat(u[0]," !== ").concat(c[0],`
`)}else if(r!=="strictEqualObject"){var v=$.process.stderr&&$.process.stderr.isTTY?$.process.stderr.columns:80;if(d<v){for(;u[0][f]===c[0][f];)f++;f>2&&(p=`
  `.concat(Mc(" ",f),"^"),f=0)}}}for(var k=u[u.length-1],w=c[c.length-1];k===w&&(f++<2?a=`
  `.concat(k).concat(a):n=k,u.pop(),c.pop(),!(u.length===0||c.length===0));)k=u[u.length-1],w=c[c.length-1];var P=Math.max(u.length,c.length);if(P===0){var C=l.split(`
`);if(C.length>30)for(C[26]="".concat(Oe,"...").concat(he);C.length>27;)C.pop();return"".concat(it.notIdentical,`

`).concat(C.join(`
`),`
`)}f>3&&(a=`
`.concat(Oe,"...").concat(he).concat(a),s=!0),n!==""&&(a=`
  `.concat(n).concat(a),n="");var T=0,m=it[r]+`
`.concat(Wt,"+ actual").concat(he," ").concat(Ht,"- expected").concat(he),O=" ".concat(Oe,"...").concat(he," Lines skipped");for(f=0;f<P;f++){var q=f-o;if(u.length<f+1)q>1&&f>2&&(q>4?(i+=`
`.concat(Oe,"...").concat(he),s=!0):q>3&&(i+=`
  `.concat(c[f-2]),T++),i+=`
  `.concat(c[f-1]),T++),o=f,n+=`
`.concat(Ht,"-").concat(he," ").concat(c[f]),T++;else if(c.length<f+1)q>1&&f>2&&(q>4?(i+=`
`.concat(Oe,"...").concat(he),s=!0):q>3&&(i+=`
  `.concat(u[f-2]),T++),i+=`
  `.concat(u[f-1]),T++),o=f,i+=`
`.concat(Wt,"+").concat(he," ").concat(u[f]),T++;else{var S=c[f],G=u[f],D=G!==S&&(!vo(G,",")||G.slice(0,-1)!==S);D&&vo(S,",")&&S.slice(0,-1)===G&&(D=!1,G+=","),D?(q>1&&f>2&&(q>4?(i+=`
`.concat(Oe,"...").concat(he),s=!0):q>3&&(i+=`
  `.concat(u[f-2]),T++),i+=`
  `.concat(u[f-1]),T++),o=f,i+=`
`.concat(Wt,"+").concat(he," ").concat(G),n+=`
`.concat(Ht,"-").concat(he," ").concat(S),T+=2):(i+=n,n="",(q===1||f===0)&&(i+=`
  `.concat(G),T++))}if(T>20&&f<P-2)return"".concat(m).concat(O,`
`).concat(i,`
`).concat(Oe,"...").concat(he).concat(n,`
`)+"".concat(Oe,"...").concat(he)}return"".concat(m).concat(s?O:"",`
`).concat(i).concat(n).concat(a).concat(p)}var Dc=function(e,t){Oc(n,e);var r=Pc(n);function n(i){var o;if(_c(this,n),Se(i)!=="object"||i===null)throw new Nc("options","Object",i);var a=i.message,s=i.operator,l=i.stackStartFn,u=i.actual,c=i.expected,f=Error.stackTraceLimit;if(Error.stackTraceLimit=0,a!=null)o=r.call(this,String(a));else if($.process.stderr&&$.process.stderr.isTTY&&($.process.stderr&&$.process.stderr.getColorDepth&&$.process.stderr.getColorDepth()!==1?(Oe="\x1B[34m",Wt="\x1B[32m",he="\x1B[39m",Ht="\x1B[31m"):(Oe="",Wt="",he="",Ht="")),Se(u)==="object"&&u!==null&&Se(c)==="object"&&c!==null&&"stack"in u&&u instanceof Error&&"stack"in c&&c instanceof Error&&(u=go(u),c=go(c)),s==="deepStrictEqual"||s==="strictEqual")o=r.call(this,qc(u,c,s));else if(s==="notDeepStrictEqual"||s==="notStrictEqual"){var p=it[s],d=Gt(u).split(`
`);if(s==="notStrictEqual"&&Se(u)==="object"&&u!==null&&(p=it.notStrictEqualObject),d.length>30)for(d[26]="".concat(Oe,"...").concat(he);d.length>27;)d.pop();d.length===1?o=r.call(this,"".concat(p," ").concat(d[0])):o=r.call(this,"".concat(p,`

`).concat(d.join(`
`),`
`))}else{var v=Gt(u),k="",w=it[s];s==="notDeepEqual"||s==="notEqual"?(v="".concat(it[s],`

`).concat(v),v.length>1024&&(v="".concat(v.slice(0,1021),"..."))):(k="".concat(Gt(c)),v.length>512&&(v="".concat(v.slice(0,509),"...")),k.length>512&&(k="".concat(k.slice(0,509),"...")),s==="deepEqual"||s==="equal"?v="".concat(w,`

`).concat(v,`

should equal

`):k=" ".concat(s," ").concat(k)),o=r.call(this,"".concat(v).concat(k))}return Error.stackTraceLimit=f,o.generatedMessage=!a,Object.defineProperty(ri(o),"name",{value:"AssertionError [ERR_ASSERTION]",enumerable:!1,writable:!0,configurable:!0}),o.code="ERR_ASSERTION",o.actual=u,o.expected=c,o.operator=s,Error.captureStackTrace&&Error.captureStackTrace(ri(o),l),o.stack,o.name="AssertionError",Qa(o)}return Ac(n,[{key:"toString",value:function(){return"".concat(this.name," [").concat(this.code,"]: ").concat(this.message)}},{key:t,value:function(o,a){return ii(this,ho(ho({},a),{},{customInspect:!1,depth:0}))}}]),n}(ni(Error),ii.custom),Fc=Dc,yo=Object.prototype.toString,Ja=function(t){var r=yo.call(t),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&yo.call(t.callee)==="[object Function]"),n},Xa;if(!Object.keys){var br=Object.prototype.hasOwnProperty,mo=Object.prototype.toString,Lc=Ja,bo=Object.prototype.propertyIsEnumerable,xc=!bo.call({toString:null},"toString"),Bc=bo.call(function(){},"prototype"),wr=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Cn=function(e){var t=e.constructor;return t&&t.prototype===e},Ic={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},zc=function(){if(typeof window=="undefined")return!1;for(var e in window)try{if(!Ic["$"+e]&&br.call(window,e)&&window[e]!==null&&typeof window[e]=="object")try{Cn(window[e])}catch{return!0}}catch{return!0}return!1}(),Uc=function(e){if(typeof window=="undefined"||!zc)return Cn(e);try{return Cn(e)}catch{return!1}};Xa=function(t){var r=t!==null&&typeof t=="object",n=mo.call(t)==="[object Function]",i=Lc(t),o=r&&mo.call(t)==="[object String]",a=[];if(!r&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var s=Bc&&n;if(o&&t.length>0&&!br.call(t,0))for(var l=0;l<t.length;++l)a.push(String(l));if(i&&t.length>0)for(var u=0;u<t.length;++u)a.push(String(u));else for(var c in t)!(s&&c==="prototype")&&br.call(t,c)&&a.push(String(c));if(xc)for(var f=Uc(t),p=0;p<wr.length;++p)!(f&&wr[p]==="constructor")&&br.call(t,wr[p])&&a.push(wr[p]);return a}}var Wc=Xa,Hc=Array.prototype.slice,Gc=Ja,wo=Object.keys,Mr=wo?function(t){return wo(t)}:Wc,So=Object.keys;Mr.shim=function(){if(Object.keys){var t=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);t||(Object.keys=function(n){return Gc(n)?So(Hc.call(n)):So(n)})}else Object.keys=Mr;return Object.keys||Mr};var Za=Mr,Vc=Za,es=Ai(),ts=on,ko=Object,Kc=ts("Array.prototype.push"),Eo=ts("Object.prototype.propertyIsEnumerable"),Qc=es?Object.getOwnPropertySymbols:null,Yc=function(t,r){if(t==null)throw new TypeError("target must be an object");var n=ko(t);if(arguments.length===1)return n;for(var i=1;i<arguments.length;++i){var o=ko(arguments[i]),a=Vc(o),s=es&&(Object.getOwnPropertySymbols||Qc);if(s)for(var l=s(o),u=0;u<l.length;++u){var c=l[u];Eo(o,c)&&Kc(a,c)}for(var f=0;f<a.length;++f){var p=a[f];if(Eo(o,p)){var d=o[p];n[p]=d}}}return n},Nn=Yc,Jc=function(){if(!Object.assign)return!1;for(var e="abcdefghijklmnopqrst",t=e.split(""),r={},n=0;n<t.length;++n)r[t[n]]=t[n];var i=Object.assign({},r),o="";for(var a in i)o+=a;return e!==o},Xc=function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch{return e[1]==="y"}return!1},Zc=function(){return!Object.assign||Jc()||Xc()?Nn:Object.assign},_o=function(e){return e!==e},rs=function(t,r){return t===0&&r===0?1/t===1/r:!!(t===r||_o(t)&&_o(r))},ef=rs,ji=function(){return typeof Object.is=="function"?Object.is:ef},tf=ar,oi=tf("%Object.defineProperty%",!0),ai=function(){if(oi)try{return oi({},"a",{value:1}),!0}catch{return!1}return!1};ai.hasArrayLengthDefineBug=function(){if(!ai())return null;try{return oi([],"length",{value:1}).length!==1}catch{return!0}};var ns=ai,rf=ns(),Ci=ar,Ao=rf&&Ci("%Object.defineProperty%",!0),nf=Ci("%SyntaxError%"),mt=Ci("%TypeError%"),Ro=Wa,of=function(t,r,n){if(!t||typeof t!="object"&&typeof t!="function")throw new mt("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new mt("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new mt("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new mt("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new mt("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new mt("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,l=!!Ro&&Ro(t,r);if(Ao)Ao(t,r,{configurable:a===null&&l?l.configurable:!a,enumerable:i===null&&l?l.enumerable:!i,value:n,writable:o===null&&l?l.writable:!o});else if(s||!i&&!o&&!a)t[r]=n;else throw new nf("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},af=Za,sf=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",lf=Object.prototype.toString,uf=Array.prototype.concat,Oo=of,cf=function(e){return typeof e=="function"&&lf.call(e)==="[object Function]"},is=ns(),ff=function(e,t,r,n){if(t in e){if(n===!0){if(e[t]===r)return}else if(!cf(n)||!n())return}is?Oo(e,t,r,!0):Oo(e,t,r)},os=function(e,t){var r=arguments.length>2?arguments[2]:{},n=af(t);sf&&(n=uf.call(n,Object.getOwnPropertySymbols(t)));for(var i=0;i<n.length;i+=1)ff(e,n[i],t[n[i]],r[n[i]])};os.supportsDescriptors=!!is;var sn=os,df=ji,hf=sn,pf=function(){var t=df();return hf(Object,{is:t},{is:function(){return Object.is!==t}}),t},vf=sn,gf=sr.exports,yf=rs,as=ji,mf=pf,ss=gf(as(),Object);vf(ss,{getPolyfill:as,implementation:yf,shim:mf});var bf=ss,ls=function(t){return t!==t},wf=ls,us=function(){return Number.isNaN&&Number.isNaN(NaN)&&!Number.isNaN("a")?Number.isNaN:wf},Sf=sn,kf=us,Ef=function(){var t=kf();return Sf(Number,{isNaN:t},{isNaN:function(){return Number.isNaN!==t}}),t},_f=sr.exports,Af=sn,Rf=ls,cs=us,Of=Ef,fs=_f(cs(),Number);Af(fs,{getPolyfill:cs,implementation:Rf,shim:Of});var Pf=fs;function Po(e,t){return Nf(e)||Cf(e,t)||jf(e,t)||Tf()}function Tf(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jf(e,t){if(!!e){if(typeof e=="string")return To(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return To(e,t)}}function To(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Cf(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,o,a,s=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&r.return!=null&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return s}}function Nf(e){if(Array.isArray(e))return e}function ke(e){return ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ke(e)}var Mf=/a/g.flags!==void 0,Qr=function(t){var r=[];return t.forEach(function(n){return r.push(n)}),r},jo=function(t){var r=[];return t.forEach(function(n,i){return r.push([i,n])}),r},ds=Object.is?Object.is:bf,$r=Object.getOwnPropertySymbols?Object.getOwnPropertySymbols:function(){return[]},si=Number.isNaN?Number.isNaN:Pf;function Ni(e){return e.call.bind(e)}var zt=Ni(Object.prototype.hasOwnProperty),qr=Ni(Object.prototype.propertyIsEnumerable),Co=Ni(Object.prototype.toString),be=Ce.types,$f=be.isAnyArrayBuffer,qf=be.isArrayBufferView,No=be.isDate,Sr=be.isMap,Mo=be.isRegExp,kr=be.isSet,Df=be.isNativeError,Ff=be.isBoxedPrimitive,$o=be.isNumberObject,qo=be.isStringObject,Do=be.isBooleanObject,Fo=be.isBigIntObject,Lf=be.isSymbolObject,xf=be.isFloat32Array,Bf=be.isFloat64Array;function If(e){if(e.length===0||e.length>10)return!0;for(var t=0;t<e.length;t++){var r=e.charCodeAt(t);if(r<48||r>57)return!0}return e.length===10&&e>=Math.pow(2,32)}function Er(e){return Object.keys(e).filter(If).concat($r(e).filter(Object.prototype.propertyIsEnumerable.bind(e)))}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function hs(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0}var zf=!0,Uf=!1,li=0,Mi=1,ps=2,vs=3;function Wf(e,t){return Mf?e.source===t.source&&e.flags===t.flags:RegExp.prototype.toString.call(e)===RegExp.prototype.toString.call(t)}function Hf(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Gf(e,t){return e.byteLength!==t.byteLength?!1:hs(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))===0}function Vf(e,t){return e.byteLength===t.byteLength&&hs(new Uint8Array(e),new Uint8Array(t))===0}function Kf(e,t){return $o(e)?$o(t)&&ds(Number.prototype.valueOf.call(e),Number.prototype.valueOf.call(t)):qo(e)?qo(t)&&String.prototype.valueOf.call(e)===String.prototype.valueOf.call(t):Do(e)?Do(t)&&Boolean.prototype.valueOf.call(e)===Boolean.prototype.valueOf.call(t):Fo(e)?Fo(t)&&BigInt.prototype.valueOf.call(e)===BigInt.prototype.valueOf.call(t):Lf(t)&&Symbol.prototype.valueOf.call(e)===Symbol.prototype.valueOf.call(t)}function Ee(e,t,r,n){if(e===t)return e!==0?!0:r?ds(e,t):!0;if(r){if(ke(e)!=="object")return typeof e=="number"&&si(e)&&si(t);if(ke(t)!=="object"||e===null||t===null||Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1}else{if(e===null||ke(e)!=="object")return t===null||ke(t)!=="object"?e==t:!1;if(t===null||ke(t)!=="object")return!1}var i=Co(e),o=Co(t);if(i!==o)return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;var a=Er(e),s=Er(t);return a.length!==s.length?!1:xt(e,t,r,n,Mi,a)}if(i==="[object Object]"&&(!Sr(e)&&Sr(t)||!kr(e)&&kr(t)))return!1;if(No(e)){if(!No(t)||Date.prototype.getTime.call(e)!==Date.prototype.getTime.call(t))return!1}else if(Mo(e)){if(!Mo(t)||!Wf(e,t))return!1}else if(Df(e)||e instanceof Error){if(e.message!==t.message||e.name!==t.name)return!1}else if(qf(e)){if(!r&&(xf(e)||Bf(e))){if(!Hf(e,t))return!1}else if(!Gf(e,t))return!1;var l=Er(e),u=Er(t);return l.length!==u.length?!1:xt(e,t,r,n,li,l)}else{if(kr(e))return!kr(t)||e.size!==t.size?!1:xt(e,t,r,n,ps);if(Sr(e))return!Sr(t)||e.size!==t.size?!1:xt(e,t,r,n,vs);if($f(e)){if(!Vf(e,t))return!1}else if(Ff(e)&&!Kf(e,t))return!1}return xt(e,t,r,n,li)}function Lo(e,t){return t.filter(function(r){return qr(e,r)})}function xt(e,t,r,n,i,o){if(arguments.length===5){o=Object.keys(e);var a=Object.keys(t);if(o.length!==a.length)return!1}for(var s=0;s<o.length;s++)if(!zt(t,o[s]))return!1;if(r&&arguments.length===5){var l=$r(e);if(l.length!==0){var u=0;for(s=0;s<l.length;s++){var c=l[s];if(qr(e,c)){if(!qr(t,c))return!1;o.push(c),u++}else if(qr(t,c))return!1}var f=$r(t);if(l.length!==f.length&&Lo(t,f).length!==u)return!1}else{var p=$r(t);if(p.length!==0&&Lo(t,p).length!==0)return!1}}if(o.length===0&&(i===li||i===Mi&&e.length===0||e.size===0))return!0;if(n===void 0)n={val1:new Map,val2:new Map,position:0};else{var d=n.val1.get(e);if(d!==void 0){var v=n.val2.get(t);if(v!==void 0)return d===v}n.position++}n.val1.set(e,n.position),n.val2.set(t,n.position);var k=Zf(e,t,r,o,n,i);return n.val1.delete(e),n.val2.delete(t),k}function xo(e,t,r,n){for(var i=Qr(e),o=0;o<i.length;o++){var a=i[o];if(Ee(t,a,r,n))return e.delete(a),!0}return!1}function gs(e){switch(ke(e)){case"undefined":return null;case"object":return;case"symbol":return!1;case"string":e=+e;case"number":if(si(e))return!1}return!0}function Qf(e,t,r){var n=gs(r);return n!=null?n:t.has(n)&&!e.has(n)}function Yf(e,t,r,n,i){var o=gs(r);if(o!=null)return o;var a=t.get(o);return a===void 0&&!t.has(o)||!Ee(n,a,!1,i)?!1:!e.has(o)&&Ee(n,a,!1,i)}function Jf(e,t,r,n){for(var i=null,o=Qr(e),a=0;a<o.length;a++){var s=o[a];if(ke(s)==="object"&&s!==null)i===null&&(i=new Set),i.add(s);else if(!t.has(s)){if(r||!Qf(e,t,s))return!1;i===null&&(i=new Set),i.add(s)}}if(i!==null){for(var l=Qr(t),u=0;u<l.length;u++){var c=l[u];if(ke(c)==="object"&&c!==null){if(!xo(i,c,r,n))return!1}else if(!r&&!e.has(c)&&!xo(i,c,r,n))return!1}return i.size===0}return!0}function Bo(e,t,r,n,i,o){for(var a=Qr(e),s=0;s<a.length;s++){var l=a[s];if(Ee(r,l,i,o)&&Ee(n,t.get(l),i,o))return e.delete(l),!0}return!1}function Xf(e,t,r,n){for(var i=null,o=jo(e),a=0;a<o.length;a++){var s=Po(o[a],2),l=s[0],u=s[1];if(ke(l)==="object"&&l!==null)i===null&&(i=new Set),i.add(l);else{var c=t.get(l);if(c===void 0&&!t.has(l)||!Ee(u,c,r,n)){if(r||!Yf(e,t,l,u,n))return!1;i===null&&(i=new Set),i.add(l)}}}if(i!==null){for(var f=jo(t),p=0;p<f.length;p++){var d=Po(f[p],2),v=d[0],k=d[1];if(ke(v)==="object"&&v!==null){if(!Bo(i,e,v,k,r,n))return!1}else if(!r&&(!e.has(v)||!Ee(e.get(v),k,!1,n))&&!Bo(i,e,v,k,!1,n))return!1}return i.size===0}return!0}function Zf(e,t,r,n,i,o){var a=0;if(o===ps){if(!Jf(e,t,r,i))return!1}else if(o===vs){if(!Xf(e,t,r,i))return!1}else if(o===Mi)for(;a<e.length;a++)if(zt(e,a)){if(!zt(t,a)||!Ee(e[a],t[a],r,i))return!1}else{if(zt(t,a))return!1;for(var s=Object.keys(e);a<s.length;a++){var l=s[a];if(!zt(t,l)||!Ee(e[l],t[l],r,i))return!1}return s.length===Object.keys(t).length}for(a=0;a<n.length;a++){var u=n[a];if(!Ee(e[u],t[u],r,i))return!1}return!0}function ed(e,t){return Ee(e,t,Uf)}function td(e,t){return Ee(e,t,zf)}var rd={isDeepEqual:ed,isDeepStrictEqual:td};function Te(e){return Te=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Te(e)}function Io(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,id(n.key),n)}}function nd(e,t,r){return t&&Io(e.prototype,t),r&&Io(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function id(e){var t=od(e,"string");return Te(t)==="symbol"?t:String(t)}function od(e,t){if(Te(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Te(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ad(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var sd=_i,ur=sd.codes,zo=ur.ERR_AMBIGUOUS_ARGUMENT,Nt=ur.ERR_INVALID_ARG_TYPE,ld=ur.ERR_INVALID_ARG_VALUE,ud=ur.ERR_INVALID_RETURN_VALUE,Ze=ur.ERR_MISSING_ARGS,et=Fc,cd=Ce,Dr=cd.inspect,ys=Ce.types,fd=ys.isPromise,Yr=ys.isRegExp,dd=Zc(),ms=ji(),Jr=on("RegExp.prototype.test"),Xe,ln;function cr(){var e=rd;Xe=e.isDeepEqual,ln=e.isDeepStrictEqual}var Uo=!1,te=ir.exports=$i,un={};function Ne(e){throw e.message instanceof Error?e.message:new et(e)}function bs(e,t,r,n,i){var o=arguments.length,a;if(o===0)a="Failed";else if(o===1)r=e,e=void 0;else{if(Uo===!1){Uo=!0;var s=$.process.emitWarning?$.process.emitWarning:console.warn.bind(console);s("assert.fail() with more than one argument is deprecated. Please use assert.strictEqual() instead or only pass a message.","DeprecationWarning","DEP0094")}o===2&&(n="!=")}if(r instanceof Error)throw r;var l={actual:e,expected:t,operator:n===void 0?"fail":n,stackStartFn:i||bs};r!==void 0&&(l.message=r);var u=new et(l);throw a&&(u.message=a,u.generatedMessage=!0),u}te.fail=bs;te.AssertionError=et;function ws(e,t,r,n){if(!r){var i=!1;if(t===0)i=!0,n="No value argument passed to `assert.ok()`";else if(n instanceof Error)throw n;var o=new et({actual:r,expected:!0,message:n,operator:"==",stackStartFn:e});throw o.generatedMessage=i,o}}function $i(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];ws.apply(void 0,[$i,t.length].concat(t))}te.ok=$i;te.equal=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");t!=r&&Ne({actual:t,expected:r,message:n,operator:"==",stackStartFn:e})};te.notEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");t==r&&Ne({actual:t,expected:r,message:n,operator:"!=",stackStartFn:e})};te.deepEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");Xe===void 0&&cr(),Xe(t,r)||Ne({actual:t,expected:r,message:n,operator:"deepEqual",stackStartFn:e})};te.notDeepEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");Xe===void 0&&cr(),Xe(t,r)&&Ne({actual:t,expected:r,message:n,operator:"notDeepEqual",stackStartFn:e})};te.deepStrictEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");Xe===void 0&&cr(),ln(t,r)||Ne({actual:t,expected:r,message:n,operator:"deepStrictEqual",stackStartFn:e})};te.notDeepStrictEqual=Ss;function Ss(e,t,r){if(arguments.length<2)throw new Ze("actual","expected");Xe===void 0&&cr(),ln(e,t)&&Ne({actual:e,expected:t,message:r,operator:"notDeepStrictEqual",stackStartFn:Ss})}te.strictEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");ms(t,r)||Ne({actual:t,expected:r,message:n,operator:"strictEqual",stackStartFn:e})};te.notStrictEqual=function e(t,r,n){if(arguments.length<2)throw new Ze("actual","expected");ms(t,r)&&Ne({actual:t,expected:r,message:n,operator:"notStrictEqual",stackStartFn:e})};var Wo=nd(function e(t,r,n){var i=this;ad(this,e),r.forEach(function(o){o in t&&(n!==void 0&&typeof n[o]=="string"&&Yr(t[o])&&Jr(t[o],n[o])?i[o]=n[o]:i[o]=t[o])})});function hd(e,t,r,n,i,o){if(!(r in e)||!ln(e[r],t[r])){if(!n){var a=new Wo(e,i),s=new Wo(t,i,e),l=new et({actual:a,expected:s,operator:"deepStrictEqual",stackStartFn:o});throw l.actual=e,l.expected=t,l.operator=o.name,l}Ne({actual:e,expected:t,message:n,operator:o.name,stackStartFn:o})}}function ks(e,t,r,n){if(typeof t!="function"){if(Yr(t))return Jr(t,e);if(arguments.length===2)throw new Nt("expected",["Function","RegExp"],t);if(Te(e)!=="object"||e===null){var i=new et({actual:e,expected:t,message:r,operator:"deepStrictEqual",stackStartFn:n});throw i.operator=n.name,i}var o=Object.keys(t);if(t instanceof Error)o.push("name","message");else if(o.length===0)throw new ld("error",t,"may not be an empty object");return Xe===void 0&&cr(),o.forEach(function(a){typeof e[a]=="string"&&Yr(t[a])&&Jr(t[a],e[a])||hd(e,t,a,r,o,n)}),!0}return t.prototype!==void 0&&e instanceof t?!0:Error.isPrototypeOf(t)?!1:t.call({},e)===!0}function Es(e){if(typeof e!="function")throw new Nt("fn","Function",e);try{e()}catch(t){return t}return un}function Ho(e){return fd(e)||e!==null&&Te(e)==="object"&&typeof e.then=="function"&&typeof e.catch=="function"}function _s(e){return Promise.resolve().then(function(){var t;if(typeof e=="function"){if(t=e(),!Ho(t))throw new ud("instance of Promise","promiseFn",t)}else if(Ho(e))t=e;else throw new Nt("promiseFn",["Function","Promise"],e);return Promise.resolve().then(function(){return t}).then(function(){return un}).catch(function(r){return r})})}function As(e,t,r,n){if(typeof r=="string"){if(arguments.length===4)throw new Nt("error",["Object","Error","Function","RegExp"],r);if(Te(t)==="object"&&t!==null){if(t.message===r)throw new zo("error/message",'The error message "'.concat(t.message,'" is identical to the message.'))}else if(t===r)throw new zo("error/message",'The error "'.concat(t,'" is identical to the message.'));n=r,r=void 0}else if(r!=null&&Te(r)!=="object"&&typeof r!="function")throw new Nt("error",["Object","Error","Function","RegExp"],r);if(t===un){var i="";r&&r.name&&(i+=" (".concat(r.name,")")),i+=n?": ".concat(n):".";var o=e.name==="rejects"?"rejection":"exception";Ne({actual:void 0,expected:r,operator:e.name,message:"Missing expected ".concat(o).concat(i),stackStartFn:e})}if(r&&!ks(t,r,n,e))throw t}function Rs(e,t,r,n){if(t!==un){if(typeof r=="string"&&(n=r,r=void 0),!r||ks(t,r)){var i=n?": ".concat(n):".",o=e.name==="doesNotReject"?"rejection":"exception";Ne({actual:t,expected:r,operator:e.name,message:"Got unwanted ".concat(o).concat(i,`
`)+'Actual message: "'.concat(t&&t.message,'"'),stackStartFn:e})}throw t}}te.throws=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];As.apply(void 0,[e,Es(t)].concat(n))};te.rejects=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return _s(t).then(function(o){return As.apply(void 0,[e,o].concat(n))})};te.doesNotThrow=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];Rs.apply(void 0,[e,Es(t)].concat(n))};te.doesNotReject=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return _s(t).then(function(o){return Rs.apply(void 0,[e,o].concat(n))})};te.ifError=function e(t){if(t!=null){var r="ifError got unwanted exception: ";Te(t)==="object"&&typeof t.message=="string"?t.message.length===0&&t.constructor?r+=t.constructor.name:r+=t.message:r+=Dr(t);var n=new et({actual:t,expected:null,operator:"ifError",message:r,stackStartFn:e}),i=t.stack;if(typeof i=="string"){var o=i.split(`
`);o.shift();for(var a=n.stack.split(`
`),s=0;s<o.length;s++){var l=a.indexOf(o[s]);if(l!==-1){a=a.slice(0,l);break}}n.stack="".concat(a.join(`
`),`
`).concat(o.join(`
`))}throw n}};function Os(e,t,r,n,i){if(!Yr(t))throw new Nt("regexp","RegExp",t);var o=i==="match";if(typeof e!="string"||Jr(t,e)!==o){if(r instanceof Error)throw r;var a=!r;r=r||(typeof e!="string"?'The "string" argument must be of type string. Received type '+"".concat(Te(e)," (").concat(Dr(e),")"):(o?"The input did not match the regular expression ":"The input was expected to not match the regular expression ")+"".concat(Dr(t),`. Input:

`).concat(Dr(e),`
`));var s=new et({actual:e,expected:t,message:r,operator:i,stackStartFn:n});throw s.generatedMessage=a,s}}te.match=function e(t,r,n){Os(t,r,n,e,"match")};te.doesNotMatch=function e(t,r,n){Os(t,r,n,e,"doesNotMatch")};function Ps(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];ws.apply(void 0,[Ps,t.length].concat(t))}te.strict=dd(Ps,te,{equal:te.strictEqual,deepEqual:te.deepStrictEqual,notEqual:te.notStrictEqual,notDeepEqual:te.notDeepStrictEqual});te.strict.strict=te.strict;var fr={exports:{}},At=typeof Reflect=="object"?Reflect:null,Go=At&&typeof At.apply=="function"?At.apply:function(t,r,n){return Function.prototype.apply.call(t,r,n)},Fr;At&&typeof At.ownKeys=="function"?Fr=At.ownKeys:Object.getOwnPropertySymbols?Fr=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Fr=function(t){return Object.getOwnPropertyNames(t)};function pd(e){console&&console.warn&&console.warn(e)}var Ts=Number.isNaN||function(t){return t!==t};function ee(){ee.init.call(this)}fr.exports=ee;fr.exports.once=md;ee.EventEmitter=ee;ee.prototype._events=void 0;ee.prototype._eventsCount=0;ee.prototype._maxListeners=void 0;var Vo=10;function cn(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(ee,"defaultMaxListeners",{enumerable:!0,get:function(){return Vo},set:function(e){if(typeof e!="number"||e<0||Ts(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Vo=e}});ee.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ee.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Ts(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function js(e){return e._maxListeners===void 0?ee.defaultMaxListeners:e._maxListeners}ee.prototype.getMaxListeners=function(){return js(this)};ee.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=t==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var a;if(r.length>0&&(a=r[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=o[t];if(l===void 0)return!1;if(typeof l=="function")Go(l,this,r);else for(var u=l.length,c=qs(l,u),n=0;n<u;++n)Go(c[n],this,r);return!0};function Cs(e,t,r,n){var i,o,a;if(cn(r),o=e._events,o===void 0?(o=e._events=Object.create(null),e._eventsCount=0):(o.newListener!==void 0&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),a===void 0)a=o[t]=r,++e._eventsCount;else if(typeof a=="function"?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),i=js(e),i>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,pd(s)}return e}ee.prototype.addListener=function(t,r){return Cs(this,t,r,!1)};ee.prototype.on=ee.prototype.addListener;ee.prototype.prependListener=function(t,r){return Cs(this,t,r,!0)};function vd(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ns(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=vd.bind(n);return i.listener=r,n.wrapFn=i,i}ee.prototype.once=function(t,r){return cn(r),this.on(t,Ns(this,t,r)),this};ee.prototype.prependOnceListener=function(t,r){return cn(r),this.prependListener(t,Ns(this,t,r)),this};ee.prototype.removeListener=function(t,r){var n,i,o,a,s;if(cn(r),i=this._events,i===void 0)return this;if(n=i[t],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||r));else if(typeof n!="function"){for(o=-1,a=n.length-1;a>=0;a--)if(n[a]===r||n[a].listener===r){s=n[a].listener,o=a;break}if(o<0)return this;o===0?n.shift():gd(n,o),n.length===1&&(i[t]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",t,s||r)}return this};ee.prototype.off=ee.prototype.removeListener;ee.prototype.removeAllListeners=function(t){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var o=Object.keys(n),a;for(i=0;i<o.length;++i)a=o[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(t,r[i]);return this};function Ms(e,t,r){var n=e._events;if(n===void 0)return[];var i=n[t];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?yd(i):qs(i,i.length)}ee.prototype.listeners=function(t){return Ms(this,t,!0)};ee.prototype.rawListeners=function(t){return Ms(this,t,!1)};ee.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):$s.call(e,t)};ee.prototype.listenerCount=$s;function $s(e){var t=this._events;if(t!==void 0){var r=t[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}ee.prototype.eventNames=function(){return this._eventsCount>0?Fr(this._events):[]};function qs(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function gd(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function yd(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function md(e,t){return new Promise(function(r,n){function i(a){e.removeListener(t,o),n(a)}function o(){typeof e.removeListener=="function"&&e.removeListener("error",i),r([].slice.call(arguments))}Ds(e,t,o,{once:!0}),t!=="error"&&bd(e,i,{once:!0})})}function bd(e,t,r){typeof e.on=="function"&&Ds(e,"error",t,r)}function Ds(e,t,r,n){if(typeof e.on=="function")n.once?e.once(t,r):e.on(t,r);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(o){n.once&&e.removeEventListener(t,i),r(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var Fs=fr.exports.EventEmitter;function Ko(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Qo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ko(Object(r),!0).forEach(function(n){wd(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ko(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wd(e,t,r){return t=Ls(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Sd(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Yo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ls(n.key),n)}}function kd(e,t,r){return t&&Yo(e.prototype,t),r&&Yo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ls(e){var t=Ed(e,"string");return typeof t=="symbol"?t:String(t)}function Ed(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var _d=nn,Lr=_d.Buffer,Ad=Ce,ui=Ad.inspect,Rd=ui&&ui.custom||"inspect";function Od(e,t,r){Lr.prototype.copy.call(e,t,r)}var Pd=function(){function e(){Sd(this,e),this.head=null,this.tail=null,this.length=0}return kd(e,[{key:"push",value:function(r){var n={data:r,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length}},{key:"unshift",value:function(r){var n={data:r,next:this.head};this.length===0&&(this.tail=n),this.head=n,++this.length}},{key:"shift",value:function(){if(this.length!==0){var r=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,r}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(r){if(this.length===0)return"";for(var n=this.head,i=""+n.data;n=n.next;)i+=r+n.data;return i}},{key:"concat",value:function(r){if(this.length===0)return Lr.alloc(0);for(var n=Lr.allocUnsafe(r>>>0),i=this.head,o=0;i;)Od(i.data,n,o),o+=i.data.length,i=i.next;return n}},{key:"consume",value:function(r,n){var i;return r<this.head.data.length?(i=this.head.data.slice(0,r),this.head.data=this.head.data.slice(r)):r===this.head.data.length?i=this.shift():i=n?this._getString(r):this._getBuffer(r),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(r){var n=this.head,i=1,o=n.data;for(r-=o.length;n=n.next;){var a=n.data,s=r>a.length?a.length:r;if(s===a.length?o+=a:o+=a.slice(0,r),r-=s,r===0){s===a.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=a.slice(s));break}++i}return this.length-=i,o}},{key:"_getBuffer",value:function(r){var n=Lr.allocUnsafe(r),i=this.head,o=1;for(i.data.copy(n),r-=i.data.length;i=i.next;){var a=i.data,s=r>a.length?a.length:r;if(a.copy(n,n.length-r,0,s),r-=s,r===0){s===a.length?(++o,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=a.slice(s));break}++o}return this.length-=o,n}},{key:Rd,value:function(r,n){return ui(this,Qo(Qo({},n),{},{depth:0,customInspect:!1}))}}]),e}();function Td(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,$.process.nextTick(ci,this,e)):$.process.nextTick(ci,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(o){!t&&o?r._writableState?r._writableState.errorEmitted?$.process.nextTick(xr,r):(r._writableState.errorEmitted=!0,$.process.nextTick(Jo,r,o)):$.process.nextTick(Jo,r,o):t?($.process.nextTick(xr,r),t(o)):$.process.nextTick(xr,r)}),this)}function Jo(e,t){ci(e,t),xr(e)}function xr(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function jd(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function ci(e,t){e.emit("error",t)}function Cd(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}var xs={destroy:Td,undestroy:jd,errorOrDestroy:Cd},vt={};function Nd(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Bs={};function Ae(e,t,r){r||(r=Error);function n(o,a,s){return typeof t=="string"?t:t(o,a,s)}var i=function(o){Nd(a,o);function a(s,l,u){return o.call(this,n(s,l,u))||this}return a}(r);i.prototype.name=r.name,i.prototype.code=e,Bs[e]=i}function Xo(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(n){return String(n)}),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:r===2?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}else return"of ".concat(t," ").concat(String(e))}function Md(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function $d(e,t,r){return(r===void 0||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function qd(e,t,r){return typeof r!="number"&&(r=0),r+t.length>e.length?!1:e.indexOf(t,r)!==-1}Ae("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError);Ae("ERR_INVALID_ARG_TYPE",function(e,t,r){var n;typeof t=="string"&&Md(t,"not ")?(n="must not be",t=t.replace(/^not /,"")):n="must be";var i;if($d(e," argument"))i="The ".concat(e," ").concat(n," ").concat(Xo(t,"type"));else{var o=qd(e,".")?"property":"argument";i='The "'.concat(e,'" ').concat(o," ").concat(n," ").concat(Xo(t,"type"))}return i+=". Received type ".concat(typeof r),i},TypeError);Ae("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");Ae("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"});Ae("ERR_STREAM_PREMATURE_CLOSE","Premature close");Ae("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"});Ae("ERR_MULTIPLE_CALLBACK","Callback called multiple times");Ae("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");Ae("ERR_STREAM_WRITE_AFTER_END","write after end");Ae("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);Ae("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError);Ae("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");vt.codes=Bs;var Dd=vt.codes.ERR_INVALID_OPT_VALUE;function Fd(e,t,r){return e.highWaterMark!=null?e.highWaterMark:t?e[r]:null}function Ld(e,t,r,n){var i=Fd(t,n,r);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var o=n?r:"highWaterMark";throw new Dd(o,i)}return Math.floor(i)}return e.objectMode?16:16*1024}var Is={getHighWaterMark:Ld},xd=Bd;function Bd(e,t){if(Mn("noDeprecation"))return e;var r=!1;function n(){if(!r){if(Mn("throwDeprecation"))throw new Error(t);Mn("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}return n}function Mn(e){try{if(!Ye.localStorage)return!1}catch{return!1}var t=Ye.localStorage[e];return t==null?!1:String(t).toLowerCase()==="true"}var zs=oe;function Us(e){var t=this;this.next=null,this.entry=null,this.finish=function(){hh(t,e)}}var Rt;oe.WritableState=dr;var Id={deprecate:xd},Ws=Fs,fn=nn.Buffer,zd=(typeof Ye!="undefined"?Ye:typeof window!="undefined"?window:typeof self!="undefined"?self:{}).Uint8Array||function(){};function Ud(e){return fn.from(e)}function Wd(e){return fn.isBuffer(e)||e instanceof zd}var qi=xs,Hd=Is,Gd=Hd.getHighWaterMark,tt=vt.codes,Vd=tt.ERR_INVALID_ARG_TYPE,Kd=tt.ERR_METHOD_NOT_IMPLEMENTED,Qd=tt.ERR_MULTIPLE_CALLBACK,Yd=tt.ERR_STREAM_CANNOT_PIPE,Jd=tt.ERR_STREAM_DESTROYED,Xd=tt.ERR_STREAM_NULL_VALUES,Zd=tt.ERR_STREAM_WRITE_AFTER_END,eh=tt.ERR_UNKNOWN_ENCODING,Mt=qi.errorOrDestroy;Ie.exports(oe,Ws);function th(){}function dr(e,t,r){Rt=Rt||Ft,e=e||{},typeof r!="boolean"&&(r=t instanceof Rt),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=Gd(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=e.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(i){lh(t,i)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new Us(this)}dr.prototype.getBuffer=function(){for(var t=this.bufferedRequest,r=[];t;)r.push(t),t=t.next;return r};(function(){try{Object.defineProperty(dr.prototype,"buffer",{get:Id.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var Br;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Br=Function.prototype[Symbol.hasInstance],Object.defineProperty(oe,Symbol.hasInstance,{value:function(t){return Br.call(this,t)?!0:this!==oe?!1:t&&t._writableState instanceof dr}})):Br=function(t){return t instanceof this};function oe(e){Rt=Rt||Ft;var t=this instanceof Rt;if(!t&&!Br.call(oe,this))return new oe(e);this._writableState=new dr(e,this,t),this.writable=!0,e&&(typeof e.write=="function"&&(this._write=e.write),typeof e.writev=="function"&&(this._writev=e.writev),typeof e.destroy=="function"&&(this._destroy=e.destroy),typeof e.final=="function"&&(this._final=e.final)),Ws.call(this)}oe.prototype.pipe=function(){Mt(this,new Yd)};function rh(e,t){var r=new Zd;Mt(e,r),$.process.nextTick(t,r)}function nh(e,t,r,n){var i;return r===null?i=new Xd:typeof r!="string"&&!t.objectMode&&(i=new Vd("chunk",["string","Buffer"],r)),i?(Mt(e,i),$.process.nextTick(n,i),!1):!0}oe.prototype.write=function(e,t,r){var n=this._writableState,i=!1,o=!n.objectMode&&Wd(e);return o&&!fn.isBuffer(e)&&(e=Ud(e)),typeof t=="function"&&(r=t,t=null),o?t="buffer":t||(t=n.defaultEncoding),typeof r!="function"&&(r=th),n.ending?rh(this,r):(o||nh(this,n,e,r))&&(n.pendingcb++,i=oh(this,n,o,e,t,r)),i};oe.prototype.cork=function(){this._writableState.corked++};oe.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.bufferProcessing&&e.bufferedRequest&&Hs(this,e))};oe.prototype.setDefaultEncoding=function(t){if(typeof t=="string"&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new eh(t);return this._writableState.defaultEncoding=t,this};Object.defineProperty(oe.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function ih(e,t,r){return!e.objectMode&&e.decodeStrings!==!1&&typeof t=="string"&&(t=fn.from(t,r)),t}Object.defineProperty(oe.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function oh(e,t,r,n,i,o){if(!r){var a=ih(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var s=t.objectMode?1:n.length;t.length+=s;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else fi(e,t,!1,s,n,i,o);return l}function fi(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new Jd("write")):r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function ah(e,t,r,n,i){--t.pendingcb,r?($.process.nextTick(i,n),$.process.nextTick(tr,e,t),e._writableState.errorEmitted=!0,Mt(e,n)):(i(n),e._writableState.errorEmitted=!0,Mt(e,n),tr(e,t))}function sh(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function lh(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(typeof i!="function")throw new Qd;if(sh(r),t)ah(e,r,n,t,i);else{var o=Gs(r)||e.destroyed;!o&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&Hs(e,r),n?$.process.nextTick(Zo,e,r,o,i):Zo(e,r,o,i)}}function Zo(e,t,r,n){r||uh(e,t),t.pendingcb--,n(),tr(e,t)}function uh(e,t){t.length===0&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function Hs(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var a=0,s=!0;r;)i[a]=r,r.isBuf||(s=!1),r=r.next,a+=1;i.allBuffers=s,fi(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new Us(t),t.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,u=r.encoding,c=r.callback,f=t.objectMode?1:l.length;if(fi(e,t,!1,f,l,u,c),r=r.next,t.bufferedRequestCount--,t.writing)break}r===null&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}oe.prototype._write=function(e,t,r){r(new Kd("_write()"))};oe.prototype._writev=null;oe.prototype.end=function(e,t,r){var n=this._writableState;return typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"&&(r=t,t=null),e!=null&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||dh(this,n,r),this};Object.defineProperty(oe.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Gs(e){return e.ending&&e.length===0&&e.bufferedRequest===null&&!e.finished&&!e.writing}function ch(e,t){e._final(function(r){t.pendingcb--,r&&Mt(e,r),t.prefinished=!0,e.emit("prefinish"),tr(e,t)})}function fh(e,t){!t.prefinished&&!t.finalCalled&&(typeof e._final=="function"&&!t.destroyed?(t.pendingcb++,t.finalCalled=!0,$.process.nextTick(ch,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function tr(e,t){var r=Gs(t);if(r&&(fh(e,t),t.pendingcb===0&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}function dh(e,t,r){t.ending=!0,tr(e,t),r&&(t.finished?$.process.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function hh(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}Object.defineProperty(oe.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(t){!this._writableState||(this._writableState.destroyed=t)}});oe.prototype.destroy=qi.destroy;oe.prototype._undestroy=qi.undestroy;oe.prototype._destroy=function(e,t){t(e)};var ph=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t},Ft=De,Vs=Qs,di=zs;Ie.exports(De,Vs);for(var ea=ph(di.prototype),$n=0;$n<ea.length;$n++){var qn=ea[$n];De.prototype[qn]||(De.prototype[qn]=di.prototype[qn])}function De(e){if(!(this instanceof De))return new De(e);Vs.call(this,e),di.call(this,e),this.allowHalfOpen=!0,e&&(e.readable===!1&&(this.readable=!1),e.writable===!1&&(this.writable=!1),e.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",vh)))}Object.defineProperty(De.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(De.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(De.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function vh(){this._writableState.ended||$.process.nextTick(gh,this)}function gh(e){e.end()}Object.defineProperty(De.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(t){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=t,this._writableState.destroyed=t)}});var Di={},hi={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(e,t){var r=nn,n=r.Buffer;function i(a,s){for(var l in a)s[l]=a[l]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=o);function o(a,s,l){return n(a,s,l)}o.prototype=Object.create(n.prototype),i(n,o),o.from=function(a,s,l){if(typeof a=="number")throw new TypeError("Argument must not be a number");return n(a,s,l)},o.alloc=function(a,s,l){if(typeof a!="number")throw new TypeError("Argument must be a number");var u=n(a);return s!==void 0?typeof l=="string"?u.fill(s,l):u.fill(s):u.fill(0),u},o.allocUnsafe=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return n(a)},o.allocUnsafeSlow=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return r.SlowBuffer(a)}})(hi,hi.exports);var Fi=hi.exports.Buffer,ta=Fi.isEncoding||function(e){switch(e=""+e,e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function yh(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function mh(e){var t=yh(e);if(typeof t!="string"&&(Fi.isEncoding===ta||!ta(e)))throw new Error("Unknown encoding: "+e);return t||e}Di.StringDecoder=hr;function hr(e){this.encoding=mh(e);var t;switch(this.encoding){case"utf16le":this.text=_h,this.end=Ah,t=4;break;case"utf8":this.fillLast=Sh,t=4;break;case"base64":this.text=Rh,this.end=Oh,t=3;break;default:this.write=Ph,this.end=Th;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Fi.allocUnsafe(t)}hr.prototype.write=function(e){if(e.length===0)return"";var t,r;if(this.lastNeed){if(t=this.fillLast(e),t===void 0)return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""};hr.prototype.end=Eh;hr.prototype.text=kh;hr.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length};function Dn(e){return e<=127?0:e>>5===6?2:e>>4===14?3:e>>3===30?4:e>>6===2?-1:-2}function bh(e,t,r){var n=t.length-1;if(n<r)return 0;var i=Dn(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||i===-2?0:(i=Dn(t[n]),i>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||i===-2?0:(i=Dn(t[n]),i>=0?(i>0&&(i===2?i=0:e.lastNeed=i-3),i):0))}function wh(e,t,r){if((t[0]&192)!==128)return e.lastNeed=0,"\uFFFD";if(e.lastNeed>1&&t.length>1){if((t[1]&192)!==128)return e.lastNeed=1,"\uFFFD";if(e.lastNeed>2&&t.length>2&&(t[2]&192)!==128)return e.lastNeed=2,"\uFFFD"}}function Sh(e){var t=this.lastTotal-this.lastNeed,r=wh(this,e);if(r!==void 0)return r;if(this.lastNeed<=e.length)return e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length}function kh(e,t){var r=bh(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)}function Eh(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\uFFFD":t}function _h(e,t){if((e.length-t)%2===0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function Ah(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function Rh(e,t){var r=(e.length-t)%3;return r===0?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,r===1?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function Oh(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function Ph(e){return e.toString(this.encoding)}function Th(e){return e&&e.length?this.write(e):""}var ra=vt.codes.ERR_STREAM_PREMATURE_CLOSE;function jh(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}function Ch(){}function Nh(e){return e.setHeader&&typeof e.abort=="function"}function Ks(e,t,r){if(typeof t=="function")return Ks(e,null,t);t||(t={}),r=jh(r||Ch);var n=t.readable||t.readable!==!1&&e.readable,i=t.writable||t.writable!==!1&&e.writable,o=function(){e.writable||s()},a=e._writableState&&e._writableState.finished,s=function(){i=!1,a=!0,n||r.call(e)},l=e._readableState&&e._readableState.endEmitted,u=function(){n=!1,l=!0,i||r.call(e)},c=function(v){r.call(e,v)},f=function(){var v;if(n&&!l)return(!e._readableState||!e._readableState.ended)&&(v=new ra),r.call(e,v);if(i&&!a)return(!e._writableState||!e._writableState.ended)&&(v=new ra),r.call(e,v)},p=function(){e.req.on("finish",s)};return Nh(e)?(e.on("complete",s),e.on("abort",f),e.req?p():e.on("request",p)):i&&!e._writableState&&(e.on("end",o),e.on("close",o)),e.on("end",u),e.on("finish",s),t.error!==!1&&e.on("error",c),e.on("close",f),function(){e.removeListener("complete",s),e.removeListener("abort",f),e.removeListener("request",p),e.req&&e.req.removeListener("finish",s),e.removeListener("end",o),e.removeListener("close",o),e.removeListener("finish",s),e.removeListener("end",u),e.removeListener("error",c),e.removeListener("close",f)}}var Li=Ks,_r;function He(e,t,r){return t=Mh(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mh(e){var t=$h(e,"string");return typeof t=="symbol"?t:String(t)}function $h(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var qh=Li,Ge=Symbol("lastResolve"),rt=Symbol("lastReject"),Vt=Symbol("error"),Xr=Symbol("ended"),ot=Symbol("lastPromise"),xi=Symbol("handlePromise"),at=Symbol("stream");function Ve(e,t){return{value:e,done:t}}function Dh(e){var t=e[Ge];if(t!==null){var r=e[at].read();r!==null&&(e[ot]=null,e[Ge]=null,e[rt]=null,t(Ve(r,!1)))}}function Fh(e){$.process.nextTick(Dh,e)}function Lh(e,t){return function(r,n){e.then(function(){if(t[Xr]){r(Ve(void 0,!0));return}t[xi](r,n)},n)}}var xh=Object.getPrototypeOf(function(){}),Bh=Object.setPrototypeOf((_r={get stream(){return this[at]},next:function(){var t=this,r=this[Vt];if(r!==null)return Promise.reject(r);if(this[Xr])return Promise.resolve(Ve(void 0,!0));if(this[at].destroyed)return new Promise(function(a,s){$.process.nextTick(function(){t[Vt]?s(t[Vt]):a(Ve(void 0,!0))})});var n=this[ot],i;if(n)i=new Promise(Lh(n,this));else{var o=this[at].read();if(o!==null)return Promise.resolve(Ve(o,!1));i=new Promise(this[xi])}return this[ot]=i,i}},He(_r,Symbol.asyncIterator,function(){return this}),He(_r,"return",function(){var t=this;return new Promise(function(r,n){t[at].destroy(null,function(i){if(i){n(i);return}r(Ve(void 0,!0))})})}),_r),xh),Ih=function(t){var r,n=Object.create(Bh,(r={},He(r,at,{value:t,writable:!0}),He(r,Ge,{value:null,writable:!0}),He(r,rt,{value:null,writable:!0}),He(r,Vt,{value:null,writable:!0}),He(r,Xr,{value:t._readableState.endEmitted,writable:!0}),He(r,xi,{value:function(o,a){var s=n[at].read();s?(n[ot]=null,n[Ge]=null,n[rt]=null,o(Ve(s,!1))):(n[Ge]=o,n[rt]=a)},writable:!0}),r));return n[ot]=null,qh(t,function(i){if(i&&i.code!=="ERR_STREAM_PREMATURE_CLOSE"){var o=n[rt];o!==null&&(n[ot]=null,n[Ge]=null,n[rt]=null,o(i)),n[Vt]=i;return}var a=n[Ge];a!==null&&(n[ot]=null,n[Ge]=null,n[rt]=null,a(Ve(void 0,!0))),n[Xr]=!0}),t.on("readable",Fh.bind(null,n)),n},zh=Ih,Uh=function(){throw new Error("Readable.from is not available in the browser")},Qs=Q,Ot;Q.ReadableState=Js;fr.exports.EventEmitter;var Ys=function(t,r){return t.listeners(r).length},pr=Fs,dn=nn.Buffer,Wh=(typeof Ye!="undefined"?Ye:typeof window!="undefined"?window:typeof self!="undefined"?self:{}).Uint8Array||function(){};function Hh(e){return dn.from(e)}function Gh(e){return dn.isBuffer(e)||e instanceof Wh}var Fn=Ce,z;Fn&&Fn.debuglog?z=Fn.debuglog("stream"):z=function(){};var Vh=Pd,Bi=xs,Kh=Is,Qh=Kh.getHighWaterMark,hn=vt.codes,Yh=hn.ERR_INVALID_ARG_TYPE,Jh=hn.ERR_STREAM_PUSH_AFTER_EOF,Xh=hn.ERR_METHOD_NOT_IMPLEMENTED,Zh=hn.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,Pt,Ln,xn;Ie.exports(Q,pr);var Kt=Bi.errorOrDestroy,Bn=["error","close","destroy","pause","resume"];function ep(e,t,r){if(typeof e.prependListener=="function")return e.prependListener(t,r);!e._events||!e._events[t]?e.on(t,r):Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]}function Js(e,t,r){Ot=Ot||Ft,e=e||{},typeof r!="boolean"&&(r=t instanceof Ot),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=Qh(this,e,"readableHighWaterMark",r),this.buffer=new Vh,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=e.emitClose!==!1,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(Pt||(Pt=Di.StringDecoder),this.decoder=new Pt(e.encoding),this.encoding=e.encoding)}function Q(e){if(Ot=Ot||Ft,!(this instanceof Q))return new Q(e);var t=this instanceof Ot;this._readableState=new Js(e,this,t),this.readable=!0,e&&(typeof e.read=="function"&&(this._read=e.read),typeof e.destroy=="function"&&(this._destroy=e.destroy)),pr.call(this)}Object.defineProperty(Q.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(t){!this._readableState||(this._readableState.destroyed=t)}});Q.prototype.destroy=Bi.destroy;Q.prototype._undestroy=Bi.undestroy;Q.prototype._destroy=function(e,t){t(e)};Q.prototype.push=function(e,t){var r=this._readableState,n;return r.objectMode?n=!0:typeof e=="string"&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=dn.from(e,t),t=""),n=!0),Xs(this,e,t,!1,n)};Q.prototype.unshift=function(e){return Xs(this,e,null,!0,!1)};function Xs(e,t,r,n,i){z("readableAddChunk",t);var o=e._readableState;if(t===null)o.reading=!1,np(e,o);else{var a;if(i||(a=tp(o,t)),a)Kt(e,a);else if(o.objectMode||t&&t.length>0)if(typeof t!="string"&&!o.objectMode&&Object.getPrototypeOf(t)!==dn.prototype&&(t=Hh(t)),n)o.endEmitted?Kt(e,new Zh):In(e,o,t,!0);else if(o.ended)Kt(e,new Jh);else{if(o.destroyed)return!1;o.reading=!1,o.decoder&&!r?(t=o.decoder.write(t),o.objectMode||t.length!==0?In(e,o,t,!1):pi(e,o)):In(e,o,t,!1)}else n||(o.reading=!1,pi(e,o))}return!o.ended&&(o.length<o.highWaterMark||o.length===0)}function In(e,t,r,n){t.flowing&&t.length===0&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&pn(e)),pi(e,t)}function tp(e,t){var r;return!Gh(t)&&typeof t!="string"&&t!==void 0&&!e.objectMode&&(r=new Yh("chunk",["string","Buffer","Uint8Array"],t)),r}Q.prototype.isPaused=function(){return this._readableState.flowing===!1};Q.prototype.setEncoding=function(e){Pt||(Pt=Di.StringDecoder);var t=new Pt(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";r!==null;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),n!==""&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var na=1073741824;function rp(e){return e>=na?e=na:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function ia(e,t){return e<=0||t.length===0&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=rp(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}Q.prototype.read=function(e){z("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(e!==0&&(t.emittedReadable=!1),e===0&&t.needReadable&&((t.highWaterMark!==0?t.length>=t.highWaterMark:t.length>0)||t.ended))return z("read: emitReadable",t.length,t.ended),t.length===0&&t.ended?zn(this):pn(this),null;if(e=ia(e,t),e===0&&t.ended)return t.length===0&&zn(this),null;var n=t.needReadable;z("need readable",n),(t.length===0||t.length-e<t.highWaterMark)&&(n=!0,z("length less than watermark",n)),t.ended||t.reading?(n=!1,z("reading or ended",n)):n&&(z("do read"),t.reading=!0,t.sync=!0,t.length===0&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=ia(r,t)));var i;return e>0?i=tl(e,t):i=null,i===null?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),t.length===0&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&zn(this)),i!==null&&this.emit("data",i),i};function np(e,t){if(z("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?pn(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,Zs(e)))}}function pn(e){var t=e._readableState;z("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(z("emitReadable",t.flowing),t.emittedReadable=!0,$.process.nextTick(Zs,e))}function Zs(e){var t=e._readableState;z("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,Ii(e)}function pi(e,t){t.readingMore||(t.readingMore=!0,$.process.nextTick(ip,e,t))}function ip(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&t.length===0);){var r=t.length;if(z("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}Q.prototype._read=function(e){Kt(this,new Xh("_read()"))};Q.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e);break}n.pipesCount+=1,z("pipe count=%d opts=%j",n.pipesCount,t);var i=(!t||t.end!==!1)&&e!==$.process.stdout&&e!==$.process.stderr,o=i?s:k;n.endEmitted?$.process.nextTick(o):r.once("end",o),e.on("unpipe",a);function a(w,P){z("onunpipe"),w===r&&P&&P.hasUnpiped===!1&&(P.hasUnpiped=!0,c())}function s(){z("onend"),e.end()}var l=op(r);e.on("drain",l);var u=!1;function c(){z("cleanup"),e.removeListener("close",d),e.removeListener("finish",v),e.removeListener("drain",l),e.removeListener("error",p),e.removeListener("unpipe",a),r.removeListener("end",s),r.removeListener("end",k),r.removeListener("data",f),u=!0,n.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&l()}r.on("data",f);function f(w){z("ondata");var P=e.write(w);z("dest.write",P),P===!1&&((n.pipesCount===1&&n.pipes===e||n.pipesCount>1&&rl(n.pipes,e)!==-1)&&!u&&(z("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function p(w){z("onerror",w),k(),e.removeListener("error",p),Ys(e,"error")===0&&Kt(e,w)}ep(e,"error",p);function d(){e.removeListener("finish",v),k()}e.once("close",d);function v(){z("onfinish"),e.removeListener("close",d),k()}e.once("finish",v);function k(){z("unpipe"),r.unpipe(e)}return e.emit("pipe",r),n.flowing||(z("pipe resume"),r.resume()),e};function op(e){return function(){var r=e._readableState;z("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&Ys(e,"data")&&(r.flowing=!0,Ii(e))}}Q.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(t.pipesCount===0)return this;if(t.pipesCount===1)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,{hasUnpiped:!1});return this}var a=rl(t.pipes,e);return a===-1?this:(t.pipes.splice(a,1),t.pipesCount-=1,t.pipesCount===1&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r),this)};Q.prototype.on=function(e,t){var r=pr.prototype.on.call(this,e,t),n=this._readableState;return e==="data"?(n.readableListening=this.listenerCount("readable")>0,n.flowing!==!1&&this.resume()):e==="readable"&&!n.endEmitted&&!n.readableListening&&(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,z("on readable",n.length,n.reading),n.length?pn(this):n.reading||$.process.nextTick(ap,this)),r};Q.prototype.addListener=Q.prototype.on;Q.prototype.removeListener=function(e,t){var r=pr.prototype.removeListener.call(this,e,t);return e==="readable"&&$.process.nextTick(el,this),r};Q.prototype.removeAllListeners=function(e){var t=pr.prototype.removeAllListeners.apply(this,arguments);return(e==="readable"||e===void 0)&&$.process.nextTick(el,this),t};function el(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function ap(e){z("readable nexttick read 0"),e.read(0)}Q.prototype.resume=function(){var e=this._readableState;return e.flowing||(z("resume"),e.flowing=!e.readableListening,sp(this,e)),e.paused=!1,this};function sp(e,t){t.resumeScheduled||(t.resumeScheduled=!0,$.process.nextTick(lp,e,t))}function lp(e,t){z("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),Ii(e),t.flowing&&!t.reading&&e.read(0)}Q.prototype.pause=function(){return z("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(z("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Ii(e){var t=e._readableState;for(z("flow",t.flowing);t.flowing&&e.read()!==null;);}Q.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;e.on("end",function(){if(z("wrapped end"),r.decoder&&!r.ended){var a=r.decoder.end();a&&a.length&&t.push(a)}t.push(null)}),e.on("data",function(a){if(z("wrapped data"),r.decoder&&(a=r.decoder.write(a)),!(r.objectMode&&a==null)&&!(!r.objectMode&&(!a||!a.length))){var s=t.push(a);s||(n=!0,e.pause())}});for(var i in e)this[i]===void 0&&typeof e[i]=="function"&&(this[i]=function(s){return function(){return e[s].apply(e,arguments)}}(i));for(var o=0;o<Bn.length;o++)e.on(Bn[o],this.emit.bind(this,Bn[o]));return this._read=function(a){z("wrapped _read",a),n&&(n=!1,e.resume())},this};typeof Symbol=="function"&&(Q.prototype[Symbol.asyncIterator]=function(){return Ln===void 0&&(Ln=zh),Ln(this)});Object.defineProperty(Q.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(Q.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(Q.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}});Q._fromList=tl;Object.defineProperty(Q.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function tl(e,t){if(t.length===0)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(t.decoder?r=t.buffer.join(""):t.buffer.length===1?r=t.buffer.first():r=t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r}function zn(e){var t=e._readableState;z("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,$.process.nextTick(up,t,e))}function up(e,t){if(z("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&e.length===0&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}typeof Symbol=="function"&&(Q.from=function(e,t){return xn===void 0&&(xn=Uh),xn(Q,e,t)});function rl(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}var nl=ze,vn=vt.codes,cp=vn.ERR_METHOD_NOT_IMPLEMENTED,fp=vn.ERR_MULTIPLE_CALLBACK,dp=vn.ERR_TRANSFORM_ALREADY_TRANSFORMING,hp=vn.ERR_TRANSFORM_WITH_LENGTH_0,gn=Ft;Ie.exports(ze,gn);function pp(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(n===null)return this.emit("error",new fp);r.writechunk=null,r.writecb=null,t!=null&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function ze(e){if(!(this instanceof ze))return new ze(e);gn.call(this,e),this._transformState={afterTransform:pp.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.on("prefinish",vp)}function vp(){var e=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(t,r){oa(e,t,r)}):oa(this,null,null)}ze.prototype.push=function(e,t){return this._transformState.needTransform=!1,gn.prototype.push.call(this,e,t)};ze.prototype._transform=function(e,t,r){r(new cp("_transform()"))};ze.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};ze.prototype._read=function(e){var t=this._transformState;t.writechunk!==null&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0};ze.prototype._destroy=function(e,t){gn.prototype._destroy.call(this,e,function(r){t(r)})};function oa(e,t,r){if(t)return e.emit("error",t);if(r!=null&&e.push(r),e._writableState.length)throw new hp;if(e._transformState.transforming)throw new dp;return e.push(null)}var gp=rr,il=nl;Ie.exports(rr,il);function rr(e){if(!(this instanceof rr))return new rr(e);il.call(this,e)}rr.prototype._transform=function(e,t,r){r(null,e)};var Un;function yp(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}var ol=vt.codes,mp=ol.ERR_MISSING_ARGS,bp=ol.ERR_STREAM_DESTROYED;function aa(e){if(e)throw e}function wp(e){return e.setHeader&&typeof e.abort=="function"}function Sp(e,t,r,n){n=yp(n);var i=!1;e.on("close",function(){i=!0}),Un===void 0&&(Un=Li),Un(e,{readable:t,writable:r},function(a){if(a)return n(a);i=!0,n()});var o=!1;return function(a){if(!i&&!o){if(o=!0,wp(e))return e.abort();if(typeof e.destroy=="function")return e.destroy();n(a||new bp("pipe"))}}}function sa(e){e()}function kp(e,t){return e.pipe(t)}function Ep(e){return!e.length||typeof e[e.length-1]!="function"?aa:e.pop()}function _p(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=Ep(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new mp("streams");var i,o=t.map(function(a,s){var l=s<t.length-1,u=s>0;return Sp(a,l,u,function(c){i||(i=c),c&&o.forEach(sa),!l&&(o.forEach(sa),n(i))})});return t.reduce(kp)}var Ap=_p,Rp=_e,zi=fr.exports.EventEmitter,Op=Ie.exports;Op(_e,zi);_e.Readable=Qs;_e.Writable=zs;_e.Duplex=Ft;_e.Transform=nl;_e.PassThrough=gp;_e.finished=Li;_e.pipeline=Ap;_e.Stream=_e;function _e(){zi.call(this)}_e.prototype.pipe=function(e,t){var r=this;function n(c){e.writable&&e.write(c)===!1&&r.pause&&r.pause()}r.on("data",n);function i(){r.readable&&r.resume&&r.resume()}e.on("drain",i),!e._isStdio&&(!t||t.end!==!1)&&(r.on("end",a),r.on("close",s));var o=!1;function a(){o||(o=!0,e.end())}function s(){o||(o=!0,typeof e.destroy=="function"&&e.destroy())}function l(c){if(u(),zi.listenerCount(this,"error")===0)throw c}r.on("error",l),e.on("error",l);function u(){r.removeListener("data",n),e.removeListener("drain",i),r.removeListener("end",a),r.removeListener("close",s),r.removeListener("error",l),e.removeListener("error",l),r.removeListener("end",u),r.removeListener("close",u),e.removeListener("close",u)}return r.on("end",u),r.on("close",u),e.on("close",u),e.emit("pipe",r),e};var Ir=ir.exports,Pp=Rp.Stream,Tp=Ce,jp=/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/;function Wn(e){return e.charAt(0).toUpperCase()+e.slice(1)}function We(e,t,r,n,i){throw new Ir.AssertionError({message:Tp.format("%s (%s) is required",e,t),actual:i===void 0?typeof n:i(n),expected:t,operator:r||"===",stackStartFunction:We.caller})}function Hn(e){return Object.prototype.toString.call(e).slice(8,-1)}function bt(){}var Bt={bool:{check:function(e){return typeof e=="boolean"}},func:{check:function(e){return typeof e=="function"}},string:{check:function(e){return typeof e=="string"}},object:{check:function(e){return typeof e=="object"&&e!==null}},number:{check:function(e){return typeof e=="number"&&!isNaN(e)}},finite:{check:function(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}},buffer:{check:function(e){return $.Buffer.isBuffer(e)},operator:"Buffer.isBuffer"},array:{check:function(e){return Array.isArray(e)},operator:"Array.isArray"},stream:{check:function(e){return e instanceof Pp},operator:"instanceof",actual:Hn},date:{check:function(e){return e instanceof Date},operator:"instanceof",actual:Hn},regexp:{check:function(e){return e instanceof RegExp},operator:"instanceof",actual:Hn},uuid:{check:function(e){return typeof e=="string"&&jp.test(e)},operator:"isUUID"}};function al(e){var t=Object.keys(Bt),r;return{}.NODE_NDEBUG?r=bt:r=function(n,i){n||We(i,"true",n)},t.forEach(function(n){if(e){r[n]=bt;return}var i=Bt[n];r[n]=function(o,a){i.check(o)||We(a,n,i.operator,o,i.actual)}}),t.forEach(function(n){var i="optional"+Wn(n);if(e){r[i]=bt;return}var o=Bt[n];r[i]=function(a,s){a!=null&&(o.check(a)||We(s,n,o.operator,a,o.actual))}}),t.forEach(function(n){var i="arrayOf"+Wn(n);if(e){r[i]=bt;return}var o=Bt[n],a="["+n+"]";r[i]=function(s,l){Array.isArray(s)||We(l,a,o.operator,s,o.actual);var u;for(u=0;u<s.length;u++)o.check(s[u])||We(l,a,o.operator,s,o.actual)}}),t.forEach(function(n){var i="optionalArrayOf"+Wn(n);if(e){r[i]=bt;return}var o=Bt[n],a="["+n+"]";r[i]=function(s,l){if(s!=null){Array.isArray(s)||We(l,a,o.operator,s,o.actual);var u;for(u=0;u<s.length;u++)o.check(s[u])||We(l,a,o.operator,s,o.actual)}}}),Object.keys(Ir).forEach(function(n){if(n==="AssertionError"){r[n]=Ir[n];return}if(e){r[n]=bt;return}r[n]=Ir[n]}),r._setExports=al,r}var Cp=al({}.NODE_NDEBUG),yn={},Ut=ir.exports,Np=Ce;yn.sprintf=Ui;yn.printf=Mp;yn.fprintf=sl;function Ui(e){var t=["([^%]*)","%","(['\\-+ #0]*?)","([1-9]\\d*)?","(\\.([1-9]\\d*))?","[lhjztL]*?","([diouxXfFeEgGaAcCsSp%jr])"].join(""),r=new RegExp(t),n=Array.prototype.slice.call(arguments,1),i=e,o,a,s,l,u,c,f,p,d,v="",k=1,w=0,P,C;for(Ut.equal("string",typeof i,"first argument must be a format string");(d=r.exec(i))!==null;){if(v+=d[1],i=i.substring(d[0].length),C=d[0].substring(d[1].length),P=w+d[1].length+1,w+=d[0].length,o=d[2]||"",a=d[3]||0,s=d[4]||"",l=d[6],u=!1,f=!1,c=" ",l=="%"){v+="%";continue}if(n.length===0)throw It(e,P,C,"has no matching argument (too few arguments passed)");if(p=n.shift(),k++,o.match(/[\' #]/))throw It(e,P,C,"uses unsupported flags");if(s.length>0)throw It(e,P,C,"uses non-zero precision (not supported)");switch(o.match(/-/)&&(u=!0),o.match(/0/)&&(c="0"),o.match(/\+/)&&(f=!0),l){case"s":if(p==null)throw It(e,P,C,"attempted to print undefined or null as a string (argument "+k+" to sprintf)");v+=Gn(c,a,u,p.toString());break;case"d":p=Math.floor(p);case"f":f=f&&p>0?"+":"",v+=f+Gn(c,a,u,p.toString());break;case"x":v+=Gn(c,a,u,p.toString(16));break;case"j":a===0&&(a=10),v+=Np.inspect(p,!1,a);break;case"r":v+=ll(p);break;default:throw It(e,P,C,"is not supported")}}return v+=i,v}function It(e,t,r,n){return Ut.equal(typeof e,"string"),Ut.equal(typeof r,"string"),Ut.equal(typeof t,"number"),Ut.equal(typeof n,"string"),new Error('format string "'+e+'": conversion specifier "'+r+'" at character '+t+" "+n)}function Mp(){var e=Array.prototype.slice.call(arguments);e.unshift($.process.stdout),sl.apply(null,e)}function sl(e){var t=Array.prototype.slice.call(arguments,1);return e.write(Ui.apply(this,t))}function Gn(e,t,r,n){for(var i=n;i.length<t;)r?i+=e:i=e+i;return i}function ll(e){var t;if(!(e instanceof Error))throw new Error(Ui("invalid type for %%r: %j",e));if(t="EXCEPTION: "+e.constructor.name+": "+e.stack,e.cause&&typeof e.cause=="function"){var r=e.cause();r&&(t+=`
Caused by: `+ll(r))}return t}var ye={};function $p(e){return Array.isArray?Array.isArray(e):mn(e)==="[object Array]"}ye.isArray=$p;function qp(e){return typeof e=="boolean"}ye.isBoolean=qp;function Dp(e){return e===null}ye.isNull=Dp;function Fp(e){return e==null}ye.isNullOrUndefined=Fp;function Lp(e){return typeof e=="number"}ye.isNumber=Lp;function xp(e){return typeof e=="string"}ye.isString=xp;function Bp(e){return typeof e=="symbol"}ye.isSymbol=Bp;function Ip(e){return e===void 0}ye.isUndefined=Ip;function zp(e){return mn(e)==="[object RegExp]"}ye.isRegExp=zp;function Up(e){return typeof e=="object"&&e!==null}ye.isObject=Up;function Wp(e){return mn(e)==="[object Date]"}ye.isDate=Wp;function Hp(e){return mn(e)==="[object Error]"||e instanceof Error}ye.isError=Hp;function Gp(e){return typeof e=="function"}ye.isFunction=Gp;function Vp(e){return e===null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||typeof e=="symbol"||typeof e=="undefined"}ye.isPrimitive=Vp;ye.isBuffer=$.Buffer.isBuffer;function mn(e){return Object.prototype.toString.call(e)}var ue=Cp,bn=Ce,Kp=yn,je=ye.isError,Qp=Kp.sprintf,ae=K;K.VError=K;K.SError=Qt;K.WError=Qe;K.MultiError=Lt;function Wi(e){var t,r,n,i,o;if(ue.object(e,"args"),ue.bool(e.strict,"args.strict"),ue.array(e.argv,"args.argv"),t=e.argv,t.length===0)r={},n=[];else if(je(t[0]))r={cause:t[0]},n=t.slice(1);else if(typeof t[0]=="object"){r={};for(o in t[0])r[o]=t[0][o];n=t.slice(1)}else ue.string(t[0],"first argument to VError, SError, or WError constructor must be a string, object, or Error"),r={},n=t;return ue.object(r),!r.strict&&!e.strict&&(n=n.map(function(a){return a===null?"null":a===void 0?"undefined":a})),n.length===0?i="":i=Qp.apply(null,n),{options:r,shortmessage:i}}function K(){var e,t,r,n,i,o,a;if(e=Array.prototype.slice.call(arguments,0),!(this instanceof K))return t=Object.create(K.prototype),K.apply(t,arguments),t;if(r=Wi({argv:e,strict:!1}),r.options.name&&(ue.string(r.options.name,`error's "name" must be a string`),this.name=r.options.name),this.jse_shortmsg=r.shortmessage,o=r.shortmessage,n=r.options.cause,n&&(ue.ok(je(n),"cause is not an Error"),this.jse_cause=n,r.options.skipCauseMessage||(o+=": "+n.message)),this.jse_info={},r.options.info)for(a in r.options.info)this.jse_info[a]=r.options.info[a];return this.message=o,Error.call(this,o),Error.captureStackTrace&&(i=r.options.constructorOpt||this.constructor,Error.captureStackTrace(this,i)),this}bn.inherits(K,Error);K.prototype.name="VError";K.prototype.toString=function(){var t=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(t+=": "+this.message),t};K.prototype.cause=function(){var t=K.cause(this);return t===null?void 0:t};K.cause=function(e){return ue.ok(je(e),"err must be an Error"),je(e.jse_cause)?e.jse_cause:null};K.info=function(e){var t,r,n;if(ue.ok(je(e),"err must be an Error"),r=K.cause(e),r!==null?t=K.info(r):t={},typeof e.jse_info=="object"&&e.jse_info!==null)for(n in e.jse_info)t[n]=e.jse_info[n];return t};K.findCauseByName=function(e,t){var r;for(ue.ok(je(e),"err must be an Error"),ue.string(t,"name"),ue.ok(t.length>0,"name cannot be empty"),r=e;r!==null;r=K.cause(r))if(ue.ok(je(r)),r.name==t)return r;return null};K.hasCauseWithName=function(e,t){return K.findCauseByName(e,t)!==null};K.fullStack=function(e){ue.ok(je(e),"err must be an Error");var t=K.cause(e);return t?e.stack+`
caused by: `+K.fullStack(t):e.stack};K.errorFromList=function(e){return ue.arrayOfObject(e,"errors"),e.length===0?null:(e.forEach(function(t){ue.ok(je(t))}),e.length==1?e[0]:new Lt(e))};K.errorForEach=function(e,t){ue.ok(je(e),"err must be an Error"),ue.func(t,"func"),e instanceof Lt?e.errors().forEach(function(n){t(n)}):t(e)};function Qt(){var e,t,r,n;return e=Array.prototype.slice.call(arguments,0),this instanceof Qt?(r=Wi({argv:e,strict:!0}),n=r.options,K.call(this,n,"%s",r.shortmessage),this):(t=Object.create(Qt.prototype),Qt.apply(t,arguments),t)}bn.inherits(Qt,K);function Lt(e){ue.array(e,"list of errors"),ue.ok(e.length>0,"must be at least one error"),this.ase_errors=e,K.call(this,{cause:e[0]},"first of %d error%s",e.length,e.length==1?"":"s")}bn.inherits(Lt,K);Lt.prototype.name="MultiError";Lt.prototype.errors=function(){return this.ase_errors.slice(0)};function Qe(){var e,t,r,n;return e=Array.prototype.slice.call(arguments,0),this instanceof Qe?(r=Wi({argv:e,strict:!1}),n=r.options,n.skipCauseMessage=!0,K.call(this,n,"%s",r.shortmessage),this):(t=Object.create(Qe.prototype),Qe.apply(t,e),t)}bn.inherits(Qe,K);Qe.prototype.name="WError";Qe.prototype.toString=function(){var t=this.hasOwnProperty("name")&&this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(t+=": "+this.message),this.jse_cause&&this.jse_cause.message&&(t+="; caused by "+this.jse_cause.toString()),t};Qe.prototype.cause=function(t){return je(t)&&(this.jse_cause=t),this.jse_cause};class E{constructor(t,r){this.x=t,this.y=r}clone(){return new E(this.x,this.y)}}const ul=e=>{switch(e){case"a":return 1;case"b":return 2;case"c":return 3;case"d":return 4;case"e":return 5;case"f":return 6;case"g":return 7;case"h":return 8;default:throw new ae(`Cannot map file "${e}" to number`)}},$t=e=>{switch(e){case 1:return"a";case 2:return"b";case 3:return"c";case 4:return"d";case 5:return"e";case 6:return"f";case 7:return"g";case 8:return"h";default:throw new ae(`Cannot map "${e}" to file`)}},Yp=e=>["B","K","N","Q","R"].includes(e),Jp=e=>["b","k","n","q","r"].includes(e),Xp=e=>["a","b","c","d","e","f","g","h"].includes(e),Zp=e=>typeof e=="number"&&e>0&&e<=8,H=(e,t)=>e&&t&&e.file===t.file&&e.rank===t.rank,ev=e=>{let t="";return t+=$t(e.file),t+=e.rank,t},J=e=>e===$e.Black||e==$e.DarkGrey?"black":"white",tv=e=>({file:e%8+1,rank:8-Math.floor(e/8)}),la=e=>(9-e.rank-1)*8+(e.file-1),Le=(e,t)=>e.rank===(t==="white"?8:1),rv={White:"white",Black:"black",Draw:"draw",Forfeit:"forfeit",ForfeitWhite:"forfeit-white",ForfeitBlack:"forfeit-black"};class ua{constructor(){this.files=[],this.ranks=[],this.pieces=[],this.tokens=[]}isEmpty(){return!this.moveType&&this.files.length===0&&this.ranks.length===0&&this.pieces.length===0&&!this.castleSide&&typeof this.isDrawOffer=="undefined"&&typeof this.isGameOver=="undefined"}toNode(){if(this.isDrawOffer)return{sources:this.tokens,kind:"draw-offer"};if(this.isGameOver)return{sources:this.tokens,kind:"game-over",outcome:this.outcome};const t={from:{},to:{}};if(this.pieces[0]&&this.moveType!=="promotion"&&(t.piece=this.pieces[0]),t.kind="move",this.files.length===2)t.from.file=this.files[0],t.to.file=this.files[1];else if(this.files.length===1)t.to.file=this.files[0];else if(this.files.length!==0)throw new ae(`Parsed ${this.files.length} columns for a single move`);if(this.ranks.length===2)t.from.rank=this.ranks[0],t.to.rank=this.ranks[1];else if(this.ranks.length===1)t.to.rank=this.ranks[0];else if(this.ranks.length!==0)throw new ae(`Parsed ${this.ranks.length} ranks for a single move`);return this.moveType==="allegiance"?{...t,type:"allegiance",sources:this.tokens}:this.moveType==="capture"?{...t,type:"capture",sources:this.tokens}:this.moveType==="castle"?{...t,type:"castle",side:this.castleSide,sources:this.tokens}:this.moveType==="en-passant"?{...t,type:"en-passant",sources:this.tokens}:this.moveType==="promotion"?{...t,piece:null,type:"promotion",promotionTo:this.pieces[0],sources:this.tokens}:{...t,sources:this.tokens}}}const cl=e=>{var c,f,p;let t=0;const r=["castle","draw-offer","piece","step-number","game-over","file","move-separator"],n=["step-number","move-separator"],i=new Set(r),o=(...d)=>{i.clear(),d.forEach(v=>i.add(v))};for(;t<e.length;){const d=e[t];if(!i.has(d.kind))throw new ae(`Parse error on line ${(c=d.source)==null?void 0:c.row} column ${(f=d.source)==null?void 0:f.column}: Token kind "${d.kind}" was not expected after "${(p=e[t-1])==null?void 0:p.kind}"`);switch(d.kind){case"move-separator":o(...r,"step-number","capture");break;case"step-number":o(...r,"move-separator");break;case"promotion":o("piece");break;case"allegiance":case"capture":o("file");break;case"castle":case"double-check":case"check":case"en-passant":o(...r);break;case"checkmate":o("game-over","move-separator");break;case"file":o("rank","capture","allegiance","file");break;case"draw-offer":o(...r,"game-over");break;case"game-over":o("move-separator");break;case"rank":o(...r,"allegiance","capture","check","checkmate","double-check","en-passant","promotion");break;case"piece":o("capture","allegiance","check","checkmate","game-over","file","double-check","en-passant","promotion");break}t++}t=0;const a={kind:"root",children:[]};let s=new ua;const l=()=>{s.isEmpty()||(a.children.push(s.toNode()),s=new ua)},u=()=>{var d;return(d=e[t+1])==null?void 0:d.kind};for(;t<e.length;){const d=e[t];switch(n.includes(d.kind)||s.tokens.push(d),d.kind){case"move-separator":u()!=="en-passant"&&l();break;case"piece":s.pieces.push(d.value);break;case"allegiance":s.moveType="allegiance";break;case"capture":s.moveType="capture";break;case"castle":s.moveType="castle",s.castleSide=d.side,u()!=="move-separator"&&l();break;case"check":case"double-check":s.causesCheck=!0,s.isMate=!1,u()!=="move-separator"&&l();break;case"checkmate":s.causesCheck=!0,s.isMate=!0,u()!=="move-separator"&&l();break;case"file":s.files.push(d.value);break;case"rank":s.ranks.push(d.value),u()||l();break;case"draw-offer":s.isDrawOffer=!0,u()!=="move-separator"&&l();break;case"en-passant":s.moveType="en-passant",u()!=="move-separator"&&l();break;case"promotion":s.moveType="promotion";break;case"game-over":s.isGameOver=!0,s.outcome=d.outcome,u()!=="move-separator"&&l();break}t++}return a},fl=e=>{const t=e.replace(/[]/gu,"-");let r=1,n=1,i=0;const o=[];for(;i<t.length;){const a=t[i],s=c=>t.substring(i,i+c.length)===c,l=c=>{let f="",p=i;for(;;){const d=t[p];if(p>=t.length||c(d)){p--;break}f+=d,p++}return f},u=(c,f)=>{o.push({...f,source:{column:n,row:r,length:c}}),i+=c,n+=c};if(a===`
`){r++,n=1,u(1,{kind:"move-separator"});continue}if(a==="\r"){n=1,i++;continue}if(s("e.p.")||s(" e.p.")){u(a===" "?5:4,{kind:"en-passant"});continue}if(a===" "||a===";"){u(1,{kind:"move-separator"});continue}if(s("O-O-O")||s("0-0-0")){u(5,{kind:"castle",side:"queen"});continue}if(s("O-O")||s("0-0")){u(3,{kind:"castle",side:"king"});continue}if(a==="+"||a==="\u2020"){u(1,{kind:"check"});continue}if(s("ch")){u(2,{kind:"check"});continue}if(/[#X]/gu.test(a)){u(1,{kind:"checkmate"});continue}if(s("mate")){u(4,{kind:"checkmate"});continue}if(s("dbl ch")){u(6,{kind:"double-check"});continue}if(s("++")){u(2,{kind:"double-check"});continue}if(s("0-1")){u(3,{kind:"game-over",outcome:"black"});continue}if(s("1-0")){u(3,{kind:"game-over",outcome:"white"});continue}if(s("\xBD-\xBD")){u(3,{kind:"game-over",outcome:"draw"});continue}if(s("1/2-1/2")){u(7,{kind:"game-over",outcome:"draw"});continue}if(s("0-0")){u(3,{kind:"game-over",outcome:"forfeit"});continue}if(s("\xBD-0")){u(3,{kind:"game-over",outcome:"forfeit-white"});continue}if(s("1/2-0")){u(5,{kind:"game-over",outcome:"forfeit-white"});continue}if(s("0-\xBD")){u(3,{kind:"game-over",outcome:"forfeit-black"});continue}if(s("0-1/2")){u(5,{kind:"game-over",outcome:"forfeit-black"});continue}if(/[\d]/gu.test(a)){const c=l(p=>!/[\d]/gu.test(p));if(t[i+c.length]==="."){u(c.length+1,{kind:"step-number",value:Number.parseInt(c,10)});continue}}if(/[1-8]/gu.test(a)){u(1,{kind:"rank",value:Number.parseInt(a,10)});continue}if(/[a-h]/gu.test(a)){u(1,{kind:"file",value:ul(a)});continue}if(/[KQRBN]/gu.test(a)){u(1,{kind:"piece",value:a});continue}if(/[x:]/gu.test(a)){u(1,{kind:"capture"});continue}if(s("(=)")){u(3,{kind:"draw-offer"});continue}if(a==="="||a==="/"){u(1,{kind:"promotion"});continue}if(a==="("||a===")"){u(1,{kind:"promotion",bracket:a==="("?"open":"close"});continue}if(a===">"){u(1,{kind:"allegiance"});continue}throw new ae(`Unsupported character at line ${r} column ${n}: "${a}"`)}return o},Hi=e=>{switch(e.kind){case"draw-offer":return"(=)";case"game-over":{switch(e.outcome){case"black":return"0-1";case"white":return"1-0";case"draw":return"1/2-1/2";case"forfeit":return"0-0";case"forfeit-black":return"0-1/2";case"forfeit-white":return"1/2-0"}break}case"move":{const t=(r,n)=>{let i="";return e.piece&&(i+=e.piece),e.from.file&&(i+=`${$t(e.from.file)}`),e.from.rank&&(i+=`${e.from.rank}`),i+=r,e.type==="promotion"&&e.promotionTo&&(i+=`${e.promotionTo}`),e.to.file&&(i+=`${$t(e.to.file)}`),e.to.rank&&(i+=`${e.to.rank}`),n&&(i+=n),i};switch(e.type){case"allegiance":return t(">");case"capture":return t("x");case"castle":return e.side==="king"?"O-O":"O-O-O";case"en-passant":return t("x"," e.p.");case"promotion":return t("=");default:return t("")}}}},dl=e=>{const t=[];return e.children.forEach((r,n)=>{const i=n%2===0;(a=>{i?t.push(a):t[t.length-1]+=` ${a}`})(Hi(r))}),t.filter(Boolean).map((r,n)=>`${n+1}. ${r}`).join(`
`).trim()};var ca=Object.freeze(Object.defineProperty({__proto__:null,GameOutcome:rv,parse:cl,tokenize:fl,writeNode:Hi,write:dl},Symbol.toStringTag,{value:"Module"})),hl=(e=>(e[e.Ranks=0]="Ranks",e[e.ActiveColour=1]="ActiveColour",e[e.CastlingRights=2]="CastlingRights",e[e.EnPassantTargets=3]="EnPassantTargets",e[e.HalfmoveClock=4]="HalfmoveClock",e[e.FullmoveNumber=5]="FullmoveNumber",e))(hl||{});class fa{constructor(){this.allegianceMark=!1,this.castlingRights=[]}canSetPieceSide(){return!this.pieceSide}setPieceSide(t){if(!this.canSetPieceSide())throw new ae("Cannot set piece side on WipNode, because it's already set");this.pieceSide=t}canSetPiece(){return!this.piece&&this.piece!==null}setPiece(t){if(!this.canSetPiece())throw new ae("Cannot set piece on WipNode, because there is already one set");this.piece=t}canSetAllegianceMark(){return!this.allegianceMark}addAllegianceMark(){if(!this.canSetAllegianceMark())throw new ae("Allegiance mark already set");this.allegianceMark=!0}pieceDataReady(){return!this.canSetPiece()&&!this.canSetPieceSide()}setActiveColour(t){this.activeColour=t}hasCastlingRights(){return this.castlingRights.length!==0}addCastlingRight(t){this.castlingRights.push(t)}canSetEnPassantFile(){return!this.enPassantFile}setEnPassantFile(t){if(!this.canSetEnPassantFile())throw new ae("Cannot set en passant file on WipNode, because there is already one set");this.enPassantFile=t}canSetEnPassantRank(){return!this.enPassantRank}setEnPassantRank(t){if(!this.canSetEnPassantRank())throw new ae("Cannot set en passant rank on WipNode, because there is already one set");this.enPassantRank=t}canSetHalfmoveClock(){return typeof this.halfmoveClock!="number"}setHalfmoveClock(t){this.halfmoveClock=t}canSetFullmoveNumber(){return typeof this.fullmoveNumber!="number"}setFullmoveNumber(t){this.fullmoveNumber=t}isEnPassantType(){return!!(this.enPassantFile&&this.enPassantRank)}toNode(){if(this.piece||this.piece===null)return this.pieceSide==="white"?{kind:"piece",value:{allegiance:this.allegianceMark?$e.LightGrey:$e.White,piece:this.piece?this.piece.toUpperCase():null}}:{kind:"piece",value:{allegiance:this.allegianceMark?$e.DarkGrey:$e.Black,piece:this.piece?this.piece.toUpperCase():null}};if(this.activeColour)return{kind:"active-colour",value:this.activeColour};if(this.castlingRights.length>0){const t=[],r=[];return this.castlingRights.includes("K")&&r.push("king"),this.castlingRights.includes("Q")&&r.push("queen"),this.castlingRights.includes("k")&&t.push("king"),this.castlingRights.includes("q")&&t.push("queen"),{kind:"castling-rights",value:{black:t,white:r}}}if(this.enPassantFile&&this.enPassantRank)return{kind:"en-passant-targets",value:{file:this.enPassantFile,rank:this.enPassantRank}};if(typeof this.halfmoveClock=="number")return{kind:"halfmove-clock",value:this.halfmoveClock};if(typeof this.fullmoveNumber=="number")return{kind:"fullmove-number",value:this.fullmoveNumber};throw new ae(`Cannot create Node from WipNode, ${JSON.stringify({...this},null,2)}`)}}const nv=e=>{const t={kind:"ast",children:[]};let r=0,n=0,i=new fa;const o=l=>{t.children.push(l),r++},a=()=>{t.children.push(i.toNode()),i=new fa},s=l=>{n=l,r++};for(;r<e.length;){const l=e[r],u=e[r+1];if(n===0){if((l.kind==="char"||l.kind==="number"||l.kind==="separator"||l.kind==="space")&&i.pieceDataReady()&&a(),l.kind==="char"&&Jp(l.value)){i.setPieceSide("black"),i.setPiece(l.value),u||a(),r++;continue}if(l.kind==="char"&&Yp(l.value)){i.setPieceSide("white"),i.setPiece(l.value),u||a(),r++;continue}if(l.kind==="char"&&l.value==="p"){i.setPieceSide("black"),i.setPiece(null),u||a(),r++;continue}if(l.kind==="char"&&l.value==="P"){i.setPieceSide("white"),i.setPiece(null),u||a(),r++;continue}if(l.kind==="allegiance"){i.addAllegianceMark(),r++,u||a();continue}if(l.kind==="number"&&l.value>0&&l.value<=8){o({kind:"skip",value:l.value});continue}}switch(n){case 0:{if(l.kind==="separator"){r++;continue}if(l.kind==="space"){n=1,r++;continue}break}case 1:{if(l.kind==="char"&&l.value==="w"){i.setActiveColour("white"),r++;continue}if(l.kind==="char"&&l.value==="b"){i.setActiveColour("black"),r++;continue}if(l.kind==="space"){a(),s(2);continue}break}case 2:{if(l.kind==="char"&&(l.value==="q"||l.value==="Q"||l.value==="k"||l.value==="K")){i.addCastlingRight(l.value),r++;continue}if(l.kind==="hyphen"){r++;continue}if(l.kind==="space"){i.hasCastlingRights()&&a(),s(3);continue}break}case 3:{if(l.kind==="hyphen"){r++;continue}if(l.kind==="char"&&Xp(l.value)){i.setEnPassantFile(ul(l.value)),r++;continue}if(l.kind==="number"&&Zp(l.value)){i.setEnPassantRank(l.value),r++;continue}if(l.kind==="space"){i.isEnPassantType()&&a(),s(4);continue}break}case 4:{if(l.kind==="number"){i.setHalfmoveClock(l.value),r++;continue}if(l.kind==="space"){a(),s(5);continue}break}case 5:{l.kind==="number"&&(i.setFullmoveNumber(l.value),r++,a());continue}}throw new ae(`Unhandled token: ${l.kind}, cursor ${r}, state: ${hl[n]}`)}return t},iv=e=>{let t=0;const r=[],n=(o,a)=>{r.push(a),t+=o},i=o=>{let a="",s=t;for(;;){const l=e[s];if(s>=e.length||o(l)){s--;break}a+=l,s++}return a};for(;t<e.length;){const o=e[t];if(o===">"){n(1,{kind:"allegiance"});continue}if(o==="/"){n(1,{kind:"separator"});continue}if(/\d/gu.test(o)){const a=i(s=>!/[\d]/gu.test(s));n(a.length,{kind:"number",value:Number.parseInt(a,10)});continue}if(o===" "){n(1,{kind:"space"});continue}if(o==="-"||o==="\u2013"){n(1,{kind:"hyphen"});continue}n(1,{kind:"char",value:o})}return r},Gi={sections:["positions","active-colour","castlig-rights","en-passant-targets","halfmove-clock","fullmove-number"]},ov=(e,t=Gi)=>{let r="",n=0;e.children.forEach(k=>{var w;switch(k.kind){case"piece":{n>=8&&(r+="/",n=0);const P=J(k.value.allegiance),C=(w=k.value.piece)!=null?w:"p";r+=P==="white"?C.toUpperCase():C.toLowerCase(),(k.value.allegiance===$e.DarkGrey||k.value.allegiance===$e.LightGrey)&&(r+=">"),n++;break}case"skip":{n>=8&&(r+="/",n=0),r+=k.value,n+=k.value;break}}});const i=e.children.find(k=>k.kind==="active-colour");let o="";i?o=i.value==="white"?"w":"b":o="w";const a=e.children.find(k=>k.kind==="castling-rights");let s="";a?(a.value.white.includes("king")&&(s+="K"),a.value.white.includes("queen")&&(s+="Q"),a.value.black.includes("king")&&(s+="k"),a.value.black.includes("queen")&&(s+="q")):s="-";const l=e.children.find(k=>k.kind==="en-passant-targets");let u="";l?u=ev(l.value):u="-";const c=e.children.find(k=>k.kind==="halfmove-clock");let f="0";c&&(f=String(c.value));const p=e.children.find(k=>k.kind==="fullmove-number");let d="0";return p&&(d=String(p.value)),[t.sections.includes("positions")&&r,t.sections.includes("active-colour")&&o,t.sections.includes("castlig-rights")&&s,t.sections.includes("en-passant-targets")&&u,t.sections.includes("halfmove-clock")&&f,t.sections.includes("fullmove-number")&&d].filter(Boolean).join(" ")};class Vi{clone(){const t=new Vi;return t.memory=[...this.memory],t.activeColour=this.activeColour,t.enPassantTarget=this.enPassantTarget?{...this.enPassantTarget}:null,t._castlingRights=[...this._castlingRights],t.halfmoveClock=this.halfmoveClock,t.fullmoveNumber=this.fullmoveNumber,t.moveHistory={kind:"root",children:[...this.moveHistory.children]},t}removeCastlingRights(t,r){const n=this._castlingRights.findIndex(i=>i.colour===t&&i.side===r);n!==-1&&this._castlingRights.splice(n,1)}castlingRights(t){return this._castlingRights.filter(r=>r.colour===t).map(r=>r.side)}clear(){this.activeColour="white",this.enPassantTarget=null,this._castlingRights=[],this.halfmoveClock=0,this.fullmoveNumber=0,this.moveHistory={kind:"root",children:[]},this.memory=Array.from({length:64}).fill(null)}constructor(){this.clear()}dump(){const t=this.getSquares(),r=Array.from({length:8}).map(()=>Array.from({length:8}).map(()=>"."));let n="";t.filter(Boolean).forEach(i=>{var o,a,s,l;r[i.rank-1][i.file-1]=J(i.allegiance)==="white"?(a=(o=i.piece)==null?void 0:o.toUpperCase())!=null?a:"P":(l=(s=i.piece)==null?void 0:s.toLowerCase())!=null?l:"p"});for(let i=7;i>=0;i--)n+=`${i+1} `,n+=r[i].map(o=>o).join(" "),n+=`
`;return n+=`  ${r[0].map((i,o)=>$t(o+1)).join(" ")}`,n+=`
${this.activeColour} ${this.enPassantTarget&&`${$t(this.enPassantTarget.file)}${this.enPassantTarget.rank}`} ${this.halfmoveClock} ${this.fullmoveNumber}`,n}getSquares(){return this.memory.map((t,r)=>t?{...t,...tv(r)}:null)}getSquare(t){if(!t)throw new ae.VError("Attempted to get square with no coordinates");return this.memory[la(t)]}setSquare(t,r){this.memory[la(t)]=r}toAFEN(t=Gi){const r={kind:"ast",children:[]};let n=0;if(t.sections.includes("positions")){for(let i=0;i<this.memory.length;i++)this.memory[i]?(n&&(r.children.push({kind:"skip",value:n}),n=0),r.children.push({kind:"piece",value:this.memory[i]})):n++,(i+1)%8===0&&n&&(r.children.push({kind:"skip",value:n}),n=0);n&&r.children.push({kind:"skip",value:n})}if(t.sections.includes("active-colour")&&r.children.push({kind:"active-colour",value:this.activeColour}),t.sections.includes("castlig-rights")){const i={kind:"castling-rights",value:{black:[],white:[]}},o=this.castlingRights("white"),a=this.castlingRights("black");o.includes("king")&&i.value.white.push("king"),o.includes("queen")&&i.value.white.push("queen"),a.includes("king")&&i.value.black.push("king"),a.includes("queen")&&i.value.black.push("queen"),(i.value.white.length>0||i.value.black.length>0)&&r.children.push(i)}return t.sections.includes("en-passant-targets")&&this.enPassantTarget&&r.children.push({kind:"en-passant-targets",value:this.enPassantTarget}),t.sections.includes("halfmove-clock")&&r.children.push({kind:"halfmove-clock",value:this.halfmoveClock}),t.sections.includes("fullmove-number")&&r.children.push({kind:"fullmove-number",value:this.fullmoveNumber}),r}fromAFEN(t){var n;this.clear();let r=0;for(const i of t.children){if(i.kind==="skip"){r+=i.value;continue}if(i.kind==="piece"){this.memory[r]=i.value,r++;continue}if(i.kind==="en-passant-targets"){this.enPassantTarget=i.value;continue}if(i.kind==="castling-rights"){i.value.black.forEach(o=>{this._castlingRights.push({colour:"black",side:o})}),i.value.white.forEach(o=>{this._castlingRights.push({colour:"white",side:o})});continue}if(i.kind==="active-colour"){this.activeColour=i.value;continue}if(i.kind==="fullmove-number"){this.fullmoveNumber=i.value;continue}if(i.kind==="halfmove-clock"){this.halfmoveClock=i.value;continue}throw new ae.VError(`Unhandled node while importing AFEN: ${(n=i.kind)!=null?n:JSON.stringify(i,null,2)}`)}}}const da={VanillaDefault:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 0",GreyDefault:"r>n>b>q>kb>n>r>/p>p>p>p>p>p>p>p>/8/8/8/8/P>P>P>P>P>P>P>P>/R>N>B>Q>KB>N>R> w KQkq - 0 0"},$e={Black:0,DarkGrey:1,LightGrey:2,White:3},av=["B","N","Q","R"];class j{clear(){this.memory.clear()}clone(){const t=new j;return t.memory=this.memory.clone(),t}dump(){return this.memory.dump()}importAFEN(t){this.memory.fromAFEN(nv(iv(t)))}importMoveHistory(t){const r=cl(fl(t)),n=new j;n.importAFEN(da.VanillaDefault),r.children.forEach(i=>{const o=n.getValidMoves(),a=j.findMoveIndex(o,i);if(a===-1)throw new ae(`Move ${Hi(i)} is not valid on this board`);const s=n.executeMoveIndex(a);this.memory.moveHistory.children.push(s)})}toAFEN(t=Gi){return ov(this.memory.toAFEN(t))}getSquares(){return this.memory.getSquares()}get enPassantTarget(){return this.memory.enPassantTarget}get activeColour(){return this.memory.activeColour}get halfmoveClock(){return this.memory.halfmoveClock}get fullmoveNumber(){return this.memory.fullmoveNumber}get castlingRights(){return{black:this.memory.castlingRights("black"),white:this.memory.castlingRights("white")}}getMoveHistory(){return dl(this.memory.moveHistory)}getMoveHistoryAst(){return this.memory.moveHistory}constructor(){this.memory=new Vi}getPositionCount(){const t=this.memory.moveHistory.children,r=new Map,n=new j;n.importAFEN(da.VanillaDefault);for(const i of t){n.executeNode(i);const o=n.toAFEN({sections:["positions"]}),a=r.get(o);a?r.set(o,a+1):r.set(o,1)}return r}executeAllegianceMoveNode(t){this.memory.setSquare(t.node.to,{allegiance:t.fromSide==="white"?t.to.allegiance+1:t.to.allegiance-1,piece:t.to.piece})}executeCaptureMoveNode(t){this.memory.setSquare(t.node.to,t.from),this.memory.setSquare(t.node.from,null)}executeCastleMoveNode(t){const r=t.node.from,n=t.node.to,i=t.from;if(t.to)throw new ae(`Castling cannot cause a capture on ${JSON.stringify(t.node.to)}`);this.memory.setSquare(n,i),this.memory.setSquare(r,null);const a=t.fromSide==="white"?1:8,s=t.node.side==="king"?{file:8,rank:a}:{file:1,rank:a},l=t.node.side==="king"?{file:6,rank:a}:{file:4,rank:a};this.memory.setSquare(l,this.memory.getSquare(s)),this.memory.setSquare(s,null)}executeEnPassantMoveNode(t){this.memory.setSquare({rank:t.fromSide==="white"?t.node.to.rank-1:t.node.to.rank+1,file:t.node.to.file},null),this.memory.setSquare(t.node.to,t.from),this.memory.setSquare(t.node.from,null)}executePromotionMoveNode(t){this.memory.setSquare(t.node.to,{allegiance:t.from.allegiance,piece:t.node.promotionTo}),this.memory.setSquare(t.node.from,null)}executeDefaultMoveNode(t){this.memory.setSquare(t.node.from,null),this.memory.setSquare(t.node.to,t.from),t.node.piece===null&&Math.abs(t.node.from.rank-t.node.to.rank)===2&&(this.memory.enPassantTarget={file:t.node.from.file,rank:t.fromSide==="white"?t.node.from.rank+1:t.node.from.rank-1})}executeMoveNode(t){if(!t.from.file)throw new ae(`Cannot execute node without "from.file": ${JSON.stringify(t,null,2)}`);const r=this.memory.getSquare(t.from),n=this.memory.getSquare(t.to);if(!r)throw new ae(`There is no piece on file ${t.from.file} rank ${t.from.rank}`);r.piece==="K"&&(this.memory.removeCastlingRights(this.activeColour,"king"),this.memory.removeCastlingRights(this.activeColour,"queen")),r.piece==="R"&&t.from.file===8&&this.memory.removeCastlingRights(this.activeColour,"king"),r.piece==="R"&&t.from.file===1&&this.memory.removeCastlingRights(this.activeColour,"queen"),this.memory.enPassantTarget=null;const i=J(r.allegiance),o=n?J(n.allegiance):null;switch(t.type){case"allegiance":this.executeAllegianceMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"capture":this.executeCaptureMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"castle":this.executeCastleMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"en-passant":this.executeEnPassantMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;case"promotion":this.executePromotionMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break;default:this.executeDefaultMoveNode({from:r,to:n,fromSide:i,toSide:o,node:t});break}switch(t.type){case"capture":case"en-passant":{this.memory.halfmoveClock=0;break}case null:case void 0:{t.piece?this.memory.halfmoveClock++:this.memory.halfmoveClock=0;break}default:{this.memory.halfmoveClock++;break}}this.memory.activeColour==="black"&&this.memory.fullmoveNumber++,this.memory.activeColour=this.memory.activeColour==="white"?"black":"white"}executeNode(t){switch(t.kind){case"move":{this.executeMoveNode(t);break}default:return}this.memory.moveHistory.children.push(t)}executeMoveIndex(t){if(t<0)throw new ae(`Move index must be positive, got ${t}`);const n=this.getValidMoves().at(t);if(!n)throw new ae(`Move with index ${t} does not exist`);return this.executeNode(n),n}getSquare(t){return this.memory.getSquare(t)}static findMoveIndex(t,r){let n=t;return r.kind==="draw-offer"&&(n=n.filter(i=>i.kind==="draw-offer")),r.kind==="game-over"&&(n=n.filter(i=>i.kind==="game-over"&&i.outcome===r.outcome)),r.kind==="move"&&(r.to&&Object.keys(r.to).length===2&&(n=n.filter(i=>i.kind==="move"&&H(i.to,r.to))),r.from&&Object.keys(r.from).length===2&&(n=n.filter(i=>i.kind==="move"&&H(i.from,r.from))),r.type&&(n=n.filter(i=>"type"in i&&i.type===r.type)),r.piece||r.piece===null?n=n.filter(i=>i.kind==="move"&&i.piece===r.piece):n.length>1&&!r.piece&&(n=n.filter(i=>i.kind==="move"&&i.piece===null)),r.type==="promotion"&&(n=n.filter(i=>"promotionTo"in i&&i.promotionTo===r.promotionTo&&H(i.to,r.to)&&H(i.from,r.from)))),n.length===1?t.indexOf(n[0]):-1}static getCoordsRelative(t,r){const n={file:t.file+r.x,rank:t.rank+r.y};return n.file>8||n.file<=0||n.rank>8||n.rank<=0?null:n}traceCaptureSteps(t,r){const n=this.memory.getSquare(t);if(!n)return[];const i=[],o=new E(Math.sign(r.x),Math.sign(r.y));let a=t;for(;a=j.getCoordsRelative(a,o),!!a;){const s=this.memory.getSquare(a);if(!s){i.push({...a});continue}if(J(s.allegiance)===J(n.allegiance))break;if(J(s.allegiance)!==J(n.allegiance)){i.push({...a});break}i.push({...a})}return i}getAttackedCoordsBySide(t){const r=this.memory.getSquares().filter(i=>i&&J(i.allegiance)===t),n=[];return r.forEach(i=>{n.push(...this.getAttackedCoordsByCoords(i))}),n}getAttackedCoordsByCoords(t){const r=[],n=this.memory.getSquare(t);if(!n)return r;const i=J(n.allegiance);if(n.piece===null){const o=j.getCoordsRelative(t,new E(i==="white"?-1:1,i==="white"?1:-1)),a=j.getCoordsRelative(t,new E(i==="white"?1:-1,i==="white"?1:-1));return[o,a]}return n.piece==="R"?[...this.traceCaptureSteps(t,new E(1,0)),...this.traceCaptureSteps(t,new E(-1,0)),...this.traceCaptureSteps(t,new E(0,1)),...this.traceCaptureSteps(t,new E(0,-1))].filter(Boolean):n.piece==="N"?[j.getCoordsRelative(t,new E(1,2)),j.getCoordsRelative(t,new E(2,1)),j.getCoordsRelative(t,new E(2,-1)),j.getCoordsRelative(t,new E(1,-2)),j.getCoordsRelative(t,new E(-1,-2)),j.getCoordsRelative(t,new E(-2,-1)),j.getCoordsRelative(t,new E(-2,1)),j.getCoordsRelative(t,new E(-1,2))].filter(Boolean):n.piece==="B"?[...this.traceCaptureSteps(t,new E(1,1)),...this.traceCaptureSteps(t,new E(1,-1)),...this.traceCaptureSteps(t,new E(-1,-1)),...this.traceCaptureSteps(t,new E(-1,1))].filter(Boolean):n.piece==="Q"?[...this.traceCaptureSteps(t,new E(1,0)),...this.traceCaptureSteps(t,new E(-1,0)),...this.traceCaptureSteps(t,new E(0,1)),...this.traceCaptureSteps(t,new E(0,-1)),...this.traceCaptureSteps(t,new E(1,1)),...this.traceCaptureSteps(t,new E(1,-1)),...this.traceCaptureSteps(t,new E(-1,-1)),...this.traceCaptureSteps(t,new E(-1,1))].filter(Boolean):n.piece==="K"?[j.getCoordsRelative(t,new E(0,1)),j.getCoordsRelative(t,new E(1,1)),j.getCoordsRelative(t,new E(1,0)),j.getCoordsRelative(t,new E(1,-1)),j.getCoordsRelative(t,new E(0,-1)),j.getCoordsRelative(t,new E(-1,-1)),j.getCoordsRelative(t,new E(-1,0)),j.getCoordsRelative(t,new E(-1,1))].filter(Boolean):r}getPossibleMoves(){const t=[],r=this.memory.getSquares(),n=this.getAttackedCoordsBySide(this.activeColour==="white"?"black":"white");return this.memory.moveHistory.children.some(o=>o.kind==="game-over")?[]:(r.forEach(o=>{if(!o)return;const a=J(o.allegiance);if(o.piece===null){const s=j.getCoordsRelative(o,new E(0,a==="white"?1:-1)),l=j.getCoordsRelative(o,new E(a==="white"?-1:1,a==="white"?1:-1)),u=j.getCoordsRelative(o,new E(a==="white"?1:-1,a==="white"?1:-1)),c=f=>av.map(p=>({kind:"move",type:"promotion",from:o,to:f,piece:this.memory.getSquare(o).piece,promotionTo:p}));if(this.memory.enPassantTarget&&l&&H(this.memory.enPassantTarget,l)&&!Le(l,a)&&t.push({kind:"move",type:"en-passant",from:o,to:this.memory.enPassantTarget,piece:this.memory.getSquare(o).piece}),this.memory.enPassantTarget&&u&&H(this.memory.enPassantTarget,u)&&!Le(u,a)&&t.push({kind:"move",type:"en-passant",from:o,to:this.memory.enPassantTarget,piece:this.memory.getSquare(o).piece}),s&&!this.memory.getSquare(s)&&!Le(s,a)&&t.push({kind:"move",type:null,piece:this.memory.getSquare(o).piece,from:o,to:s}),l){const f=this.memory.getSquare(l);f&&J(f.allegiance)!==a&&(Le(l,a)?t.push(...c(l)):t.push({kind:"move",type:"capture",from:o,to:l,piece:this.memory.getSquare(o).piece},{kind:"move",type:"allegiance",from:o,to:l,piece:this.memory.getSquare(o).piece}))}if(u){const f=this.memory.getSquare(u);f&&J(f.allegiance)!==a&&(Le(u,a)?t.push(...c(u)):t.push({kind:"move",type:"capture",from:o,to:u,piece:this.memory.getSquare(o).piece},{kind:"move",type:"allegiance",from:o,to:u,piece:this.memory.getSquare(o).piece}))}if(o.rank===2&&a==="white"||o.rank===7&&a==="black"){const f=j.getCoordsRelative(o,new E(0,a==="white"?2:-2));!this.memory.getSquare(s)&&!this.memory.getSquare(f)&&t.push({kind:"move",type:null,from:o,to:f,piece:this.memory.getSquare(o).piece})}!this.getSquare(s)&&Le(s,a)&&t.push(...c(s))}if(o.piece==="R"){const s=[...this.traceCaptureSteps(o,new E(1,0)),...this.traceCaptureSteps(o,new E(-1,0)),...this.traceCaptureSteps(o,new E(0,1)),...this.traceCaptureSteps(o,new E(0,-1))];t.push(...s.map(l=>{const u=this.memory.getSquare(l);return{kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}}),...s.map(l=>this.memory.getSquare(l)?{kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}:null).filter(Boolean))}if(o.piece==="N"&&[j.getCoordsRelative(o,new E(1,2)),j.getCoordsRelative(o,new E(2,1)),j.getCoordsRelative(o,new E(2,-1)),j.getCoordsRelative(o,new E(1,-2)),j.getCoordsRelative(o,new E(-1,-2)),j.getCoordsRelative(o,new E(-2,-1)),j.getCoordsRelative(o,new E(-2,1)),j.getCoordsRelative(o,new E(-1,2))].filter(Boolean).forEach(l=>{const u=this.memory.getSquare(l);u&&J(u.allegiance)===a||(t.push({kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}),u&&t.push({kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}))}),o.piece==="B"){const s=[...this.traceCaptureSteps(o,new E(1,1)),...this.traceCaptureSteps(o,new E(1,-1)),...this.traceCaptureSteps(o,new E(-1,-1)),...this.traceCaptureSteps(o,new E(-1,1))];t.push(...s.map(l=>{const u=this.memory.getSquare(l);return{kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}}),...s.map(l=>this.memory.getSquare(l)?{kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}:null).filter(Boolean))}if(o.piece==="Q"){const s=[...this.traceCaptureSteps(o,new E(1,0)),...this.traceCaptureSteps(o,new E(-1,0)),...this.traceCaptureSteps(o,new E(0,1)),...this.traceCaptureSteps(o,new E(0,-1)),...this.traceCaptureSteps(o,new E(1,1)),...this.traceCaptureSteps(o,new E(1,-1)),...this.traceCaptureSteps(o,new E(-1,-1)),...this.traceCaptureSteps(o,new E(-1,1))];t.push(...s.map(l=>{const u=this.memory.getSquare(l);return{kind:"move",type:u?"capture":null,from:o,to:l,piece:o.piece}}),...s.map(l=>this.memory.getSquare(l)?{kind:"move",type:"allegiance",from:o,to:l,piece:o.piece}:null).filter(Boolean))}if(o.piece==="K"){[j.getCoordsRelative(o,new E(0,1)),j.getCoordsRelative(o,new E(1,1)),j.getCoordsRelative(o,new E(1,0)),j.getCoordsRelative(o,new E(1,-1)),j.getCoordsRelative(o,new E(0,-1)),j.getCoordsRelative(o,new E(-1,-1)),j.getCoordsRelative(o,new E(-1,0)),j.getCoordsRelative(o,new E(-1,1))].filter(Boolean).forEach(f=>{const p=this.memory.getSquare(f);p&&J(p.allegiance)===a||(t.push({kind:"move",type:p?"capture":null,from:o,to:f,piece:o.piece}),p&&t.push({kind:"move",type:"allegiance",from:o,to:f,piece:o.piece}))});const l=this.memory.castlingRights("white"),u=n.some(f=>H(o,f));if(this.activeColour==="white"&&l.length>0){const f=this.memory.getSquare({file:1,rank:1}),p=this.memory.getSquare({file:2,rank:1}),d=this.memory.getSquare({file:3,rank:1}),v=this.memory.getSquare({file:4,rank:1}),k=this.memory.getSquare({file:6,rank:1}),w=this.memory.getSquare({file:7,rank:1}),P=this.memory.getSquare({file:8,rank:1}),C=n.some(S=>H(S,{file:2,rank:1})),T=n.some(S=>H(S,{file:3,rank:1})),m=n.some(S=>H(S,{file:4,rank:1})),O=n.some(S=>H(S,{file:6,rank:1})),q=n.some(S=>H(S,{file:7,rank:1}));l.forEach(S=>{S==="king"&&!u&&!k&&!w&&P&&P.piece==="R"&&J(P.allegiance)==="white"&&!O&&!q&&t.push({kind:"move",type:"castle",from:o,to:j.getCoordsRelative(o,new E(2,0)),piece:this.memory.getSquare(o).piece,side:"king"}),S==="queen"&&!u&&!p&&!d&&!v&&f&&f.piece==="R"&&J(f.allegiance)==="white"&&!C&&!T&&!m&&t.push({kind:"move",type:"castle",from:o,to:j.getCoordsRelative(o,new E(-2,0)),piece:this.memory.getSquare(o).piece,side:"queen"})})}const c=this.memory.castlingRights("black");if(this.activeColour==="black"&&c.length>0){const f=this.memory.getSquare({file:1,rank:8}),p=this.memory.getSquare({file:2,rank:8}),d=this.memory.getSquare({file:3,rank:8}),v=this.memory.getSquare({file:4,rank:8}),k=this.memory.getSquare({file:6,rank:8}),w=this.memory.getSquare({file:7,rank:8}),P=this.memory.getSquare({file:8,rank:8}),C=n.some(S=>H(S,{file:2,rank:8})),T=n.some(S=>H(S,{file:3,rank:8})),m=n.some(S=>H(S,{file:4,rank:8})),O=n.some(S=>H(S,{file:6,rank:8})),q=n.some(S=>H(S,{file:7,rank:8}));c.forEach(S=>{S==="king"&&!u&&!k&&!w&&P&&P.piece==="R"&&J(P.allegiance)==="black"&&!O&&!q&&t.push({kind:"move",type:"castle",from:o,to:j.getCoordsRelative(o,new E(2,0)),piece:this.memory.getSquare(o).piece,side:"king"}),S==="queen"&&!u&&!p&&!d&&!v&&f&&f.piece==="R"&&J(f.allegiance)==="black"&&!C&&!T&&!m&&t.push({kind:"move",type:"castle",from:o,to:j.getCoordsRelative(o,new E(-2,0)),piece:this.memory.getSquare(o).piece,side:"queen"})})}}}),t)}getGameOverNode(t,r){const n=this.getCheckMovesFromList(t),i=this.getSquares().filter(Boolean),o=this.activeColour,a=this.activeColour==="white"?"black":"white",s=(v,k)=>i.reduce((w,P)=>!k&&k!==null&&J(P.allegiance)===v||P.piece===k&&J(P.allegiance)===v?w+1:w,0),l=n.some(v=>{const k=this.memory.getSquare(v.to);return J(k.allegiance)===o});if(l&&r.length===0)return{kind:"game-over",outcome:a,reason:"Checkmate"};if(!l&&r.length===0)return{kind:"game-over",outcome:"draw",reason:"Stalemate"};const u=s(o),c=s(a);if(u===1&&c===1){const v=i.find(w=>J(w.allegiance)===a);if(i.find(w=>J(w.allegiance)===o).piece==="K"&&v.piece==="K")return{kind:"game-over",outcome:"draw",reason:"Insufficient material (king vs king)"}}if(u<=2&&c<=2){const v=i.find(C=>J(C.allegiance)===a&&C.piece==="K"),k=i.find(C=>J(C.allegiance)===a&&C.piece!=="K"),w=i.find(C=>J(C.allegiance)===o&&C.piece==="K"),P=i.find(C=>J(C.allegiance)===o&&C.piece!=="K");if(w&&v&&(!P||P.piece==="N"||P.piece==="B")&&(!k||k.piece==="N"||k.piece==="B"))return{kind:"game-over",outcome:"draw",reason:"Insufficient material (king + minor vs king + minor)"}}if(this.halfmoveClock>=100)return{kind:"game-over",outcome:"draw",reason:"50 move-rule"};const f=this.getPositionCount(),p=this.toAFEN({sections:["positions"]});if((f.get(p)||0)>=3)return{kind:"game-over",outcome:"draw",reason:"Repetition"}}getCheckMoves(){const t=this.getPossibleMoves();return this.getCheckMovesFromList(t)}getCheckMovesFromList(t){return t.filter(r=>{if(r.kind!=="move"||!r.to)return;const n=this.memory.getSquare(r.to);return n&&n.piece==="K"})}getValidMovesFromList(t,r){const n=t.filter(o=>{if(o.kind!=="move")return!0;if(r.from&&!H(r.from,o.from))return!1;const a=this.memory.getSquare(o.from);if(J(a.allegiance)!==this.activeColour)return!1;const s=this.clone();s.executeNode(o);const l=s.getPossibleMoves();return s.getCheckMovesFromList(l).every(c=>{const f=s.getSquare(c.to);return J(f.allegiance)!==this.activeColour})}),i=this.getGameOverNode(t,n);return i?[i]:n}getValidMoves(t){const r=this.getPossibleMoves();return this.getValidMovesFromList(r,{from:t,side:this.activeColour})}}const sv={class:"row column full-width full-height no-pointer-events background-layer","data-testid":"background"},lv={key:0,class:"absolute absolute-bottom-right q-px-sm"},uv={key:1,class:"absolute absolute-top-left q-pa-xs"},cv=Ue({__name:"background-layer",props:{ranks:{},files:{},perspective:{}},setup(e){const t=rn();return(r,n)=>(M(),Z("div",sv,[(M(!0),Z(xe,null,Be(r.ranks,(i,o)=>(M(),Z("div",{class:"rank col row full-width",key:o},[(M(!0),Z(xe,null,Be(r.files,(a,s)=>(M(),Z("div",{key:s,class:Ke(["file col relative-position",{"text-h6 text-bold":le(t).screen.gt.sm,"text-subtitle1 text-bold":le(t).screen.sm,"text-subtitle2":le(t).screen.lt.sm}])},[o===7?(M(),Z("span",lv,kt(le($t)(r.perspective==="white"?9-(8-s):8-s)),1)):pe("",!0),s===0?(M(),Z("span",uv,kt(r.perspective==="white"?8-o:9-(8-o)),1)):pe("",!0)],2))),128))]))),128))]))}});var fv=ht(cv,[["__scopeId","data-v-5503eeb2"]]);const dv={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function hv({showing:e,avoidEmit:t,configureAnchorEl:r}){const{props:n,proxy:i,emit:o}=Dt(),a=U(null);let s=null;function l(d){return a.value===null?!1:d===void 0||d.touches===void 0||d.touches.length<=1}const u={};r===void 0&&(Object.assign(u,{hide(d){i.hide(d)},toggle(d){i.toggle(d),d.qAnchorHandled=!0},toggleKey(d){yi(d,13)===!0&&u.toggle(d)},contextClick(d){i.hide(d),Qi(d),Aa(()=>{i.show(d),d.qAnchorHandled=!0})},prevent:Qi,mobileTouch(d){if(u.mobileCleanup(d),l(d)!==!0)return;i.hide(d),a.value.classList.add("non-selectable");const v=d.target;Yi(u,"anchor",[[v,"touchmove","mobileCleanup","passive"],[v,"touchend","mobileCleanup","passive"],[v,"touchcancel","mobileCleanup","passive"],[a.value,"contextmenu","prevent","notPassive"]]),s=setTimeout(()=>{s=null,i.show(d),d.qAnchorHandled=!0},300)},mobileCleanup(d){a.value.classList.remove("non-selectable"),s!==null&&(clearTimeout(s),s=null),e.value===!0&&d!==void 0&&Ql()}}),r=function(d=n.contextMenu){if(n.noParentEvent===!0||a.value===null)return;let v;d===!0?i.$q.platform.is.mobile===!0?v=[[a.value,"touchstart","mobileTouch","passive"]]:v=[[a.value,"mousedown","hide","passive"],[a.value,"contextmenu","contextClick","notPassive"]]:v=[[a.value,"click","toggle","passive"],[a.value,"keyup","toggleKey","passive"]],Yi(u,"anchor",v)});function c(){Pl(u,"anchor")}function f(d){for(a.value=d;a.value.classList.contains("q-anchor--skip");)a.value=a.value.parentNode;r()}function p(){if(n.target===!1||n.target===""||i.$el.parentNode===null)a.value=null;else if(n.target===!0)f(i.$el.parentNode);else{let d=n.target;if(typeof n.target=="string")try{d=document.querySelector(n.target)}catch{d=void 0}d!=null?(a.value=d.$el||d,r()):(a.value=null,console.error(`Anchor: target "${n.target}" not found`))}}return qe(()=>n.contextMenu,d=>{a.value!==null&&(c(),r(d))}),qe(()=>n.target,()=>{a.value!==null&&c(),p()}),qe(()=>n.noParentEvent,d=>{a.value!==null&&(d===!0?c():r())}),mi(()=>{p(),t!==!0&&n.modelValue===!0&&a.value===null&&o("update:modelValue",!1)}),pt(()=>{s!==null&&clearTimeout(s),c()}),{anchorEl:a,canShow:l,anchorEvents:u}}function pv(e,t){const r=U(null);let n;function i(s,l){const u=`${l!==void 0?"add":"remove"}EventListener`,c=l!==void 0?l:n;s!==window&&s[u]("scroll",c,Qn.passive),window[u]("scroll",c,Qn.passive),n=l}function o(){r.value!==null&&(i(r.value),r.value=null)}const a=qe(()=>e.noParentEvent,()=>{r.value!==null&&(o(),t())});return pt(a),{localScrollTarget:r,unconfigureScrollTarget:o,changeScrollEvent:i}}const Tt=[];function vv(e){return Tt.find(t=>t.contentEl!==null&&t.contentEl.contains(e))}function pl(e,t){do{if(e.$options.name==="QMenu"){if(e.hide(t),e.$props.separateClosePopup===!0)return Rr(e)}else if(e.__qPortal===!0){const r=Rr(e);return r!==void 0&&r.$options.name==="QPopupProxy"?(e.hide(t),r):e}e=Rr(e)}while(e!=null)}function gv(e,t,r){for(;r!==0&&e!==void 0&&e!==null;){if(e.__qPortal===!0){if(r--,e.$options.name==="QMenu"){e=pl(e,t);continue}e.hide(t)}e=Rr(e)}}function yv(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function vl(e,t,r,n){const i=U(!1),o=U(!1);let a=null;const s={},l=n==="dialog"&&yv(e);function u(f){if(f===!0){to(s),o.value=!0;return}o.value=!1,i.value===!1&&(l===!1&&a===null&&(a=Nl(!1,n)),i.value=!0,Tt.push(e.proxy),tu(s))}function c(f){if(o.value=!1,f!==!0)return;to(s),i.value=!1;const p=Tt.indexOf(e.proxy);p!==-1&&Tt.splice(p,1),a!==null&&(Ml(a),a=null)}return Tl(()=>{c(!0)}),e.proxy.__qPortal=!0,jl(e.proxy,"contentEl",()=>t.value),{showPortal:u,hidePortal:c,portalIsActive:i,portalIsAccessible:o,renderPortal:()=>l===!0?r():i.value===!0?[re(Cl,{to:a},r())]:void 0}}const gl={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function yl(e,t=()=>{},r=()=>{}){return{transitionProps:L(()=>{const n=`q-transition--${e.transitionShow||t()}`,i=`q-transition--${e.transitionHide||r()}`;return{appear:!0,enterFromClass:`${n}-enter-from`,enterActiveClass:`${n}-enter-active`,enterToClass:`${n}-enter-to`,leaveFromClass:`${i}-leave-from`,leaveActiveClass:`${i}-leave-active`,leaveToClass:`${i}-leave-to`}}),transitionStyle:L(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}function ml(){let e;const t=Dt();function r(){e=void 0}return Ra(r),pt(r),{removeTick:r,registerTick(n){e=n,Aa(()=>{e===n&&($l(t)===!1&&e(),e=void 0)})}}}const ct=[];let qt;function mv(e){qt=e.keyCode===27}function bv(){qt===!0&&(qt=!1)}function wv(e){qt===!0&&(qt=!1,yi(e,27)===!0&&ct[ct.length-1](e))}function bl(e){window[e]("keydown",mv),window[e]("blur",bv),window[e]("keyup",wv),qt=!1}function wl(e){bi.is.desktop===!0&&(ct.push(e),ct.length===1&&bl("addEventListener"))}function Zr(e){const t=ct.indexOf(e);t>-1&&(ct.splice(t,1),ct.length===0&&bl("removeEventListener"))}const ft=[];function Sl(e){ft[ft.length-1](e)}function kl(e){bi.is.desktop===!0&&(ft.push(e),ft.length===1&&document.body.addEventListener("focusin",Sl))}function vi(e){const t=ft.indexOf(e);t>-1&&(ft.splice(t,1),ft.length===0&&document.body.removeEventListener("focusin",Sl))}const{notPassiveCapture:en}=Qn,dt=[];function tn(e){const t=e.target;if(t===void 0||t.nodeType===8||t.classList.contains("no-pointer-events")===!0)return;let r=Tt.length-1;for(;r>=0;){const n=Tt[r].$;if(n.type.name==="QTooltip"){r--;continue}if(n.type.name!=="QDialog")break;if(n.props.seamless!==!0)return;r--}for(let n=dt.length-1;n>=0;n--){const i=dt[n];if((i.anchorEl.value===null||i.anchorEl.value.contains(t)===!1)&&(t===document.body||i.innerRef.value!==null&&i.innerRef.value.contains(t)===!1))e.qClickOutside=!0,i.onClickOutside(e);else return}}function Sv(e){dt.push(e),dt.length===1&&(document.addEventListener("mousedown",tn,en),document.addEventListener("touchstart",tn,en))}function ha(e){const t=dt.findIndex(r=>r===e);t>-1&&(dt.splice(t,1),dt.length===0&&(document.removeEventListener("mousedown",tn,en),document.removeEventListener("touchstart",tn,en)))}let pa,va;function ga(e){const t=e.split(" ");return t.length!==2?!1:["top","center","bottom"].includes(t[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(t[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function kv(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const gi={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{gi[`${e}#ltr`]=e,gi[`${e}#rtl`]=e});function ya(e,t){const r=e.split(" ");return{vertical:r[0],horizontal:gi[`${r[1]}#${t===!0?"rtl":"ltr"}`]}}function Ev(e,t){let{top:r,left:n,right:i,bottom:o,width:a,height:s}=e.getBoundingClientRect();return t!==void 0&&(r-=t[1],n-=t[0],o+=t[1],i+=t[0],a+=t[0],s+=t[1]),{top:r,bottom:o,height:s,left:n,right:i,width:a,middle:n+(i-n)/2,center:r+(o-r)/2}}function _v(e,t,r){let{top:n,left:i}=e.getBoundingClientRect();return n+=t.top,i+=t.left,r!==void 0&&(n+=r[1],i+=r[0]),{top:n,bottom:n+1,height:1,left:i,right:i+1,width:1,middle:i,center:n}}function Av(e,t){return{top:0,center:t/2,bottom:t,left:0,middle:e/2,right:e}}function ma(e,t,r,n){return{top:e[r.vertical]-t[n.vertical],left:e[r.horizontal]-t[n.horizontal]}}function El(e,t=0){if(e.targetEl===null||e.anchorEl===null||t>5)return;if(e.targetEl.offsetHeight===0||e.targetEl.offsetWidth===0){setTimeout(()=>{El(e,t+1)},10);return}const{targetEl:r,offset:n,anchorEl:i,anchorOrigin:o,selfOrigin:a,absoluteOffset:s,fit:l,cover:u,maxHeight:c,maxWidth:f}=e;if(bi.is.ios===!0&&window.visualViewport!==void 0){const q=document.body.style,{offsetLeft:S,offsetTop:G}=window.visualViewport;S!==pa&&(q.setProperty("--q-pe-left",S+"px"),pa=S),G!==va&&(q.setProperty("--q-pe-top",G+"px"),va=G)}const{scrollLeft:p,scrollTop:d}=r,v=s===void 0?Ev(i,u===!0?[0,0]:n):_v(i,s,n);Object.assign(r.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:f||"100vw",maxHeight:c||"100vh",visibility:"visible"});const{offsetWidth:k,offsetHeight:w}=r,{elWidth:P,elHeight:C}=l===!0||u===!0?{elWidth:Math.max(v.width,k),elHeight:u===!0?Math.max(v.height,w):w}:{elWidth:k,elHeight:w};let T={maxWidth:f,maxHeight:c};(l===!0||u===!0)&&(T.minWidth=v.width+"px",u===!0&&(T.minHeight=v.height+"px")),Object.assign(r.style,T);const m=Av(P,C);let O=ma(v,m,o,a);if(s===void 0||n===void 0)Vn(O,v,m,o,a);else{const{top:q,left:S}=O;Vn(O,v,m,o,a);let G=!1;if(O.top!==q){G=!0;const D=2*n[1];v.center=v.top-=D,v.bottom-=D+2}if(O.left!==S){G=!0;const D=2*n[0];v.middle=v.left-=D,v.right-=D+2}G===!0&&(O=ma(v,m,o,a),Vn(O,v,m,o,a))}T={top:O.top+"px",left:O.left+"px"},O.maxHeight!==void 0&&(T.maxHeight=O.maxHeight+"px",v.height>O.maxHeight&&(T.minHeight=T.maxHeight)),O.maxWidth!==void 0&&(T.maxWidth=O.maxWidth+"px",v.width>O.maxWidth&&(T.minWidth=T.maxWidth)),Object.assign(r.style,T),r.scrollTop!==d&&(r.scrollTop=d),r.scrollLeft!==p&&(r.scrollLeft=p)}function Vn(e,t,r,n,i){const o=r.bottom,a=r.right,s=Yl(),l=window.innerHeight-s,u=document.body.clientWidth;if(e.top<0||e.top+o>l)if(i.vertical==="center")e.top=t[n.vertical]>l/2?Math.max(0,l-o):0,e.maxHeight=Math.min(o,l);else if(t[n.vertical]>l/2){const c=Math.min(l,n.vertical==="center"?t.center:n.vertical===i.vertical?t.bottom:t.top);e.maxHeight=Math.min(o,c),e.top=Math.max(0,c-o)}else e.top=Math.max(0,n.vertical==="center"?t.center:n.vertical===i.vertical?t.top:t.bottom),e.maxHeight=Math.min(o,l-e.top);if(e.left<0||e.left+a>u)if(e.maxWidth=Math.min(a,u),i.horizontal==="middle")e.left=t[n.horizontal]>u/2?Math.max(0,u-a):0;else if(t[n.horizontal]>u/2){const c=Math.min(u,n.horizontal==="middle"?t.middle:n.horizontal===i.horizontal?t.right:t.left);e.maxWidth=Math.min(a,c),e.left=Math.max(0,c-e.maxWidth)}else e.left=Math.max(0,n.horizontal==="middle"?t.middle:n.horizontal===i.horizontal?t.left:t.right),e.maxWidth=Math.min(a,u-e.left)}var _l=nr({name:"QMenu",inheritAttrs:!1,props:{...dv,...ja,...ki,...gl,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:ga},self:{type:String,validator:ga},offset:{type:Array,validator:kv},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...Ca,"click","escapeKey"],setup(e,{slots:t,emit:r,attrs:n}){let i=null,o,a,s;const l=Dt(),{proxy:u}=l,{$q:c}=u,f=U(null),p=U(!1),d=L(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),v=Ei(e,c),{registerTick:k,removeTick:w}=ml(),{registerTimeout:P}=Na(),{transitionProps:C,transitionStyle:T}=yl(e),{localScrollTarget:m,changeScrollEvent:O,unconfigureScrollTarget:q}=pv(e,g),{anchorEl:S,canShow:G}=hv({showing:p}),{hide:D}=Ma({showing:p,canShow:G,handleShow:de,handleHide:Me,hideOnRouteChange:d,processOnMount:!0}),{showPortal:ve,hidePortal:ie,renderPortal:se}=vl(l,f,x,"menu"),Re={anchorEl:S,innerRef:f,onClickOutside(R){if(e.persistent!==!0&&p.value===!0)return D(R),(R.type==="touchstart"||R.target.classList.contains("q-dialog__backdrop"))&&Pa(R),!0}},me=L(()=>ya(e.anchor||(e.cover===!0?"center middle":"bottom start"),c.lang.rtl)),we=L(()=>e.cover===!0?me.value:ya(e.self||"top start",c.lang.rtl)),A=L(()=>(e.square===!0?" q-menu--square":"")+(v.value===!0?" q-menu--dark q-dark":"")),F=L(()=>e.autoClose===!0?{onClick:b}:{}),B=L(()=>p.value===!0&&e.persistent!==!0);qe(B,R=>{R===!0?(wl(N),Sv(Re)):(Zr(N),ha(Re))});function ne(){$a(()=>{let R=f.value;R&&R.contains(document.activeElement)!==!0&&(R=R.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||R.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||R.querySelector("[autofocus], [data-autofocus]")||R,R.focus({preventScroll:!0}))})}function de(R){if(i=e.noRefocus===!1?document.activeElement:null,kl(_),ve(),g(),o=void 0,R!==void 0&&(e.touchPosition||e.contextMenu)){const Y=ql(R);if(Y.left!==void 0){const{top:ge,left:Fe}=S.value.getBoundingClientRect();o={left:Y.left-Fe,top:Y.top-ge}}}a===void 0&&(a=qe(()=>c.screen.width+"|"+c.screen.height+"|"+e.self+"|"+e.anchor+"|"+c.lang.rtl,I)),e.noFocus!==!0&&document.activeElement.blur(),k(()=>{I(),e.noFocus!==!0&&ne()}),P(()=>{c.platform.is.ios===!0&&(s=e.autoClose,f.value.click()),I(),ve(!0),r("show",R)},e.transitionDuration)}function Me(R){w(),ie(),h(!0),i!==null&&(R===void 0||R.qClickOutside!==!0)&&(((R&&R.type.indexOf("key")===0?i.closest('[tabindex]:not([tabindex^="-"])'):void 0)||i).focus(),i=null),P(()=>{ie(!0),r("hide",R)},e.transitionDuration)}function h(R){o=void 0,a!==void 0&&(a(),a=void 0),(R===!0||p.value===!0)&&(vi(_),q(),ha(Re),Zr(N)),R!==!0&&(i=null)}function g(){(S.value!==null||e.scrollTarget!==void 0)&&(m.value=Jl(S.value,e.scrollTarget),O(m.value,I))}function b(R){s!==!0?(pl(u,R),r("click",R)):s=!1}function _(R){B.value===!0&&e.noFocus!==!0&&Oa(f.value,R.target)!==!0&&ne()}function N(R){r("escapeKey"),D(R)}function I(){El({targetEl:f.value,offset:e.offset,anchorEl:S.value,anchorOrigin:me.value,selfOrigin:we.value,absoluteOffset:o,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function x(){return re(Yt,C.value,()=>p.value===!0?re("div",{role:"menu",...n,ref:f,tabindex:-1,class:["q-menu q-position-engine scroll"+A.value,n.class],style:[n.style,T.value],...F.value},wi(t.default)):null)}return pt(h),Object.assign(u,{focus:ne,updatePosition:I}),se}});const Rv=Ue({__name:"promotion-selector",props:{modelValue:{type:Boolean},allegiance:{}},emits:["click","dismiss"],setup(e,{emit:t}){const r=["Q","N","R","B"],n=()=>{t("dismiss")};return(i,o)=>(M(),ce(_l,{cover:"","model-value":i.modelValue,"onUpdate:modelValue":n},{default:X(()=>[V(Ta,null,{default:X(()=>[(M(),Z(xe,null,Be(r,a=>V(Ur,{clickable:"",key:a,class:"q-pa-sm",onClick:s=>t("click",a)},{default:X(()=>[V(Xt,{class:"promotion-piece items-center"},{default:X(()=>[V(jt,{allegiance:i.allegiance,piece:a,size:92},null,8,["allegiance","piece"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1},8,["model-value"]))}});var Ov=ht(Rv,[["__scopeId","data-v-370c2c26"]]);const Pv=Ue({__name:"capture-selector",props:{modelValue:{type:Boolean},moves:{}},emits:["click","dismiss"],setup(e,{emit:t}){const r=()=>{t("dismiss")};return(n,i)=>(M(),ce(_l,{cover:"","model-value":n.modelValue,"onUpdate:modelValue":r},{default:X(()=>[V(Ta,null,{default:X(()=>[n.moves.includes("x")?(M(),ce(Ur,{key:0,clickable:"",onClick:i[0]||(i[0]=o=>t("click","capture")),class:"q-py-lg"},{default:X(()=>[V(Xt,{class:"items-center"},{default:X(()=>[V(st,{size:"72px",name:"close"})]),_:1})]),_:1})):pe("",!0),n.moves.includes(">")?(M(),ce(Ur,{key:1,clickable:"",onClick:i[1]||(i[1]=o=>t("click","challenge")),class:"q-py-lg"},{default:X(()=>[V(Xt,{class:"items-center"},{default:X(()=>[V(st,{size:"64px",name:"arrow_forward_ios"})]),_:1})]),_:1})):pe("",!0)]),_:1})]),_:1},8,["model-value"]))}});const Tv={class:"relative-position full-width full-height interaction-layer"},jv=["onClick"],Cv=Ue({__name:"interaction-layer",props:{enPassantTarget:{},squares:{},squareSize:{},ranks:{},files:{},perspective:{},pieceFocus:{},validMoves:{},activeColour:{}},emits:["execute-node-index","update-piece-focus","update-highlights"],setup(e,{emit:t}){const r=e,n=U(null),i=U(null),o=U(null),a=m=>r.squares.find(O=>H(O,m)),s=L(()=>r.pieceFocus?a(r.pieceFocus):null),l=L(()=>r.pieceFocus?r.validMoves.filter(q=>q.kind==="move"&&H(r.pieceFocus,q.from)).map(q=>q.kind!=="move"?null:q.to).filter(Boolean):[]),u=m=>{const O=r.squares.find(q=>H(q,m));return O?J(O.allegiance)!==r.perspective:!1},c=m=>l.value.some(O=>O&&H(m,O)),f=(m,O)=>{var S,G;if(O.stopPropagation(),O.preventDefault(),c(m)&&r.pieceFocus&&s.value){if(r.enPassantTarget&&H(r.enPassantTarget,m))t("execute-node-index",j.findMoveIndex(r.validMoves,{kind:"move",type:"en-passant",from:r.pieceFocus,to:m})),t("update-piece-focus",null);else if(Le(m,r.activeColour)&&s&&s.value.piece===null){i.value=m;const D=a(r.pieceFocus);o.value=(S=D==null?void 0:D.allegiance)!=null?S:null}else a(m)?n.value=m:((G=s.value)==null?void 0:G.piece)==="K"&&Math.abs(r.pieceFocus.file-m.file)>1?t("execute-node-index",j.findMoveIndex(r.validMoves,{kind:"move",type:"castle",side:m.file===7?"king":"queen",from:r.pieceFocus,to:m})):t("execute-node-index",j.findMoveIndex(r.validMoves,{kind:"move",from:r.pieceFocus,to:m}));return}if(u(m))return;const q=a(m);t("update-piece-focus",q?m:null)},p=(m,O)=>{if(!r.pieceFocus)return;i.value=null;const q=j.findMoveIndex(r.validMoves,{kind:"move",type:"promotion",from:r.pieceFocus,to:m,promotionTo:O});t("execute-node-index",q),t("update-piece-focus",null)},d=()=>{i.value=null,o.value=null},v=()=>{n.value=null},k=m=>{if(!r.pieceFocus||!n.value)return;const O=j.findMoveIndex(r.validMoves,{kind:"move",type:m==="capture"?"capture":"allegiance",from:r.pieceFocus,to:n.value});t("execute-node-index",O),n.value=null,t("update-piece-focus",null)},w=(m,O)=>{const q=m+1,S=O+1;return r.perspective==="white"?{file:q,rank:9-S}:{file:9-q,rank:S}},P=m=>!a(m),C=(m,O,q)=>r.validMoves.some(S=>S.kind==="move"&&H(S.to,q)&&H(S.from,O)&&S.type===m),T=L(()=>{const m=[];return!r.pieceFocus||!n.value||(C("allegiance",r.pieceFocus,n.value)&&m.push(">"),C("capture",r.pieceFocus,n.value)&&m.push("x")),m});return(m,O)=>(M(),Z("div",Tv,[(M(!0),Z(xe,null,Be(m.ranks,(q,S)=>(M(),Z("div",{class:"col column row full-width",key:S},[(M(!0),Z(xe,null,Be(m.files,(G,D)=>{var ve,ie;return M(),Z("div",{key:D,class:"full-height"},[Jt((M(),Z("div",{class:Ke(["absolute",{"cursor-pointer":!P(w(D,S))||c(w(D,S)),"cursor-not-allowed":u(w(D,S))&&!s.value}]),onClick:se=>f(w(D,S),se),style:zr(m.perspective==="white"?{width:`${m.squareSize}px`,height:`${m.squareSize}px`,left:`${(w(D,S).file-1)*m.squareSize}px`,bottom:`${(w(D,S).rank-1)*m.squareSize}px`}:{width:`${m.squareSize}px`,height:`${m.squareSize}px`,right:`${(w(D,S).file-1)*m.squareSize}px`,top:`${(w(D,S).rank-1)*m.squareSize}px`})},[n.value&&le(H)(n.value,w(D,S))?(M(),ce(Pv,{key:0,moves:T.value,"model-value":(ve=le(H)(n.value,w(D,S)))!=null?ve:!1,size:m.squareSize,onClick:k,onDismiss:v},null,8,["moves","model-value","size"])):pe("",!0),o.value!==null&&(le(Le)(w(D,S),"white")||le(Le)(w(D,S),"black"))?(M(),ce(Ov,{key:1,"model-value":(ie=le(H)(i.value,w(D,S)))!=null?ie:!1,allegiance:o.value,size:m.squareSize,onClick:se=>p(w(D,S),se),onDismiss:d},null,8,["model-value","allegiance","size","onClick"])):pe("",!0)],14,jv)),[[Si,!P(w(D,S))&&!u(w(D,S))]])])}),128))]))),128))]))}});var Nv=ht(Cv,[["__scopeId","data-v-26605594"]]);const Mv={class:"relative-position full-width full-height column no-pointer-events indicators-layer"},$v=Ue({__name:"indicators-layer",props:{squares:{},checkMoves:{},validMoves:{},ranks:{},files:{},squareSize:{},perspective:{},pieceFocus:{},lastMove:{}},setup(e){const t=e,r=L(()=>t.pieceFocus?t.validMoves.filter(u=>u.kind==="move"&&H(t.pieceFocus,u.from)).map(u=>u.kind!=="move"?null:u.to).filter(Boolean):[]),n=s=>r.value.some(l=>l&&H(s,l)),i=s=>!t.squares.find(l=>H(s,l)),o=(s,l)=>{const u=s+1,c=l+1;return t.perspective==="white"?{file:u,rank:9-c}:{file:9-u,rank:c}},a=s=>t.checkMoves.some(l=>l.kind==="move"&&H(l.to,s));return(s,l)=>(M(),Z("div",Mv,[(M(!0),Z(xe,null,Be(s.ranks,(u,c)=>(M(),Z("div",{class:"col column row full-width",key:c},[(M(!0),Z(xe,null,Be(s.files,(f,p)=>{var d,v;return M(),Z("div",{key:p,class:Ke(["full-height move-placeholder",{even:c%2===0?p%2===0:p%2!==0,focus:le(H)(s.pieceFocus,o(p,c)),show:n(o(p,c)),capture:!i(o(p,c)),target:i(o(p,c)),checked:a(o(p,c)),"last-from":((d=s.lastMove)==null?void 0:d.kind)==="move"&&le(H)(s.lastMove.from,o(p,c)),"last-to":((v=s.lastMove)==null?void 0:v.kind)==="move"&&le(H)(s.lastMove.to,o(p,c))}])},null,2)}),128))]))),128))]))}});var qv=ht($v,[["__scopeId","data-v-1db9cbe6"]]);const Dv={class:"relative-position full-width full-height no-pointer-events pieces-layer"},Fv=Ue({__name:"pieces-layer",props:{modelValue:{},squareSize:{},perspective:{}},setup(e){const t=rn();return(r,n)=>(M(),Z("div",Dv,[(M(!0),Z(xe,null,Be(r.modelValue,(i,o)=>(M(),Z("div",{key:o},[i?(M(),ce(jt,{key:0,"data-testid":"piece",class:Ke(["absolute",{"q-pa-xs":le(t).screen.sm||le(t).screen.md,"q-pa-sm":le(t).screen.gt.sm}]),piece:i.piece,allegiance:i.allegiance,size:r.squareSize,style:zr(r.perspective==="white"?{left:`${(i.file-1)*r.squareSize}px`,bottom:`${(i.rank-1)*r.squareSize}px`}:{right:`${(i.file-1)*r.squareSize}px`,top:`${(i.rank-1)*r.squareSize}px`})},null,8,["class","piece","allegiance","size","style"])):(M(),Z("div",{key:1,style:zr({width:`${r.squareSize}px`,height:`${r.squareSize}px`})},null,4))]))),128))]))}});var Lv=ht(Fv,[["__scopeId","data-v-32a0cdca"]]);const xv={class:"absolute full-width full-height"},Bv={class:"absolute full-width full-height"},Iv={class:"absolute full-width full-height"},zv={class:"absolute full-width full-height"},Og=Ue({__name:"chess-board",props:{squares:{},moveHistoryAst:{},checkMoves:{},width:{},perspective:{},playAs:{},roundedBorders:{type:Boolean},validMoves:{},activeColour:{},enPassantTarget:{}},emits:["execute-node-index"],setup(e,{emit:t}){const r=e,n=L(()=>r.width/8),i=U(null),o=s=>{t("execute-node-index",s),i.value=null},a=L(()=>{var s;return(s=r.moveHistoryAst.children.at(-1))!=null?s:null});return(s,l)=>(M(),Z("div",{"data-testid":"chess-board",class:Ke(["relative-position column",{"rounded-borders overflow-hidden":s.roundedBorders}]),style:zr({width:r.width+"px",height:r.width+"px"})},[Pe("div",xv,[V(fv,{ranks:8,files:8,perspective:s.perspective},null,8,["perspective"])]),Pe("div",Bv,[V(qv,{"valid-moves":s.validMoves,"check-moves":s.checkMoves,squares:s.squares,"square-size":n.value,files:8,ranks:8,perspective:s.perspective,"piece-focus":i.value,"last-move":a.value},null,8,["valid-moves","check-moves","squares","square-size","perspective","piece-focus","last-move"])]),Pe("div",Iv,[V(Lv,{"model-value":s.squares,perspective:r.perspective,"square-size":n.value},null,8,["model-value","perspective","square-size"])]),Pe("div",zv,[V(Nv,{onExecuteNodeIndex:o,onUpdatePieceFocus:l[0]||(l[0]=u=>i.value=u),"piece-focus":i.value,squares:s.squares,"en-passant-target":s.enPassantTarget,"active-colour":s.activeColour,"square-size":n.value,files:8,ranks:8,perspective:s.perspective,"valid-moves":s.validMoves},null,8,["piece-focus","squares","en-passant-target","active-colour","square-size","perspective","valid-moves"])])],6))}}),Uv={xs:8,sm:10,md:14,lg:20,xl:24};var ba=nr({name:"QChip",props:{...ki,...Dl,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:t,emit:r}){const{proxy:{$q:n}}=Dt(),i=Ei(e,n),o=Fl(e,Uv),a=L(()=>e.selected===!0||e.icon!==void 0),s=L(()=>e.selected===!0?e.iconSelected||n.iconSet.chip.selected:e.icon),l=L(()=>e.iconRemove||n.iconSet.chip.remove),u=L(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),c=L(()=>{const w=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(w?` text-${w} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(u.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(i.value===!0?" q-chip--dark q-dark":"")}),f=L(()=>{const w=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},P={...w,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||n.lang.label.remove};return{chip:w,remove:P}});function p(w){w.keyCode===13&&d(w)}function d(w){e.disable||(r("update:selected",!e.selected),r("click",w))}function v(w){(w.keyCode===void 0||w.keyCode===13)&&(Pa(w),e.disable===!1&&(r("update:modelValue",!1),r("remove")))}function k(){const w=[];u.value===!0&&w.push(re("div",{class:"q-focus-helper"})),a.value===!0&&w.push(re(st,{class:"q-chip__icon q-chip__icon--left",name:s.value}));const P=e.label!==void 0?[re("div",{class:"ellipsis"},[e.label])]:void 0;return w.push(re("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},xl(t.default,P))),e.iconRight&&w.push(re(st,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&w.push(re(st,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:l.value,...f.value.remove,onClick:v,onKeyup:v})),w}return()=>{if(e.modelValue===!1)return;const w={class:c.value,style:o.value};return u.value===!0&&Object.assign(w,f.value.chip,{onClick:d,onKeyup:p}),Ll("div",w,k(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[Si,e.ripple]])}}});const wa=["vertical","horizontal"],Kn={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},Sa={prevent:!0,mouse:!0,mouseAllDir:!0},ka=e=>e>=250?50:Math.ceil(e/5);var Wv=nr({name:"QScrollArea",props:{...ki,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:t,emit:r}){const n=U(!1),i=U(!1),o=U(!1),a={vertical:U(0),horizontal:U(0)},s={vertical:{ref:U(null),position:U(0),size:U(0)},horizontal:{ref:U(null),position:U(0),size:U(0)}},{proxy:l}=Dt(),u=Ei(e,l.$q);let c=null,f;const p=U(null),d=L(()=>"q-scrollarea"+(u.value===!0?" q-scrollarea--dark":""));s.vertical.percentage=L(()=>{const A=s.vertical.size.value-a.vertical.value;if(A<=0)return 0;const F=mr(s.vertical.position.value/A,0,1);return Math.round(F*1e4)/1e4}),s.vertical.thumbHidden=L(()=>(e.visible===null?o.value:e.visible)!==!0&&n.value===!1&&i.value===!1||s.vertical.size.value<=a.vertical.value+1),s.vertical.thumbStart=L(()=>s.vertical.percentage.value*(a.vertical.value-s.vertical.thumbSize.value)),s.vertical.thumbSize=L(()=>Math.round(mr(a.vertical.value*a.vertical.value/s.vertical.size.value,ka(a.vertical.value),a.vertical.value))),s.vertical.style=L(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${s.vertical.thumbStart.value}px`,height:`${s.vertical.thumbSize.value}px`})),s.vertical.thumbClass=L(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(s.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),s.vertical.barClass=L(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(s.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),s.horizontal.percentage=L(()=>{const A=s.horizontal.size.value-a.horizontal.value;if(A<=0)return 0;const F=mr(Math.abs(s.horizontal.position.value)/A,0,1);return Math.round(F*1e4)/1e4}),s.horizontal.thumbHidden=L(()=>(e.visible===null?o.value:e.visible)!==!0&&n.value===!1&&i.value===!1||s.horizontal.size.value<=a.horizontal.value+1),s.horizontal.thumbStart=L(()=>s.horizontal.percentage.value*(a.horizontal.value-s.horizontal.thumbSize.value)),s.horizontal.thumbSize=L(()=>Math.round(mr(a.horizontal.value*a.horizontal.value/s.horizontal.size.value,ka(a.horizontal.value),a.horizontal.value))),s.horizontal.style=L(()=>({...e.thumbStyle,...e.horizontalThumbStyle,[l.$q.lang.rtl===!0?"right":"left"]:`${s.horizontal.thumbStart.value}px`,width:`${s.horizontal.thumbSize.value}px`})),s.horizontal.thumbClass=L(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(s.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),s.horizontal.barClass=L(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(s.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const v=L(()=>s.vertical.thumbHidden.value===!0&&s.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),k=[[eo,A=>{S(A,"vertical")},void 0,{vertical:!0,...Sa}]],w=[[eo,A=>{S(A,"horizontal")},void 0,{horizontal:!0,...Sa}]];function P(){const A={};return wa.forEach(F=>{const B=s[F];A[F+"Position"]=B.position.value,A[F+"Percentage"]=B.percentage.value,A[F+"Size"]=B.size.value,A[F+"ContainerSize"]=a[F].value}),A}const C=Bl(()=>{const A=P();A.ref=l,r("scroll",A)},0);function T(A,F,B){if(wa.includes(A)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(A==="vertical"?Zi:Sn)(p.value,F,B)}function m({height:A,width:F}){let B=!1;a.vertical.value!==A&&(a.vertical.value=A,B=!0),a.horizontal.value!==F&&(a.horizontal.value=F,B=!0),B===!0&&ie()}function O({position:A}){let F=!1;s.vertical.position.value!==A.top&&(s.vertical.position.value=A.top,F=!0),s.horizontal.position.value!==A.left&&(s.horizontal.position.value=A.left,F=!0),F===!0&&ie()}function q({height:A,width:F}){s.horizontal.size.value!==F&&(s.horizontal.size.value=F,ie()),s.vertical.size.value!==A&&(s.vertical.size.value=A,ie())}function S(A,F){const B=s[F];if(A.isFirst===!0){if(B.thumbHidden.value===!0)return;f=B.position.value,i.value=!0}else if(i.value!==!0)return;A.isFinal===!0&&(i.value=!1);const ne=Kn[F],de=a[F].value,Me=(B.size.value-de)/(de-B.thumbSize.value),h=A.distance[ne.dist],g=f+(A.direction===ne.dir?1:-1)*h*Me;se(g,F)}function G(A,F){const B=s[F];if(B.thumbHidden.value!==!0){const ne=A[Kn[F].offset];if(ne<B.thumbStart.value||ne>B.thumbStart.value+B.thumbSize.value){const de=ne-B.thumbSize.value/2;se(de/a[F].value*B.size.value,F)}B.ref.value!==null&&B.ref.value.dispatchEvent(new MouseEvent(A.type,A))}}function D(A){G(A,"vertical")}function ve(A){G(A,"horizontal")}function ie(){n.value=!0,c!==null&&clearTimeout(c),c=setTimeout(()=>{c=null,n.value=!1},e.delay),e.onScroll!==void 0&&C()}function se(A,F){p.value[Kn[F].scroll]=A}function Re(){o.value=!0}function me(){o.value=!1}let we=null;return qe(()=>l.$q.lang.rtl,A=>{p.value!==null&&Sn(p.value,Math.abs(s.horizontal.position.value)*(A===!0?-1:1))}),Ra(()=>{we={top:s.vertical.position.value,left:s.horizontal.position.value}}),Il(()=>{if(we===null)return;const A=p.value;A!==null&&(Sn(A,we.left),Zi(A,we.top))}),pt(C.cancel),Object.assign(l,{getScrollTarget:()=>p.value,getScroll:P,getScrollPosition:()=>({top:s.vertical.position.value,left:s.horizontal.position.value}),getScrollPercentage:()=>({top:s.vertical.percentage.value,left:s.horizontal.percentage.value}),setScrollPosition:T,setScrollPercentage(A,F,B){T(A,F*(s[A].size.value-a[A].value)*(A==="horizontal"&&l.$q.lang.rtl===!0?-1:1),B)}}),()=>re("div",{class:d.value,onMouseenter:Re,onMouseleave:me},[re("div",{ref:p,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[re("div",{class:"q-scrollarea__content absolute",style:v.value},zl(t.default,[re(Xi,{debounce:0,onResize:q})])),re(Xl,{axis:"both",onScroll:O})]),re(Xi,{debounce:0,onResize:m}),re("div",{class:s.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:D}),re("div",{class:s.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:ve}),Jt(re("div",{ref:s.vertical.ref,class:s.vertical.thumbClass.value,style:s.vertical.style.value,"aria-hidden":"true"}),k),Jt(re("div",{ref:s.horizontal.ref,class:s.horizontal.thumbClass.value,style:s.horizontal.style.value,"aria-hidden":"true"}),w)])}});const wn=e=>(Wl("data-v-4b85c492"),e=e(),Hl(),e),Hv=wn(()=>Pe("div",{class:"text-h6"},"Your turn!",-1)),Gv=wn(()=>Pe("div",{class:"text-h6"},"Waiting for opponent...",-1)),Vv=wn(()=>Pe("div",{class:"text-h6"},"Game over!",-1)),Kv=wn(()=>Pe("div",{class:"spacer col"},null,-1)),Qv={"data-testid":"default-slot"},Yv={"data-testid":"afen"},Jv={"data-testid":"move-history"},Xv={key:0,class:"col"},Zv={key:0,class:"col"},eg=Ue({__name:"game-sidebar",props:{moveHistory:{},activeColour:{},ownColour:{},afen:{},gameOver:{}},setup(e){const t=e,r=L(()=>{const a=[];return t.moveHistory.children.forEach(s=>{const l=a.at(-1);if(!l||l.length!==1){a.push([s]);return}l.push(s)}),a}),n=U(null);qe(r,()=>{!n.value||n.value.setScrollPosition("vertical",r.value.length*36,1e3)}),mi(()=>{!n.value||n.value.setScrollPosition("vertical",r.value.length*36,1e3)});const i=rn(),o=()=>{if(!!t.afen)try{navigator.clipboard.writeText(t.afen),i.notify({position:"bottom-right",timeout:4e3,message:"AFEN copied to clipboard",icon:"content_copy"})}catch{i.notify({position:"bottom-right",timeout:4e3,message:"Could not write to clipboard",icon:"close",iconColor:"red"})}};return(a,s)=>(M(),ce(qa,{flat:"",bordered:"",class:"q-ma-md full-height column justify-between","data-testid":"game-sidebar"},{default:X(()=>[V(Yt,{mode:"out-in"},{default:X(()=>[!a.gameOver&&a.activeColour===a.ownColour?(M(),ce(nt,{key:0,class:"bg-primary text-white q-mb-md"},{default:X(()=>[Hv]),_:1})):a.gameOver?(M(),ce(nt,{key:2,class:"bg-negative text-white q-mb-md"},{default:X(()=>[Vv]),_:1})):(M(),ce(nt,{key:1,class:"bg-grey text-black q-mb-md"},{default:X(()=>[Gv]),_:1}))]),_:1}),Kv,Pe("div",Qv,[V(Or),Ul(a.$slots,"default",{},void 0,!0)]),Pe("div",Yv,[V(Or),Jt((M(),ce(Ur,{clickable:"",onClick:o},{default:X(()=>[V(Xt,{class:"q-mt-sm q-mb-sm"},{default:X(()=>[V(ro,null,{default:X(()=>[yr("AFEN")]),_:1}),V(ro,{caption:"",lines:"2"},{default:X(()=>[yr(kt(a.afen),1)]),_:1})]),_:1}),V(Xt,{side:""},{default:X(()=>[V(st,{name:"edit"})]),_:1})]),_:1})),[[Si]])]),Pe("div",Jv,[V(Or),V(le(Wv),{style:{height:"500px"},ref_key:"moveHistoryScrollArea",ref:n},{default:X(()=>[(M(!0),Z(xe,null,Be(r.value,(l,u)=>(M(),ce(nt,{key:u,horizontal:"",class:Ke(["row q-py-none q-mx-md",{"q-pt-md":u===0,"q-pb-md":u===r.value.length-1}])},{default:X(()=>[l[0]?(M(),Z("div",Xv,[V(ba,{ripple:!1,class:Ke(["white-move",{highlight:l[0].kind!=="move"}])},{default:X(()=>[l[0].kind==="move"&&l[0].piece?(M(),ce(jt,{key:0,piece:l[0].piece,allegiance:3,size:24},null,8,["piece"])):pe("",!0),yr(" "+kt(le(ca).writeNode(l[0])),1)]),_:2},1032,["class"])])):pe("",!0),V(Yt,{mode:"out-in"},{default:X(()=>[l[1]?(M(),Z("div",Zv,[V(ba,{ripple:!1,class:Ke(["black-move",{highlight:l[1].kind!=="move"}])},{default:X(()=>[l[1].kind==="move"&&l[1].piece?(M(),ce(jt,{key:0,piece:l[1].piece,allegiance:0,size:24},null,8,["piece"])):pe("",!0),yr(" "+kt(le(ca).writeNode(l[1])),1)]),_:2},1032,["class"])])):pe("",!0)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1},512)])]),_:3}))}});var Pg=ht(eg,[["__scopeId","data-v-4b85c492"]]),tg=nr({name:"QCardActions",props:{...Gl,vertical:Boolean},setup(e,{slots:t}){const r=Vl(e),n=L(()=>`q-card__actions ${r.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>re("div",{class:n.value},wi(t.default))}});let Ar=0;const rg={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},Ea={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]};var ng=nr({name:"QDialog",inheritAttrs:!1,props:{...ja,...gl,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,position:{type:String,default:"standard",validator:e=>e==="standard"||["top","bottom","left","right"].includes(e)}},emits:[...Ca,"shake","click","escapeKey"],setup(e,{slots:t,emit:r,attrs:n}){const i=Dt(),o=U(null),a=U(!1),s=U(!1);let l=null,u=null,c,f;const p=L(()=>e.persistent!==!0&&e.noRouteDismiss!==!0&&e.seamless!==!0),{preventBodyScroll:d}=eu(),{registerTimeout:v}=Na(),{registerTick:k,removeTick:w}=ml(),{transitionProps:P,transitionStyle:C}=yl(e,()=>Ea[e.position][0],()=>Ea[e.position][1]),{showPortal:T,hidePortal:m,portalIsAccessible:O,renderPortal:q}=vl(i,o,b,"dialog"),{hide:S}=Ma({showing:a,hideOnRouteChange:p,handleShow:me,handleHide:we,processOnMount:!0}),{addToHistory:G,removeFromHistory:D}=Zl(a,S,p),ve=L(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${e.maximized===!0?"maximized":"minimized"} q-dialog__inner--${e.position} ${rg[e.position]}`+(s.value===!0?" q-dialog__inner--animating":"")+(e.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(e.fullHeight===!0?" q-dialog__inner--fullheight":"")+(e.square===!0?" q-dialog__inner--square":"")),ie=L(()=>a.value===!0&&e.seamless!==!0),se=L(()=>e.autoClose===!0?{onClick:Me}:{}),Re=L(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${ie.value===!0?"modal":"seamless"}`,n.class]);qe(()=>e.maximized,_=>{a.value===!0&&de(_)}),qe(ie,_=>{d(_),_===!0?(kl(g),wl(B)):(vi(g),Zr(B))});function me(_){G(),u=e.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,de(e.maximized),T(),s.value=!0,e.noFocus!==!0?(document.activeElement!==null&&document.activeElement.blur(),k(A)):w(),v(()=>{if(i.proxy.$q.platform.is.ios===!0){if(e.seamless!==!0&&document.activeElement){const{top:N,bottom:I}=document.activeElement.getBoundingClientRect(),{innerHeight:x}=window,R=window.visualViewport!==void 0?window.visualViewport.height:x;N>0&&I>R/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-R,I>=x?1/0:Math.ceil(document.scrollingElement.scrollTop+I-R/2))),document.activeElement.scrollIntoView()}f=!0,o.value.click(),f=!1}T(!0),s.value=!1,r("show",_)},e.transitionDuration)}function we(_){w(),D(),ne(!0),s.value=!0,m(),u!==null&&(((_&&_.type.indexOf("key")===0?u.closest('[tabindex]:not([tabindex^="-"])'):void 0)||u).focus(),u=null),v(()=>{m(!0),s.value=!1,r("hide",_)},e.transitionDuration)}function A(_){$a(()=>{let N=o.value;N===null||N.contains(document.activeElement)===!0||(N=(_!==""?N.querySelector(_):null)||N.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||N.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||N.querySelector("[autofocus], [data-autofocus]")||N,N.focus({preventScroll:!0}))})}function F(_){_&&typeof _.focus=="function"?_.focus({preventScroll:!0}):A(),r("shake");const N=o.value;N!==null&&(N.classList.remove("q-animate--scale"),N.classList.add("q-animate--scale"),l!==null&&clearTimeout(l),l=setTimeout(()=>{l=null,o.value!==null&&(N.classList.remove("q-animate--scale"),A())},170))}function B(){e.seamless!==!0&&(e.persistent===!0||e.noEscDismiss===!0?e.maximized!==!0&&e.noShake!==!0&&F():(r("escapeKey"),S()))}function ne(_){l!==null&&(clearTimeout(l),l=null),(_===!0||a.value===!0)&&(de(!1),e.seamless!==!0&&(d(!1),vi(g),Zr(B))),_!==!0&&(u=null)}function de(_){_===!0?c!==!0&&(Ar<1&&document.body.classList.add("q-body--dialog"),Ar++,c=!0):c===!0&&(Ar<2&&document.body.classList.remove("q-body--dialog"),Ar--,c=!1)}function Me(_){f!==!0&&(S(_),r("click",_))}function h(_){e.persistent!==!0&&e.noBackdropDismiss!==!0?S(_):e.noShake!==!0&&F()}function g(_){e.allowFocusOutside!==!0&&O.value===!0&&Oa(o.value,_.target)!==!0&&A('[tabindex]:not([tabindex="-1"])')}Object.assign(i.proxy,{focus:A,shake:F,__updateRefocusTarget(_){u=_||null}}),pt(ne);function b(){return re("div",{role:"dialog","aria-modal":ie.value===!0?"true":"false",...n,class:Re.value},[re(Yt,{name:"q-transition--fade",appear:!0},()=>ie.value===!0?re("div",{class:"q-dialog__backdrop fixed-full",style:C.value,"aria-hidden":"true",tabindex:-1,onClick:h}):null),re(Yt,P.value,()=>a.value===!0?re("div",{ref:o,class:ve.value,style:C.value,tabindex:-1,...se.value},wi(t.default)):null)])}return q}});function _a(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}var ig=Kl({name:"close-popup",beforeMount(e,{value:t}){const r={depth:_a(t),handler(n){r.depth!==0&&setTimeout(()=>{const i=vv(e);i!==void 0&&gv(i,n,r.depth)})},handlerKey(n){yi(n,13)===!0&&r.handler(n)}};e.__qclosepopup=r,e.addEventListener("click",r.handler),e.addEventListener("keyup",r.handlerKey)},updated(e,{value:t,oldValue:r}){t!==r&&(e.__qclosepopup.depth=_a(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}});const og={key:0},ag={key:1},sg={key:2},lg={key:0,class:"text-subtitle1 text-center"},ug=Ue({__name:"game-over-dialog",props:{node:{}},setup(e){return(t,r)=>(M(),ce(ng,{"model-value":!0,persistent:"",position:"bottom"},{default:X(()=>[V(qa,{class:"my-card game-over-dialog"},{default:X(()=>[V(nt,{class:"bg-primary text-h5 row justify-between"},{default:X(()=>[t.node.outcome==="white"?(M(),Z("span",og,"White wins!")):pe("",!0),t.node.outcome==="black"?(M(),Z("span",ag,"Black wins!")):pe("",!0),t.node.outcome==="draw"?(M(),Z("span",sg,"Draw!")):pe("",!0),Jt(V(Ji,{icon:"close",flat:"",round:"",dense:""},null,512),[[ig]])]),_:1}),V(nt,{class:"row justify-center"},{default:X(()=>[t.node.outcome==="white"?(M(),ce(jt,{key:0,allegiance:le($e).White,piece:"K",size:96},null,8,["allegiance"])):pe("",!0),t.node.outcome==="black"?(M(),ce(jt,{key:1,allegiance:le($e).Black,piece:"K",size:96},null,8,["allegiance"])):pe("",!0),t.node.outcome==="draw"?(M(),ce(st,{key:2,name:"balance",size:"96px",color:"grey"})):pe("",!0)]),_:1}),V(nt,{class:"q-pt-none"},{default:X(()=>[t.node.reason?(M(),Z("div",lg,kt(t.node.reason),1)):pe("",!0)]),_:1}),V(Or),V(tg,{align:"right"},{default:X(()=>[V(Ji,{color:"secondary","text-color":"primary",label:"New game",to:"/play"})]),_:1})]),_:1})]),_:1}))}});var Tg=ht(ug,[["__scopeId","data-v-fc28b0e2"]]);const jg=()=>{const e=rn();return L(()=>{let t=e.screen.width;return e.screen.gt.xs&&(t=e.screen.width-65),e.screen.gt.sm&&(t=e.screen.sizes.sm),e.screen.gt.md&&(t=e.screen.sizes.md-265),e.screen.gt.lg&&(t=e.screen.sizes.lg-265),Math.min(t,e.screen.height)})};function cg(){return new Worker("/assets/bot-worker.75d9774a.js",{type:"module"})}var fg="/assets/navigation_backward-selection-minimal.5c6fba09.ogg",dg="/assets/navigation_hover-tap.713baf32.ogg",hg="/assets/navigation-cancel.92012997.ogg",pg="/assets/ui_refresh-feed.44b5b5d7.ogg",vg="/assets/ui_tap-variant-01.21f59a16.ogg";const gg=()=>{if(typeof window=="undefined")return null;const e=new Audio(fg),t=new Audio(dg),r=new Audio(hg),n=new Audio(pg),i=new Audio(vg);return{playNode:a=>{if(a.kind==="game-over")return e.play();if(a.kind==="move")switch(a.type){default:return i.play();case"capture":case"en-passant":return r.play();case"allegiance":return t.play();case"castle":case"promotion":return n.play()}}}},Cg=e=>{const t=U(),r=U(!1),n=U(""),i=U(""),o=U("white"),a=U(0),s=U([]),l=U([]),u=U(null),c=U({kind:"root",children:[]}),f=U([]),p=gg(),d=L(()=>{if(s.value.length!==1)return null;const T=s.value.at(0);return!T||T.kind!=="game-over"?null:T}),v=T=>{var O;const m=T.data;switch(m.type){case"board-update":i.value=m.moveHistory,n.value=m.afen,o.value=m.activeColour,a.value=m.boardScore,s.value=m.validMoves,l.value=m.checkMoves,u.value=m.enPassantTarget,c.value=m.moveHistoryAst,f.value=m.squares;break;case"node-execution":p==null||p.playNode(m.node);break;case"ready":r.value=!0;break}m.type==="board-update"&&e.autoplayFor.includes(m.activeColour)&&!d.value&&((O=t.value)==null||O.postMessage({type:"bot-move"}))};return mi(()=>{t.value=new cg,t.value.addEventListener("message",v)}),pt(()=>{var m,O;(m=t.value)==null||m.removeEventListener("message",v);const T={type:"reset"};(O=t.value)==null||O.postMessage(T)}),{ready:r,afen:n,moveHistory:i,moveHistoryAst:c,activeColour:o,boardScore:a,validMoves:s,checkMoves:l,enPassantTarget:u,squares:f,gameOver:d,executeMoveIndex:T=>{var O;const m={type:"execute-move-index",index:T};(O=t.value)==null||O.postMessage(m)},importAfen:T=>{var O;const m={type:"import-afen",afen:T};(O=t.value)==null||O.postMessage(m)},importMoveHistory:T=>{var O;const m={type:"import-move-history",history:T};(O=t.value)==null||O.postMessage(m)},reset:()=>{var m;const T={type:"reset"};(m=t.value)==null||m.postMessage(T)}}};export{Pg as G,Og as _,Cg as a,Tg as b,jg as u};
//# sourceMappingURL=board-worker.b8c1d317.js.map
