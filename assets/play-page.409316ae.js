import{u as R,a as A}from"./use-dark.2e69cd78.js";import{c as E,aj as F,ak as L,a as o,h as C,L as I,j as O,al as z,r as _,B as T,o as H,d as S,M as Q,am as j,an as J,w,Y as U,$ as x,N as M,O as N}from"./index.a9edeccc.js";import{H as D}from"./hex.7790ba8b.js";import{u as V}from"./use-quasar.7f94eb4f.js";import{F as W}from"./boards.07b20eb6.js";const X={xs:2,sm:4,md:6,lg:10,xl:14};function P(t,s,a){return{transform:s===!0?`translateX(${a.lang.rtl===!0?"-":""}100%) scale3d(${-t},1,1)`:`scale3d(${t},1,1)`}}var Y=E({name:"QLinearProgress",props:{...R,...F,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(t,{slots:s}){const{proxy:a}=O(),d=A(t,a.$q),r=L(t,X),n=o(()=>t.indeterminate===!0||t.query===!0),c=o(()=>t.reverse!==t.query),i=o(()=>({...r.value!==null?r.value:{},"--q-linear-progress-speed":`${t.animationSpeed}ms`})),v=o(()=>"q-linear-progress"+(t.color!==void 0?` text-${t.color}`:"")+(t.reverse===!0||t.query===!0?" q-linear-progress--reverse":"")+(t.rounded===!0?" rounded-borders":"")),p=o(()=>P(t.buffer!==void 0?t.buffer:1,c.value,a.$q)),m=o(()=>`with${t.instantFeedback===!0?"out":""}-transition`),h=o(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${m.value} q-linear-progress__track--${d.value===!0?"dark":"light"}`+(t.trackColor!==void 0?` bg-${t.trackColor}`:"")),e=o(()=>P(n.value===!0?1:t.value,c.value,a.$q)),l=o(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${m.value} q-linear-progress__model--${n.value===!0?"in":""}determinate`),f=o(()=>({width:`${t.value*100}%`})),k=o(()=>`q-linear-progress__stripe absolute-${t.reverse===!0?"right":"left"} q-linear-progress__stripe--${m.value}`);return()=>{const g=[C("div",{class:h.value,style:p.value}),C("div",{class:l.value,style:e.value})];return t.stripe===!0&&n.value===!1&&g.push(C("div",{class:k.value,style:f.value})),C("div",{class:v.value,style:i.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":t.indeterminate===!0?void 0:t.value},I(s.default,g))}}});const G=()=>{const t=V();return{notify:a=>{t.notify({timeout:4e3,position:"bottom-right",...a})}}},K=async()=>{if(typeof window=="undefined")return null;const{Peer:t}=await z(()=>import("./bundler.2201616e.js"),["assets/bundler.2201616e.js","assets/index.a9edeccc.js","assets/index.d684e578.css"]),s=_(null),{notify:a}=G(),d=_(null),r=_([]),n=_(),c=_("initial"),i=e=>{r.value=[...r.value,e]},v=e=>{const l=u=>{if(u instanceof ArrayBuffer){i({type:"data",value:S.Buffer.from(u)});return}if(!S.Buffer.isBuffer(u)){console.warn("Non-buffer data received through WebRTC!",u);return}i({type:"data",value:u})},f=u=>{i({type:"state",value:u})},k=()=>{i({type:"open",value:void 0})},g=u=>{var y;i({type:"error",value:u}),(y=n.value)==null||y.close(),a({message:"Connection error",caption:u.message,icon:"link_off",iconColor:"red"})},b=()=>{var u,y,q,$,B;(u=n.value)==null||u.on("data",l),(y=n.value)==null||y.on("error",g),(q=n.value)==null||q.on("close",b),($=n.value)==null||$.on("iceStateChanged",f),(B=n.value)==null||B.on("open",k),c.value="initial",n.value=null,r.value=[],a({message:"Connection closed",icon:"link_off"})};e.on("data",l),e.on("error",g),e.on("close",b),e.on("iceStateChanged",f),e.on("open",k)};return T(()=>{s.value=new t,s.value.on("open",e=>{d.value=D.utf8ToHex(e),a({message:"Connection ready",icon:"check",iconColor:"green"})}),s.value.on("connection",e=>{if(n.value){a({message:"Refused secondary connection",icon:"link_off",iconColor:"red"}),e.close();return}c.value="server",v(e),n.value=e,a({message:"Connected to guest",icon:"link"})})}),H(()=>{var e,l;(e=s.value)==null||e.destroy(),(l=n.value)==null||l.close()}),{connect:e=>{if(n.value||!s.value||!e)return;const l=D.hexToUtf8(e),f=s.value.connect(l);c.value="client",v(f),n.value=f,a({message:"Connected to host",icon:"link"})},mode:c,peerId:d,messages:r,sendData:e=>n.value?(n.value.send(e),i({type:"data",value:e}),!0):!1,disconnect:()=>n.value?(n.value.close(),n.value=null,!0):!1}},Z=async()=>{const t=await K();if(!t)return null;const{connect:s,mode:a,peerId:d,sendData:r,messages:n,disconnect:c}=t,i=e=>{r(S.Buffer.from(JSON.stringify(e),"utf8"))},v=o(()=>n.value.filter(e=>e.type==="data").map(e=>S.Buffer.isBuffer(e.value)?JSON.parse(e.value.toString("utf8")):null)),p=o(()=>{const e=v.value.findLast(l=>l.type==="afen-update");return e&&e.value||""}),m=o(()=>n.value.some(e=>e.type==="open")),h=o(()=>{const e=v.value.find(l=>l.type==="side-assignment");return e?e.value:null});return{connect:s,mode:a,peerId:d,boardAFEN:p,sendMessage:i,open:m,disconnect:c,serverSide:h}},se=Q({__name:"play-page",async setup(t){let s,a;const d=j(),r=([s,a]=J(()=>Z()),s=await s,a(),s);return r&&(w(r.mode,n=>{n==="initial"&&d.push("/play")}),w(r.open,n=>{!n||(d.push(`/play/online/${r.peerId.value}`),r.mode.value==="server"&&(r.sendMessage({type:"side-assignment",value:Math.random()>.5?"white":"black"}),r.sendMessage({type:"afen-update",value:W.VanillaDefault})))})),(n,c)=>{const i=U("router-view");return x(r)?(M(),N(i,{key:0,connection:x(r)},null,8,["connection"])):(M(),N(Y,{key:1}))}}});export{se as default};
