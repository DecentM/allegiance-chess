{"version":3,"file":"game-sidebar.04882da5.js","sources":["../../../../../../../node_modules/quasar/src/composables/private/use-anchor.js","../../../../../../../node_modules/quasar/src/composables/private/use-scroll-target.js","../../../../../../../node_modules/quasar/src/utils/private/portal.js","../../../../../../../node_modules/quasar/src/composables/private/use-portal.js","../../../../../../../node_modules/quasar/src/composables/private/use-transition.js","../../../../../../../node_modules/quasar/src/composables/private/use-tick.js","../../../../../../../node_modules/quasar/src/utils/private/escape-key.js","../../../../../../../node_modules/quasar/src/utils/private/focusout.js","../../../../../../../node_modules/quasar/src/utils/private/click-outside.js","../../../../../../../node_modules/quasar/src/utils/private/position-engine.js","../../../../../../../node_modules/quasar/src/components/menu/QMenu.js","../../../../../src/components/promotion-selector.vue","../../../../../src/components/capture-selector.vue","../../../../../src/components/board/layers/interaction-layer.vue","../../../../../src/components/board/layers/indicators-layer.vue","../../../../../src/components/board/layers/pieces-layer.vue","../../../../../src/components/chess-board.vue","../../../../../../../node_modules/quasar/src/components/chip/QChip.js","../../../../../../../node_modules/quasar/src/components/scroll-area/QScrollArea.js","../../../../../src/components/game-sidebar.vue"],"sourcesContent":["import { ref, watch, onMounted, onBeforeUnmount, nextTick, getCurrentInstance } from 'vue'\n\nimport { clearSelection } from '../../utils/private/selection.js'\nimport { addEvt, cleanEvt, prevent } from '../../utils/event.js'\nimport { isKeyCode } from '../../utils/private/key-composition.js'\n\nexport const useAnchorProps = {\n  target: {\n    default: true\n  },\n  noParentEvent: Boolean,\n  contextMenu: Boolean\n}\n\nexport default function ({\n  showing,\n  avoidEmit, // required for QPopupProxy (true)\n  configureAnchorEl // optional\n}) {\n  const { props, proxy, emit } = getCurrentInstance()\n\n  const anchorEl = ref(null)\n\n  let touchTimer = null\n\n  function canShow (evt) {\n    // abort with no parent configured or on multi-touch\n    return anchorEl.value === null\n      ? false\n      : (evt === void 0 || evt.touches === void 0 || evt.touches.length <= 1)\n  }\n\n  const anchorEvents = {}\n\n  if (configureAnchorEl === void 0) {\n    // default configureAnchorEl is designed for\n    // QMenu & QPopupProxy (which is why it's handled here)\n\n    Object.assign(anchorEvents, {\n      hide (evt) {\n        proxy.hide(evt)\n      },\n\n      toggle (evt) {\n        proxy.toggle(evt)\n        evt.qAnchorHandled = true\n      },\n\n      toggleKey (evt) {\n        isKeyCode(evt, 13) === true && anchorEvents.toggle(evt)\n      },\n\n      contextClick (evt) {\n        proxy.hide(evt)\n        prevent(evt)\n        nextTick(() => {\n          proxy.show(evt)\n          evt.qAnchorHandled = true\n        })\n      },\n\n      prevent,\n\n      mobileTouch (evt) {\n        anchorEvents.mobileCleanup(evt)\n\n        if (canShow(evt) !== true) {\n          return\n        }\n\n        proxy.hide(evt)\n        anchorEl.value.classList.add('non-selectable')\n\n        const target = evt.target\n        addEvt(anchorEvents, 'anchor', [\n          [ target, 'touchmove', 'mobileCleanup', 'passive' ],\n          [ target, 'touchend', 'mobileCleanup', 'passive' ],\n          [ target, 'touchcancel', 'mobileCleanup', 'passive' ],\n          [ anchorEl.value, 'contextmenu', 'prevent', 'notPassive' ]\n        ])\n\n        touchTimer = setTimeout(() => {\n          touchTimer = null\n          proxy.show(evt)\n          evt.qAnchorHandled = true\n        }, 300)\n      },\n\n      mobileCleanup (evt) {\n        anchorEl.value.classList.remove('non-selectable')\n\n        if (touchTimer !== null) {\n          clearTimeout(touchTimer)\n          touchTimer = null\n        }\n\n        if (showing.value === true && evt !== void 0) {\n          clearSelection()\n        }\n      }\n    })\n\n    configureAnchorEl = function (context = props.contextMenu) {\n      if (props.noParentEvent === true || anchorEl.value === null) { return }\n\n      let evts\n\n      if (context === true) {\n        if (proxy.$q.platform.is.mobile === true) {\n          evts = [\n            [ anchorEl.value, 'touchstart', 'mobileTouch', 'passive' ]\n          ]\n        }\n        else {\n          evts = [\n            [ anchorEl.value, 'mousedown', 'hide', 'passive' ],\n            [ anchorEl.value, 'contextmenu', 'contextClick', 'notPassive' ]\n          ]\n        }\n      }\n      else {\n        evts = [\n          [ anchorEl.value, 'click', 'toggle', 'passive' ],\n          [ anchorEl.value, 'keyup', 'toggleKey', 'passive' ]\n        ]\n      }\n\n      addEvt(anchorEvents, 'anchor', evts)\n    }\n  }\n\n  function unconfigureAnchorEl () {\n    cleanEvt(anchorEvents, 'anchor')\n  }\n\n  function setAnchorEl (el) {\n    anchorEl.value = el\n    while (anchorEl.value.classList.contains('q-anchor--skip')) {\n      anchorEl.value = anchorEl.value.parentNode\n    }\n    configureAnchorEl()\n  }\n\n  function pickAnchorEl () {\n    if (props.target === false || props.target === '' || proxy.$el.parentNode === null) {\n      anchorEl.value = null\n    }\n    else if (props.target === true) {\n      setAnchorEl(proxy.$el.parentNode)\n    }\n    else {\n      let el = props.target\n\n      if (typeof props.target === 'string') {\n        try {\n          el = document.querySelector(props.target)\n        }\n        catch (err) {\n          el = void 0\n        }\n      }\n\n      if (el !== void 0 && el !== null) {\n        anchorEl.value = el.$el || el\n        configureAnchorEl()\n      }\n      else {\n        anchorEl.value = null\n        console.error(`Anchor: target \"${ props.target }\" not found`)\n      }\n    }\n  }\n\n  watch(() => props.contextMenu, val => {\n    if (anchorEl.value !== null) {\n      unconfigureAnchorEl()\n      configureAnchorEl(val)\n    }\n  })\n\n  watch(() => props.target, () => {\n    if (anchorEl.value !== null) {\n      unconfigureAnchorEl()\n    }\n\n    pickAnchorEl()\n  })\n\n  watch(() => props.noParentEvent, val => {\n    if (anchorEl.value !== null) {\n      if (val === true) {\n        unconfigureAnchorEl()\n      }\n      else {\n        configureAnchorEl()\n      }\n    }\n  })\n\n  onMounted(() => {\n    pickAnchorEl()\n\n    if (avoidEmit !== true && props.modelValue === true && anchorEl.value === null) {\n      emit('update:modelValue', false)\n    }\n  })\n\n  onBeforeUnmount(() => {\n    touchTimer !== null && clearTimeout(touchTimer)\n    unconfigureAnchorEl()\n  })\n\n  return {\n    anchorEl,\n    canShow,\n    anchorEvents\n  }\n}\n","import { ref, watch, onBeforeUnmount } from 'vue'\n\nimport { listenOpts } from '../../utils/event.js'\n\nexport default function (\n  props,\n  configureScrollTarget\n) {\n  const localScrollTarget = ref(null)\n  let scrollFn\n\n  function changeScrollEvent (scrollTarget, fn) {\n    const fnProp = `${ fn !== void 0 ? 'add' : 'remove' }EventListener`\n    const fnHandler = fn !== void 0 ? fn : scrollFn\n\n    if (scrollTarget !== window) {\n      scrollTarget[ fnProp ]('scroll', fnHandler, listenOpts.passive)\n    }\n\n    window[ fnProp ]('scroll', fnHandler, listenOpts.passive)\n\n    scrollFn = fn\n  }\n\n  function unconfigureScrollTarget () {\n    if (localScrollTarget.value !== null) {\n      changeScrollEvent(localScrollTarget.value)\n      localScrollTarget.value = null\n    }\n  }\n\n  const noParentEventWatcher = watch(() => props.noParentEvent, () => {\n    if (localScrollTarget.value !== null) {\n      unconfigureScrollTarget()\n      configureScrollTarget()\n    }\n  })\n\n  onBeforeUnmount(noParentEventWatcher)\n\n  return {\n    localScrollTarget,\n    unconfigureScrollTarget,\n    changeScrollEvent\n  }\n}\n","import { getParentProxy } from './vm.js'\n\nexport const portalProxyList = []\n\nexport function getPortalProxy (el) {\n  return portalProxyList.find(proxy =>\n    proxy.contentEl !== null\n    && proxy.contentEl.contains(el)\n  )\n}\n\nexport function closePortalMenus (proxy, evt) {\n  do {\n    if (proxy.$options.name === 'QMenu') {\n      proxy.hide(evt)\n\n      // is this a point of separation?\n      if (proxy.$props.separateClosePopup === true) {\n        return getParentProxy(proxy)\n      }\n    }\n    else if (proxy.__qPortal === true) {\n      // treat it as point of separation if parent is QPopupProxy\n      // (so mobile matches desktop behavior)\n      // and hide it too\n      const parent = getParentProxy(proxy)\n\n      if (parent !== void 0 && parent.$options.name === 'QPopupProxy') {\n        proxy.hide(evt)\n        return parent\n      }\n      else {\n        return proxy\n      }\n    }\n\n    proxy = getParentProxy(proxy)\n  } while (proxy !== void 0 && proxy !== null)\n}\n\nexport function closePortals (proxy, evt, depth) {\n  while (depth !== 0 && proxy !== void 0 && proxy !== null) {\n    if (proxy.__qPortal === true) {\n      depth--\n\n      if (proxy.$options.name === 'QMenu') {\n        proxy = closePortalMenus(proxy, evt)\n        continue\n      }\n\n      proxy.hide(evt)\n    }\n\n    proxy = getParentProxy(proxy)\n  }\n}\n","import { h, ref, onUnmounted, Teleport } from 'vue'\n\nimport { noop } from '../../utils/event.js'\nimport { addFocusWaitFlag, removeFocusWaitFlag } from '../../utils/private/focus-manager.js'\nimport { createGlobalNode, removeGlobalNode } from '../../utils/private/global-nodes.js'\nimport { portalProxyList } from '../../utils/private/portal.js'\nimport { injectProp } from '../../utils/private/inject-obj-prop.js'\n\nfunction isOnGlobalDialog (vm) {\n  vm = vm.parent\n\n  while (vm !== void 0 && vm !== null) {\n    if (vm.type.name === 'QGlobalDialog') {\n      return true\n    }\n    if (vm.type.name === 'QDialog' || vm.type.name === 'QMenu') {\n      return false\n    }\n\n    vm = vm.parent\n  }\n\n  return false\n}\n\n// Warning!\n// You MUST specify \"inheritAttrs: false\" in your component\n\nexport default function (vm, innerRef, renderPortalContent, type) {\n  // showing, including while in show/hide transition\n  const portalIsActive = ref(false)\n\n  // showing & not in any show/hide transition\n  const portalIsAccessible = ref(false)\n\n  if (__QUASAR_SSR_SERVER__) {\n    return {\n      portalIsActive,\n      portalIsAccessible,\n\n      showPortal: noop,\n      hidePortal: noop,\n      renderPortal: noop\n    }\n  }\n\n  let portalEl = null\n  const focusObj = {}\n  const onGlobalDialog = type === 'dialog' && isOnGlobalDialog(vm)\n\n  function showPortal (isReady) {\n    if (isReady === true) {\n      removeFocusWaitFlag(focusObj)\n      portalIsAccessible.value = true\n      return\n    }\n\n    portalIsAccessible.value = false\n\n    if (portalIsActive.value === false) {\n      if (onGlobalDialog === false && portalEl === null) {\n        portalEl = createGlobalNode(false, type)\n      }\n\n      portalIsActive.value = true\n\n      // register portal\n      portalProxyList.push(vm.proxy)\n\n      addFocusWaitFlag(focusObj)\n    }\n  }\n\n  function hidePortal (isReady) {\n    portalIsAccessible.value = false\n\n    if (isReady !== true) { return }\n\n    removeFocusWaitFlag(focusObj)\n    portalIsActive.value = false\n\n    // unregister portal\n    const index = portalProxyList.indexOf(vm.proxy)\n    if (index !== -1) {\n      portalProxyList.splice(index, 1)\n    }\n\n    if (portalEl !== null) {\n      removeGlobalNode(portalEl)\n      portalEl = null\n    }\n  }\n\n  onUnmounted(() => { hidePortal(true) })\n\n  // needed for portal vm detection\n  vm.proxy.__qPortal = true\n\n  // public way of accessing the rendered content\n  injectProp(vm.proxy, 'contentEl', () => innerRef.value)\n\n  return {\n    showPortal,\n    hidePortal,\n\n    portalIsActive,\n    portalIsAccessible,\n\n    renderPortal: () => (\n      onGlobalDialog === true\n        ? renderPortalContent()\n        : (\n            portalIsActive.value === true\n              ? [ h(Teleport, { to: portalEl }, renderPortalContent()) ]\n              : void 0\n          )\n    )\n  }\n}\n","import { computed } from 'vue'\n\nexport const useTransitionProps = {\n  transitionShow: {\n    type: String,\n    default: 'fade'\n  },\n\n  transitionHide: {\n    type: String,\n    default: 'fade'\n  },\n\n  transitionDuration: {\n    type: [ String, Number ],\n    default: 300\n  }\n}\n\nexport default function (props, defaultShowFn = () => {}, defaultHideFn = () => {}) {\n  return {\n    transitionProps: computed(() => {\n      const show = `q-transition--${ props.transitionShow || defaultShowFn() }`\n      const hide = `q-transition--${ props.transitionHide || defaultHideFn() }`\n\n      return {\n        appear: true,\n\n        enterFromClass: `${ show }-enter-from`,\n        enterActiveClass: `${ show }-enter-active`,\n        enterToClass: `${ show }-enter-to`,\n\n        leaveFromClass: `${ hide }-leave-from`,\n        leaveActiveClass: `${ hide }-leave-active`,\n        leaveToClass: `${ hide }-leave-to`\n      }\n    }),\n\n    transitionStyle: computed(() => `--q-transition-duration: ${ props.transitionDuration }ms`)\n  }\n}\n","import { nextTick, onDeactivated, onBeforeUnmount, getCurrentInstance } from 'vue'\n\nimport { vmIsDestroyed } from '../../utils/private/vm'\n\n/*\n * Usage:\n *    registerTick(fn)\n *    removeTick()\n */\n\nexport default function () {\n  let tickFn\n  const vm = getCurrentInstance()\n\n  function removeTick () {\n    tickFn = void 0\n  }\n\n  onDeactivated(removeTick)\n  onBeforeUnmount(removeTick)\n\n  return {\n    removeTick,\n\n    registerTick (fn) {\n      tickFn = fn\n\n      nextTick(() => {\n        if (tickFn === fn) {\n          // we also check if VM is destroyed, since if it\n          // got to trigger one nextTick() we cannot stop it\n          vmIsDestroyed(vm) === false && tickFn()\n          tickFn = void 0\n        }\n      })\n    }\n  }\n}\n","import { client } from '../../plugins/Platform.js'\nimport { isKeyCode } from './key-composition.js'\n\nconst handlers = []\nlet escDown\n\nfunction onKeydown (evt) {\n  escDown = evt.keyCode === 27\n}\n\nfunction onBlur () {\n  if (escDown === true) {\n    escDown = false\n  }\n}\n\nfunction onKeyup (evt) {\n  if (escDown === true) {\n    escDown = false\n\n    if (isKeyCode(evt, 27) === true) {\n      handlers[ handlers.length - 1 ](evt)\n    }\n  }\n}\n\nfunction update (action) {\n  window[ action ]('keydown', onKeydown)\n  window[ action ]('blur', onBlur)\n  window[ action ]('keyup', onKeyup)\n  escDown = false\n}\n\nexport function addEscapeKey (fn) {\n  if (client.is.desktop === true) {\n    handlers.push(fn)\n\n    if (handlers.length === 1) {\n      update('addEventListener')\n    }\n  }\n}\n\nexport function removeEscapeKey (fn) {\n  const index = handlers.indexOf(fn)\n  if (index > -1) {\n    handlers.splice(index, 1)\n\n    if (handlers.length === 0) {\n      update('removeEventListener')\n    }\n  }\n}\n","import { client } from '../../plugins/Platform.js'\n\nconst handlers = []\n\nfunction trigger (e) {\n  handlers[ handlers.length - 1 ](e)\n}\n\nexport function addFocusout (fn) {\n  if (client.is.desktop === true) {\n    handlers.push(fn)\n\n    if (handlers.length === 1) {\n      document.body.addEventListener('focusin', trigger)\n    }\n  }\n}\n\nexport function removeFocusout (fn) {\n  const index = handlers.indexOf(fn)\n  if (index > -1) {\n    handlers.splice(index, 1)\n\n    if (handlers.length === 0) {\n      document.body.removeEventListener('focusin', trigger)\n    }\n  }\n}\n","import { listenOpts } from '../event.js'\nimport { portalProxyList } from '../private/portal.js'\n\nlet timer = null\n\nconst\n  { notPassiveCapture } = listenOpts,\n  registeredList = []\n\nfunction globalHandler (evt) {\n  if (timer !== null) {\n    clearTimeout(timer)\n    timer = null\n  }\n\n  const target = evt.target\n\n  if (\n    target === void 0\n    || target.nodeType === 8\n    || target.classList.contains('no-pointer-events') === true\n  ) {\n    return\n  }\n\n  // check last portal vm if it's\n  // a QDialog and not in seamless mode\n  let portalIndex = portalProxyList.length - 1\n\n  while (portalIndex >= 0) {\n    const proxy = portalProxyList[ portalIndex ].$\n\n    // skip QTooltip portals\n    if (proxy.type.name === 'QTooltip') {\n      portalIndex--\n      continue\n    }\n\n    if (proxy.type.name !== 'QDialog') {\n      break\n    }\n\n    if (proxy.props.seamless !== true) {\n      return\n    }\n\n    portalIndex--\n  }\n\n  for (let i = registeredList.length - 1; i >= 0; i--) {\n    const state = registeredList[ i ]\n\n    if (\n      (\n        state.anchorEl.value === null\n        || state.anchorEl.value.contains(target) === false\n      )\n      && (\n        target === document.body\n        || (\n          state.innerRef.value !== null\n          && state.innerRef.value.contains(target) === false\n        )\n      )\n    ) {\n      // mark the event as being processed by clickOutside\n      // used to prevent refocus after menu close\n      evt.qClickOutside = true\n      state.onClickOutside(evt)\n    }\n    else {\n      return\n    }\n  }\n}\n\nexport function addClickOutside (clickOutsideProps) {\n  registeredList.push(clickOutsideProps)\n\n  if (registeredList.length === 1) {\n    document.addEventListener('mousedown', globalHandler, notPassiveCapture)\n    document.addEventListener('touchstart', globalHandler, notPassiveCapture)\n  }\n}\n\nexport function removeClickOutside (clickOutsideProps) {\n  const index = registeredList.findIndex(h => h === clickOutsideProps)\n\n  if (index > -1) {\n    registeredList.splice(index, 1)\n\n    if (registeredList.length === 0) {\n      if (timer !== null) {\n        clearTimeout(timer)\n        timer = null\n      }\n\n      document.removeEventListener('mousedown', globalHandler, notPassiveCapture)\n      document.removeEventListener('touchstart', globalHandler, notPassiveCapture)\n    }\n  }\n}\n","import { getScrollbarWidth } from '../scroll.js'\nimport { client } from '../../plugins/Platform.js'\n\nlet vpLeft, vpTop\n\nexport function validatePosition (pos) {\n  const parts = pos.split(' ')\n  if (parts.length !== 2) {\n    return false\n  }\n  if ([ 'top', 'center', 'bottom' ].includes(parts[ 0 ]) !== true) {\n    console.error('Anchor/Self position must start with one of top/center/bottom')\n    return false\n  }\n  if ([ 'left', 'middle', 'right', 'start', 'end' ].includes(parts[ 1 ]) !== true) {\n    console.error('Anchor/Self position must end with one of left/middle/right/start/end')\n    return false\n  }\n  return true\n}\n\nexport function validateOffset (val) {\n  if (!val) { return true }\n  if (val.length !== 2) { return false }\n  if (typeof val[ 0 ] !== 'number' || typeof val[ 1 ] !== 'number') {\n    return false\n  }\n  return true\n}\n\nconst horizontalPos = {\n  'start#ltr': 'left',\n  'start#rtl': 'right',\n  'end#ltr': 'right',\n  'end#rtl': 'left'\n}\n\n;[ 'left', 'middle', 'right' ].forEach(pos => {\n  horizontalPos[ `${ pos }#ltr` ] = pos\n  horizontalPos[ `${ pos }#rtl` ] = pos\n})\n\nexport function parsePosition (pos, rtl) {\n  const parts = pos.split(' ')\n  return {\n    vertical: parts[ 0 ],\n    horizontal: horizontalPos[ `${ parts[ 1 ] }#${ rtl === true ? 'rtl' : 'ltr' }` ]\n  }\n}\n\nexport function getAnchorProps (el, offset) {\n  let { top, left, right, bottom, width, height } = el.getBoundingClientRect()\n\n  if (offset !== void 0) {\n    top -= offset[ 1 ]\n    left -= offset[ 0 ]\n    bottom += offset[ 1 ]\n    right += offset[ 0 ]\n\n    width += offset[ 0 ]\n    height += offset[ 1 ]\n  }\n\n  return {\n    top, bottom, height,\n    left, right, width,\n    middle: left + (right - left) / 2,\n    center: top + (bottom - top) / 2\n  }\n}\n\nfunction getAbsoluteAnchorProps (el, absoluteOffset, offset) {\n  let { top, left } = el.getBoundingClientRect()\n\n  top += absoluteOffset.top\n  left += absoluteOffset.left\n\n  if (offset !== void 0) {\n    top += offset[ 1 ]\n    left += offset[ 0 ]\n  }\n\n  return {\n    top, bottom: top + 1, height: 1,\n    left, right: left + 1, width: 1,\n    middle: left,\n    center: top\n  }\n}\n\nfunction getTargetProps (width, height) {\n  return {\n    top: 0,\n    center: height / 2,\n    bottom: height,\n    left: 0,\n    middle: width / 2,\n    right: width\n  }\n}\n\nfunction getTopLeftProps (anchorProps, targetProps, anchorOrigin, selfOrigin) {\n  return {\n    top: anchorProps[ anchorOrigin.vertical ] - targetProps[ selfOrigin.vertical ],\n    left: anchorProps[ anchorOrigin.horizontal ] - targetProps[ selfOrigin.horizontal ]\n  }\n}\n\nexport function setPosition (cfg, retryNumber = 0) {\n  if (\n    cfg.targetEl === null\n    || cfg.anchorEl === null\n    || retryNumber > 5 // we should try only a few times\n  ) {\n    return\n  }\n\n  // some browsers report zero height or width because\n  // we are trying too early to get these dimensions\n  if (cfg.targetEl.offsetHeight === 0 || cfg.targetEl.offsetWidth === 0) {\n    setTimeout(() => {\n      setPosition(cfg, retryNumber + 1)\n    }, 10)\n    return\n  }\n\n  const {\n    targetEl,\n    offset,\n    anchorEl,\n    anchorOrigin,\n    selfOrigin,\n    absoluteOffset,\n    fit,\n    cover,\n    maxHeight,\n    maxWidth\n  } = cfg\n\n  if (client.is.ios === true && window.visualViewport !== void 0) {\n    // uses the q-position-engine CSS class\n\n    const el = document.body.style\n    const { offsetLeft: left, offsetTop: top } = window.visualViewport\n\n    if (left !== vpLeft) {\n      el.setProperty('--q-pe-left', left + 'px')\n      vpLeft = left\n    }\n    if (top !== vpTop) {\n      el.setProperty('--q-pe-top', top + 'px')\n      vpTop = top\n    }\n  }\n\n  // scroll position might change\n  // if max-height/-width changes, so we\n  // need to restore it after we calculate\n  // the new positioning\n  const { scrollLeft, scrollTop } = targetEl\n\n  const anchorProps = absoluteOffset === void 0\n    ? getAnchorProps(anchorEl, cover === true ? [ 0, 0 ] : offset)\n    : getAbsoluteAnchorProps(anchorEl, absoluteOffset, offset)\n\n  // we \"reset\" the critical CSS properties\n  // so we can take an accurate measurement\n  Object.assign(targetEl.style, {\n    top: 0,\n    left: 0,\n    minWidth: null,\n    minHeight: null,\n    maxWidth: maxWidth || '100vw',\n    maxHeight: maxHeight || '100vh',\n    visibility: 'visible'\n  })\n\n  const { offsetWidth: origElWidth, offsetHeight: origElHeight } = targetEl\n  const { elWidth, elHeight } = fit === true || cover === true\n    ? { elWidth: Math.max(anchorProps.width, origElWidth), elHeight: cover === true ? Math.max(anchorProps.height, origElHeight) : origElHeight }\n    : { elWidth: origElWidth, elHeight: origElHeight }\n\n  let elStyle = { maxWidth, maxHeight }\n\n  if (fit === true || cover === true) {\n    elStyle.minWidth = anchorProps.width + 'px'\n    if (cover === true) {\n      elStyle.minHeight = anchorProps.height + 'px'\n    }\n  }\n\n  Object.assign(targetEl.style, elStyle)\n\n  const targetProps = getTargetProps(elWidth, elHeight)\n  let props = getTopLeftProps(anchorProps, targetProps, anchorOrigin, selfOrigin)\n\n  if (absoluteOffset === void 0 || offset === void 0) {\n    applyBoundaries(props, anchorProps, targetProps, anchorOrigin, selfOrigin)\n  }\n  else { // we have touch position or context menu with offset\n    const { top, left } = props // cache initial values\n\n    // apply initial boundaries\n    applyBoundaries(props, anchorProps, targetProps, anchorOrigin, selfOrigin)\n\n    let hasChanged = false\n\n    // did it flip vertically?\n    if (props.top !== top) {\n      hasChanged = true\n      const offsetY = 2 * offset[ 1 ]\n      anchorProps.center = anchorProps.top -= offsetY\n      anchorProps.bottom -= offsetY + 2\n    }\n\n    // did it flip horizontally?\n    if (props.left !== left) {\n      hasChanged = true\n      const offsetX = 2 * offset[ 0 ]\n      anchorProps.middle = anchorProps.left -= offsetX\n      anchorProps.right -= offsetX + 2\n    }\n\n    if (hasChanged === true) {\n      // re-calculate props with the new anchor\n      props = getTopLeftProps(anchorProps, targetProps, anchorOrigin, selfOrigin)\n\n      // and re-apply boundaries\n      applyBoundaries(props, anchorProps, targetProps, anchorOrigin, selfOrigin)\n    }\n  }\n\n  elStyle = {\n    top: props.top + 'px',\n    left: props.left + 'px'\n  }\n\n  if (props.maxHeight !== void 0) {\n    elStyle.maxHeight = props.maxHeight + 'px'\n\n    if (anchorProps.height > props.maxHeight) {\n      elStyle.minHeight = elStyle.maxHeight\n    }\n  }\n  if (props.maxWidth !== void 0) {\n    elStyle.maxWidth = props.maxWidth + 'px'\n\n    if (anchorProps.width > props.maxWidth) {\n      elStyle.minWidth = elStyle.maxWidth\n    }\n  }\n\n  Object.assign(targetEl.style, elStyle)\n\n  // restore scroll position\n  if (targetEl.scrollTop !== scrollTop) {\n    targetEl.scrollTop = scrollTop\n  }\n  if (targetEl.scrollLeft !== scrollLeft) {\n    targetEl.scrollLeft = scrollLeft\n  }\n}\n\nfunction applyBoundaries (props, anchorProps, targetProps, anchorOrigin, selfOrigin) {\n  const\n    currentHeight = targetProps.bottom,\n    currentWidth = targetProps.right,\n    margin = getScrollbarWidth(),\n    innerHeight = window.innerHeight - margin,\n    innerWidth = document.body.clientWidth\n\n  if (props.top < 0 || props.top + currentHeight > innerHeight) {\n    if (selfOrigin.vertical === 'center') {\n      props.top = anchorProps[ anchorOrigin.vertical ] > innerHeight / 2\n        ? Math.max(0, innerHeight - currentHeight)\n        : 0\n      props.maxHeight = Math.min(currentHeight, innerHeight)\n    }\n    else if (anchorProps[ anchorOrigin.vertical ] > innerHeight / 2) {\n      const anchorY = Math.min(\n        innerHeight,\n        anchorOrigin.vertical === 'center'\n          ? anchorProps.center\n          : (anchorOrigin.vertical === selfOrigin.vertical ? anchorProps.bottom : anchorProps.top)\n      )\n      props.maxHeight = Math.min(currentHeight, anchorY)\n      props.top = Math.max(0, anchorY - currentHeight)\n    }\n    else {\n      props.top = Math.max(0, anchorOrigin.vertical === 'center'\n        ? anchorProps.center\n        : (anchorOrigin.vertical === selfOrigin.vertical ? anchorProps.top : anchorProps.bottom)\n      )\n      props.maxHeight = Math.min(currentHeight, innerHeight - props.top)\n    }\n  }\n\n  if (props.left < 0 || props.left + currentWidth > innerWidth) {\n    props.maxWidth = Math.min(currentWidth, innerWidth)\n    if (selfOrigin.horizontal === 'middle') {\n      props.left = anchorProps[ anchorOrigin.horizontal ] > innerWidth / 2\n        ? Math.max(0, innerWidth - currentWidth)\n        : 0\n    }\n    else if (anchorProps[ anchorOrigin.horizontal ] > innerWidth / 2) {\n      const anchorX = Math.min(\n        innerWidth,\n        anchorOrigin.horizontal === 'middle'\n          ? anchorProps.middle\n          : (anchorOrigin.horizontal === selfOrigin.horizontal ? anchorProps.right : anchorProps.left)\n      )\n      props.maxWidth = Math.min(currentWidth, anchorX)\n      props.left = Math.max(0, anchorX - props.maxWidth)\n    }\n    else {\n      props.left = Math.max(0, anchorOrigin.horizontal === 'middle'\n        ? anchorProps.middle\n        : (anchorOrigin.horizontal === selfOrigin.horizontal ? anchorProps.left : anchorProps.right)\n      )\n      props.maxWidth = Math.min(currentWidth, innerWidth - props.left)\n    }\n  }\n}\n","import { h, ref, computed, watch, Transition, onBeforeUnmount, getCurrentInstance } from 'vue'\n\nimport useAnchor, { useAnchorProps } from '../../composables/private/use-anchor.js'\nimport useScrollTarget from '../../composables/private/use-scroll-target.js'\nimport useModelToggle, { useModelToggleProps, useModelToggleEmits } from '../../composables/private/use-model-toggle.js'\nimport useDark, { useDarkProps } from '../../composables/private/use-dark.js'\nimport usePortal from '../../composables/private/use-portal.js'\nimport useTransition, { useTransitionProps } from '../../composables/private/use-transition.js'\nimport useTick from '../../composables/private/use-tick.js'\nimport useTimeout from '../../composables/private/use-timeout.js'\n\nimport { createComponent } from '../../utils/private/create.js'\nimport { closePortalMenus } from '../../utils/private/portal.js'\nimport { getScrollTarget } from '../../utils/scroll.js'\nimport { position, stopAndPrevent } from '../../utils/event.js'\nimport { hSlot } from '../../utils/private/render.js'\nimport { addEscapeKey, removeEscapeKey } from '../../utils/private/escape-key.js'\nimport { addFocusout, removeFocusout } from '../../utils/private/focusout.js'\nimport { childHasFocus } from '../../utils/dom.js'\nimport { addClickOutside, removeClickOutside } from '../../utils/private/click-outside.js'\nimport { addFocusFn } from '../../utils/private/focus-manager.js'\n\nimport {\n  validatePosition, validateOffset, setPosition, parsePosition\n} from '../../utils/private/position-engine.js'\n\nexport default createComponent({\n  name: 'QMenu',\n\n  inheritAttrs: false,\n\n  props: {\n    ...useAnchorProps,\n    ...useModelToggleProps,\n    ...useDarkProps,\n    ...useTransitionProps,\n\n    persistent: Boolean,\n    autoClose: Boolean,\n    separateClosePopup: Boolean,\n\n    noRouteDismiss: Boolean,\n    noRefocus: Boolean,\n    noFocus: Boolean,\n\n    fit: Boolean,\n    cover: Boolean,\n\n    square: Boolean,\n\n    anchor: {\n      type: String,\n      validator: validatePosition\n    },\n    self: {\n      type: String,\n      validator: validatePosition\n    },\n    offset: {\n      type: Array,\n      validator: validateOffset\n    },\n\n    scrollTarget: {\n      default: void 0\n    },\n\n    touchPosition: Boolean,\n\n    maxHeight: {\n      type: String,\n      default: null\n    },\n    maxWidth: {\n      type: String,\n      default: null\n    }\n  },\n\n  emits: [\n    ...useModelToggleEmits,\n    'click', 'escapeKey'\n  ],\n\n  setup (props, { slots, emit, attrs }) {\n    let refocusTarget = null, absoluteOffset, unwatchPosition, avoidAutoClose\n\n    const vm = getCurrentInstance()\n    const { proxy } = vm\n    const { $q } = proxy\n\n    const innerRef = ref(null)\n    const showing = ref(false)\n\n    const hideOnRouteChange = computed(() =>\n      props.persistent !== true\n      && props.noRouteDismiss !== true\n    )\n\n    const isDark = useDark(props, $q)\n    const { registerTick, removeTick } = useTick()\n    const { registerTimeout } = useTimeout()\n    const { transitionProps, transitionStyle } = useTransition(props)\n    const { localScrollTarget, changeScrollEvent, unconfigureScrollTarget } = useScrollTarget(props, configureScrollTarget)\n\n    const { anchorEl, canShow } = useAnchor({ showing })\n\n    const { hide } = useModelToggle({\n      showing, canShow, handleShow, handleHide,\n      hideOnRouteChange,\n      processOnMount: true\n    })\n\n    const { showPortal, hidePortal, renderPortal } = usePortal(vm, innerRef, renderPortalContent, 'menu')\n\n    const clickOutsideProps = {\n      anchorEl,\n      innerRef,\n      onClickOutside (e) {\n        if (props.persistent !== true && showing.value === true) {\n          hide(e)\n\n          if (\n            // always prevent touch event\n            e.type === 'touchstart'\n            // prevent click if it's on a dialog backdrop\n            || e.target.classList.contains('q-dialog__backdrop')\n          ) {\n            stopAndPrevent(e)\n          }\n\n          return true\n        }\n      }\n    }\n\n    const anchorOrigin = computed(() =>\n      parsePosition(\n        props.anchor || (\n          props.cover === true ? 'center middle' : 'bottom start'\n        ),\n        $q.lang.rtl\n      )\n    )\n\n    const selfOrigin = computed(() => (\n      props.cover === true\n        ? anchorOrigin.value\n        : parsePosition(props.self || 'top start', $q.lang.rtl)\n    ))\n\n    const menuClass = computed(() =>\n      (props.square === true ? ' q-menu--square' : '')\n      + (isDark.value === true ? ' q-menu--dark q-dark' : '')\n    )\n\n    const onEvents = computed(() => (\n      props.autoClose === true\n        ? { onClick: onAutoClose }\n        : {}\n    ))\n\n    const handlesFocus = computed(() =>\n      showing.value === true && props.persistent !== true\n    )\n\n    watch(handlesFocus, val => {\n      if (val === true) {\n        addEscapeKey(onEscapeKey)\n        addClickOutside(clickOutsideProps)\n      }\n      else {\n        removeEscapeKey(onEscapeKey)\n        removeClickOutside(clickOutsideProps)\n      }\n    })\n\n    function focus () {\n      addFocusFn(() => {\n        let node = innerRef.value\n\n        if (node && node.contains(document.activeElement) !== true) {\n          node = node.querySelector('[autofocus][tabindex], [data-autofocus][tabindex]')\n            || node.querySelector('[autofocus] [tabindex], [data-autofocus] [tabindex]')\n            || node.querySelector('[autofocus], [data-autofocus]')\n            || node\n          node.focus({ preventScroll: true })\n        }\n      })\n    }\n\n    function handleShow (evt) {\n      refocusTarget = props.noRefocus === false\n        ? document.activeElement\n        : null\n\n      addFocusout(onFocusout)\n\n      showPortal()\n      configureScrollTarget()\n\n      absoluteOffset = void 0\n\n      if (evt !== void 0 && (props.touchPosition || props.contextMenu)) {\n        const pos = position(evt)\n\n        if (pos.left !== void 0) {\n          const { top, left } = anchorEl.value.getBoundingClientRect()\n          absoluteOffset = { left: pos.left - left, top: pos.top - top }\n        }\n      }\n\n      if (unwatchPosition === void 0) {\n        unwatchPosition = watch(\n          () => $q.screen.width + '|' + $q.screen.height + '|' + props.self + '|' + props.anchor + '|' + $q.lang.rtl,\n          updatePosition\n        )\n      }\n\n      if (props.noFocus !== true) {\n        document.activeElement.blur()\n      }\n\n      // should removeTick() if this gets removed\n      registerTick(() => {\n        updatePosition()\n        props.noFocus !== true && focus()\n      })\n\n      // should removeTimeout() if this gets removed\n      registerTimeout(() => {\n        // required in order to avoid the \"double-tap needed\" issue\n        if ($q.platform.is.ios === true) {\n          // if auto-close, then this click should\n          // not close the menu\n          avoidAutoClose = props.autoClose\n          innerRef.value.click()\n        }\n\n        updatePosition()\n        showPortal(true) // done showing portal\n        emit('show', evt)\n      }, props.transitionDuration)\n    }\n\n    function handleHide (evt) {\n      removeTick()\n      hidePortal()\n\n      anchorCleanup(true)\n\n      if (\n        refocusTarget !== null\n        && (\n          // menu was hidden from code or ESC plugin\n          evt === void 0\n          // menu was not closed from a mouse or touch clickOutside\n          || evt.qClickOutside !== true\n        )\n      ) {\n        ((evt && evt.type.indexOf('key') === 0\n          ? refocusTarget.closest('[tabindex]:not([tabindex^=\"-\"])')\n          : void 0\n        ) || refocusTarget).focus()\n        refocusTarget = null\n      }\n\n      // should removeTimeout() if this gets removed\n      registerTimeout(() => {\n        hidePortal(true) // done hiding, now destroy\n        emit('hide', evt)\n      }, props.transitionDuration)\n    }\n\n    function anchorCleanup (hiding) {\n      absoluteOffset = void 0\n\n      if (unwatchPosition !== void 0) {\n        unwatchPosition()\n        unwatchPosition = void 0\n      }\n\n      if (hiding === true || showing.value === true) {\n        removeFocusout(onFocusout)\n        unconfigureScrollTarget()\n        removeClickOutside(clickOutsideProps)\n        removeEscapeKey(onEscapeKey)\n      }\n\n      if (hiding !== true) {\n        refocusTarget = null\n      }\n    }\n\n    function configureScrollTarget () {\n      if (anchorEl.value !== null || props.scrollTarget !== void 0) {\n        localScrollTarget.value = getScrollTarget(anchorEl.value, props.scrollTarget)\n        changeScrollEvent(localScrollTarget.value, updatePosition)\n      }\n    }\n\n    function onAutoClose (e) {\n      // if auto-close, then the ios double-tap fix which\n      // issues a click should not close the menu\n      if (avoidAutoClose !== true) {\n        closePortalMenus(proxy, e)\n        emit('click', e)\n      }\n      else {\n        avoidAutoClose = false\n      }\n    }\n\n    function onFocusout (evt) {\n      // the focus is not in a vue child component\n      if (\n        handlesFocus.value === true\n        && props.noFocus !== true\n        && childHasFocus(innerRef.value, evt.target) !== true\n      ) {\n        focus()\n      }\n    }\n\n    function onEscapeKey (evt) {\n      emit('escapeKey')\n      hide(evt)\n    }\n\n    function updatePosition () {\n      setPosition({\n        targetEl: innerRef.value,\n        offset: props.offset,\n        anchorEl: anchorEl.value,\n        anchorOrigin: anchorOrigin.value,\n        selfOrigin: selfOrigin.value,\n        absoluteOffset,\n        fit: props.fit,\n        cover: props.cover,\n        maxHeight: props.maxHeight,\n        maxWidth: props.maxWidth\n      })\n    }\n\n    function renderPortalContent () {\n      return h(\n        Transition,\n        transitionProps.value,\n        () => (\n          showing.value === true\n            ? h('div', {\n              role: 'menu',\n              ...attrs,\n              ref: innerRef,\n              tabindex: -1,\n              class: [\n                'q-menu q-position-engine scroll' + menuClass.value,\n                attrs.class\n              ],\n              style: [\n                attrs.style,\n                transitionStyle.value\n              ],\n              ...onEvents.value\n            }, hSlot(slots.default))\n            : null\n        )\n      )\n    }\n\n    onBeforeUnmount(anchorCleanup)\n\n    // expose public methods\n    Object.assign(proxy, { focus, updatePosition })\n\n    return renderPortal\n  }\n})\n","<script setup lang=\"ts\">\nimport { Notation, PieceAllegiance } from '@decentm/allegiance-chess-core'\n\nimport ChessPiece from './chess-piece.vue'\n\ndefineProps<{\n  modelValue: boolean\n  allegiance: PieceAllegiance\n}>()\n\nconst emit = defineEmits<{\n  (event: 'click', piece: Notation.Piece): void\n  (event: 'dismiss'): void\n}>()\n\nconst pieces: Notation.Piece[] = ['Q', 'N', 'R', 'B']\n\nconst handleDismiss = () => {\n  emit('dismiss')\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.promotion-piece {\n  width: 92px;\n  height: 92px;\n}\n</style>\n\n<template>\n  <q-menu cover :model-value=\"modelValue\" @update:model-value=\"handleDismiss\">\n    <q-list>\n      <q-item\n        clickable\n        v-for=\"piece in pieces\"\n        :key=\"piece\"\n        class=\"q-pa-sm\"\n        @click=\"emit('click', piece)\"\n      >\n        <q-item-section class=\"promotion-piece items-center\">\n          <chess-piece :allegiance=\"allegiance\" :piece=\"piece\" :size=\"92\" />\n        </q-item-section>\n      </q-item>\n    </q-list>\n  </q-menu>\n</template>\n","<script setup lang=\"ts\">\ndefineProps<{\n  modelValue: boolean\n  moves: Array<'x' | '>'>\n}>()\n\nconst emit = defineEmits<{\n  (event: 'click', choice: 'capture' | 'challenge'): void\n  (event: 'dismiss'): void\n}>()\n\nconst handleDismiss = () => {\n  emit('dismiss')\n}\n</script>\n\n<template>\n  <q-menu cover :model-value=\"modelValue\" @update:model-value=\"handleDismiss\">\n    <q-list>\n      <q-item\n        v-if=\"moves.includes('x')\"\n        clickable\n        @click=\"emit('click', 'capture')\"\n        class=\"q-py-lg\"\n      >\n        <q-item-section class=\"items-center\">\n          <q-icon size=\"72px\" name=\"close\" />\n        </q-item-section>\n      </q-item>\n\n      <q-item\n        v-if=\"moves.includes('>')\"\n        clickable\n        @click=\"emit('click', 'challenge')\"\n        class=\"q-py-lg\"\n      >\n        <q-item-section class=\"items-center\">\n          <q-icon size=\"64px\" name=\"arrow_forward_ios\" />\n        </q-item-section>\n      </q-item>\n    </q-list>\n  </q-menu>\n</template>\n","<script setup lang=\"ts\">\nimport { ComputedRef, computed, ref } from 'vue'\n\nimport {\n  Board,\n  coordinatesEqual,\n  isPromotion,\n  PieceAllegiance,\n  Notation,\n  allegianceSide,\n} from '@decentm/allegiance-chess-core'\n\nimport PromotionSelector from '../../promotion-selector.vue'\nimport CaptureSelector from '../../capture-selector.vue'\n\nconst props = defineProps<{\n  board: Board\n  squareSize: number\n  ranks: number\n  files: number\n  perspective: 'white' | 'black'\n  pieceFocus: Notation.Coordinates | null\n}>()\n\nconst captureFocus = ref<Notation.Coordinates | null>(null)\n\nconst enPassantTarget = computed(() => {\n  return props.board.enPassantTarget\n})\n\nconst showPromotionPopup = ref<Notation.Coordinates | null>(null)\nconst promotionAllegiance = ref<PieceAllegiance | null>(null)\n\nconst emit = defineEmits<{\n  (event: 'execute-node', node: Partial<Notation.Node>): void\n  (event: 'update-piece-focus', coords: Notation.Coordinates | null): void\n  (\n    event: 'update-highlights',\n    targets: Notation.Coordinates[],\n    captures: Notation.Coordinates[]\n  ): void\n}>()\n\nconst focusedSquare = computed(() => {\n  return props.pieceFocus ? props.board.getSquare(props.pieceFocus) : null\n})\n\nconst highlightSquares = computed(() => {\n  if (!props.pieceFocus) {\n    return []\n  }\n\n  const moves = props.board.getValidMoves(props.pieceFocus)\n\n  const result = moves\n    .map((node) => {\n      if (node.kind !== 'move') {\n        return null\n      }\n\n      return node.to\n    })\n    .filter(Boolean)\n\n  return result\n})\n\nconst isOpponent = (coords: Notation.Coordinates) => {\n  const square = props.board.getSquare(coords)\n\n  if (!square) {\n    return false\n  }\n\n  return allegianceSide(square.allegiance) !== props.perspective\n}\n\nconst isHighlighted = (coords: Notation.Coordinates) =>\n  highlightSquares.value.some(\n    (coordinate) => coordinate && coordinatesEqual(coords, coordinate)\n  )\n\nconst handleCoordsClick = (coords: Notation.Coordinates, event: MouseEvent) => {\n  event.stopPropagation()\n  event.preventDefault()\n\n  if (isHighlighted(coords) && props.pieceFocus && focusedSquare.value) {\n    if (\n      enPassantTarget.value &&\n      coordinatesEqual(enPassantTarget.value, coords)\n    ) {\n      emit('execute-node', {\n        kind: 'move',\n        type: 'en-passant',\n        from: props.pieceFocus,\n        to: coords,\n      })\n      emit('update-piece-focus', null)\n    } else if (\n      isPromotion(coords, props.board.activeColour) &&\n      focusedSquare &&\n      focusedSquare.value.piece === null\n    ) {\n      showPromotionPopup.value = coords\n\n      const fromSquare = props.board.getSquare(props.pieceFocus)\n      promotionAllegiance.value = fromSquare?.allegiance ?? null\n    } else if (props.board.getSquare(coords)) {\n      captureFocus.value = coords\n    } else if (\n      focusedSquare.value?.piece === 'K' &&\n      Math.abs(props.pieceFocus.file - coords.file) > 1\n    ) {\n      emit('execute-node', {\n        kind: 'move',\n        type: 'castle',\n        side: coords.file === 7 ? 'king' : 'queen',\n        from: props.pieceFocus,\n        to: coords,\n      })\n    } else {\n      emit('execute-node', {\n        kind: 'move',\n        from: props.pieceFocus,\n        to: coords,\n      })\n    }\n\n    return\n  }\n\n  if (isOpponent(coords)) {\n    return\n  }\n\n  const square = props.board.getSquare(coords)\n\n  emit('update-piece-focus', square ? coords : null)\n}\n\nconst handlePromotion = (\n  coords: Notation.Coordinates,\n  piece: Notation.Piece\n) => {\n  if (!props.pieceFocus) {\n    return\n  }\n\n  showPromotionPopup.value = null\n\n  emit('execute-node', {\n    kind: 'move',\n    type: 'promotion',\n    from: props.pieceFocus,\n    to: coords,\n    promotionTo: piece,\n  })\n\n  emit('update-piece-focus', null)\n}\n\nconst handlePromotionDismiss = () => {\n  showPromotionPopup.value = null\n  promotionAllegiance.value = null\n}\n\nconst handleCaptureDismiss = () => {\n  captureFocus.value = null\n}\n\nconst handleCaptureClick = (decision: 'capture' | 'challenge') => {\n  if (!props.pieceFocus || !captureFocus.value) {\n    return\n  }\n\n  if (decision === 'capture') {\n    emit('execute-node', {\n      kind: 'move',\n      type: 'capture',\n      from: props.pieceFocus,\n      to: captureFocus.value,\n    })\n  } else {\n    emit('execute-node', {\n      kind: 'move',\n      type: 'allegiance',\n      from: props.pieceFocus,\n      to: captureFocus.value,\n    })\n  }\n\n  captureFocus.value = null\n\n  emit('update-piece-focus', null)\n}\n\nconst indexToCoords = (\n  fileIndex: number,\n  rankIndex: number\n): Notation.Coordinates => {\n  const rawFile = fileIndex + 1\n  const rawRank = rankIndex + 1\n\n  if (props.perspective === 'white') {\n    return {\n      file: rawFile as Notation.File,\n      rank: (9 - rawRank) as Notation.Rank,\n    }\n  }\n\n  return {\n    file: (9 - rawFile) as Notation.File,\n    rank: rawRank as Notation.Rank,\n  }\n}\n\nconst coordsEmpty = (coords: Notation.Coordinates) => {\n  return !props.board.getSquare(coords)\n}\n\nconst canMove = (\n  type: 'capture' | 'allegiance',\n  from: Notation.Coordinates,\n  to: Notation.Coordinates\n) => {\n  const moves = props.board.getValidMoves()\n\n  return moves.some((move) => {\n    return (\n      move.kind === 'move' &&\n      coordinatesEqual(move.to, to) &&\n      coordinatesEqual(move.from, from) &&\n      move.type === type\n    )\n  })\n}\n\nconst captureMoves: ComputedRef<Array<'x' | '>'>> = computed(() => {\n  const result: Array<'x' | '>'> = []\n\n  if (!props.pieceFocus || !captureFocus.value) {\n    return result\n  }\n\n  if (canMove('allegiance', props.pieceFocus, captureFocus.value)) {\n    result.push('>')\n  }\n\n  if (canMove('capture', props.pieceFocus, captureFocus.value)) {\n    result.push('x')\n  }\n\n  return result\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.interaction-layer {\n  z-index: 4;\n}\n</style>\n\n<template>\n  <div class=\"relative-position full-width full-height interaction-layer\">\n    <div\n      class=\"col column row full-width\"\n      v-for=\"(_, rankIndex) in ranks\"\n      :key=\"rankIndex\"\n    >\n      <div v-for=\"(_, fileIndex) in files\" :key=\"fileIndex\" class=\"full-height\">\n        <div\n          v-ripple=\"\n            !coordsEmpty(indexToCoords(fileIndex, rankIndex)) &&\n            !isOpponent(indexToCoords(fileIndex, rankIndex))\n          \"\n          class=\"absolute\"\n          @click=\"\n            (event) =>\n              handleCoordsClick(indexToCoords(fileIndex, rankIndex), event)\n          \"\n          :class=\"{\n            'cursor-pointer':\n              !coordsEmpty(indexToCoords(fileIndex, rankIndex)) ||\n              isHighlighted(indexToCoords(fileIndex, rankIndex)),\n            'cursor-not-allowed':\n              isOpponent(indexToCoords(fileIndex, rankIndex)) && !focusedSquare,\n          }\"\n          :style=\"\n            perspective === 'white'\n              ? {\n                  width: `${squareSize}px`,\n                  height: `${squareSize}px`,\n                  left: `${\n                    (indexToCoords(fileIndex, rankIndex).file - 1) * squareSize\n                  }px`,\n                  bottom: `${\n                    (indexToCoords(fileIndex, rankIndex).rank - 1) * squareSize\n                  }px`,\n                }\n              : {\n                  width: `${squareSize}px`,\n                  height: `${squareSize}px`,\n                  right: `${\n                    (indexToCoords(fileIndex, rankIndex).file - 1) * squareSize\n                  }px`,\n                  top: `${\n                    (indexToCoords(fileIndex, rankIndex).rank - 1) * squareSize\n                  }px`,\n                }\n          \"\n        >\n          <capture-selector\n            v-if=\"\n              captureFocus &&\n              coordinatesEqual(\n                captureFocus,\n                indexToCoords(fileIndex, rankIndex)\n              )\n            \"\n            :moves=\"captureMoves\"\n            :model-value=\"\n              coordinatesEqual(\n                captureFocus,\n                indexToCoords(fileIndex, rankIndex)\n              ) ?? false\n            \"\n            :size=\"squareSize\"\n            @click=\"handleCaptureClick\"\n            @dismiss=\"handleCaptureDismiss\"\n          />\n\n          <promotion-selector\n            v-if=\"\n              promotionAllegiance !== null &&\n              (isPromotion(indexToCoords(fileIndex, rankIndex), 'white') ||\n                isPromotion(indexToCoords(fileIndex, rankIndex), 'black'))\n            \"\n            :model-value=\"\n              coordinatesEqual(\n                showPromotionPopup,\n                indexToCoords(fileIndex, rankIndex)\n              ) ?? false\n            \"\n            :allegiance=\"promotionAllegiance\"\n            :size=\"squareSize\"\n            @click=\"\n              (piece) =>\n                handlePromotion(indexToCoords(fileIndex, rankIndex), piece)\n            \"\n            @dismiss=\"handlePromotionDismiss\"\n          />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport {\n  Board,\n  Notation,\n  coordinatesEqual,\n} from '@decentm/allegiance-chess-core'\n\nconst props = defineProps<{\n  board: Board\n  ranks: number\n  files: number\n  squareSize: number\n  perspective: 'white' | 'black'\n  pieceFocus: Notation.Coordinates | null\n  lastMove: Notation.Node | null\n}>()\n\nconst highlightSquares = computed(() => {\n  if (!props.pieceFocus) {\n    return []\n  }\n\n  const moves = props.board.getValidMoves(props.pieceFocus)\n\n  const result = moves\n    .map((node) => {\n      if (node.kind !== 'move') {\n        return null\n      }\n\n      return node.to\n    })\n    .filter(Boolean)\n\n  return result\n})\n\nconst show = (coords: Notation.Coordinates) =>\n  highlightSquares.value.some(\n    (coordinate) => coordinate && coordinatesEqual(coords, coordinate)\n  )\n\nconst coordsEmpty = (coords: Notation.Coordinates) => {\n  return !props.board.getSquare(coords)\n}\n\nconst indexToCoords = (\n  fileIndex: number,\n  rankIndex: number\n): Notation.Coordinates => {\n  const rawFile = fileIndex + 1\n  const rawRank = rankIndex + 1\n\n  if (props.perspective === 'white') {\n    return {\n      file: rawFile as Notation.File,\n      rank: (9 - rawRank) as Notation.Rank,\n    }\n  }\n\n  return {\n    file: (9 - rawFile) as Notation.File,\n    rank: rawRank as Notation.Rank,\n  }\n}\n\nconst checkMoves = computed(() => {\n  return props.board.getCheckMoves()\n})\n\nconst isChecked = (coords: Notation.Coordinates) => {\n  return checkMoves.value.some(\n    (move) => move.kind === 'move' && coordinatesEqual(move.to, coords)\n  )\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.indicators-layer {\n  z-index: 2;\n}\n\n.move-placeholder {\n  position: relative;\n\n  transition-property: outline-color;\n  transition-duration: 0.1s;\n  transition-timing-function: linear;\n  transition-delay: inherit;\n\n  outline-color: transparent;\n\n  &::before {\n    filter: blur(1px);\n\n    display: block;\n    position: absolute;\n    content: '';\n    border-radius: 50%;\n    z-index: 2;\n\n    background-color: rgba(0, 0, 0, 0);\n    border-color: rgba(0, 0, 0, 0);\n\n    transition-property: background-color, border-color;\n    transition-duration: inherit;\n    transition-timing-function: inherit;\n    transition-delay: inherit;\n  }\n\n  &.checked {\n    &::before {\n      background-color: $negative;\n      opacity: 0.8;\n      filter: blur(15px);\n    }\n  }\n\n  &.focus {\n    border-radius: 1rem;\n\n    outline-width: 0.25rem;\n    outline-style: dashed;\n    outline-offset: -0.5rem;\n\n    &.even {\n      outline-color: $chess-black;\n    }\n\n    &:not(.even) {\n      outline-color: $chess-white;\n    }\n  }\n\n  &.target {\n    &::before {\n      height: 33%;\n      width: 33%;\n      left: 33%;\n      top: 33%;\n    }\n  }\n\n  &.capture {\n    &::before {\n      height: 90%;\n      width: 90%;\n      left: 5%;\n      top: 5%;\n\n      border-width: 1rem;\n      border-style: solid;\n    }\n  }\n\n  &.show {\n    &::before {\n      pointer-events: all;\n    }\n\n    &.target {\n      &::before {\n        background-color: rgba(0, 0, 0, 0.2);\n      }\n    }\n\n    &.capture {\n      &::before {\n        border-color: rgba(0, 0, 0, 0.2);\n      }\n    }\n  }\n\n  &.last {\n    &-from {\n      background-color: rgba($chess-highlight, 0.5);\n    }\n\n    &-to {\n      background-color: rgba($chess-highlight, 0.7);\n    }\n  }\n}\n</style>\n\n<template>\n  <div\n    class=\"relative-position full-width full-height column no-pointer-events indicators-layer\"\n  >\n    <div\n      class=\"col column row full-width\"\n      v-for=\"(_, rankIndex) in ranks\"\n      :key=\"rankIndex\"\n    >\n      <div\n        v-for=\"(_, fileIndex) in files\"\n        :key=\"fileIndex\"\n        class=\"full-height move-placeholder\"\n        :class=\"{\n          even: rankIndex % 2 === 0 ? fileIndex % 2 === 0 : fileIndex % 2 !== 0,\n          focus: coordinatesEqual(\n            pieceFocus,\n            indexToCoords(fileIndex, rankIndex)\n          ),\n          show: show(indexToCoords(fileIndex, rankIndex)),\n          capture: !coordsEmpty(indexToCoords(fileIndex, rankIndex)),\n          target: coordsEmpty(indexToCoords(fileIndex, rankIndex)),\n          checked: isChecked(indexToCoords(fileIndex, rankIndex)),\n          'last-from':\n            lastMove?.kind === 'move' &&\n            coordinatesEqual(\n              lastMove.from,\n              indexToCoords(fileIndex, rankIndex)\n            ),\n          'last-to':\n            lastMove?.kind === 'move' &&\n            coordinatesEqual(lastMove.to, indexToCoords(fileIndex, rankIndex)),\n        }\"\n      />\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { useQuasar } from 'quasar'\nimport { BoardSquare, Notation } from '@decentm/allegiance-chess-core'\n\nimport ChessPiece from '../../chess-piece.vue'\n\ndefineProps<{\n  modelValue: Array<Notation.Coordinates & BoardSquare>\n  squareSize: number\n  perspective: 'white' | 'black'\n}>()\n\nconst q = useQuasar()\n</script>\n\n<style lang=\"scss\" scoped>\n.pieces-layer {\n  z-index: 3;\n}\n</style>\n\n<template>\n  <div\n    class=\"relative-position full-width full-height no-pointer-events pieces-layer\"\n  >\n    <div v-for=\"(square, index) in modelValue\" :key=\"index\">\n      <chess-piece\n        v-if=\"square\"\n        data-testid=\"piece\"\n        class=\"absolute\"\n        :class=\"{\n          'q-pa-xs': q.screen.sm || q.screen.md,\n          'q-pa-sm': q.screen.gt.sm,\n        }\"\n        :piece=\"square.piece\"\n        :allegiance=\"square.allegiance\"\n        :size=\"squareSize\"\n        :style=\"\n          perspective === 'white'\n            ? {\n                left: `${(square.file - 1) * squareSize}px`,\n                bottom: `${(square.rank - 1) * squareSize}px`,\n              }\n            : {\n                right: `${(square.file - 1) * squareSize}px`,\n                top: `${(square.rank - 1) * squareSize}px`,\n              }\n        \"\n      />\n\n      <div\n        v-else\n        :style=\"{ width: `${squareSize}px`, height: `${squareSize}px` }\"\n      ></div>\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\n\nimport { Board, Notation } from '@decentm/allegiance-chess-core'\n\nimport BackgroundLayer from './board/layers/background-layer.vue'\nimport InteractionLayer from './board/layers/interaction-layer.vue'\nimport IndicatorsLayer from './board/layers/indicators-layer.vue'\nimport PiecesLayer from './board/layers/pieces-layer.vue'\n\nconst props = defineProps<{\n  board: Board\n  width: number\n  perspective: 'black' | 'white'\n  playAs: Array<'black' | 'white'>\n  roundedBorders?: boolean\n}>()\n\nconst emit = defineEmits<{\n  (event: 'execute-node', value: Partial<Notation.Node>): void\n}>()\n\nconst squareSize = computed(() => {\n  return props.width / 8\n})\n\nconst pieceFocus = ref<Notation.Coordinates | null>(null)\n\nconst handleExcuteNode = (node: Partial<Notation.Node>) => {\n  emit('execute-node', node)\n  pieceFocus.value = null\n}\n\nconst lastMove = computed(() => {\n  const ast = props.board.getMoveHistoryAst()\n\n  return ast.children.at(-1) ?? null\n})\n</script>\n\n<template>\n  <div\n    data-testid=\"chess-board\"\n    class=\"relative-position column\"\n    :class=\"{ 'rounded-borders overflow-hidden': roundedBorders }\"\n    :style=\"{ width: props.width + 'px', height: props.width + 'px' }\"\n  >\n    <div class=\"absolute full-width full-height\">\n      <background-layer :ranks=\"8\" :files=\"8\" />\n    </div>\n\n    <div class=\"absolute full-width full-height\">\n      <indicators-layer\n        :board=\"board\"\n        :square-size=\"squareSize\"\n        :files=\"8\"\n        :ranks=\"8\"\n        :perspective=\"perspective\"\n        :piece-focus=\"pieceFocus\"\n        :last-move=\"lastMove\"\n      />\n    </div>\n\n    <div class=\"absolute full-width full-height\">\n      <pieces-layer\n        :model-value=\"board.getSquares()\"\n        :perspective=\"props.perspective\"\n        :square-size=\"squareSize\"\n      />\n    </div>\n\n    <div class=\"absolute full-width full-height\">\n      <interaction-layer\n        @execute-node=\"handleExcuteNode\"\n        @update-piece-focus=\"(focus) => (pieceFocus = focus)\"\n        :piece-focus=\"pieceFocus\"\n        :board=\"board\"\n        :square-size=\"squareSize\"\n        :files=\"8\"\n        :ranks=\"8\"\n        :perspective=\"props.perspective\"\n      />\n    </div>\n  </div>\n</template>\n","import { h, computed, getCurrentInstance } from 'vue'\n\nimport QIcon from '../icon/QIcon.js'\n\nimport Ripple from '../../directives/Ripple.js'\n\nimport useDark, { useDarkProps } from '../../composables/private/use-dark.js'\nimport useSize, { useSizeProps } from '../../composables/private/use-size.js'\n\nimport { createComponent } from '../../utils/private/create.js'\nimport { stopAndPrevent } from '../../utils/event.js'\nimport { hMergeSlotSafely, hDir } from '../../utils/private/render.js'\n\nexport const defaultSizes = {\n  xs: 8,\n  sm: 10,\n  md: 14,\n  lg: 20,\n  xl: 24\n}\n\nexport default createComponent({\n  name: 'QChip',\n\n  props: {\n    ...useDarkProps,\n    ...useSizeProps,\n\n    dense: Boolean,\n\n    icon: String,\n    iconRight: String,\n    iconRemove: String,\n    iconSelected: String,\n    label: [ String, Number ],\n\n    color: String,\n    textColor: String,\n\n    modelValue: {\n      type: Boolean,\n      default: true\n    },\n    selected: {\n      type: Boolean,\n      default: null\n    },\n\n    square: Boolean,\n    outline: Boolean,\n    clickable: Boolean,\n    removable: Boolean,\n\n    removeAriaLabel: String,\n\n    tabindex: [ String, Number ],\n    disable: Boolean,\n\n    ripple: {\n      type: [ Boolean, Object ],\n      default: true\n    }\n  },\n\n  emits: [ 'update:modelValue', 'update:selected', 'remove', 'click' ],\n\n  setup (props, { slots, emit }) {\n    const { proxy: { $q } } = getCurrentInstance()\n\n    const isDark = useDark(props, $q)\n    const sizeStyle = useSize(props, defaultSizes)\n\n    const hasLeftIcon = computed(() => props.selected === true || props.icon !== void 0)\n\n    const leftIcon = computed(() => (\n      props.selected === true\n        ? props.iconSelected || $q.iconSet.chip.selected\n        : props.icon\n    ))\n\n    const removeIcon = computed(() => props.iconRemove || $q.iconSet.chip.remove)\n\n    const isClickable = computed(() =>\n      props.disable === false\n      && (props.clickable === true || props.selected !== null)\n    )\n\n    const classes = computed(() => {\n      const text = props.outline === true\n        ? props.color || props.textColor\n        : props.textColor\n\n      return 'q-chip row inline no-wrap items-center'\n        + (props.outline === false && props.color !== void 0 ? ` bg-${ props.color }` : '')\n        + (text ? ` text-${ text } q-chip--colored` : '')\n        + (props.disable === true ? ' disabled' : '')\n        + (props.dense === true ? ' q-chip--dense' : '')\n        + (props.outline === true ? ' q-chip--outline' : '')\n        + (props.selected === true ? ' q-chip--selected' : '')\n        + (isClickable.value === true ? ' q-chip--clickable cursor-pointer non-selectable q-hoverable' : '')\n        + (props.square === true ? ' q-chip--square' : '')\n        + (isDark.value === true ? ' q-chip--dark q-dark' : '')\n    })\n\n    const attributes = computed(() => {\n      const chip = props.disable === true\n        ? { tabindex: -1, 'aria-disabled': 'true' }\n        : { tabindex: props.tabindex || 0 }\n      const remove = {\n        ...chip,\n        role: 'button',\n        'aria-hidden': 'false',\n        'aria-label': props.removeAriaLabel || $q.lang.label.remove\n      }\n\n      return { chip, remove }\n    })\n\n    function onKeyup (e) {\n      e.keyCode === 13 /* ENTER */ && onClick(e)\n    }\n\n    function onClick (e) {\n      if (!props.disable) {\n        emit('update:selected', !props.selected)\n        emit('click', e)\n      }\n    }\n\n    function onRemove (e) {\n      if (e.keyCode === void 0 || e.keyCode === 13) {\n        stopAndPrevent(e)\n        if (props.disable === false) {\n          emit('update:modelValue', false)\n          emit('remove')\n        }\n      }\n    }\n\n    function getContent () {\n      const child = []\n\n      isClickable.value === true && child.push(\n        h('div', { class: 'q-focus-helper' })\n      )\n\n      hasLeftIcon.value === true && child.push(\n        h(QIcon, {\n          class: 'q-chip__icon q-chip__icon--left',\n          name: leftIcon.value\n        })\n      )\n\n      const label = props.label !== void 0\n        ? [ h('div', { class: 'ellipsis' }, [ props.label ]) ]\n        : void 0\n\n      child.push(\n        h('div', {\n          class: 'q-chip__content col row no-wrap items-center q-anchor--skip'\n        }, hMergeSlotSafely(slots.default, label))\n      )\n\n      props.iconRight && child.push(\n        h(QIcon, {\n          class: 'q-chip__icon q-chip__icon--right',\n          name: props.iconRight\n        })\n      )\n\n      props.removable === true && child.push(\n        h(QIcon, {\n          class: 'q-chip__icon q-chip__icon--remove cursor-pointer',\n          name: removeIcon.value,\n          ...attributes.value.remove,\n          onClick: onRemove,\n          onKeyup: onRemove\n        })\n      )\n\n      return child\n    }\n\n    return () => {\n      if (props.modelValue === false) { return }\n\n      const data = {\n        class: classes.value,\n        style: sizeStyle.value\n      }\n\n      isClickable.value === true && Object.assign(\n        data,\n        attributes.value.chip,\n        { onClick, onKeyup }\n      )\n\n      return hDir(\n        'div',\n        data,\n        getContent(),\n        'ripple',\n        props.ripple !== false && props.disable !== true,\n        () => [ [ Ripple, props.ripple ] ]\n      )\n    }\n  }\n})\n","import { h, ref, computed, watch, withDirectives, onActivated, onDeactivated, onBeforeUnmount, getCurrentInstance } from 'vue'\n\nimport useDark, { useDarkProps } from '../../composables/private/use-dark.js'\n\nimport QResizeObserver from '../resize-observer/QResizeObserver.js'\nimport QScrollObserver from '../scroll-observer/QScrollObserver.js'\n\nimport TouchPan from '../../directives/TouchPan.js'\n\nimport { createComponent } from '../../utils/private/create.js'\nimport { between } from '../../utils/format.js'\nimport { setVerticalScrollPosition, setHorizontalScrollPosition } from '../../utils/scroll.js'\nimport { hMergeSlot } from '../../utils/private/render.js'\nimport debounce from '../../utils/debounce.js'\n\nconst axisList = [ 'vertical', 'horizontal' ]\nconst dirProps = {\n  vertical: { offset: 'offsetY', scroll: 'scrollTop', dir: 'down', dist: 'y' },\n  horizontal: { offset: 'offsetX', scroll: 'scrollLeft', dir: 'right', dist: 'x' }\n}\nconst panOpts = {\n  prevent: true,\n  mouse: true,\n  mouseAllDir: true\n}\n\nconst getMinThumbSize = size => (size >= 250 ? 50 : Math.ceil(size / 5))\n\nexport default createComponent({\n  name: 'QScrollArea',\n\n  props: {\n    ...useDarkProps,\n\n    thumbStyle: Object,\n    verticalThumbStyle: Object,\n    horizontalThumbStyle: Object,\n\n    barStyle: [ Array, String, Object ],\n    verticalBarStyle: [ Array, String, Object ],\n    horizontalBarStyle: [ Array, String, Object ],\n\n    contentStyle: [ Array, String, Object ],\n    contentActiveStyle: [ Array, String, Object ],\n\n    delay: {\n      type: [ String, Number ],\n      default: 1000\n    },\n\n    visible: {\n      type: Boolean,\n      default: null\n    },\n\n    tabindex: [ String, Number ],\n\n    onScroll: Function\n  },\n\n  setup (props, { slots, emit }) {\n    // state management\n    const tempShowing = ref(false)\n    const panning = ref(false)\n    const hover = ref(false)\n\n    // other...\n    const container = {\n      vertical: ref(0),\n      horizontal: ref(0)\n    }\n\n    const scroll = {\n      vertical: {\n        ref: ref(null),\n        position: ref(0),\n        size: ref(0)\n      },\n\n      horizontal: {\n        ref: ref(null),\n        position: ref(0),\n        size: ref(0)\n      }\n    }\n\n    const { proxy } = getCurrentInstance()\n\n    const isDark = useDark(props, proxy.$q)\n\n    let timer = null, panRefPos\n\n    const targetRef = ref(null)\n\n    const classes = computed(() =>\n      'q-scrollarea'\n      + (isDark.value === true ? ' q-scrollarea--dark' : '')\n    )\n\n    scroll.vertical.percentage = computed(() => {\n      const diff = scroll.vertical.size.value - container.vertical.value\n      if (diff <= 0) { return 0 }\n      const p = between(scroll.vertical.position.value / diff, 0, 1)\n      return Math.round(p * 10000) / 10000\n    })\n    scroll.vertical.thumbHidden = computed(() =>\n      (\n        (props.visible === null ? hover.value : props.visible) !== true\n        && tempShowing.value === false\n        && panning.value === false\n      ) || scroll.vertical.size.value <= container.vertical.value + 1\n    )\n    scroll.vertical.thumbStart = computed(() =>\n      scroll.vertical.percentage.value * (container.vertical.value - scroll.vertical.thumbSize.value)\n    )\n    scroll.vertical.thumbSize = computed(() =>\n      Math.round(\n        between(\n          container.vertical.value * container.vertical.value / scroll.vertical.size.value,\n          getMinThumbSize(container.vertical.value),\n          container.vertical.value\n        )\n      )\n    )\n    scroll.vertical.style = computed(() => {\n      return {\n        ...props.thumbStyle,\n        ...props.verticalThumbStyle,\n        top: `${ scroll.vertical.thumbStart.value }px`,\n        height: `${ scroll.vertical.thumbSize.value }px`\n      }\n    })\n    scroll.vertical.thumbClass = computed(() =>\n      'q-scrollarea__thumb q-scrollarea__thumb--v absolute-right'\n      + (scroll.vertical.thumbHidden.value === true ? ' q-scrollarea__thumb--invisible' : '')\n    )\n    scroll.vertical.barClass = computed(() =>\n      'q-scrollarea__bar q-scrollarea__bar--v absolute-right'\n      + (scroll.vertical.thumbHidden.value === true ? ' q-scrollarea__bar--invisible' : '')\n    )\n\n    scroll.horizontal.percentage = computed(() => {\n      const diff = scroll.horizontal.size.value - container.horizontal.value\n      if (diff <= 0) { return 0 }\n      const p = between(Math.abs(scroll.horizontal.position.value) / diff, 0, 1)\n      return Math.round(p * 10000) / 10000\n    })\n    scroll.horizontal.thumbHidden = computed(() =>\n      (\n        (props.visible === null ? hover.value : props.visible) !== true\n        && tempShowing.value === false\n        && panning.value === false\n      ) || scroll.horizontal.size.value <= container.horizontal.value + 1\n    )\n    scroll.horizontal.thumbStart = computed(() =>\n      scroll.horizontal.percentage.value * (container.horizontal.value - scroll.horizontal.thumbSize.value)\n    )\n    scroll.horizontal.thumbSize = computed(() =>\n      Math.round(\n        between(\n          container.horizontal.value * container.horizontal.value / scroll.horizontal.size.value,\n          getMinThumbSize(container.horizontal.value),\n          container.horizontal.value\n        )\n      )\n    )\n    scroll.horizontal.style = computed(() => {\n      return {\n        ...props.thumbStyle,\n        ...props.horizontalThumbStyle,\n        [ proxy.$q.lang.rtl === true ? 'right' : 'left' ]: `${ scroll.horizontal.thumbStart.value }px`,\n        width: `${ scroll.horizontal.thumbSize.value }px`\n      }\n    })\n    scroll.horizontal.thumbClass = computed(() =>\n      'q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom'\n      + (scroll.horizontal.thumbHidden.value === true ? ' q-scrollarea__thumb--invisible' : '')\n    )\n    scroll.horizontal.barClass = computed(() =>\n      'q-scrollarea__bar q-scrollarea__bar--h absolute-bottom'\n      + (scroll.horizontal.thumbHidden.value === true ? ' q-scrollarea__bar--invisible' : '')\n    )\n\n    const mainStyle = computed(() => (\n      scroll.vertical.thumbHidden.value === true && scroll.horizontal.thumbHidden.value === true\n        ? props.contentStyle\n        : props.contentActiveStyle\n    ))\n\n    const thumbVertDir = [ [\n      TouchPan,\n      e => { onPanThumb(e, 'vertical') },\n      void 0,\n      { vertical: true, ...panOpts }\n    ] ]\n\n    const thumbHorizDir = [ [\n      TouchPan,\n      e => { onPanThumb(e, 'horizontal') },\n      void 0,\n      { horizontal: true, ...panOpts }\n    ] ]\n\n    function getScroll () {\n      const info = {}\n\n      axisList.forEach(axis => {\n        const data = scroll[ axis ]\n\n        info[ axis + 'Position' ] = data.position.value\n        info[ axis + 'Percentage' ] = data.percentage.value\n        info[ axis + 'Size' ] = data.size.value\n        info[ axis + 'ContainerSize' ] = container[ axis ].value\n      })\n\n      return info\n    }\n\n    // we have lots of listeners, so\n    // ensure we're not emitting same info\n    // multiple times\n    const emitScroll = debounce(() => {\n      const info = getScroll()\n      info.ref = proxy\n      emit('scroll', info)\n    }, 0)\n\n    function localSetScrollPosition (axis, offset, duration) {\n      if (axisList.includes(axis) === false) {\n        console.error('[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)')\n        return\n      }\n\n      const fn = axis === 'vertical'\n        ? setVerticalScrollPosition\n        : setHorizontalScrollPosition\n\n      fn(targetRef.value, offset, duration)\n    }\n\n    function updateContainer ({ height, width }) {\n      let change = false\n\n      if (container.vertical.value !== height) {\n        container.vertical.value = height\n        change = true\n      }\n\n      if (container.horizontal.value !== width) {\n        container.horizontal.value = width\n        change = true\n      }\n\n      change === true && startTimer()\n    }\n\n    function updateScroll ({ position }) {\n      let change = false\n\n      if (scroll.vertical.position.value !== position.top) {\n        scroll.vertical.position.value = position.top\n        change = true\n      }\n\n      if (scroll.horizontal.position.value !== position.left) {\n        scroll.horizontal.position.value = position.left\n        change = true\n      }\n\n      change === true && startTimer()\n    }\n\n    function updateScrollSize ({ height, width }) {\n      if (scroll.horizontal.size.value !== width) {\n        scroll.horizontal.size.value = width\n        startTimer()\n      }\n\n      if (scroll.vertical.size.value !== height) {\n        scroll.vertical.size.value = height\n        startTimer()\n      }\n    }\n\n    function onPanThumb (e, axis) {\n      const data = scroll[ axis ]\n\n      if (e.isFirst === true) {\n        if (data.thumbHidden.value === true) {\n          return\n        }\n\n        panRefPos = data.position.value\n        panning.value = true\n      }\n      else if (panning.value !== true) {\n        return\n      }\n\n      if (e.isFinal === true) {\n        panning.value = false\n      }\n\n      const dProp = dirProps[ axis ]\n      const containerSize = container[ axis ].value\n\n      const multiplier = (data.size.value - containerSize) / (containerSize - data.thumbSize.value)\n      const distance = e.distance[ dProp.dist ]\n      const pos = panRefPos + (e.direction === dProp.dir ? 1 : -1) * distance * multiplier\n\n      setScroll(pos, axis)\n    }\n\n    function onMousedown (evt, axis) {\n      const data = scroll[ axis ]\n\n      if (data.thumbHidden.value !== true) {\n        const offset = evt[ dirProps[ axis ].offset ]\n        if (offset < data.thumbStart.value || offset > data.thumbStart.value + data.thumbSize.value) {\n          const pos = offset - data.thumbSize.value / 2\n          setScroll(pos / container[ axis ].value * data.size.value, axis)\n        }\n\n        // activate thumb pan\n        if (data.ref.value !== null) {\n          data.ref.value.dispatchEvent(new MouseEvent(evt.type, evt))\n        }\n      }\n    }\n\n    function onVerticalMousedown (evt) {\n      onMousedown(evt, 'vertical')\n    }\n\n    function onHorizontalMousedown (evt) {\n      onMousedown(evt, 'horizontal')\n    }\n\n    function startTimer () {\n      tempShowing.value = true\n\n      timer !== null && clearTimeout(timer)\n      timer = setTimeout(() => {\n        timer = null\n        tempShowing.value = false\n      }, props.delay)\n\n      props.onScroll !== void 0 && emitScroll()\n    }\n\n    function setScroll (offset, axis) {\n      targetRef.value[ dirProps[ axis ].scroll ] = offset\n    }\n\n    function onMouseenter () {\n      hover.value = true\n    }\n\n    function onMouseleave () {\n      hover.value = false\n    }\n\n    let scrollPosition = null\n\n    watch(() => proxy.$q.lang.rtl, rtl => {\n      if (targetRef.value !== null) {\n        setHorizontalScrollPosition(\n          targetRef.value,\n          Math.abs(scroll.horizontal.position.value) * (rtl === true ? -1 : 1)\n        )\n      }\n    })\n\n    onDeactivated(() => {\n      scrollPosition = {\n        top: scroll.vertical.position.value,\n        left: scroll.horizontal.position.value\n      }\n    })\n\n    onActivated(() => {\n      if (scrollPosition === null) { return }\n\n      const scrollTarget = targetRef.value\n\n      if (scrollTarget !== null) {\n        setHorizontalScrollPosition(scrollTarget, scrollPosition.left)\n        setVerticalScrollPosition(scrollTarget, scrollPosition.top)\n      }\n    })\n\n    onBeforeUnmount(emitScroll.cancel)\n\n    // expose public methods\n    Object.assign(proxy, {\n      getScrollTarget: () => targetRef.value,\n      getScroll,\n      getScrollPosition: () => ({\n        top: scroll.vertical.position.value,\n        left: scroll.horizontal.position.value\n      }),\n      getScrollPercentage: () => ({\n        top: scroll.vertical.percentage.value,\n        left: scroll.horizontal.percentage.value\n      }),\n      setScrollPosition: localSetScrollPosition,\n      setScrollPercentage (axis, percentage, duration) {\n        localSetScrollPosition(\n          axis,\n          percentage\n            * (scroll[ axis ].size.value - container[ axis ].value)\n            * (axis === 'horizontal' && proxy.$q.lang.rtl === true ? -1 : 1),\n          duration\n        )\n      }\n    })\n\n    return () => {\n      return h('div', {\n        class: classes.value,\n        onMouseenter,\n        onMouseleave\n      }, [\n        h('div', {\n          ref: targetRef,\n          class: 'q-scrollarea__container scroll relative-position fit hide-scrollbar',\n          tabindex: props.tabindex !== void 0 ? props.tabindex : void 0\n        }, [\n          h('div', {\n            class: 'q-scrollarea__content absolute',\n            style: mainStyle.value\n          }, hMergeSlot(slots.default, [\n            h(QResizeObserver, {\n              debounce: 0,\n              onResize: updateScrollSize\n            })\n          ])),\n\n          h(QScrollObserver, {\n            axis: 'both',\n            onScroll: updateScroll\n          })\n        ]),\n\n        h(QResizeObserver, {\n          debounce: 0,\n          onResize: updateContainer\n        }),\n\n        h('div', {\n          class: scroll.vertical.barClass.value,\n          style: [ props.barStyle, props.verticalBarStyle ],\n          'aria-hidden': 'true',\n          onMousedown: onVerticalMousedown\n        }),\n\n        h('div', {\n          class: scroll.horizontal.barClass.value,\n          style: [ props.barStyle, props.horizontalBarStyle ],\n          'aria-hidden': 'true',\n          onMousedown: onHorizontalMousedown\n        }),\n\n        withDirectives(\n          h('div', {\n            ref: scroll.vertical.ref,\n            class: scroll.vertical.thumbClass.value,\n            style: scroll.vertical.style.value,\n            'aria-hidden': 'true'\n          }),\n          thumbVertDir\n        ),\n\n        withDirectives(\n          h('div', {\n            ref: scroll.horizontal.ref,\n            class: scroll.horizontal.thumbClass.value,\n            style: scroll.horizontal.style.value,\n            'aria-hidden': 'true'\n          }),\n          thumbHorizDir\n        )\n      ])\n    }\n  }\n})\n","<script setup lang=\"ts\">\nimport { Ref, computed, onMounted, ref, watch } from 'vue'\nimport { Notation } from '@decentm/allegiance-chess-core'\nimport { QScrollArea, useQuasar } from 'quasar'\n\nimport ChessPiece from './chess-piece.vue'\n\nconst props = defineProps<{\n  moveHistory: Notation.RootNode\n  activeColour: 'white' | 'black'\n  ownColour: 'white' | 'black'\n  afen: string\n}>()\n\nconst rows = computed(() => {\n  const result: Notation.Node[][] = []\n\n  props.moveHistory.children.forEach((node) => {\n    const lastRow = result.at(-1)\n\n    if (!lastRow || lastRow.length !== 1) {\n      result.push([node])\n      return\n    }\n\n    lastRow.push(node)\n  })\n\n  return result\n})\n\nconst moveHistoryScrollArea: Ref<QScrollArea | null> = ref(null)\n\nwatch(rows, () => {\n  if (!moveHistoryScrollArea.value) {\n    return\n  }\n\n  moveHistoryScrollArea.value.setScrollPosition(\n    'vertical',\n    rows.value.length * 36,\n    1000\n  )\n})\n\nonMounted(() => {\n  if (!moveHistoryScrollArea.value) {\n    return\n  }\n\n  moveHistoryScrollArea.value.setScrollPosition(\n    'vertical',\n    rows.value.length * 36,\n    1000\n  )\n})\n\nconst q = useQuasar()\n\nconst handleAFENCopy = () => {\n  if (!props.afen) {\n    return\n  }\n\n  try {\n    navigator.clipboard.writeText(props.afen)\n\n    q.notify({\n      position: 'bottom-right',\n      timeout: 4000,\n      message: 'AFEN copied to clipboard',\n      icon: 'content_copy',\n    })\n  } catch {\n    q.notify({\n      position: 'bottom-right',\n      timeout: 4000,\n      message: 'Could not write to clipboard',\n      icon: 'close',\n      iconColor: 'red',\n    })\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.white-move {\n  background-color: $chess-white;\n  color: $chess-black;\n}\n\n.black-move {\n  background-color: $chess-black;\n  color: $chess-white;\n}\n\n.highlight {\n  background-color: $chess-highlight;\n}\n</style>\n\n<template>\n  <q-card\n    flat\n    bordered\n    class=\"q-ma-md full-height column justify-between\"\n    data-testid=\"game-sidebar\"\n  >\n    <transition mode=\"out-in\">\n      <q-card-section\n        class=\"bg-primary text-white q-mb-md\"\n        v-if=\"activeColour === ownColour\"\n      >\n        <div class=\"text-h6\">Your turn!</div>\n      </q-card-section>\n\n      <q-card-section class=\"bg-grey text-black q-mb-md\" v-else>\n        <div class=\"text-h6\">Waiting for opponent...</div>\n      </q-card-section>\n    </transition>\n\n    <div class=\"spacer col\" />\n\n    <div data-testid=\"afen\">\n      <q-separator />\n\n      <q-item clickable v-ripple @click=\"handleAFENCopy\">\n        <q-item-section class=\"q-mt-sm q-mb-sm\">\n          <q-item-label>AFEN</q-item-label>\n          <q-item-label caption lines=\"2\">{{ afen }}</q-item-label>\n        </q-item-section>\n\n        <q-item-section side>\n          <q-icon name=\"edit\" />\n        </q-item-section>\n      </q-item>\n    </div>\n\n    <div data-testid=\"move-history\">\n      <q-separator />\n\n      <q-scroll-area style=\"height: 500px\" ref=\"moveHistoryScrollArea\">\n        <q-card-section\n          v-for=\"(row, index) in rows\"\n          :key=\"index\"\n          horizontal\n          class=\"row q-py-none q-mx-md\"\n          :class=\"{\n            'q-pt-md': index === 0,\n            'q-pb-md': index === rows.length - 1,\n          }\"\n        >\n          <div class=\"col\" v-if=\"row[0]\">\n            <q-chip\n              :ripple=\"false\"\n              class=\"white-move\"\n              :class=\"{\n                highlight: row[0].kind !== 'move',\n              }\"\n            >\n              <chess-piece\n                v-if=\"row[0].kind === 'move' && row[0].piece\"\n                :piece=\"row[0].piece\"\n                :allegiance=\"3\"\n                :size=\"24\"\n              />\n\n              {{ Notation.writeNode(row[0]) }}\n            </q-chip>\n          </div>\n\n          <transition mode=\"out-in\">\n            <div class=\"col\" v-if=\"row[1]\">\n              <q-chip\n                :ripple=\"false\"\n                class=\"black-move\"\n                :class=\"{\n                  highlight: row[1].kind !== 'move',\n                }\"\n              >\n                <chess-piece\n                  v-if=\"row[1].kind === 'move' && row[1].piece\"\n                  :piece=\"row[1].piece\"\n                  :allegiance=\"0\"\n                  :size=\"24\"\n                />\n\n                {{ Notation.writeNode(row[1]) }}\n              </q-chip>\n            </div>\n          </transition>\n        </q-card-section>\n      </q-scroll-area>\n    </div>\n  </q-card>\n</template>\n"],"names":["useAnchorProps","useAnchor","showing","avoidEmit","configureAnchorEl","props","proxy","emit","getCurrentInstance","anchorEl","ref","touchTimer","canShow","evt","anchorEvents","isKeyCode","prevent","nextTick","target","addEvt","clearSelection","context","evts","unconfigureAnchorEl","cleanEvt","setAnchorEl","el","pickAnchorEl","watch","val","onMounted","onBeforeUnmount","useScrollTarget","configureScrollTarget","localScrollTarget","scrollFn","changeScrollEvent","scrollTarget","fn","fnProp","fnHandler","listenOpts","unconfigureScrollTarget","noParentEventWatcher","portalProxyList","closePortalMenus","getParentProxy","parent","isOnGlobalDialog","vm","usePortal","innerRef","renderPortalContent","type","portalIsActive","portalIsAccessible","portalEl","focusObj","onGlobalDialog","showPortal","isReady","removeFocusWaitFlag","createGlobalNode","addFocusWaitFlag","hidePortal","index","removeGlobalNode","onUnmounted","injectProp","h","Teleport","useTransitionProps","useTransition","defaultShowFn","defaultHideFn","computed","show","hide","useTick","tickFn","removeTick","onDeactivated","vmIsDestroyed","handlers","escDown","onKeydown","onBlur","onKeyup","update","action","addEscapeKey","client","removeEscapeKey","trigger","addFocusout","removeFocusout","notPassiveCapture","registeredList","globalHandler","portalIndex","i","state","addClickOutside","clickOutsideProps","removeClickOutside","vpLeft","vpTop","validatePosition","pos","parts","validateOffset","horizontalPos","parsePosition","rtl","getAnchorProps","offset","top","left","right","bottom","width","height","getAbsoluteAnchorProps","absoluteOffset","getTargetProps","getTopLeftProps","anchorProps","targetProps","anchorOrigin","selfOrigin","setPosition","cfg","retryNumber","targetEl","fit","cover","maxHeight","maxWidth","scrollLeft","scrollTop","origElWidth","origElHeight","elWidth","elHeight","elStyle","applyBoundaries","hasChanged","offsetY","offsetX","currentHeight","currentWidth","margin","getScrollbarWidth","innerHeight","innerWidth","anchorY","anchorX","QMenu","createComponent","useModelToggleProps","useDarkProps","useModelToggleEmits","slots","attrs","refocusTarget","unwatchPosition","avoidAutoClose","$q","hideOnRouteChange","isDark","useDark","registerTick","registerTimeout","useTimeout","transitionProps","transitionStyle","useModelToggle","handleShow","handleHide","renderPortal","e","stopAndPrevent","menuClass","onEvents","onAutoClose","handlesFocus","onEscapeKey","focus","addFocusFn","node","onFocusout","position","updatePosition","anchorCleanup","hiding","getScrollTarget","childHasFocus","Transition","hSlot","pieces","handleDismiss","captureFocus","enPassantTarget","showPromotionPopup","promotionAllegiance","focusedSquare","highlightSquares","isOpponent","coords","square","allegianceSide","isHighlighted","coordinate","coordinatesEqual","handleCoordsClick","event","isPromotion","fromSquare","_a","_b","handlePromotion","piece","handlePromotionDismiss","handleCaptureDismiss","handleCaptureClick","decision","indexToCoords","fileIndex","rankIndex","rawFile","rawRank","coordsEmpty","canMove","from","to","move","captureMoves","result","checkMoves","isChecked","q","useQuasar","squareSize","pieceFocus","handleExcuteNode","lastMove","defaultSizes","QChip","useSizeProps","sizeStyle","useSize","hasLeftIcon","leftIcon","removeIcon","isClickable","classes","text","attributes","chip","remove","onClick","onRemove","getContent","child","QIcon","label","hMergeSlotSafely","data","hDir","Ripple","axisList","dirProps","panOpts","getMinThumbSize","size","QScrollArea","tempShowing","panning","hover","container","scroll","timer","panRefPos","targetRef","diff","p","between","mainStyle","thumbVertDir","TouchPan","onPanThumb","thumbHorizDir","getScroll","info","axis","emitScroll","debounce","localSetScrollPosition","duration","setVerticalScrollPosition","setHorizontalScrollPosition","updateContainer","change","startTimer","updateScroll","updateScrollSize","dProp","containerSize","multiplier","distance","setScroll","onMousedown","onVerticalMousedown","onHorizontalMousedown","onMouseenter","onMouseleave","scrollPosition","onActivated","percentage","hMergeSlot","QResizeObserver","QScrollObserver","withDirectives","rows","lastRow","moveHistoryScrollArea","handleAFENCopy"],"mappings":"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"}