{"version":3,"file":"pen-pal-game.85b864b6.js","sources":["../../../../../src/pages/play/pen-pal-game.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { useRoute, useRouter } from 'vue-router'\nimport { computed, onMounted, watch } from 'vue'\nimport { useQuasar } from 'quasar'\n\nimport GameLayout from '../../components/game-layout.vue'\n\nimport ChessBoard from '../../components/chess-board.vue'\nimport GameSidebar from '../../components/game-sidebar.vue'\nimport GameOverDialog from '../../components/game-over-dialog.vue'\n\nimport { Hex } from '../../lib/hex'\nimport { useBoardWorker } from '../../hooks/board-worker'\n\nconst route = useRoute()\nconst router = useRouter()\n\nconst board = useBoardWorker({\n  autoplayFor: [],\n})\n\nconst state = computed<{ afen: string; history: string }>(() => {\n  try {\n    const result = Array.isArray(route.params.state)\n      ? route.params.state[0]\n      : route.params.state\n\n    return JSON.parse(Hex.hexToUtf8(result))\n  } catch {\n    return {\n      afen: '',\n      history: '',\n    }\n  }\n})\n\nonMounted(() => {\n  board.reset()\n\n  if (state.value.afen) board.importAfen(state.value.afen)\n  if (state.value.history) board.importMoveHistory(state.value.history)\n})\n\nconst handleExecuteNodeIndex = (index: number) => {\n  board.executeMoveIndex(index)\n}\n\nwatch(board.loading, (newLoading) => {\n  if (newLoading) {\n    return\n  }\n\n  router.push({\n    path: `/play/pen-pal/${Hex.utf8ToHex(\n      JSON.stringify({\n        afen: board.afen.value,\n        history: board.moveHistory.value,\n      })\n    )}`,\n  })\n})\n\nconst q = useQuasar()\n</script>\n\n<template>\n  <game-layout>\n    <template #board>\n      <chess-board\n        @execute-node-index=\"handleExecuteNodeIndex\"\n        :board=\"board\"\n        :perspective=\"board.activeColour.value\"\n        :active-colour=\"board.activeColour.value\"\n        :check-moves=\"board.checkMoves.value\"\n        :en-passant-target=\"board.enPassantTarget.value\"\n        :move-history-ast=\"board.moveHistoryAst.value\"\n        :squares=\"board.squares.value\"\n        :valid-moves=\"board.validMoves.value\"\n        :play-as=\"['white', 'black']\"\n        :rounded-borders=\"q.screen.gt.xs\"\n        :loading=\"board.loading.value\"\n      />\n    </template>\n\n    <template #sidebar>\n      <game-sidebar\n        :move-history=\"board.moveHistoryAst.value\"\n        :active-colour=\"board.activeColour.value\"\n        :own-colour=\"board.activeColour.value\"\n        :afen=\"board.afen.value\"\n        :game-over=\"board.gameOver.value\"\n      />\n    </template>\n\n    <template #default>\n      <game-over-dialog\n        v-if=\"board.gameOver.value\"\n        :node=\"board.gameOver.value\"\n      />\n    </template>\n  </game-layout>\n</template>\n"],"names":["route","useRoute","router","useRouter","board","useBoardWorker","state","computed","result","Hex","onMounted","handleExecuteNodeIndex","index","watch","newLoading","q","useQuasar"],"mappings":"6lBAcA,MAAMA,EAAQC,IACRC,EAASC,IAETC,EAAQC,EAAe,CAC3B,YAAa,CAAC,CAAA,CACf,EAEKC,EAAQC,EAA4C,IAAM,CAC1D,GAAA,CACF,MAAMC,EAAS,MAAM,QAAQR,EAAM,OAAO,KAAK,EAC3CA,EAAM,OAAO,MAAM,GACnBA,EAAM,OAAO,MAEjB,OAAO,KAAK,MAAMS,EAAI,UAAUD,CAAM,CAAC,CAAA,MACvC,CACO,MAAA,CACL,KAAM,GACN,QAAS,EAAA,CAEb,CAAA,CACD,EAEDE,EAAU,IAAM,CACdN,EAAM,MAAM,EAERE,EAAM,MAAM,MAAYF,EAAA,WAAWE,EAAM,MAAM,IAAI,EACnDA,EAAM,MAAM,SAAeF,EAAA,kBAAkBE,EAAM,MAAM,OAAO,CAAA,CACrE,EAEK,MAAAK,EAA0BC,GAAkB,CAChDR,EAAM,iBAAiBQ,CAAK,CAAA,EAGxBC,EAAAT,EAAM,QAAUU,GAAe,CAC/BA,GAIJZ,EAAO,KAAK,CACV,KAAM,iBAAiBO,EAAI,UACzB,KAAK,UAAU,CACb,KAAML,EAAM,KAAK,MACjB,QAASA,EAAM,YAAY,KAAA,CAC5B,CAAA,GACH,CACD,CAAA,CACF,EAED,MAAMW,EAAIC"}