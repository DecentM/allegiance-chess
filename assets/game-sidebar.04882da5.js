import{E as U,F as b,J as $,O as V,K as N,_ as ae,r as M,ac as st,a6 as Re,q as ut,a4 as Ve,w as G,p as ct,o as ue,j as ce,a9 as kt,m as Fe,au as we,D as qt,ao as wt,h as F,av as Ct,aw as $t,ax as Tt,a as g,$ as dt,a0 as Mt,k as xe,c as Ae,a8 as Pt,e as Et,ad as He,ay as Ft,s as vt,G as x,I as T,L as C,z as le,U as K,t as pe,az as Le,T as X,aj as ge,S as A,af as R,aA as Ht,aB as Bt,u as xt,aC as At,an as Lt,aq as Dt,x as Ot,M as he,N as Ce,as as Wt,at as Qt}from"./index.8d9c83aa.js";import{G as Rt,p as Vt,t as Nt,w as jt,a as Kt,c as D,i as $e,b as Gt}from"./board.64d623de.js";import{b as be,a as se,Q as ft}from"./QList.c12061ea.js";import{j as Ut,f as Yt,u as Xt,b as Jt,c as Zt,d as It,k as el,e as me,Q as Ne,i as tl,s as je,l as Te,T as Ke}from"./QScrollObserver.fbcc7a2d.js";import{u as De,a as Oe}from"./use-dark.20efcb0d.js";import{b as Ge,c as ll,a as ol}from"./focus-manager.202af5b7.js";import{C as ye,Q as Ue}from"./chess-piece.4f2e33e2.js";import{u as ht}from"./use-quasar.66729495.js";import{Q as al,a as Me,b as Ye}from"./QCard.f4e8267a.js";var Xe=Object.freeze(Object.defineProperty({__proto__:null,GameOutcome:Rt,parse:Vt,tokenize:Nt,writeNode:jt,write:Kt},Symbol.toStringTag,{value:"Module"}));const il={class:"row column full-width full-height no-pointer-events background-layer","data-testid":"background"},nl=U({__name:"background-layer",props:{ranks:{},files:{}},setup(e){return(l,t)=>(b(),$("div",il,[(b(!0),$(V,null,N(l.ranks,(a,n)=>(b(),$("div",{class:"rank col row full-width",key:n},[(b(!0),$(V,null,N(l.files,(u,i)=>(b(),$("div",{key:i,class:"file col"}))),128))]))),128))]))}});var rl=ae(nl,[["__scopeId","data-v-34ddfc50"]]);const sl={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function ul({showing:e,avoidEmit:l,configureAnchorEl:t}){const{props:a,proxy:n,emit:u}=ce(),i=M(null);let o=null;function r(s){return i.value===null?!1:s===void 0||s.touches===void 0||s.touches.length<=1}const v={};t===void 0&&(Object.assign(v,{hide(s){n.hide(s)},toggle(s){n.toggle(s),s.qAnchorHandled=!0},toggleKey(s){st(s,13)===!0&&v.toggle(s)},contextClick(s){n.hide(s),Re(s),ut(()=>{n.show(s),s.qAnchorHandled=!0})},prevent:Re,mobileTouch(s){if(v.mobileCleanup(s),r(s)!==!0)return;n.hide(s),i.value.classList.add("non-selectable");const m=s.target;Ve(v,"anchor",[[m,"touchmove","mobileCleanup","passive"],[m,"touchend","mobileCleanup","passive"],[m,"touchcancel","mobileCleanup","passive"],[i.value,"contextmenu","prevent","notPassive"]]),o=setTimeout(()=>{o=null,n.show(s),s.qAnchorHandled=!0},300)},mobileCleanup(s){i.value.classList.remove("non-selectable"),o!==null&&(clearTimeout(o),o=null),e.value===!0&&s!==void 0&&Ut()}}),t=function(s=a.contextMenu){if(a.noParentEvent===!0||i.value===null)return;let m;s===!0?n.$q.platform.is.mobile===!0?m=[[i.value,"touchstart","mobileTouch","passive"]]:m=[[i.value,"mousedown","hide","passive"],[i.value,"contextmenu","contextClick","notPassive"]]:m=[[i.value,"click","toggle","passive"],[i.value,"keyup","toggleKey","passive"]],Ve(v,"anchor",m)});function h(){kt(v,"anchor")}function _(s){for(i.value=s;i.value.classList.contains("q-anchor--skip");)i.value=i.value.parentNode;t()}function q(){if(a.target===!1||a.target===""||n.$el.parentNode===null)i.value=null;else if(a.target===!0)_(n.$el.parentNode);else{let s=a.target;if(typeof a.target=="string")try{s=document.querySelector(a.target)}catch{s=void 0}s!=null?(i.value=s.$el||s,t()):(i.value=null,console.error(`Anchor: target "${a.target}" not found`))}}return G(()=>a.contextMenu,s=>{i.value!==null&&(h(),t(s))}),G(()=>a.target,()=>{i.value!==null&&h(),q()}),G(()=>a.noParentEvent,s=>{i.value!==null&&(s===!0?h():t())}),ct(()=>{q(),l!==!0&&a.modelValue===!0&&i.value===null&&u("update:modelValue",!1)}),ue(()=>{o!==null&&clearTimeout(o),h()}),{anchorEl:i,canShow:r,anchorEvents:v}}function cl(e,l){const t=M(null);let a;function n(o,r){const v=`${r!==void 0?"add":"remove"}EventListener`,h=r!==void 0?r:a;o!==window&&o[v]("scroll",h,Fe.passive),window[v]("scroll",h,Fe.passive),a=r}function u(){t.value!==null&&(n(t.value),t.value=null)}const i=G(()=>e.noParentEvent,()=>{t.value!==null&&(u(),l())});return ue(i),{localScrollTarget:t,unconfigureScrollTarget:u,changeScrollEvent:n}}const re=[];function dl(e,l){do{if(e.$options.name==="QMenu"){if(e.hide(l),e.$props.separateClosePopup===!0)return we(e)}else if(e.__qPortal===!0){const t=we(e);return t!==void 0&&t.$options.name==="QPopupProxy"?(e.hide(l),t):e}e=we(e)}while(e!=null)}function vl(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function fl(e,l,t,a){const n=M(!1),u=M(!1);let i=null;const o={},r=a==="dialog"&&vl(e);function v(_){if(_===!0){Ge(o),u.value=!0;return}u.value=!1,n.value===!1&&(r===!1&&i===null&&(i=$t(!1,a)),n.value=!0,re.push(e.proxy),ll(o))}function h(_){if(u.value=!1,_!==!0)return;Ge(o),n.value=!1;const q=re.indexOf(e.proxy);q!==-1&&re.splice(q,1),i!==null&&(Tt(i),i=null)}return qt(()=>{h(!0)}),e.proxy.__qPortal=!0,wt(e.proxy,"contentEl",()=>l.value),{showPortal:v,hidePortal:h,portalIsActive:n,portalIsAccessible:u,renderPortal:()=>r===!0?t():n.value===!0?[F(Ct,{to:i},t())]:void 0}}const hl={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function ml(e,l=()=>{},t=()=>{}){return{transitionProps:g(()=>{const a=`q-transition--${e.transitionShow||l()}`,n=`q-transition--${e.transitionHide||t()}`;return{appear:!0,enterFromClass:`${a}-enter-from`,enterActiveClass:`${a}-enter-active`,enterToClass:`${a}-enter-to`,leaveFromClass:`${n}-leave-from`,leaveActiveClass:`${n}-leave-active`,leaveToClass:`${n}-leave-to`}}),transitionStyle:g(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}function pl(){let e;const l=ce();function t(){e=void 0}return dt(t),ue(t),{removeTick:t,registerTick(a){e=a,ut(()=>{e===a&&(Mt(l)===!1&&e(),e=void 0)})}}}const J=[];let oe;function gl(e){oe=e.keyCode===27}function bl(){oe===!0&&(oe=!1)}function yl(e){oe===!0&&(oe=!1,st(e,27)===!0&&J[J.length-1](e))}function mt(e){window[e]("keydown",gl),window[e]("blur",bl),window[e]("keyup",yl),oe=!1}function _l(e){xe.is.desktop===!0&&(J.push(e),J.length===1&&mt("addEventListener"))}function Je(e){const l=J.indexOf(e);l>-1&&(J.splice(l,1),J.length===0&&mt("removeEventListener"))}const Z=[];function pt(e){Z[Z.length-1](e)}function Sl(e){xe.is.desktop===!0&&(Z.push(e),Z.length===1&&document.body.addEventListener("focusin",pt))}function zl(e){const l=Z.indexOf(e);l>-1&&(Z.splice(l,1),Z.length===0&&document.body.removeEventListener("focusin",pt))}const{notPassiveCapture:_e}=Fe,I=[];function Se(e){const l=e.target;if(l===void 0||l.nodeType===8||l.classList.contains("no-pointer-events")===!0)return;let t=re.length-1;for(;t>=0;){const a=re[t].$;if(a.type.name==="QTooltip"){t--;continue}if(a.type.name!=="QDialog")break;if(a.props.seamless!==!0)return;t--}for(let a=I.length-1;a>=0;a--){const n=I[a];if((n.anchorEl.value===null||n.anchorEl.value.contains(l)===!1)&&(l===document.body||n.innerRef.value!==null&&n.innerRef.value.contains(l)===!1))e.qClickOutside=!0,n.onClickOutside(e);else return}}function kl(e){I.push(e),I.length===1&&(document.addEventListener("mousedown",Se,_e),document.addEventListener("touchstart",Se,_e))}function Ze(e){const l=I.findIndex(t=>t===e);l>-1&&(I.splice(l,1),I.length===0&&(document.removeEventListener("mousedown",Se,_e),document.removeEventListener("touchstart",Se,_e)))}let Ie,et;function tt(e){const l=e.split(" ");return l.length!==2?!1:["top","center","bottom"].includes(l[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(l[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function ql(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const Be={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{Be[`${e}#ltr`]=e,Be[`${e}#rtl`]=e});function lt(e,l){const t=e.split(" ");return{vertical:t[0],horizontal:Be[`${t[1]}#${l===!0?"rtl":"ltr"}`]}}function wl(e,l){let{top:t,left:a,right:n,bottom:u,width:i,height:o}=e.getBoundingClientRect();return l!==void 0&&(t-=l[1],a-=l[0],u+=l[1],n+=l[0],i+=l[0],o+=l[1]),{top:t,bottom:u,height:o,left:a,right:n,width:i,middle:a+(n-a)/2,center:t+(u-t)/2}}function Cl(e,l,t){let{top:a,left:n}=e.getBoundingClientRect();return a+=l.top,n+=l.left,t!==void 0&&(a+=t[1],n+=t[0]),{top:a,bottom:a+1,height:1,left:n,right:n+1,width:1,middle:n,center:a}}function $l(e,l){return{top:0,center:l/2,bottom:l,left:0,middle:e/2,right:e}}function ot(e,l,t,a){return{top:e[t.vertical]-l[a.vertical],left:e[t.horizontal]-l[a.horizontal]}}function gt(e,l=0){if(e.targetEl===null||e.anchorEl===null||l>5)return;if(e.targetEl.offsetHeight===0||e.targetEl.offsetWidth===0){setTimeout(()=>{gt(e,l+1)},10);return}const{targetEl:t,offset:a,anchorEl:n,anchorOrigin:u,selfOrigin:i,absoluteOffset:o,fit:r,cover:v,maxHeight:h,maxWidth:_}=e;if(xe.is.ios===!0&&window.visualViewport!==void 0){const E=document.body.style,{offsetLeft:p,offsetTop:P}=window.visualViewport;p!==Ie&&(E.setProperty("--q-pe-left",p+"px"),Ie=p),P!==et&&(E.setProperty("--q-pe-top",P+"px"),et=P)}const{scrollLeft:q,scrollTop:s}=t,m=o===void 0?wl(n,v===!0?[0,0]:a):Cl(n,o,a);Object.assign(t.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:_||"100vw",maxHeight:h||"100vh",visibility:"visible"});const{offsetWidth:L,offsetHeight:f}=t,{elWidth:B,elHeight:Q}=r===!0||v===!0?{elWidth:Math.max(m.width,L),elHeight:v===!0?Math.max(m.height,f):f}:{elWidth:L,elHeight:f};let H={maxWidth:_,maxHeight:h};(r===!0||v===!0)&&(H.minWidth=m.width+"px",v===!0&&(H.minHeight=m.height+"px")),Object.assign(t.style,H);const d=$l(B,Q);let S=ot(m,d,u,i);if(o===void 0||a===void 0)Pe(S,m,d,u,i);else{const{top:E,left:p}=S;Pe(S,m,d,u,i);let P=!1;if(S.top!==E){P=!0;const k=2*a[1];m.center=m.top-=k,m.bottom-=k+2}if(S.left!==p){P=!0;const k=2*a[0];m.middle=m.left-=k,m.right-=k+2}P===!0&&(S=ot(m,d,u,i),Pe(S,m,d,u,i))}H={top:S.top+"px",left:S.left+"px"},S.maxHeight!==void 0&&(H.maxHeight=S.maxHeight+"px",m.height>S.maxHeight&&(H.minHeight=H.maxHeight)),S.maxWidth!==void 0&&(H.maxWidth=S.maxWidth+"px",m.width>S.maxWidth&&(H.minWidth=H.maxWidth)),Object.assign(t.style,H),t.scrollTop!==s&&(t.scrollTop=s),t.scrollLeft!==q&&(t.scrollLeft=q)}function Pe(e,l,t,a,n){const u=t.bottom,i=t.right,o=Yt(),r=window.innerHeight-o,v=document.body.clientWidth;if(e.top<0||e.top+u>r)if(n.vertical==="center")e.top=l[a.vertical]>r/2?Math.max(0,r-u):0,e.maxHeight=Math.min(u,r);else if(l[a.vertical]>r/2){const h=Math.min(r,a.vertical==="center"?l.center:a.vertical===n.vertical?l.bottom:l.top);e.maxHeight=Math.min(u,h),e.top=Math.max(0,h-u)}else e.top=Math.max(0,a.vertical==="center"?l.center:a.vertical===n.vertical?l.top:l.bottom),e.maxHeight=Math.min(u,r-e.top);if(e.left<0||e.left+i>v)if(e.maxWidth=Math.min(i,v),n.horizontal==="middle")e.left=l[a.horizontal]>v/2?Math.max(0,v-i):0;else if(l[a.horizontal]>v/2){const h=Math.min(v,a.horizontal==="middle"?l.middle:a.horizontal===n.horizontal?l.right:l.left);e.maxWidth=Math.min(i,h),e.left=Math.max(0,h-e.maxWidth)}else e.left=Math.max(0,a.horizontal==="middle"?l.middle:a.horizontal===n.horizontal?l.left:l.right),e.maxWidth=Math.min(i,v-e.left)}var bt=Ae({name:"QMenu",inheritAttrs:!1,props:{...sl,...Xt,...De,...hl,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:tt},self:{type:String,validator:tt},offset:{type:Array,validator:ql},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...Jt,"click","escapeKey"],setup(e,{slots:l,emit:t,attrs:a}){let n=null,u,i,o;const r=ce(),{proxy:v}=r,{$q:h}=v,_=M(null),q=M(!1),s=g(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),m=Oe(e,h),{registerTick:L,removeTick:f}=pl(),{registerTimeout:B}=Zt(),{transitionProps:Q,transitionStyle:H}=ml(e),{localScrollTarget:d,changeScrollEvent:S,unconfigureScrollTarget:E}=cl(e,fe),{anchorEl:p,canShow:P}=ul({showing:q}),{hide:k}=It({showing:q,canShow:P,handleShow:te,handleHide:ze,hideOnRouteChange:s,processOnMount:!0}),{showPortal:Y,hidePortal:W,renderPortal:j}=fl(r,_,_t,"menu"),ie={anchorEl:p,innerRef:_,onClickOutside(z){if(e.persistent!==!0&&q.value===!0)return k(z),(z.type==="touchstart"||z.target.classList.contains("q-dialog__backdrop"))&&vt(z),!0}},de=g(()=>lt(e.anchor||(e.cover===!0?"center middle":"bottom start"),h.lang.rtl)),ee=g(()=>e.cover===!0?de.value:lt(e.self||"top start",h.lang.rtl)),c=g(()=>(e.square===!0?" q-menu--square":"")+(m.value===!0?" q-menu--dark q-dark":"")),y=g(()=>e.autoClose===!0?{onClick:yt}:{}),w=g(()=>q.value===!0&&e.persistent!==!0);G(w,z=>{z===!0?(_l(ke),kl(ie)):(Je(ke),Ze(ie))});function O(){ol(()=>{let z=_.value;z&&z.contains(document.activeElement)!==!0&&(z=z.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||z.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||z.querySelector("[autofocus], [data-autofocus]")||z,z.focus({preventScroll:!0}))})}function te(z){if(n=e.noRefocus===!1?document.activeElement:null,Sl(Qe),Y(),fe(),u=void 0,z!==void 0&&(e.touchPosition||e.contextMenu)){const qe=Pt(z);if(qe.left!==void 0){const{top:St,left:zt}=p.value.getBoundingClientRect();u={left:qe.left-zt,top:qe.top-St}}}i===void 0&&(i=G(()=>h.screen.width+"|"+h.screen.height+"|"+e.self+"|"+e.anchor+"|"+h.lang.rtl,ne)),e.noFocus!==!0&&document.activeElement.blur(),L(()=>{ne(),e.noFocus!==!0&&O()}),B(()=>{h.platform.is.ios===!0&&(o=e.autoClose,_.value.click()),ne(),Y(!0),t("show",z)},e.transitionDuration)}function ze(z){f(),W(),ve(!0),n!==null&&(z===void 0||z.qClickOutside!==!0)&&(((z&&z.type.indexOf("key")===0?n.closest('[tabindex]:not([tabindex^="-"])'):void 0)||n).focus(),n=null),B(()=>{W(!0),t("hide",z)},e.transitionDuration)}function ve(z){u=void 0,i!==void 0&&(i(),i=void 0),(z===!0||q.value===!0)&&(zl(Qe),E(),Ze(ie),Je(ke)),z!==!0&&(n=null)}function fe(){(p.value!==null||e.scrollTarget!==void 0)&&(d.value=el(p.value,e.scrollTarget),S(d.value,ne))}function yt(z){o!==!0?(dl(v,z),t("click",z)):o=!1}function Qe(z){w.value===!0&&e.noFocus!==!0&&Ft(_.value,z.target)!==!0&&O()}function ke(z){t("escapeKey"),k(z)}function ne(){gt({targetEl:_.value,offset:e.offset,anchorEl:p.value,anchorOrigin:de.value,selfOrigin:ee.value,absoluteOffset:u,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function _t(){return F(He,Q.value,()=>q.value===!0?F("div",{role:"menu",...a,ref:_,tabindex:-1,class:["q-menu q-position-engine scroll"+c.value,a.class],style:[a.style,H.value],...y.value},Et(l.default)):null)}return ue(ve),Object.assign(v,{focus:O,updatePosition:ne}),j}});const Tl=U({__name:"promotion-selector",props:{modelValue:{type:Boolean},allegiance:{}},emits:["click","dismiss"],setup(e,{emit:l}){const t=["Q","N","R","B"],a=()=>{l("dismiss")};return(n,u)=>(b(),x(bt,{cover:"","model-value":n.modelValue,"onUpdate:modelValue":a},{default:T(()=>[C(ft,null,{default:T(()=>[(b(),$(V,null,N(t,i=>C(be,{clickable:"",key:i,class:"q-pa-sm",onClick:o=>l("click",i)},{default:T(()=>[C(se,{class:"promotion-piece items-center"},{default:T(()=>[C(ye,{allegiance:n.allegiance,piece:i,size:92},null,8,["allegiance","piece"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1},8,["model-value"]))}});var Ml=ae(Tl,[["__scopeId","data-v-370c2c26"]]);const Pl=U({__name:"capture-selector",props:{modelValue:{type:Boolean},moves:{}},emits:["click","dismiss"],setup(e,{emit:l}){const t=()=>{l("dismiss")};return(a,n)=>(b(),x(bt,{cover:"","model-value":a.modelValue,"onUpdate:modelValue":t},{default:T(()=>[C(ft,null,{default:T(()=>[a.moves.includes("x")?(b(),x(be,{key:0,clickable:"",onClick:n[0]||(n[0]=u=>l("click","capture")),class:"q-py-lg"},{default:T(()=>[C(se,{class:"items-center"},{default:T(()=>[C(le,{size:"72px",name:"close"})]),_:1})]),_:1})):K("",!0),a.moves.includes(">")?(b(),x(be,{key:1,clickable:"",onClick:n[1]||(n[1]=u=>l("click","challenge")),class:"q-py-lg"},{default:T(()=>[C(se,{class:"items-center"},{default:T(()=>[C(le,{size:"64px",name:"arrow_forward_ios"})]),_:1})]),_:1})):K("",!0)]),_:1})]),_:1},8,["model-value"]))}});const El={class:"relative-position full-width full-height interaction-layer"},Fl=["onClick"],Hl=U({__name:"interaction-layer",props:{board:{},squareSize:{},ranks:{},files:{},perspective:{},pieceFocus:{}},emits:["execute-node","update-piece-focus","update-highlights"],setup(e,{emit:l}){const t=e,a=M(null),n=g(()=>t.board.enPassantTarget),u=M(null),i=M(null),o=g(()=>t.pieceFocus?t.board.getSquare(t.pieceFocus):null),r=g(()=>t.pieceFocus?t.board.getValidMoves(t.pieceFocus).map(E=>E.kind!=="move"?null:E.to).filter(Boolean):[]),v=d=>{const S=t.board.getSquare(d);return S?Gt(S.allegiance)!==t.perspective:!1},h=d=>r.value.some(S=>S&&D(d,S)),_=(d,S)=>{var p,P;if(S.stopPropagation(),S.preventDefault(),h(d)&&t.pieceFocus&&o.value){if(n.value&&D(n.value,d))l("execute-node",{kind:"move",type:"en-passant",from:t.pieceFocus,to:d}),l("update-piece-focus",null);else if($e(d,t.board.activeColour)&&o&&o.value.piece===null){u.value=d;const k=t.board.getSquare(t.pieceFocus);i.value=(p=k==null?void 0:k.allegiance)!=null?p:null}else t.board.getSquare(d)?a.value=d:((P=o.value)==null?void 0:P.piece)==="K"&&Math.abs(t.pieceFocus.file-d.file)>1?l("execute-node",{kind:"move",type:"castle",side:d.file===7?"king":"queen",from:t.pieceFocus,to:d}):l("execute-node",{kind:"move",from:t.pieceFocus,to:d});return}if(v(d))return;const E=t.board.getSquare(d);l("update-piece-focus",E?d:null)},q=(d,S)=>{!t.pieceFocus||(u.value=null,l("execute-node",{kind:"move",type:"promotion",from:t.pieceFocus,to:d,promotionTo:S}),l("update-piece-focus",null))},s=()=>{u.value=null,i.value=null},m=()=>{a.value=null},L=d=>{!t.pieceFocus||!a.value||(d==="capture"?l("execute-node",{kind:"move",type:"capture",from:t.pieceFocus,to:a.value}):l("execute-node",{kind:"move",type:"allegiance",from:t.pieceFocus,to:a.value}),a.value=null,l("update-piece-focus",null))},f=(d,S)=>{const E=d+1,p=S+1;return t.perspective==="white"?{file:E,rank:9-p}:{file:9-E,rank:p}},B=d=>!t.board.getSquare(d),Q=(d,S,E)=>t.board.getValidMoves().some(P=>P.kind==="move"&&D(P.to,E)&&D(P.from,S)&&P.type===d),H=g(()=>{const d=[];return!t.pieceFocus||!a.value||(Q("allegiance",t.pieceFocus,a.value)&&d.push(">"),Q("capture",t.pieceFocus,a.value)&&d.push("x")),d});return(d,S)=>(b(),$("div",El,[(b(!0),$(V,null,N(d.ranks,(E,p)=>(b(),$("div",{class:"col column row full-width",key:p},[(b(!0),$(V,null,N(d.files,(P,k)=>{var Y,W;return b(),$("div",{key:k,class:"full-height"},[pe((b(),$("div",{class:X(["absolute",{"cursor-pointer":!B(f(k,p))||h(f(k,p)),"cursor-not-allowed":v(f(k,p))&&!o.value}]),onClick:j=>_(f(k,p),j),style:ge(d.perspective==="white"?{width:`${d.squareSize}px`,height:`${d.squareSize}px`,left:`${(f(k,p).file-1)*d.squareSize}px`,bottom:`${(f(k,p).rank-1)*d.squareSize}px`}:{width:`${d.squareSize}px`,height:`${d.squareSize}px`,right:`${(f(k,p).file-1)*d.squareSize}px`,top:`${(f(k,p).rank-1)*d.squareSize}px`})},[a.value&&A(D)(a.value,f(k,p))?(b(),x(Pl,{key:0,moves:H.value,"model-value":(Y=A(D)(a.value,f(k,p)))!=null?Y:!1,size:d.squareSize,onClick:L,onDismiss:m},null,8,["moves","model-value","size"])):K("",!0),i.value!==null&&(A($e)(f(k,p),"white")||A($e)(f(k,p),"black"))?(b(),x(Ml,{key:1,"model-value":(W=A(D)(u.value,f(k,p)))!=null?W:!1,allegiance:i.value,size:d.squareSize,onClick:j=>q(f(k,p),j),onDismiss:s},null,8,["model-value","allegiance","size","onClick"])):K("",!0)],14,Fl)),[[Le,!B(f(k,p))&&!v(f(k,p))]])])}),128))]))),128))]))}});var Bl=ae(Hl,[["__scopeId","data-v-40d593bc"]]);const xl={class:"relative-position full-width full-height column no-pointer-events indicators-layer"},Al=U({__name:"indicators-layer",props:{board:{},ranks:{},files:{},squareSize:{},perspective:{},pieceFocus:{},lastMove:{}},setup(e){const l=e,t=g(()=>l.pieceFocus?l.board.getValidMoves(l.pieceFocus).map(h=>h.kind!=="move"?null:h.to).filter(Boolean):[]),a=r=>t.value.some(v=>v&&D(r,v)),n=r=>!l.board.getSquare(r),u=(r,v)=>{const h=r+1,_=v+1;return l.perspective==="white"?{file:h,rank:9-_}:{file:9-h,rank:_}},i=g(()=>l.board.getCheckMoves()),o=r=>i.value.some(v=>v.kind==="move"&&D(v.to,r));return(r,v)=>(b(),$("div",xl,[(b(!0),$(V,null,N(r.ranks,(h,_)=>(b(),$("div",{class:"col column row full-width",key:_},[(b(!0),$(V,null,N(r.files,(q,s)=>{var m,L;return b(),$("div",{key:s,class:X(["full-height move-placeholder",{even:_%2===0?s%2===0:s%2!==0,focus:A(D)(r.pieceFocus,u(s,_)),show:a(u(s,_)),capture:!n(u(s,_)),target:n(u(s,_)),checked:o(u(s,_)),"last-from":((m=r.lastMove)==null?void 0:m.kind)==="move"&&A(D)(r.lastMove.from,u(s,_)),"last-to":((L=r.lastMove)==null?void 0:L.kind)==="move"&&A(D)(r.lastMove.to,u(s,_))}])},null,2)}),128))]))),128))]))}});var Ll=ae(Al,[["__scopeId","data-v-b504cbe8"]]);const Dl={class:"relative-position full-width full-height no-pointer-events pieces-layer"},Ol=U({__name:"pieces-layer",props:{modelValue:{},squareSize:{},perspective:{}},setup(e){const l=ht();return(t,a)=>(b(),$("div",Dl,[(b(!0),$(V,null,N(t.modelValue,(n,u)=>(b(),$("div",{key:u},[n?(b(),x(ye,{key:0,"data-testid":"piece",class:X(["absolute",{"q-pa-xs":A(l).screen.sm||A(l).screen.md,"q-pa-sm":A(l).screen.gt.sm}]),piece:n.piece,allegiance:n.allegiance,size:t.squareSize,style:ge(t.perspective==="white"?{left:`${(n.file-1)*t.squareSize}px`,bottom:`${(n.rank-1)*t.squareSize}px`}:{right:`${(n.file-1)*t.squareSize}px`,top:`${(n.rank-1)*t.squareSize}px`})},null,8,["class","piece","allegiance","size","style"])):(b(),$("div",{key:1,style:ge({width:`${t.squareSize}px`,height:`${t.squareSize}px`})},null,4))]))),128))]))}});var Wl=ae(Ol,[["__scopeId","data-v-32a0cdca"]]);const Ql={class:"absolute full-width full-height"},Rl={class:"absolute full-width full-height"},Vl={class:"absolute full-width full-height"},Nl={class:"absolute full-width full-height"},co=U({__name:"chess-board",props:{board:{},width:{},perspective:{},playAs:{},roundedBorders:{type:Boolean}},emits:["execute-node"],setup(e,{emit:l}){const t=e,a=g(()=>t.width/8),n=M(null),u=o=>{l("execute-node",o),n.value=null},i=g(()=>{var r;return(r=t.board.getMoveHistoryAst().children.at(-1))!=null?r:null});return(o,r)=>(b(),$("div",{"data-testid":"chess-board",class:X(["relative-position column",{"rounded-borders overflow-hidden":o.roundedBorders}]),style:ge({width:t.width+"px",height:t.width+"px"})},[R("div",Ql,[C(rl,{ranks:8,files:8})]),R("div",Rl,[C(Ll,{board:o.board,"square-size":a.value,files:8,ranks:8,perspective:o.perspective,"piece-focus":n.value,"last-move":i.value},null,8,["board","square-size","perspective","piece-focus","last-move"])]),R("div",Vl,[C(Wl,{"model-value":o.board.getSquares(),perspective:t.perspective,"square-size":a.value},null,8,["model-value","perspective","square-size"])]),R("div",Nl,[C(Bl,{onExecuteNode:u,onUpdatePieceFocus:r[0]||(r[0]=v=>n.value=v),"piece-focus":n.value,board:o.board,"square-size":a.value,files:8,ranks:8,perspective:t.perspective},null,8,["piece-focus","board","square-size","perspective"])])],6))}}),jl={xs:8,sm:10,md:14,lg:20,xl:24};var at=Ae({name:"QChip",props:{...De,...Ht,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:l,emit:t}){const{proxy:{$q:a}}=ce(),n=Oe(e,a),u=Bt(e,jl),i=g(()=>e.selected===!0||e.icon!==void 0),o=g(()=>e.selected===!0?e.iconSelected||a.iconSet.chip.selected:e.icon),r=g(()=>e.iconRemove||a.iconSet.chip.remove),v=g(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),h=g(()=>{const f=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(f?` text-${f} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(v.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(n.value===!0?" q-chip--dark q-dark":"")}),_=g(()=>{const f=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},B={...f,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||a.lang.label.remove};return{chip:f,remove:B}});function q(f){f.keyCode===13&&s(f)}function s(f){e.disable||(t("update:selected",!e.selected),t("click",f))}function m(f){(f.keyCode===void 0||f.keyCode===13)&&(vt(f),e.disable===!1&&(t("update:modelValue",!1),t("remove")))}function L(){const f=[];v.value===!0&&f.push(F("div",{class:"q-focus-helper"})),i.value===!0&&f.push(F(le,{class:"q-chip__icon q-chip__icon--left",name:o.value}));const B=e.label!==void 0?[F("div",{class:"ellipsis"},[e.label])]:void 0;return f.push(F("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},At(l.default,B))),e.iconRight&&f.push(F(le,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&f.push(F(le,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:r.value,..._.value.remove,onClick:m,onKeyup:m})),f}return()=>{if(e.modelValue===!1)return;const f={class:h.value,style:u.value};return v.value===!0&&Object.assign(f,_.value.chip,{onClick:s,onKeyup:q}),xt("div",f,L(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[Le,e.ripple]])}}});const it=["vertical","horizontal"],Ee={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},nt={prevent:!0,mouse:!0,mouseAllDir:!0},rt=e=>e>=250?50:Math.ceil(e/5);var Kl=Ae({name:"QScrollArea",props:{...De,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:l,emit:t}){const a=M(!1),n=M(!1),u=M(!1),i={vertical:M(0),horizontal:M(0)},o={vertical:{ref:M(null),position:M(0),size:M(0)},horizontal:{ref:M(null),position:M(0),size:M(0)}},{proxy:r}=ce(),v=Oe(e,r.$q);let h=null,_;const q=M(null),s=g(()=>"q-scrollarea"+(v.value===!0?" q-scrollarea--dark":""));o.vertical.percentage=g(()=>{const c=o.vertical.size.value-i.vertical.value;if(c<=0)return 0;const y=me(o.vertical.position.value/c,0,1);return Math.round(y*1e4)/1e4}),o.vertical.thumbHidden=g(()=>(e.visible===null?u.value:e.visible)!==!0&&a.value===!1&&n.value===!1||o.vertical.size.value<=i.vertical.value+1),o.vertical.thumbStart=g(()=>o.vertical.percentage.value*(i.vertical.value-o.vertical.thumbSize.value)),o.vertical.thumbSize=g(()=>Math.round(me(i.vertical.value*i.vertical.value/o.vertical.size.value,rt(i.vertical.value),i.vertical.value))),o.vertical.style=g(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${o.vertical.thumbStart.value}px`,height:`${o.vertical.thumbSize.value}px`})),o.vertical.thumbClass=g(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(o.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),o.vertical.barClass=g(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(o.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),o.horizontal.percentage=g(()=>{const c=o.horizontal.size.value-i.horizontal.value;if(c<=0)return 0;const y=me(Math.abs(o.horizontal.position.value)/c,0,1);return Math.round(y*1e4)/1e4}),o.horizontal.thumbHidden=g(()=>(e.visible===null?u.value:e.visible)!==!0&&a.value===!1&&n.value===!1||o.horizontal.size.value<=i.horizontal.value+1),o.horizontal.thumbStart=g(()=>o.horizontal.percentage.value*(i.horizontal.value-o.horizontal.thumbSize.value)),o.horizontal.thumbSize=g(()=>Math.round(me(i.horizontal.value*i.horizontal.value/o.horizontal.size.value,rt(i.horizontal.value),i.horizontal.value))),o.horizontal.style=g(()=>({...e.thumbStyle,...e.horizontalThumbStyle,[r.$q.lang.rtl===!0?"right":"left"]:`${o.horizontal.thumbStart.value}px`,width:`${o.horizontal.thumbSize.value}px`})),o.horizontal.thumbClass=g(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(o.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),o.horizontal.barClass=g(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(o.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const m=g(()=>o.vertical.thumbHidden.value===!0&&o.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),L=[[Ke,c=>{p(c,"vertical")},void 0,{vertical:!0,...nt}]],f=[[Ke,c=>{p(c,"horizontal")},void 0,{horizontal:!0,...nt}]];function B(){const c={};return it.forEach(y=>{const w=o[y];c[y+"Position"]=w.position.value,c[y+"Percentage"]=w.percentage.value,c[y+"Size"]=w.size.value,c[y+"ContainerSize"]=i[y].value}),c}const Q=Lt(()=>{const c=B();c.ref=r,t("scroll",c)},0);function H(c,y,w){if(it.includes(c)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(c==="vertical"?je:Te)(q.value,y,w)}function d({height:c,width:y}){let w=!1;i.vertical.value!==c&&(i.vertical.value=c,w=!0),i.horizontal.value!==y&&(i.horizontal.value=y,w=!0),w===!0&&W()}function S({position:c}){let y=!1;o.vertical.position.value!==c.top&&(o.vertical.position.value=c.top,y=!0),o.horizontal.position.value!==c.left&&(o.horizontal.position.value=c.left,y=!0),y===!0&&W()}function E({height:c,width:y}){o.horizontal.size.value!==y&&(o.horizontal.size.value=y,W()),o.vertical.size.value!==c&&(o.vertical.size.value=c,W())}function p(c,y){const w=o[y];if(c.isFirst===!0){if(w.thumbHidden.value===!0)return;_=w.position.value,n.value=!0}else if(n.value!==!0)return;c.isFinal===!0&&(n.value=!1);const O=Ee[y],te=i[y].value,ze=(w.size.value-te)/(te-w.thumbSize.value),ve=c.distance[O.dist],fe=_+(c.direction===O.dir?1:-1)*ve*ze;j(fe,y)}function P(c,y){const w=o[y];if(w.thumbHidden.value!==!0){const O=c[Ee[y].offset];if(O<w.thumbStart.value||O>w.thumbStart.value+w.thumbSize.value){const te=O-w.thumbSize.value/2;j(te/i[y].value*w.size.value,y)}w.ref.value!==null&&w.ref.value.dispatchEvent(new MouseEvent(c.type,c))}}function k(c){P(c,"vertical")}function Y(c){P(c,"horizontal")}function W(){a.value=!0,h!==null&&clearTimeout(h),h=setTimeout(()=>{h=null,a.value=!1},e.delay),e.onScroll!==void 0&&Q()}function j(c,y){q.value[Ee[y].scroll]=c}function ie(){u.value=!0}function de(){u.value=!1}let ee=null;return G(()=>r.$q.lang.rtl,c=>{q.value!==null&&Te(q.value,Math.abs(o.horizontal.position.value)*(c===!0?-1:1))}),dt(()=>{ee={top:o.vertical.position.value,left:o.horizontal.position.value}}),Dt(()=>{if(ee===null)return;const c=q.value;c!==null&&(Te(c,ee.left),je(c,ee.top))}),ue(Q.cancel),Object.assign(r,{getScrollTarget:()=>q.value,getScroll:B,getScrollPosition:()=>({top:o.vertical.position.value,left:o.horizontal.position.value}),getScrollPercentage:()=>({top:o.vertical.percentage.value,left:o.horizontal.percentage.value}),setScrollPosition:H,setScrollPercentage(c,y,w){H(c,y*(o[c].size.value-i[c].value)*(c==="horizontal"&&r.$q.lang.rtl===!0?-1:1),w)}}),()=>F("div",{class:s.value,onMouseenter:ie,onMouseleave:de},[F("div",{ref:q,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[F("div",{class:"q-scrollarea__content absolute",style:m.value},Ot(l.default,[F(Ne,{debounce:0,onResize:E})])),F(tl,{axis:"both",onScroll:S})]),F(Ne,{debounce:0,onResize:d}),F("div",{class:o.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:k}),F("div",{class:o.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:Y}),pe(F("div",{ref:o.vertical.ref,class:o.vertical.thumbClass.value,style:o.vertical.style.value,"aria-hidden":"true"}),L),pe(F("div",{ref:o.horizontal.ref,class:o.horizontal.thumbClass.value,style:o.horizontal.style.value,"aria-hidden":"true"}),f)])}});const We=e=>(Wt("data-v-5d6f4010"),e=e(),Qt(),e),Gl=We(()=>R("div",{class:"text-h6"},"Your turn!",-1)),Ul=We(()=>R("div",{class:"text-h6"},"Waiting for opponent...",-1)),Yl=We(()=>R("div",{class:"spacer col"},null,-1)),Xl={"data-testid":"afen"},Jl={"data-testid":"move-history"},Zl={key:0,class:"col"},Il={key:0,class:"col"},eo=U({__name:"game-sidebar",props:{moveHistory:{},activeColour:{},ownColour:{},afen:{}},setup(e){const l=e,t=g(()=>{const i=[];return l.moveHistory.children.forEach(o=>{const r=i.at(-1);if(!r||r.length!==1){i.push([o]);return}r.push(o)}),i}),a=M(null);G(t,()=>{!a.value||a.value.setScrollPosition("vertical",t.value.length*36,1e3)}),ct(()=>{!a.value||a.value.setScrollPosition("vertical",t.value.length*36,1e3)});const n=ht(),u=()=>{if(!!l.afen)try{navigator.clipboard.writeText(l.afen),n.notify({position:"bottom-right",timeout:4e3,message:"AFEN copied to clipboard",icon:"content_copy"})}catch{n.notify({position:"bottom-right",timeout:4e3,message:"Could not write to clipboard",icon:"close",iconColor:"red"})}};return(i,o)=>(b(),x(al,{flat:"",bordered:"",class:"q-ma-md full-height column justify-between","data-testid":"game-sidebar"},{default:T(()=>[C(He,{mode:"out-in"},{default:T(()=>[i.activeColour===i.ownColour?(b(),x(Me,{key:0,class:"bg-primary text-white q-mb-md"},{default:T(()=>[Gl]),_:1})):(b(),x(Me,{key:1,class:"bg-grey text-black q-mb-md"},{default:T(()=>[Ul]),_:1}))]),_:1}),Yl,R("div",Xl,[C(Ye),pe((b(),x(be,{clickable:"",onClick:u},{default:T(()=>[C(se,{class:"q-mt-sm q-mb-sm"},{default:T(()=>[C(Ue,null,{default:T(()=>[he("AFEN")]),_:1}),C(Ue,{caption:"",lines:"2"},{default:T(()=>[he(Ce(i.afen),1)]),_:1})]),_:1}),C(se,{side:""},{default:T(()=>[C(le,{name:"edit"})]),_:1})]),_:1})),[[Le]])]),R("div",Jl,[C(Ye),C(A(Kl),{style:{height:"500px"},ref_key:"moveHistoryScrollArea",ref:a},{default:T(()=>[(b(!0),$(V,null,N(t.value,(r,v)=>(b(),x(Me,{key:v,horizontal:"",class:X(["row q-py-none q-mx-md",{"q-pt-md":v===0,"q-pb-md":v===t.value.length-1}])},{default:T(()=>[r[0]?(b(),$("div",Zl,[C(at,{ripple:!1,class:X(["white-move",{highlight:r[0].kind!=="move"}])},{default:T(()=>[r[0].kind==="move"&&r[0].piece?(b(),x(ye,{key:0,piece:r[0].piece,allegiance:3,size:24},null,8,["piece"])):K("",!0),he(" "+Ce(A(Xe).writeNode(r[0])),1)]),_:2},1032,["class"])])):K("",!0),C(He,{mode:"out-in"},{default:T(()=>[r[1]?(b(),$("div",Il,[C(at,{ripple:!1,class:X(["black-move",{highlight:r[1].kind!=="move"}])},{default:T(()=>[r[1].kind==="move"&&r[1].piece?(b(),x(ye,{key:0,piece:r[1].piece,allegiance:0,size:24},null,8,["piece"])):K("",!0),he(" "+Ce(A(Xe).writeNode(r[1])),1)]),_:2},1032,["class"])])):K("",!0)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1},512)])]),_:1}))}});var vo=ae(eo,[["__scopeId","data-v-5d6f4010"]]);export{vo as G,co as _};
//# sourceMappingURL=game-sidebar.04882da5.js.map
