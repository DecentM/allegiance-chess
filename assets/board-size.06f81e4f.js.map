{"version":3,"file":"board-size.06f81e4f.js","sources":["../../../../../../../packages/core/src/notation/declarations.ts","../../../../../src/components/board/layers/background-layer.vue","../../../../../../../node_modules/quasar/src/composables/private/use-anchor.js","../../../../../../../node_modules/quasar/src/composables/private/use-scroll-target.js","../../../../../../../node_modules/quasar/src/utils/private/portal.js","../../../../../../../node_modules/quasar/src/composables/private/use-portal.js","../../../../../../../node_modules/quasar/src/composables/private/use-transition.js","../../../../../../../node_modules/quasar/src/composables/private/use-tick.js","../../../../../../../node_modules/quasar/src/utils/private/escape-key.js","../../../../../../../node_modules/quasar/src/utils/private/focusout.js","../../../../../../../node_modules/quasar/src/utils/private/click-outside.js","../../../../../../../node_modules/quasar/src/utils/private/position-engine.js","../../../../../../../node_modules/quasar/src/components/menu/QMenu.js","../../../../../src/components/promotion-selector.vue","../../../../../src/components/capture-selector.vue","../../../../../src/components/board/layers/interaction-layer.vue","../../../../../src/components/board/layers/indicators-layer.vue","../../../../../src/components/board/layers/pieces-layer.vue","../../../../../src/components/chess-board.vue","../../../../../../../node_modules/quasar/src/components/chip/QChip.js","../../../../../../../node_modules/quasar/src/components/scroll-area/QScrollArea.js","../../../../../src/components/game-sidebar.vue","../../../../../../../node_modules/quasar/src/components/card/QCardActions.js","../../../../../../../node_modules/quasar/src/components/dialog/QDialog.js","../../../../../../../node_modules/quasar/src/directives/ClosePopup.js","../../../../../src/hooks/board-size.ts"],"sourcesContent":["export type File = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8\n\nexport type Rank = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8\n\nexport type Piece = 'K' | 'Q' | 'R' | 'B' | 'N'\n\nexport const GameOutcome = {\n  White: 'white',\n  Black: 'black',\n  Draw: 'draw',\n  Forfeit: 'forfeit',\n  ForfeitWhite: 'forfeit-white',\n  ForfeitBlack: 'forfeit-black',\n} as const\n\nexport type GameOutcome = (typeof GameOutcome)[keyof typeof GameOutcome]\n","<script setup lang=\"ts\">\nimport { Notation, fileToLetter } from '@decentm/allegiance-chess-core'\nimport { useQuasar } from 'quasar'\n\ndefineProps<{\n  ranks: number\n  files: number\n  perspective: 'black' | 'white'\n}>()\n\nconst q = useQuasar()\n</script>\n\n<style lang=\"scss\" scoped>\n.background-layer {\n  z-index: 1;\n}\n\n.rank {\n  &:nth-child(odd) {\n    > .file {\n      &:nth-child(odd) {\n        background-color: $chess-white;\n        color: $chess-black;\n      }\n\n      &:nth-child(even) {\n        background-color: $chess-black;\n        color: $chess-white;\n      }\n    }\n  }\n\n  &:nth-child(even) {\n    > .file {\n      &:nth-child(even) {\n        background-color: $chess-white;\n        color: $chess-black;\n      }\n\n      &:nth-child(odd) {\n        background-color: $chess-black;\n        color: $chess-white;\n      }\n    }\n  }\n}\n</style>\n\n<template>\n  <div\n    class=\"row column full-width full-height no-pointer-events background-layer\"\n    data-testid=\"background\"\n  >\n    <div\n      class=\"rank col row full-width\"\n      v-for=\"(_, rankIndex) in ranks\"\n      :key=\"rankIndex\"\n    >\n      <div\n        v-for=\"(_, fileIndex) in files\"\n        :key=\"fileIndex\"\n        class=\"file col relative-position\"\n        :class=\"{\n          'text-h6 text-bold': q.screen.gt.sm,\n          'text-subtitle1 text-bold': q.screen.sm,\n          'text-subtitle2': q.screen.lt.sm,\n        }\"\n      >\n        <span\n          v-if=\"rankIndex === 7\"\n          class=\"absolute absolute-bottom-right q-px-sm\"\n        >\n          {{\n            fileToLetter(\n              (perspective === 'white'\n                ? 9 - (8 - fileIndex)\n                : 8 - fileIndex) as Notation.File\n            )\n          }}\n        </span>\n\n        <span v-if=\"fileIndex === 0\" class=\"absolute absolute-top-left q-pa-xs\">\n          {{ perspective === 'white' ? 8 - rankIndex : 9 - (8 - rankIndex) }}\n        </span>\n      </div>\n    </div>\n  </div>\n</template>\n","import { ref, watch, onMounted, onBeforeUnmount, nextTick, getCurrentInstance } from 'vue'\n\nimport { clearSelection } from '../../utils/private/selection.js'\nimport { addEvt, cleanEvt, prevent } from '../../utils/event.js'\nimport { isKeyCode } from '../../utils/private/key-composition.js'\n\nexport const useAnchorProps = {\n  target: {\n    default: true\n  },\n  noParentEvent: Boolean,\n  contextMenu: Boolean\n}\n\nexport default function ({\n  showing,\n  avoidEmit, // required for QPopupProxy (true)\n  configureAnchorEl // optional\n}) {\n  const { props, proxy, emit } = getCurrentInstance()\n\n  const anchorEl = ref(null)\n\n  let touchTimer = null\n\n  function canShow (evt) {\n    // abort with no parent configured or on multi-touch\n    return anchorEl.value === null\n      ? false\n      : (evt === void 0 || evt.touches === void 0 || evt.touches.length <= 1)\n  }\n\n  const anchorEvents = {}\n\n  if (configureAnchorEl === void 0) {\n    // default configureAnchorEl is designed for\n    // QMenu & QPopupProxy (which is why it's handled here)\n\n    Object.assign(anchorEvents, {\n      hide (evt) {\n        proxy.hide(evt)\n      },\n\n      toggle (evt) {\n        proxy.toggle(evt)\n        evt.qAnchorHandled = true\n      },\n\n      toggleKey (evt) {\n        isKeyCode(evt, 13) === true && anchorEvents.toggle(evt)\n      },\n\n      contextClick (evt) {\n        proxy.hide(evt)\n        prevent(evt)\n        nextTick(() => {\n          proxy.show(evt)\n          evt.qAnchorHandled = true\n        })\n      },\n\n      prevent,\n\n      mobileTouch (evt) {\n        anchorEvents.mobileCleanup(evt)\n\n        if (canShow(evt) !== true) {\n          return\n        }\n\n        proxy.hide(evt)\n        anchorEl.value.classList.add('non-selectable')\n\n        const target = evt.target\n        addEvt(anchorEvents, 'anchor', [\n          [ target, 'touchmove', 'mobileCleanup', 'passive' ],\n          [ target, 'touchend', 'mobileCleanup', 'passive' ],\n          [ target, 'touchcancel', 'mobileCleanup', 'passive' ],\n          [ anchorEl.value, 'contextmenu', 'prevent', 'notPassive' ]\n        ])\n\n        touchTimer = setTimeout(() => {\n          touchTimer = null\n          proxy.show(evt)\n          evt.qAnchorHandled = true\n        }, 300)\n      },\n\n      mobileCleanup (evt) {\n        anchorEl.value.classList.remove('non-selectable')\n\n        if (touchTimer !== null) {\n          clearTimeout(touchTimer)\n          touchTimer = null\n        }\n\n        if (showing.value === true && evt !== void 0) {\n          clearSelection()\n        }\n      }\n    })\n\n    configureAnchorEl = function (context = props.contextMenu) {\n      if (props.noParentEvent === true || anchorEl.value === null) { return }\n\n      let evts\n\n      if (context === true) {\n        if (proxy.$q.platform.is.mobile === true) {\n          evts = [\n            [ anchorEl.value, 'touchstart', 'mobileTouch', 'passive' ]\n          ]\n        }\n        else {\n          evts = [\n            [ anchorEl.value, 'mousedown', 'hide', 'passive' ],\n            [ anchorEl.value, 'contextmenu', 'contextClick', 'notPassive' ]\n          ]\n        }\n      }\n      else {\n        evts = [\n          [ anchorEl.value, 'click', 'toggle', 'passive' ],\n          [ anchorEl.value, 'keyup', 'toggleKey', 'passive' ]\n        ]\n      }\n\n      addEvt(anchorEvents, 'anchor', evts)\n    }\n  }\n\n  function unconfigureAnchorEl () {\n    cleanEvt(anchorEvents, 'anchor')\n  }\n\n  function setAnchorEl (el) {\n    anchorEl.value = el\n    while (anchorEl.value.classList.contains('q-anchor--skip')) {\n      anchorEl.value = anchorEl.value.parentNode\n    }\n    configureAnchorEl()\n  }\n\n  function pickAnchorEl () {\n    if (props.target === false || props.target === '' || proxy.$el.parentNode === null) {\n      anchorEl.value = null\n    }\n    else if (props.target === true) {\n      setAnchorEl(proxy.$el.parentNode)\n    }\n    else {\n      let el = props.target\n\n      if (typeof props.target === 'string') {\n        try {\n          el = document.querySelector(props.target)\n        }\n        catch (err) {\n          el = void 0\n        }\n      }\n\n      if (el !== void 0 && el !== null) {\n        anchorEl.value = el.$el || el\n        configureAnchorEl()\n      }\n      else {\n        anchorEl.value = null\n        console.error(`Anchor: target \"${ props.target }\" not found`)\n      }\n    }\n  }\n\n  watch(() => props.contextMenu, val => {\n    if (anchorEl.value !== null) {\n      unconfigureAnchorEl()\n      configureAnchorEl(val)\n    }\n  })\n\n  watch(() => props.target, () => {\n    if (anchorEl.value !== null) {\n      unconfigureAnchorEl()\n    }\n\n    pickAnchorEl()\n  })\n\n  watch(() => props.noParentEvent, val => {\n    if (anchorEl.value !== null) {\n      if (val === true) {\n        unconfigureAnchorEl()\n      }\n      else {\n        configureAnchorEl()\n      }\n    }\n  })\n\n  onMounted(() => {\n    pickAnchorEl()\n\n    if (avoidEmit !== true && props.modelValue === true && anchorEl.value === null) {\n      emit('update:modelValue', false)\n    }\n  })\n\n  onBeforeUnmount(() => {\n    touchTimer !== null && clearTimeout(touchTimer)\n    unconfigureAnchorEl()\n  })\n\n  return {\n    anchorEl,\n    canShow,\n    anchorEvents\n  }\n}\n","import { ref, watch, onBeforeUnmount } from 'vue'\n\nimport { listenOpts } from '../../utils/event.js'\n\nexport default function (\n  props,\n  configureScrollTarget\n) {\n  const localScrollTarget = ref(null)\n  let scrollFn\n\n  function changeScrollEvent (scrollTarget, fn) {\n    const fnProp = `${ fn !== void 0 ? 'add' : 'remove' }EventListener`\n    const fnHandler = fn !== void 0 ? fn : scrollFn\n\n    if (scrollTarget !== window) {\n      scrollTarget[ fnProp ]('scroll', fnHandler, listenOpts.passive)\n    }\n\n    window[ fnProp ]('scroll', fnHandler, listenOpts.passive)\n\n    scrollFn = fn\n  }\n\n  function unconfigureScrollTarget () {\n    if (localScrollTarget.value !== null) {\n      changeScrollEvent(localScrollTarget.value)\n      localScrollTarget.value = null\n    }\n  }\n\n  const noParentEventWatcher = watch(() => props.noParentEvent, () => {\n    if (localScrollTarget.value !== null) {\n      unconfigureScrollTarget()\n      configureScrollTarget()\n    }\n  })\n\n  onBeforeUnmount(noParentEventWatcher)\n\n  return {\n    localScrollTarget,\n    unconfigureScrollTarget,\n    changeScrollEvent\n  }\n}\n","import { getParentProxy } from './vm.js'\n\nexport const portalProxyList = []\n\nexport function getPortalProxy (el) {\n  return portalProxyList.find(proxy =>\n    proxy.contentEl !== null\n    && proxy.contentEl.contains(el)\n  )\n}\n\nexport function closePortalMenus (proxy, evt) {\n  do {\n    if (proxy.$options.name === 'QMenu') {\n      proxy.hide(evt)\n\n      // is this a point of separation?\n      if (proxy.$props.separateClosePopup === true) {\n        return getParentProxy(proxy)\n      }\n    }\n    else if (proxy.__qPortal === true) {\n      // treat it as point of separation if parent is QPopupProxy\n      // (so mobile matches desktop behavior)\n      // and hide it too\n      const parent = getParentProxy(proxy)\n\n      if (parent !== void 0 && parent.$options.name === 'QPopupProxy') {\n        proxy.hide(evt)\n        return parent\n      }\n      else {\n        return proxy\n      }\n    }\n\n    proxy = getParentProxy(proxy)\n  } while (proxy !== void 0 && proxy !== null)\n}\n\nexport function closePortals (proxy, evt, depth) {\n  while (depth !== 0 && proxy !== void 0 && proxy !== null) {\n    if (proxy.__qPortal === true) {\n      depth--\n\n      if (proxy.$options.name === 'QMenu') {\n        proxy = closePortalMenus(proxy, evt)\n        continue\n      }\n\n      proxy.hide(evt)\n    }\n\n    proxy = getParentProxy(proxy)\n  }\n}\n","import { h, ref, onUnmounted, Teleport } from 'vue'\n\nimport { noop } from '../../utils/event.js'\nimport { addFocusWaitFlag, removeFocusWaitFlag } from '../../utils/private/focus-manager.js'\nimport { createGlobalNode, removeGlobalNode } from '../../utils/private/global-nodes.js'\nimport { portalProxyList } from '../../utils/private/portal.js'\nimport { injectProp } from '../../utils/private/inject-obj-prop.js'\n\nfunction isOnGlobalDialog (vm) {\n  vm = vm.parent\n\n  while (vm !== void 0 && vm !== null) {\n    if (vm.type.name === 'QGlobalDialog') {\n      return true\n    }\n    if (vm.type.name === 'QDialog' || vm.type.name === 'QMenu') {\n      return false\n    }\n\n    vm = vm.parent\n  }\n\n  return false\n}\n\n// Warning!\n// You MUST specify \"inheritAttrs: false\" in your component\n\nexport default function (vm, innerRef, renderPortalContent, type) {\n  // showing, including while in show/hide transition\n  const portalIsActive = ref(false)\n\n  // showing & not in any show/hide transition\n  const portalIsAccessible = ref(false)\n\n  if (__QUASAR_SSR_SERVER__) {\n    return {\n      portalIsActive,\n      portalIsAccessible,\n\n      showPortal: noop,\n      hidePortal: noop,\n      renderPortal: noop\n    }\n  }\n\n  let portalEl = null\n  const focusObj = {}\n  const onGlobalDialog = type === 'dialog' && isOnGlobalDialog(vm)\n\n  function showPortal (isReady) {\n    if (isReady === true) {\n      removeFocusWaitFlag(focusObj)\n      portalIsAccessible.value = true\n      return\n    }\n\n    portalIsAccessible.value = false\n\n    if (portalIsActive.value === false) {\n      if (onGlobalDialog === false && portalEl === null) {\n        portalEl = createGlobalNode(false, type)\n      }\n\n      portalIsActive.value = true\n\n      // register portal\n      portalProxyList.push(vm.proxy)\n\n      addFocusWaitFlag(focusObj)\n    }\n  }\n\n  function hidePortal (isReady) {\n    portalIsAccessible.value = false\n\n    if (isReady !== true) { return }\n\n    removeFocusWaitFlag(focusObj)\n    portalIsActive.value = false\n\n    // unregister portal\n    const index = portalProxyList.indexOf(vm.proxy)\n    if (index !== -1) {\n      portalProxyList.splice(index, 1)\n    }\n\n    if (portalEl !== null) {\n      removeGlobalNode(portalEl)\n      portalEl = null\n    }\n  }\n\n  onUnmounted(() => { hidePortal(true) })\n\n  // needed for portal vm detection\n  vm.proxy.__qPortal = true\n\n  // public way of accessing the rendered content\n  injectProp(vm.proxy, 'contentEl', () => innerRef.value)\n\n  return {\n    showPortal,\n    hidePortal,\n\n    portalIsActive,\n    portalIsAccessible,\n\n    renderPortal: () => (\n      onGlobalDialog === true\n        ? renderPortalContent()\n        : (\n            portalIsActive.value === true\n              ? [ h(Teleport, { to: portalEl }, renderPortalContent()) ]\n              : void 0\n          )\n    )\n  }\n}\n","import { computed } from 'vue'\n\nexport const useTransitionProps = {\n  transitionShow: {\n    type: String,\n    default: 'fade'\n  },\n\n  transitionHide: {\n    type: String,\n    default: 'fade'\n  },\n\n  transitionDuration: {\n    type: [ String, Number ],\n    default: 300\n  }\n}\n\nexport default function (props, defaultShowFn = () => {}, defaultHideFn = () => {}) {\n  return {\n    transitionProps: computed(() => {\n      const show = `q-transition--${ props.transitionShow || defaultShowFn() }`\n      const hide = `q-transition--${ props.transitionHide || defaultHideFn() }`\n\n      return {\n        appear: true,\n\n        enterFromClass: `${ show }-enter-from`,\n        enterActiveClass: `${ show }-enter-active`,\n        enterToClass: `${ show }-enter-to`,\n\n        leaveFromClass: `${ hide }-leave-from`,\n        leaveActiveClass: `${ hide }-leave-active`,\n        leaveToClass: `${ hide }-leave-to`\n      }\n    }),\n\n    transitionStyle: computed(() => `--q-transition-duration: ${ props.transitionDuration }ms`)\n  }\n}\n","import { nextTick, onDeactivated, onBeforeUnmount, getCurrentInstance } from 'vue'\n\nimport { vmIsDestroyed } from '../../utils/private/vm'\n\n/*\n * Usage:\n *    registerTick(fn)\n *    removeTick()\n */\n\nexport default function () {\n  let tickFn\n  const vm = getCurrentInstance()\n\n  function removeTick () {\n    tickFn = void 0\n  }\n\n  onDeactivated(removeTick)\n  onBeforeUnmount(removeTick)\n\n  return {\n    removeTick,\n\n    registerTick (fn) {\n      tickFn = fn\n\n      nextTick(() => {\n        if (tickFn === fn) {\n          // we also check if VM is destroyed, since if it\n          // got to trigger one nextTick() we cannot stop it\n          vmIsDestroyed(vm) === false && tickFn()\n          tickFn = void 0\n        }\n      })\n    }\n  }\n}\n","import { client } from '../../plugins/Platform.js'\nimport { isKeyCode } from './key-composition.js'\n\nconst handlers = []\nlet escDown\n\nfunction onKeydown (evt) {\n  escDown = evt.keyCode === 27\n}\n\nfunction onBlur () {\n  if (escDown === true) {\n    escDown = false\n  }\n}\n\nfunction onKeyup (evt) {\n  if (escDown === true) {\n    escDown = false\n\n    if (isKeyCode(evt, 27) === true) {\n      handlers[ handlers.length - 1 ](evt)\n    }\n  }\n}\n\nfunction update (action) {\n  window[ action ]('keydown', onKeydown)\n  window[ action ]('blur', onBlur)\n  window[ action ]('keyup', onKeyup)\n  escDown = false\n}\n\nexport function addEscapeKey (fn) {\n  if (client.is.desktop === true) {\n    handlers.push(fn)\n\n    if (handlers.length === 1) {\n      update('addEventListener')\n    }\n  }\n}\n\nexport function removeEscapeKey (fn) {\n  const index = handlers.indexOf(fn)\n  if (index > -1) {\n    handlers.splice(index, 1)\n\n    if (handlers.length === 0) {\n      update('removeEventListener')\n    }\n  }\n}\n","import { client } from '../../plugins/Platform.js'\n\nconst handlers = []\n\nfunction trigger (e) {\n  handlers[ handlers.length - 1 ](e)\n}\n\nexport function addFocusout (fn) {\n  if (client.is.desktop === true) {\n    handlers.push(fn)\n\n    if (handlers.length === 1) {\n      document.body.addEventListener('focusin', trigger)\n    }\n  }\n}\n\nexport function removeFocusout (fn) {\n  const index = handlers.indexOf(fn)\n  if (index > -1) {\n    handlers.splice(index, 1)\n\n    if (handlers.length === 0) {\n      document.body.removeEventListener('focusin', trigger)\n    }\n  }\n}\n","import { listenOpts } from '../event.js'\nimport { portalProxyList } from '../private/portal.js'\n\nlet timer = null\n\nconst\n  { notPassiveCapture } = listenOpts,\n  registeredList = []\n\nfunction globalHandler (evt) {\n  if (timer !== null) {\n    clearTimeout(timer)\n    timer = null\n  }\n\n  const target = evt.target\n\n  if (\n    target === void 0\n    || target.nodeType === 8\n    || target.classList.contains('no-pointer-events') === true\n  ) {\n    return\n  }\n\n  // check last portal vm if it's\n  // a QDialog and not in seamless mode\n  let portalIndex = portalProxyList.length - 1\n\n  while (portalIndex >= 0) {\n    const proxy = portalProxyList[ portalIndex ].$\n\n    // skip QTooltip portals\n    if (proxy.type.name === 'QTooltip') {\n      portalIndex--\n      continue\n    }\n\n    if (proxy.type.name !== 'QDialog') {\n      break\n    }\n\n    if (proxy.props.seamless !== true) {\n      return\n    }\n\n    portalIndex--\n  }\n\n  for (let i = registeredList.length - 1; i >= 0; i--) {\n    const state = registeredList[ i ]\n\n    if (\n      (\n        state.anchorEl.value === null\n        || state.anchorEl.value.contains(target) === false\n      )\n      && (\n        target === document.body\n        || (\n          state.innerRef.value !== null\n          && state.innerRef.value.contains(target) === false\n        )\n      )\n    ) {\n      // mark the event as being processed by clickOutside\n      // used to prevent refocus after menu close\n      evt.qClickOutside = true\n      state.onClickOutside(evt)\n    }\n    else {\n      return\n    }\n  }\n}\n\nexport function addClickOutside (clickOutsideProps) {\n  registeredList.push(clickOutsideProps)\n\n  if (registeredList.length === 1) {\n    document.addEventListener('mousedown', globalHandler, notPassiveCapture)\n    document.addEventListener('touchstart', globalHandler, notPassiveCapture)\n  }\n}\n\nexport function removeClickOutside (clickOutsideProps) {\n  const index = registeredList.findIndex(h => h === clickOutsideProps)\n\n  if (index > -1) {\n    registeredList.splice(index, 1)\n\n    if (registeredList.length === 0) {\n      if (timer !== null) {\n        clearTimeout(timer)\n        timer = null\n      }\n\n      document.removeEventListener('mousedown', globalHandler, notPassiveCapture)\n      document.removeEventListener('touchstart', globalHandler, notPassiveCapture)\n    }\n  }\n}\n","import { getScrollbarWidth } from '../scroll.js'\nimport { client } from '../../plugins/Platform.js'\n\nlet vpLeft, vpTop\n\nexport function validatePosition (pos) {\n  const parts = pos.split(' ')\n  if (parts.length !== 2) {\n    return false\n  }\n  if ([ 'top', 'center', 'bottom' ].includes(parts[ 0 ]) !== true) {\n    console.error('Anchor/Self position must start with one of top/center/bottom')\n    return false\n  }\n  if ([ 'left', 'middle', 'right', 'start', 'end' ].includes(parts[ 1 ]) !== true) {\n    console.error('Anchor/Self position must end with one of left/middle/right/start/end')\n    return false\n  }\n  return true\n}\n\nexport function validateOffset (val) {\n  if (!val) { return true }\n  if (val.length !== 2) { return false }\n  if (typeof val[ 0 ] !== 'number' || typeof val[ 1 ] !== 'number') {\n    return false\n  }\n  return true\n}\n\nconst horizontalPos = {\n  'start#ltr': 'left',\n  'start#rtl': 'right',\n  'end#ltr': 'right',\n  'end#rtl': 'left'\n}\n\n;[ 'left', 'middle', 'right' ].forEach(pos => {\n  horizontalPos[ `${ pos }#ltr` ] = pos\n  horizontalPos[ `${ pos }#rtl` ] = pos\n})\n\nexport function parsePosition (pos, rtl) {\n  const parts = pos.split(' ')\n  return {\n    vertical: parts[ 0 ],\n    horizontal: horizontalPos[ `${ parts[ 1 ] }#${ rtl === true ? 'rtl' : 'ltr' }` ]\n  }\n}\n\nexport function getAnchorProps (el, offset) {\n  let { top, left, right, bottom, width, height } = el.getBoundingClientRect()\n\n  if (offset !== void 0) {\n    top -= offset[ 1 ]\n    left -= offset[ 0 ]\n    bottom += offset[ 1 ]\n    right += offset[ 0 ]\n\n    width += offset[ 0 ]\n    height += offset[ 1 ]\n  }\n\n  return {\n    top, bottom, height,\n    left, right, width,\n    middle: left + (right - left) / 2,\n    center: top + (bottom - top) / 2\n  }\n}\n\nfunction getAbsoluteAnchorProps (el, absoluteOffset, offset) {\n  let { top, left } = el.getBoundingClientRect()\n\n  top += absoluteOffset.top\n  left += absoluteOffset.left\n\n  if (offset !== void 0) {\n    top += offset[ 1 ]\n    left += offset[ 0 ]\n  }\n\n  return {\n    top, bottom: top + 1, height: 1,\n    left, right: left + 1, width: 1,\n    middle: left,\n    center: top\n  }\n}\n\nfunction getTargetProps (width, height) {\n  return {\n    top: 0,\n    center: height / 2,\n    bottom: height,\n    left: 0,\n    middle: width / 2,\n    right: width\n  }\n}\n\nfunction getTopLeftProps (anchorProps, targetProps, anchorOrigin, selfOrigin) {\n  return {\n    top: anchorProps[ anchorOrigin.vertical ] - targetProps[ selfOrigin.vertical ],\n    left: anchorProps[ anchorOrigin.horizontal ] - targetProps[ selfOrigin.horizontal ]\n  }\n}\n\nexport function setPosition (cfg, retryNumber = 0) {\n  if (\n    cfg.targetEl === null\n    || cfg.anchorEl === null\n    || retryNumber > 5 // we should try only a few times\n  ) {\n    return\n  }\n\n  // some browsers report zero height or width because\n  // we are trying too early to get these dimensions\n  if (cfg.targetEl.offsetHeight === 0 || cfg.targetEl.offsetWidth === 0) {\n    setTimeout(() => {\n      setPosition(cfg, retryNumber + 1)\n    }, 10)\n    return\n  }\n\n  const {\n    targetEl,\n    offset,\n    anchorEl,\n    anchorOrigin,\n    selfOrigin,\n    absoluteOffset,\n    fit,\n    cover,\n    maxHeight,\n    maxWidth\n  } = cfg\n\n  if (client.is.ios === true && window.visualViewport !== void 0) {\n    // uses the q-position-engine CSS class\n\n    const el = document.body.style\n    const { offsetLeft: left, offsetTop: top } = window.visualViewport\n\n    if (left !== vpLeft) {\n      el.setProperty('--q-pe-left', left + 'px')\n      vpLeft = left\n    }\n    if (top !== vpTop) {\n      el.setProperty('--q-pe-top', top + 'px')\n      vpTop = top\n    }\n  }\n\n  // scroll position might change\n  // if max-height/-width changes, so we\n  // need to restore it after we calculate\n  // the new positioning\n  const { scrollLeft, scrollTop } = targetEl\n\n  const anchorProps = absoluteOffset === void 0\n    ? getAnchorProps(anchorEl, cover === true ? [ 0, 0 ] : offset)\n    : getAbsoluteAnchorProps(anchorEl, absoluteOffset, offset)\n\n  // we \"reset\" the critical CSS properties\n  // so we can take an accurate measurement\n  Object.assign(targetEl.style, {\n    top: 0,\n    left: 0,\n    minWidth: null,\n    minHeight: null,\n    maxWidth: maxWidth || '100vw',\n    maxHeight: maxHeight || '100vh',\n    visibility: 'visible'\n  })\n\n  const { offsetWidth: origElWidth, offsetHeight: origElHeight } = targetEl\n  const { elWidth, elHeight } = fit === true || cover === true\n    ? { elWidth: Math.max(anchorProps.width, origElWidth), elHeight: cover === true ? Math.max(anchorProps.height, origElHeight) : origElHeight }\n    : { elWidth: origElWidth, elHeight: origElHeight }\n\n  let elStyle = { maxWidth, maxHeight }\n\n  if (fit === true || cover === true) {\n    elStyle.minWidth = anchorProps.width + 'px'\n    if (cover === true) {\n      elStyle.minHeight = anchorProps.height + 'px'\n    }\n  }\n\n  Object.assign(targetEl.style, elStyle)\n\n  const targetProps = getTargetProps(elWidth, elHeight)\n  let props = getTopLeftProps(anchorProps, targetProps, anchorOrigin, selfOrigin)\n\n  if (absoluteOffset === void 0 || offset === void 0) {\n    applyBoundaries(props, anchorProps, targetProps, anchorOrigin, selfOrigin)\n  }\n  else { // we have touch position or context menu with offset\n    const { top, left } = props // cache initial values\n\n    // apply initial boundaries\n    applyBoundaries(props, anchorProps, targetProps, anchorOrigin, selfOrigin)\n\n    let hasChanged = false\n\n    // did it flip vertically?\n    if (props.top !== top) {\n      hasChanged = true\n      const offsetY = 2 * offset[ 1 ]\n      anchorProps.center = anchorProps.top -= offsetY\n      anchorProps.bottom -= offsetY + 2\n    }\n\n    // did it flip horizontally?\n    if (props.left !== left) {\n      hasChanged = true\n      const offsetX = 2 * offset[ 0 ]\n      anchorProps.middle = anchorProps.left -= offsetX\n      anchorProps.right -= offsetX + 2\n    }\n\n    if (hasChanged === true) {\n      // re-calculate props with the new anchor\n      props = getTopLeftProps(anchorProps, targetProps, anchorOrigin, selfOrigin)\n\n      // and re-apply boundaries\n      applyBoundaries(props, anchorProps, targetProps, anchorOrigin, selfOrigin)\n    }\n  }\n\n  elStyle = {\n    top: props.top + 'px',\n    left: props.left + 'px'\n  }\n\n  if (props.maxHeight !== void 0) {\n    elStyle.maxHeight = props.maxHeight + 'px'\n\n    if (anchorProps.height > props.maxHeight) {\n      elStyle.minHeight = elStyle.maxHeight\n    }\n  }\n  if (props.maxWidth !== void 0) {\n    elStyle.maxWidth = props.maxWidth + 'px'\n\n    if (anchorProps.width > props.maxWidth) {\n      elStyle.minWidth = elStyle.maxWidth\n    }\n  }\n\n  Object.assign(targetEl.style, elStyle)\n\n  // restore scroll position\n  if (targetEl.scrollTop !== scrollTop) {\n    targetEl.scrollTop = scrollTop\n  }\n  if (targetEl.scrollLeft !== scrollLeft) {\n    targetEl.scrollLeft = scrollLeft\n  }\n}\n\nfunction applyBoundaries (props, anchorProps, targetProps, anchorOrigin, selfOrigin) {\n  const\n    currentHeight = targetProps.bottom,\n    currentWidth = targetProps.right,\n    margin = getScrollbarWidth(),\n    innerHeight = window.innerHeight - margin,\n    innerWidth = document.body.clientWidth\n\n  if (props.top < 0 || props.top + currentHeight > innerHeight) {\n    if (selfOrigin.vertical === 'center') {\n      props.top = anchorProps[ anchorOrigin.vertical ] > innerHeight / 2\n        ? Math.max(0, innerHeight - currentHeight)\n        : 0\n      props.maxHeight = Math.min(currentHeight, innerHeight)\n    }\n    else if (anchorProps[ anchorOrigin.vertical ] > innerHeight / 2) {\n      const anchorY = Math.min(\n        innerHeight,\n        anchorOrigin.vertical === 'center'\n          ? anchorProps.center\n          : (anchorOrigin.vertical === selfOrigin.vertical ? anchorProps.bottom : anchorProps.top)\n      )\n      props.maxHeight = Math.min(currentHeight, anchorY)\n      props.top = Math.max(0, anchorY - currentHeight)\n    }\n    else {\n      props.top = Math.max(0, anchorOrigin.vertical === 'center'\n        ? anchorProps.center\n        : (anchorOrigin.vertical === selfOrigin.vertical ? anchorProps.top : anchorProps.bottom)\n      )\n      props.maxHeight = Math.min(currentHeight, innerHeight - props.top)\n    }\n  }\n\n  if (props.left < 0 || props.left + currentWidth > innerWidth) {\n    props.maxWidth = Math.min(currentWidth, innerWidth)\n    if (selfOrigin.horizontal === 'middle') {\n      props.left = anchorProps[ anchorOrigin.horizontal ] > innerWidth / 2\n        ? Math.max(0, innerWidth - currentWidth)\n        : 0\n    }\n    else if (anchorProps[ anchorOrigin.horizontal ] > innerWidth / 2) {\n      const anchorX = Math.min(\n        innerWidth,\n        anchorOrigin.horizontal === 'middle'\n          ? anchorProps.middle\n          : (anchorOrigin.horizontal === selfOrigin.horizontal ? anchorProps.right : anchorProps.left)\n      )\n      props.maxWidth = Math.min(currentWidth, anchorX)\n      props.left = Math.max(0, anchorX - props.maxWidth)\n    }\n    else {\n      props.left = Math.max(0, anchorOrigin.horizontal === 'middle'\n        ? anchorProps.middle\n        : (anchorOrigin.horizontal === selfOrigin.horizontal ? anchorProps.left : anchorProps.right)\n      )\n      props.maxWidth = Math.min(currentWidth, innerWidth - props.left)\n    }\n  }\n}\n","import { h, ref, computed, watch, Transition, onBeforeUnmount, getCurrentInstance } from 'vue'\n\nimport useAnchor, { useAnchorProps } from '../../composables/private/use-anchor.js'\nimport useScrollTarget from '../../composables/private/use-scroll-target.js'\nimport useModelToggle, { useModelToggleProps, useModelToggleEmits } from '../../composables/private/use-model-toggle.js'\nimport useDark, { useDarkProps } from '../../composables/private/use-dark.js'\nimport usePortal from '../../composables/private/use-portal.js'\nimport useTransition, { useTransitionProps } from '../../composables/private/use-transition.js'\nimport useTick from '../../composables/private/use-tick.js'\nimport useTimeout from '../../composables/private/use-timeout.js'\n\nimport { createComponent } from '../../utils/private/create.js'\nimport { closePortalMenus } from '../../utils/private/portal.js'\nimport { getScrollTarget } from '../../utils/scroll.js'\nimport { position, stopAndPrevent } from '../../utils/event.js'\nimport { hSlot } from '../../utils/private/render.js'\nimport { addEscapeKey, removeEscapeKey } from '../../utils/private/escape-key.js'\nimport { addFocusout, removeFocusout } from '../../utils/private/focusout.js'\nimport { childHasFocus } from '../../utils/dom.js'\nimport { addClickOutside, removeClickOutside } from '../../utils/private/click-outside.js'\nimport { addFocusFn } from '../../utils/private/focus-manager.js'\n\nimport {\n  validatePosition, validateOffset, setPosition, parsePosition\n} from '../../utils/private/position-engine.js'\n\nexport default createComponent({\n  name: 'QMenu',\n\n  inheritAttrs: false,\n\n  props: {\n    ...useAnchorProps,\n    ...useModelToggleProps,\n    ...useDarkProps,\n    ...useTransitionProps,\n\n    persistent: Boolean,\n    autoClose: Boolean,\n    separateClosePopup: Boolean,\n\n    noRouteDismiss: Boolean,\n    noRefocus: Boolean,\n    noFocus: Boolean,\n\n    fit: Boolean,\n    cover: Boolean,\n\n    square: Boolean,\n\n    anchor: {\n      type: String,\n      validator: validatePosition\n    },\n    self: {\n      type: String,\n      validator: validatePosition\n    },\n    offset: {\n      type: Array,\n      validator: validateOffset\n    },\n\n    scrollTarget: {\n      default: void 0\n    },\n\n    touchPosition: Boolean,\n\n    maxHeight: {\n      type: String,\n      default: null\n    },\n    maxWidth: {\n      type: String,\n      default: null\n    }\n  },\n\n  emits: [\n    ...useModelToggleEmits,\n    'click', 'escapeKey'\n  ],\n\n  setup (props, { slots, emit, attrs }) {\n    let refocusTarget = null, absoluteOffset, unwatchPosition, avoidAutoClose\n\n    const vm = getCurrentInstance()\n    const { proxy } = vm\n    const { $q } = proxy\n\n    const innerRef = ref(null)\n    const showing = ref(false)\n\n    const hideOnRouteChange = computed(() =>\n      props.persistent !== true\n      && props.noRouteDismiss !== true\n    )\n\n    const isDark = useDark(props, $q)\n    const { registerTick, removeTick } = useTick()\n    const { registerTimeout } = useTimeout()\n    const { transitionProps, transitionStyle } = useTransition(props)\n    const { localScrollTarget, changeScrollEvent, unconfigureScrollTarget } = useScrollTarget(props, configureScrollTarget)\n\n    const { anchorEl, canShow } = useAnchor({ showing })\n\n    const { hide } = useModelToggle({\n      showing, canShow, handleShow, handleHide,\n      hideOnRouteChange,\n      processOnMount: true\n    })\n\n    const { showPortal, hidePortal, renderPortal } = usePortal(vm, innerRef, renderPortalContent, 'menu')\n\n    const clickOutsideProps = {\n      anchorEl,\n      innerRef,\n      onClickOutside (e) {\n        if (props.persistent !== true && showing.value === true) {\n          hide(e)\n\n          if (\n            // always prevent touch event\n            e.type === 'touchstart'\n            // prevent click if it's on a dialog backdrop\n            || e.target.classList.contains('q-dialog__backdrop')\n          ) {\n            stopAndPrevent(e)\n          }\n\n          return true\n        }\n      }\n    }\n\n    const anchorOrigin = computed(() =>\n      parsePosition(\n        props.anchor || (\n          props.cover === true ? 'center middle' : 'bottom start'\n        ),\n        $q.lang.rtl\n      )\n    )\n\n    const selfOrigin = computed(() => (\n      props.cover === true\n        ? anchorOrigin.value\n        : parsePosition(props.self || 'top start', $q.lang.rtl)\n    ))\n\n    const menuClass = computed(() =>\n      (props.square === true ? ' q-menu--square' : '')\n      + (isDark.value === true ? ' q-menu--dark q-dark' : '')\n    )\n\n    const onEvents = computed(() => (\n      props.autoClose === true\n        ? { onClick: onAutoClose }\n        : {}\n    ))\n\n    const handlesFocus = computed(() =>\n      showing.value === true && props.persistent !== true\n    )\n\n    watch(handlesFocus, val => {\n      if (val === true) {\n        addEscapeKey(onEscapeKey)\n        addClickOutside(clickOutsideProps)\n      }\n      else {\n        removeEscapeKey(onEscapeKey)\n        removeClickOutside(clickOutsideProps)\n      }\n    })\n\n    function focus () {\n      addFocusFn(() => {\n        let node = innerRef.value\n\n        if (node && node.contains(document.activeElement) !== true) {\n          node = node.querySelector('[autofocus][tabindex], [data-autofocus][tabindex]')\n            || node.querySelector('[autofocus] [tabindex], [data-autofocus] [tabindex]')\n            || node.querySelector('[autofocus], [data-autofocus]')\n            || node\n          node.focus({ preventScroll: true })\n        }\n      })\n    }\n\n    function handleShow (evt) {\n      refocusTarget = props.noRefocus === false\n        ? document.activeElement\n        : null\n\n      addFocusout(onFocusout)\n\n      showPortal()\n      configureScrollTarget()\n\n      absoluteOffset = void 0\n\n      if (evt !== void 0 && (props.touchPosition || props.contextMenu)) {\n        const pos = position(evt)\n\n        if (pos.left !== void 0) {\n          const { top, left } = anchorEl.value.getBoundingClientRect()\n          absoluteOffset = { left: pos.left - left, top: pos.top - top }\n        }\n      }\n\n      if (unwatchPosition === void 0) {\n        unwatchPosition = watch(\n          () => $q.screen.width + '|' + $q.screen.height + '|' + props.self + '|' + props.anchor + '|' + $q.lang.rtl,\n          updatePosition\n        )\n      }\n\n      if (props.noFocus !== true) {\n        document.activeElement.blur()\n      }\n\n      // should removeTick() if this gets removed\n      registerTick(() => {\n        updatePosition()\n        props.noFocus !== true && focus()\n      })\n\n      // should removeTimeout() if this gets removed\n      registerTimeout(() => {\n        // required in order to avoid the \"double-tap needed\" issue\n        if ($q.platform.is.ios === true) {\n          // if auto-close, then this click should\n          // not close the menu\n          avoidAutoClose = props.autoClose\n          innerRef.value.click()\n        }\n\n        updatePosition()\n        showPortal(true) // done showing portal\n        emit('show', evt)\n      }, props.transitionDuration)\n    }\n\n    function handleHide (evt) {\n      removeTick()\n      hidePortal()\n\n      anchorCleanup(true)\n\n      if (\n        refocusTarget !== null\n        && (\n          // menu was hidden from code or ESC plugin\n          evt === void 0\n          // menu was not closed from a mouse or touch clickOutside\n          || evt.qClickOutside !== true\n        )\n      ) {\n        ((evt && evt.type.indexOf('key') === 0\n          ? refocusTarget.closest('[tabindex]:not([tabindex^=\"-\"])')\n          : void 0\n        ) || refocusTarget).focus()\n        refocusTarget = null\n      }\n\n      // should removeTimeout() if this gets removed\n      registerTimeout(() => {\n        hidePortal(true) // done hiding, now destroy\n        emit('hide', evt)\n      }, props.transitionDuration)\n    }\n\n    function anchorCleanup (hiding) {\n      absoluteOffset = void 0\n\n      if (unwatchPosition !== void 0) {\n        unwatchPosition()\n        unwatchPosition = void 0\n      }\n\n      if (hiding === true || showing.value === true) {\n        removeFocusout(onFocusout)\n        unconfigureScrollTarget()\n        removeClickOutside(clickOutsideProps)\n        removeEscapeKey(onEscapeKey)\n      }\n\n      if (hiding !== true) {\n        refocusTarget = null\n      }\n    }\n\n    function configureScrollTarget () {\n      if (anchorEl.value !== null || props.scrollTarget !== void 0) {\n        localScrollTarget.value = getScrollTarget(anchorEl.value, props.scrollTarget)\n        changeScrollEvent(localScrollTarget.value, updatePosition)\n      }\n    }\n\n    function onAutoClose (e) {\n      // if auto-close, then the ios double-tap fix which\n      // issues a click should not close the menu\n      if (avoidAutoClose !== true) {\n        closePortalMenus(proxy, e)\n        emit('click', e)\n      }\n      else {\n        avoidAutoClose = false\n      }\n    }\n\n    function onFocusout (evt) {\n      // the focus is not in a vue child component\n      if (\n        handlesFocus.value === true\n        && props.noFocus !== true\n        && childHasFocus(innerRef.value, evt.target) !== true\n      ) {\n        focus()\n      }\n    }\n\n    function onEscapeKey (evt) {\n      emit('escapeKey')\n      hide(evt)\n    }\n\n    function updatePosition () {\n      setPosition({\n        targetEl: innerRef.value,\n        offset: props.offset,\n        anchorEl: anchorEl.value,\n        anchorOrigin: anchorOrigin.value,\n        selfOrigin: selfOrigin.value,\n        absoluteOffset,\n        fit: props.fit,\n        cover: props.cover,\n        maxHeight: props.maxHeight,\n        maxWidth: props.maxWidth\n      })\n    }\n\n    function renderPortalContent () {\n      return h(\n        Transition,\n        transitionProps.value,\n        () => (\n          showing.value === true\n            ? h('div', {\n              role: 'menu',\n              ...attrs,\n              ref: innerRef,\n              tabindex: -1,\n              class: [\n                'q-menu q-position-engine scroll' + menuClass.value,\n                attrs.class\n              ],\n              style: [\n                attrs.style,\n                transitionStyle.value\n              ],\n              ...onEvents.value\n            }, hSlot(slots.default))\n            : null\n        )\n      )\n    }\n\n    onBeforeUnmount(anchorCleanup)\n\n    // expose public methods\n    Object.assign(proxy, { focus, updatePosition })\n\n    return renderPortal\n  }\n})\n","<script setup lang=\"ts\">\nimport { Notation, PieceAllegiance } from '@decentm/allegiance-chess-core'\n\nimport ChessPiece from './chess-piece.vue'\n\ndefineProps<{\n  modelValue: boolean\n  allegiance: PieceAllegiance\n}>()\n\nconst emit = defineEmits<{\n  (event: 'click', piece: Notation.Piece): void\n  (event: 'dismiss'): void\n}>()\n\nconst pieces: Notation.Piece[] = ['Q', 'N', 'R', 'B']\n\nconst handleDismiss = () => {\n  emit('dismiss')\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.promotion-piece {\n  width: 92px;\n  height: 92px;\n}\n</style>\n\n<template>\n  <q-menu cover :model-value=\"modelValue\" @update:model-value=\"handleDismiss\">\n    <q-list>\n      <q-item\n        clickable\n        v-for=\"piece in pieces\"\n        :key=\"piece\"\n        class=\"q-pa-sm\"\n        @click=\"emit('click', piece)\"\n      >\n        <q-item-section class=\"promotion-piece items-center\">\n          <chess-piece :allegiance=\"allegiance\" :piece=\"piece\" :size=\"92\" />\n        </q-item-section>\n      </q-item>\n    </q-list>\n  </q-menu>\n</template>\n","<script setup lang=\"ts\">\ndefineProps<{\n  modelValue: boolean\n  moves: Array<'x' | '>'>\n}>()\n\nconst emit = defineEmits<{\n  (event: 'click', choice: 'capture' | 'challenge'): void\n  (event: 'dismiss'): void\n}>()\n\nconst handleDismiss = () => {\n  emit('dismiss')\n}\n</script>\n\n<template>\n  <q-menu cover :model-value=\"modelValue\" @update:model-value=\"handleDismiss\">\n    <q-list>\n      <q-item\n        v-if=\"moves.includes('x')\"\n        clickable\n        @click=\"emit('click', 'capture')\"\n        class=\"q-py-lg\"\n      >\n        <q-item-section class=\"items-center\">\n          <q-icon size=\"72px\" name=\"close\" />\n        </q-item-section>\n      </q-item>\n\n      <q-item\n        v-if=\"moves.includes('>')\"\n        clickable\n        @click=\"emit('click', 'challenge')\"\n        class=\"q-py-lg\"\n      >\n        <q-item-section class=\"items-center\">\n          <q-icon size=\"64px\" name=\"arrow_forward_ios\" />\n        </q-item-section>\n      </q-item>\n    </q-list>\n  </q-menu>\n</template>\n","<script setup lang=\"ts\">\nimport { ComputedRef, computed, ref } from 'vue'\n\nimport {\n  Board,\n  coordinatesEqual,\n  isPromotion,\n  PieceAllegiance,\n  Notation,\n  allegianceSide,\n} from '@decentm/allegiance-chess-core'\n\nimport PromotionSelector from '../../promotion-selector.vue'\nimport CaptureSelector from '../../capture-selector.vue'\n\nconst props = defineProps<{\n  board: Board\n  squareSize: number\n  ranks: number\n  files: number\n  perspective: 'white' | 'black'\n  pieceFocus: Notation.Coordinates | null\n}>()\n\nconst captureFocus = ref<Notation.Coordinates | null>(null)\n\nconst enPassantTarget = computed(() => {\n  return props.board.enPassantTarget\n})\n\nconst showPromotionPopup = ref<Notation.Coordinates | null>(null)\nconst promotionAllegiance = ref<PieceAllegiance | null>(null)\n\nconst emit = defineEmits<{\n  (event: 'execute-node-index', index: number): void\n  (event: 'update-piece-focus', coords: Notation.Coordinates | null): void\n  (\n    event: 'update-highlights',\n    targets: Notation.Coordinates[],\n    captures: Notation.Coordinates[]\n  ): void\n}>()\n\nconst focusedSquare = computed(() => {\n  return props.pieceFocus ? props.board.getSquare(props.pieceFocus) : null\n})\n\nconst highlightSquares = computed(() => {\n  if (!props.pieceFocus) {\n    return []\n  }\n\n  const moves = props.board.getValidMoves(props.pieceFocus)\n\n  const result = moves\n    .map((node) => {\n      if (node.kind !== 'move') {\n        return null\n      }\n\n      return node.to\n    })\n    .filter(Boolean)\n\n  return result\n})\n\nconst isOpponent = (coords: Notation.Coordinates) => {\n  const square = props.board.getSquare(coords)\n\n  if (!square) {\n    return false\n  }\n\n  return allegianceSide(square.allegiance) !== props.perspective\n}\n\nconst isHighlighted = (coords: Notation.Coordinates) =>\n  highlightSquares.value.some(\n    (coordinate) => coordinate && coordinatesEqual(coords, coordinate)\n  )\n\nconst handleCoordsClick = (coords: Notation.Coordinates, event: MouseEvent) => {\n  event.stopPropagation()\n  event.preventDefault()\n\n  if (isHighlighted(coords) && props.pieceFocus && focusedSquare.value) {\n    if (\n      enPassantTarget.value &&\n      coordinatesEqual(enPassantTarget.value, coords)\n    ) {\n      emit(\n        'execute-node-index',\n        props.board.findMoveIndex({\n          kind: 'move',\n          type: 'en-passant',\n          from: props.pieceFocus,\n          to: coords,\n        })\n      )\n\n      emit('update-piece-focus', null)\n    } else if (\n      isPromotion(coords, props.board.activeColour) &&\n      focusedSquare &&\n      focusedSquare.value.piece === null\n    ) {\n      showPromotionPopup.value = coords\n\n      const fromSquare = props.board.getSquare(props.pieceFocus)\n      promotionAllegiance.value = fromSquare?.allegiance ?? null\n    } else if (props.board.getSquare(coords)) {\n      captureFocus.value = coords\n    } else if (\n      focusedSquare.value?.piece === 'K' &&\n      Math.abs(props.pieceFocus.file - coords.file) > 1\n    ) {\n      emit(\n        'execute-node-index',\n        props.board.findMoveIndex({\n          kind: 'move',\n          type: 'castle',\n          side: coords.file === 7 ? 'king' : 'queen',\n          from: props.pieceFocus,\n          to: coords,\n        })\n      )\n    } else {\n      emit(\n        'execute-node-index',\n        props.board.findMoveIndex({\n          kind: 'move',\n          from: props.pieceFocus,\n          to: coords,\n        })\n      )\n    }\n\n    return\n  }\n\n  if (isOpponent(coords)) {\n    return\n  }\n\n  const square = props.board.getSquare(coords)\n\n  emit('update-piece-focus', square ? coords : null)\n}\n\nconst handlePromotion = (\n  coords: Notation.Coordinates,\n  piece: Notation.Piece\n) => {\n  if (!props.pieceFocus) {\n    return\n  }\n\n  showPromotionPopup.value = null\n\n  const index = props.board.findMoveIndex({\n    kind: 'move',\n    type: 'promotion',\n    from: props.pieceFocus,\n    to: coords,\n    promotionTo: piece,\n  })\n\n  emit('execute-node-index', index)\n\n  emit('update-piece-focus', null)\n}\n\nconst handlePromotionDismiss = () => {\n  showPromotionPopup.value = null\n  promotionAllegiance.value = null\n}\n\nconst handleCaptureDismiss = () => {\n  captureFocus.value = null\n}\n\nconst handleCaptureClick = (decision: 'capture' | 'challenge') => {\n  if (!props.pieceFocus || !captureFocus.value) {\n    return\n  }\n\n  const index = props.board.findMoveIndex({\n    kind: 'move',\n    type: decision === 'capture' ? 'capture' : 'allegiance',\n    from: props.pieceFocus,\n    to: captureFocus.value,\n  })\n\n  emit('execute-node-index', index)\n\n  captureFocus.value = null\n\n  emit('update-piece-focus', null)\n}\n\nconst indexToCoords = (\n  fileIndex: number,\n  rankIndex: number\n): Notation.Coordinates => {\n  const rawFile = fileIndex + 1\n  const rawRank = rankIndex + 1\n\n  if (props.perspective === 'white') {\n    return {\n      file: rawFile as Notation.File,\n      rank: (9 - rawRank) as Notation.Rank,\n    }\n  }\n\n  return {\n    file: (9 - rawFile) as Notation.File,\n    rank: rawRank as Notation.Rank,\n  }\n}\n\nconst coordsEmpty = (coords: Notation.Coordinates) => {\n  return !props.board.getSquare(coords)\n}\n\nconst canMove = (\n  type: 'capture' | 'allegiance',\n  from: Notation.Coordinates,\n  to: Notation.Coordinates\n) => {\n  const moves = props.board.getValidMoves()\n\n  return moves.some((move) => {\n    return (\n      move.kind === 'move' &&\n      coordinatesEqual(move.to, to) &&\n      coordinatesEqual(move.from, from) &&\n      move.type === type\n    )\n  })\n}\n\nconst captureMoves: ComputedRef<Array<'x' | '>'>> = computed(() => {\n  const result: Array<'x' | '>'> = []\n\n  if (!props.pieceFocus || !captureFocus.value) {\n    return result\n  }\n\n  if (canMove('allegiance', props.pieceFocus, captureFocus.value)) {\n    result.push('>')\n  }\n\n  if (canMove('capture', props.pieceFocus, captureFocus.value)) {\n    result.push('x')\n  }\n\n  return result\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.interaction-layer {\n  z-index: 4;\n}\n</style>\n\n<template>\n  <div class=\"relative-position full-width full-height interaction-layer\">\n    <div\n      class=\"col column row full-width\"\n      v-for=\"(_, rankIndex) in ranks\"\n      :key=\"rankIndex\"\n    >\n      <div v-for=\"(_, fileIndex) in files\" :key=\"fileIndex\" class=\"full-height\">\n        <div\n          v-ripple=\"\n            !coordsEmpty(indexToCoords(fileIndex, rankIndex)) &&\n            !isOpponent(indexToCoords(fileIndex, rankIndex))\n          \"\n          class=\"absolute\"\n          @click=\"\n            (event) =>\n              handleCoordsClick(indexToCoords(fileIndex, rankIndex), event)\n          \"\n          :class=\"{\n            'cursor-pointer':\n              !coordsEmpty(indexToCoords(fileIndex, rankIndex)) ||\n              isHighlighted(indexToCoords(fileIndex, rankIndex)),\n            'cursor-not-allowed':\n              isOpponent(indexToCoords(fileIndex, rankIndex)) && !focusedSquare,\n          }\"\n          :style=\"\n            perspective === 'white'\n              ? {\n                  width: `${squareSize}px`,\n                  height: `${squareSize}px`,\n                  left: `${\n                    (indexToCoords(fileIndex, rankIndex).file - 1) * squareSize\n                  }px`,\n                  bottom: `${\n                    (indexToCoords(fileIndex, rankIndex).rank - 1) * squareSize\n                  }px`,\n                }\n              : {\n                  width: `${squareSize}px`,\n                  height: `${squareSize}px`,\n                  right: `${\n                    (indexToCoords(fileIndex, rankIndex).file - 1) * squareSize\n                  }px`,\n                  top: `${\n                    (indexToCoords(fileIndex, rankIndex).rank - 1) * squareSize\n                  }px`,\n                }\n          \"\n        >\n          <capture-selector\n            v-if=\"\n              captureFocus &&\n              coordinatesEqual(\n                captureFocus,\n                indexToCoords(fileIndex, rankIndex)\n              )\n            \"\n            :moves=\"captureMoves\"\n            :model-value=\"\n              coordinatesEqual(\n                captureFocus,\n                indexToCoords(fileIndex, rankIndex)\n              ) ?? false\n            \"\n            :size=\"squareSize\"\n            @click=\"handleCaptureClick\"\n            @dismiss=\"handleCaptureDismiss\"\n          />\n\n          <promotion-selector\n            v-if=\"\n              promotionAllegiance !== null &&\n              (isPromotion(indexToCoords(fileIndex, rankIndex), 'white') ||\n                isPromotion(indexToCoords(fileIndex, rankIndex), 'black'))\n            \"\n            :model-value=\"\n              coordinatesEqual(\n                showPromotionPopup,\n                indexToCoords(fileIndex, rankIndex)\n              ) ?? false\n            \"\n            :allegiance=\"promotionAllegiance\"\n            :size=\"squareSize\"\n            @click=\"\n              (piece) =>\n                handlePromotion(indexToCoords(fileIndex, rankIndex), piece)\n            \"\n            @dismiss=\"handlePromotionDismiss\"\n          />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport {\n  Board,\n  Notation,\n  coordinatesEqual,\n} from '@decentm/allegiance-chess-core'\n\nconst props = defineProps<{\n  board: Board\n  ranks: number\n  files: number\n  squareSize: number\n  perspective: 'white' | 'black'\n  pieceFocus: Notation.Coordinates | null\n  lastMove: Notation.Node | null\n}>()\n\nconst highlightSquares = computed(() => {\n  if (!props.pieceFocus) {\n    return []\n  }\n\n  const moves = props.board.getValidMoves(props.pieceFocus)\n\n  const result = moves\n    .map((node) => {\n      if (node.kind !== 'move') {\n        return null\n      }\n\n      return node.to\n    })\n    .filter(Boolean)\n\n  return result\n})\n\nconst show = (coords: Notation.Coordinates) =>\n  highlightSquares.value.some(\n    (coordinate) => coordinate && coordinatesEqual(coords, coordinate)\n  )\n\nconst coordsEmpty = (coords: Notation.Coordinates) => {\n  return !props.board.getSquare(coords)\n}\n\nconst indexToCoords = (\n  fileIndex: number,\n  rankIndex: number\n): Notation.Coordinates => {\n  const rawFile = fileIndex + 1\n  const rawRank = rankIndex + 1\n\n  if (props.perspective === 'white') {\n    return {\n      file: rawFile as Notation.File,\n      rank: (9 - rawRank) as Notation.Rank,\n    }\n  }\n\n  return {\n    file: (9 - rawFile) as Notation.File,\n    rank: rawRank as Notation.Rank,\n  }\n}\n\nconst checkMoves = computed(() => {\n  return props.board.getCheckMoves()\n})\n\nconst isChecked = (coords: Notation.Coordinates) => {\n  return checkMoves.value.some(\n    (move) => move.kind === 'move' && coordinatesEqual(move.to, coords)\n  )\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.indicators-layer {\n  z-index: 2;\n}\n\n.move-placeholder {\n  position: relative;\n\n  transition-property: outline-color;\n  transition-duration: 0.1s;\n  transition-timing-function: linear;\n  transition-delay: inherit;\n\n  outline-color: transparent;\n\n  &::before {\n    filter: blur(1px);\n\n    display: block;\n    position: absolute;\n    content: '';\n    border-radius: 50%;\n    z-index: 2;\n\n    background-color: rgba(0, 0, 0, 0);\n    border-color: rgba(0, 0, 0, 0);\n\n    transition-property: background-color, border-color;\n    transition-duration: inherit;\n    transition-timing-function: inherit;\n    transition-delay: inherit;\n  }\n\n  &.checked {\n    &::before {\n      background-color: $negative;\n      opacity: 0.8;\n      filter: blur(15px);\n    }\n  }\n\n  &.focus {\n    border-radius: 1rem;\n\n    outline-width: 0.25rem;\n    outline-style: dashed;\n    outline-offset: -0.5rem;\n\n    &.even {\n      outline-color: $chess-black;\n    }\n\n    &:not(.even) {\n      outline-color: $chess-white;\n    }\n  }\n\n  &.target {\n    &::before {\n      height: 33%;\n      width: 33%;\n      left: 33%;\n      top: 33%;\n    }\n  }\n\n  &.capture {\n    &::before {\n      height: 90%;\n      width: 90%;\n      left: 5%;\n      top: 5%;\n\n      border-width: 1rem;\n      border-style: solid;\n    }\n  }\n\n  &.show {\n    &::before {\n      pointer-events: all;\n    }\n\n    &.target {\n      &::before {\n        background-color: rgba(0, 0, 0, 0.2);\n      }\n    }\n\n    &.capture {\n      &::before {\n        border-color: rgba(0, 0, 0, 0.2);\n      }\n    }\n  }\n\n  &.last {\n    &-from {\n      background-color: rgba($chess-highlight, 0.5);\n    }\n\n    &-to {\n      background-color: rgba($chess-highlight, 0.7);\n    }\n  }\n}\n</style>\n\n<template>\n  <div\n    class=\"relative-position full-width full-height column no-pointer-events indicators-layer\"\n  >\n    <div\n      class=\"col column row full-width\"\n      v-for=\"(_, rankIndex) in ranks\"\n      :key=\"rankIndex\"\n    >\n      <div\n        v-for=\"(_, fileIndex) in files\"\n        :key=\"fileIndex\"\n        class=\"full-height move-placeholder\"\n        :class=\"{\n          even: rankIndex % 2 === 0 ? fileIndex % 2 === 0 : fileIndex % 2 !== 0,\n          focus: coordinatesEqual(\n            pieceFocus,\n            indexToCoords(fileIndex, rankIndex)\n          ),\n          show: show(indexToCoords(fileIndex, rankIndex)),\n          capture: !coordsEmpty(indexToCoords(fileIndex, rankIndex)),\n          target: coordsEmpty(indexToCoords(fileIndex, rankIndex)),\n          checked: isChecked(indexToCoords(fileIndex, rankIndex)),\n          'last-from':\n            lastMove?.kind === 'move' &&\n            coordinatesEqual(\n              lastMove.from,\n              indexToCoords(fileIndex, rankIndex)\n            ),\n          'last-to':\n            lastMove?.kind === 'move' &&\n            coordinatesEqual(lastMove.to, indexToCoords(fileIndex, rankIndex)),\n        }\"\n      />\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { useQuasar } from 'quasar'\nimport { BoardSquare, Notation } from '@decentm/allegiance-chess-core'\n\nimport ChessPiece from '../../chess-piece.vue'\n\ndefineProps<{\n  modelValue: Array<Notation.Coordinates & BoardSquare>\n  squareSize: number\n  perspective: 'white' | 'black'\n}>()\n\nconst q = useQuasar()\n</script>\n\n<style lang=\"scss\" scoped>\n.pieces-layer {\n  z-index: 3;\n}\n</style>\n\n<template>\n  <div\n    class=\"relative-position full-width full-height no-pointer-events pieces-layer\"\n  >\n    <div v-for=\"(square, index) in modelValue\" :key=\"index\">\n      <chess-piece\n        v-if=\"square\"\n        data-testid=\"piece\"\n        class=\"absolute\"\n        :class=\"{\n          'q-pa-xs': q.screen.sm || q.screen.md,\n          'q-pa-sm': q.screen.gt.sm,\n        }\"\n        :piece=\"square.piece\"\n        :allegiance=\"square.allegiance\"\n        :size=\"squareSize\"\n        :style=\"\n          perspective === 'white'\n            ? {\n                left: `${(square.file - 1) * squareSize}px`,\n                bottom: `${(square.rank - 1) * squareSize}px`,\n              }\n            : {\n                right: `${(square.file - 1) * squareSize}px`,\n                top: `${(square.rank - 1) * squareSize}px`,\n              }\n        \"\n      />\n\n      <div\n        v-else\n        :style=\"{ width: `${squareSize}px`, height: `${squareSize}px` }\"\n      ></div>\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\n\nimport { Board, Notation } from '@decentm/allegiance-chess-core'\n\nimport BackgroundLayer from './board/layers/background-layer.vue'\nimport InteractionLayer from './board/layers/interaction-layer.vue'\nimport IndicatorsLayer from './board/layers/indicators-layer.vue'\nimport PiecesLayer from './board/layers/pieces-layer.vue'\n\nconst props = defineProps<{\n  board: Board\n  width: number\n  perspective: 'black' | 'white'\n  playAs: Array<'black' | 'white'>\n  roundedBorders?: boolean\n}>()\n\nconst emit = defineEmits<{\n  (event: 'execute-node-index', value: number): void\n}>()\n\nconst squareSize = computed(() => {\n  return props.width / 8\n})\n\nconst pieceFocus = ref<Notation.Coordinates | null>(null)\n\nconst handleExcuteNodeIndex = (index: number) => {\n  emit('execute-node-index', index)\n  pieceFocus.value = null\n}\n\nconst lastMove = computed(() => {\n  const ast = props.board.getMoveHistoryAst()\n\n  return ast.children.at(-1) ?? null\n})\n</script>\n\n<template>\n  <div\n    data-testid=\"chess-board\"\n    class=\"relative-position column\"\n    :class=\"{ 'rounded-borders overflow-hidden': roundedBorders }\"\n    :style=\"{ width: props.width + 'px', height: props.width + 'px' }\"\n  >\n    <div class=\"absolute full-width full-height\">\n      <background-layer :ranks=\"8\" :files=\"8\" :perspective=\"perspective\" />\n    </div>\n\n    <div class=\"absolute full-width full-height\">\n      <indicators-layer\n        :board=\"board\"\n        :square-size=\"squareSize\"\n        :files=\"8\"\n        :ranks=\"8\"\n        :perspective=\"perspective\"\n        :piece-focus=\"pieceFocus\"\n        :last-move=\"lastMove\"\n      />\n    </div>\n\n    <div class=\"absolute full-width full-height\">\n      <pieces-layer\n        :model-value=\"board.getSquares()\"\n        :perspective=\"props.perspective\"\n        :square-size=\"squareSize\"\n      />\n    </div>\n\n    <div class=\"absolute full-width full-height\">\n      <interaction-layer\n        @execute-node-index=\"handleExcuteNodeIndex\"\n        @update-piece-focus=\"(focus) => (pieceFocus = focus)\"\n        :piece-focus=\"pieceFocus\"\n        :board=\"board\"\n        :square-size=\"squareSize\"\n        :files=\"8\"\n        :ranks=\"8\"\n        :perspective=\"props.perspective\"\n      />\n    </div>\n  </div>\n</template>\n","import { h, computed, getCurrentInstance } from 'vue'\n\nimport QIcon from '../icon/QIcon.js'\n\nimport Ripple from '../../directives/Ripple.js'\n\nimport useDark, { useDarkProps } from '../../composables/private/use-dark.js'\nimport useSize, { useSizeProps } from '../../composables/private/use-size.js'\n\nimport { createComponent } from '../../utils/private/create.js'\nimport { stopAndPrevent } from '../../utils/event.js'\nimport { hMergeSlotSafely, hDir } from '../../utils/private/render.js'\n\nexport const defaultSizes = {\n  xs: 8,\n  sm: 10,\n  md: 14,\n  lg: 20,\n  xl: 24\n}\n\nexport default createComponent({\n  name: 'QChip',\n\n  props: {\n    ...useDarkProps,\n    ...useSizeProps,\n\n    dense: Boolean,\n\n    icon: String,\n    iconRight: String,\n    iconRemove: String,\n    iconSelected: String,\n    label: [ String, Number ],\n\n    color: String,\n    textColor: String,\n\n    modelValue: {\n      type: Boolean,\n      default: true\n    },\n    selected: {\n      type: Boolean,\n      default: null\n    },\n\n    square: Boolean,\n    outline: Boolean,\n    clickable: Boolean,\n    removable: Boolean,\n\n    removeAriaLabel: String,\n\n    tabindex: [ String, Number ],\n    disable: Boolean,\n\n    ripple: {\n      type: [ Boolean, Object ],\n      default: true\n    }\n  },\n\n  emits: [ 'update:modelValue', 'update:selected', 'remove', 'click' ],\n\n  setup (props, { slots, emit }) {\n    const { proxy: { $q } } = getCurrentInstance()\n\n    const isDark = useDark(props, $q)\n    const sizeStyle = useSize(props, defaultSizes)\n\n    const hasLeftIcon = computed(() => props.selected === true || props.icon !== void 0)\n\n    const leftIcon = computed(() => (\n      props.selected === true\n        ? props.iconSelected || $q.iconSet.chip.selected\n        : props.icon\n    ))\n\n    const removeIcon = computed(() => props.iconRemove || $q.iconSet.chip.remove)\n\n    const isClickable = computed(() =>\n      props.disable === false\n      && (props.clickable === true || props.selected !== null)\n    )\n\n    const classes = computed(() => {\n      const text = props.outline === true\n        ? props.color || props.textColor\n        : props.textColor\n\n      return 'q-chip row inline no-wrap items-center'\n        + (props.outline === false && props.color !== void 0 ? ` bg-${ props.color }` : '')\n        + (text ? ` text-${ text } q-chip--colored` : '')\n        + (props.disable === true ? ' disabled' : '')\n        + (props.dense === true ? ' q-chip--dense' : '')\n        + (props.outline === true ? ' q-chip--outline' : '')\n        + (props.selected === true ? ' q-chip--selected' : '')\n        + (isClickable.value === true ? ' q-chip--clickable cursor-pointer non-selectable q-hoverable' : '')\n        + (props.square === true ? ' q-chip--square' : '')\n        + (isDark.value === true ? ' q-chip--dark q-dark' : '')\n    })\n\n    const attributes = computed(() => {\n      const chip = props.disable === true\n        ? { tabindex: -1, 'aria-disabled': 'true' }\n        : { tabindex: props.tabindex || 0 }\n      const remove = {\n        ...chip,\n        role: 'button',\n        'aria-hidden': 'false',\n        'aria-label': props.removeAriaLabel || $q.lang.label.remove\n      }\n\n      return { chip, remove }\n    })\n\n    function onKeyup (e) {\n      e.keyCode === 13 /* ENTER */ && onClick(e)\n    }\n\n    function onClick (e) {\n      if (!props.disable) {\n        emit('update:selected', !props.selected)\n        emit('click', e)\n      }\n    }\n\n    function onRemove (e) {\n      if (e.keyCode === void 0 || e.keyCode === 13) {\n        stopAndPrevent(e)\n        if (props.disable === false) {\n          emit('update:modelValue', false)\n          emit('remove')\n        }\n      }\n    }\n\n    function getContent () {\n      const child = []\n\n      isClickable.value === true && child.push(\n        h('div', { class: 'q-focus-helper' })\n      )\n\n      hasLeftIcon.value === true && child.push(\n        h(QIcon, {\n          class: 'q-chip__icon q-chip__icon--left',\n          name: leftIcon.value\n        })\n      )\n\n      const label = props.label !== void 0\n        ? [ h('div', { class: 'ellipsis' }, [ props.label ]) ]\n        : void 0\n\n      child.push(\n        h('div', {\n          class: 'q-chip__content col row no-wrap items-center q-anchor--skip'\n        }, hMergeSlotSafely(slots.default, label))\n      )\n\n      props.iconRight && child.push(\n        h(QIcon, {\n          class: 'q-chip__icon q-chip__icon--right',\n          name: props.iconRight\n        })\n      )\n\n      props.removable === true && child.push(\n        h(QIcon, {\n          class: 'q-chip__icon q-chip__icon--remove cursor-pointer',\n          name: removeIcon.value,\n          ...attributes.value.remove,\n          onClick: onRemove,\n          onKeyup: onRemove\n        })\n      )\n\n      return child\n    }\n\n    return () => {\n      if (props.modelValue === false) { return }\n\n      const data = {\n        class: classes.value,\n        style: sizeStyle.value\n      }\n\n      isClickable.value === true && Object.assign(\n        data,\n        attributes.value.chip,\n        { onClick, onKeyup }\n      )\n\n      return hDir(\n        'div',\n        data,\n        getContent(),\n        'ripple',\n        props.ripple !== false && props.disable !== true,\n        () => [ [ Ripple, props.ripple ] ]\n      )\n    }\n  }\n})\n","import { h, ref, computed, watch, withDirectives, onActivated, onDeactivated, onBeforeUnmount, getCurrentInstance } from 'vue'\n\nimport useDark, { useDarkProps } from '../../composables/private/use-dark.js'\n\nimport QResizeObserver from '../resize-observer/QResizeObserver.js'\nimport QScrollObserver from '../scroll-observer/QScrollObserver.js'\n\nimport TouchPan from '../../directives/TouchPan.js'\n\nimport { createComponent } from '../../utils/private/create.js'\nimport { between } from '../../utils/format.js'\nimport { setVerticalScrollPosition, setHorizontalScrollPosition } from '../../utils/scroll.js'\nimport { hMergeSlot } from '../../utils/private/render.js'\nimport debounce from '../../utils/debounce.js'\n\nconst axisList = [ 'vertical', 'horizontal' ]\nconst dirProps = {\n  vertical: { offset: 'offsetY', scroll: 'scrollTop', dir: 'down', dist: 'y' },\n  horizontal: { offset: 'offsetX', scroll: 'scrollLeft', dir: 'right', dist: 'x' }\n}\nconst panOpts = {\n  prevent: true,\n  mouse: true,\n  mouseAllDir: true\n}\n\nconst getMinThumbSize = size => (size >= 250 ? 50 : Math.ceil(size / 5))\n\nexport default createComponent({\n  name: 'QScrollArea',\n\n  props: {\n    ...useDarkProps,\n\n    thumbStyle: Object,\n    verticalThumbStyle: Object,\n    horizontalThumbStyle: Object,\n\n    barStyle: [ Array, String, Object ],\n    verticalBarStyle: [ Array, String, Object ],\n    horizontalBarStyle: [ Array, String, Object ],\n\n    contentStyle: [ Array, String, Object ],\n    contentActiveStyle: [ Array, String, Object ],\n\n    delay: {\n      type: [ String, Number ],\n      default: 1000\n    },\n\n    visible: {\n      type: Boolean,\n      default: null\n    },\n\n    tabindex: [ String, Number ],\n\n    onScroll: Function\n  },\n\n  setup (props, { slots, emit }) {\n    // state management\n    const tempShowing = ref(false)\n    const panning = ref(false)\n    const hover = ref(false)\n\n    // other...\n    const container = {\n      vertical: ref(0),\n      horizontal: ref(0)\n    }\n\n    const scroll = {\n      vertical: {\n        ref: ref(null),\n        position: ref(0),\n        size: ref(0)\n      },\n\n      horizontal: {\n        ref: ref(null),\n        position: ref(0),\n        size: ref(0)\n      }\n    }\n\n    const { proxy } = getCurrentInstance()\n\n    const isDark = useDark(props, proxy.$q)\n\n    let timer = null, panRefPos\n\n    const targetRef = ref(null)\n\n    const classes = computed(() =>\n      'q-scrollarea'\n      + (isDark.value === true ? ' q-scrollarea--dark' : '')\n    )\n\n    scroll.vertical.percentage = computed(() => {\n      const diff = scroll.vertical.size.value - container.vertical.value\n      if (diff <= 0) { return 0 }\n      const p = between(scroll.vertical.position.value / diff, 0, 1)\n      return Math.round(p * 10000) / 10000\n    })\n    scroll.vertical.thumbHidden = computed(() =>\n      (\n        (props.visible === null ? hover.value : props.visible) !== true\n        && tempShowing.value === false\n        && panning.value === false\n      ) || scroll.vertical.size.value <= container.vertical.value + 1\n    )\n    scroll.vertical.thumbStart = computed(() =>\n      scroll.vertical.percentage.value * (container.vertical.value - scroll.vertical.thumbSize.value)\n    )\n    scroll.vertical.thumbSize = computed(() =>\n      Math.round(\n        between(\n          container.vertical.value * container.vertical.value / scroll.vertical.size.value,\n          getMinThumbSize(container.vertical.value),\n          container.vertical.value\n        )\n      )\n    )\n    scroll.vertical.style = computed(() => {\n      return {\n        ...props.thumbStyle,\n        ...props.verticalThumbStyle,\n        top: `${ scroll.vertical.thumbStart.value }px`,\n        height: `${ scroll.vertical.thumbSize.value }px`\n      }\n    })\n    scroll.vertical.thumbClass = computed(() =>\n      'q-scrollarea__thumb q-scrollarea__thumb--v absolute-right'\n      + (scroll.vertical.thumbHidden.value === true ? ' q-scrollarea__thumb--invisible' : '')\n    )\n    scroll.vertical.barClass = computed(() =>\n      'q-scrollarea__bar q-scrollarea__bar--v absolute-right'\n      + (scroll.vertical.thumbHidden.value === true ? ' q-scrollarea__bar--invisible' : '')\n    )\n\n    scroll.horizontal.percentage = computed(() => {\n      const diff = scroll.horizontal.size.value - container.horizontal.value\n      if (diff <= 0) { return 0 }\n      const p = between(Math.abs(scroll.horizontal.position.value) / diff, 0, 1)\n      return Math.round(p * 10000) / 10000\n    })\n    scroll.horizontal.thumbHidden = computed(() =>\n      (\n        (props.visible === null ? hover.value : props.visible) !== true\n        && tempShowing.value === false\n        && panning.value === false\n      ) || scroll.horizontal.size.value <= container.horizontal.value + 1\n    )\n    scroll.horizontal.thumbStart = computed(() =>\n      scroll.horizontal.percentage.value * (container.horizontal.value - scroll.horizontal.thumbSize.value)\n    )\n    scroll.horizontal.thumbSize = computed(() =>\n      Math.round(\n        between(\n          container.horizontal.value * container.horizontal.value / scroll.horizontal.size.value,\n          getMinThumbSize(container.horizontal.value),\n          container.horizontal.value\n        )\n      )\n    )\n    scroll.horizontal.style = computed(() => {\n      return {\n        ...props.thumbStyle,\n        ...props.horizontalThumbStyle,\n        [ proxy.$q.lang.rtl === true ? 'right' : 'left' ]: `${ scroll.horizontal.thumbStart.value }px`,\n        width: `${ scroll.horizontal.thumbSize.value }px`\n      }\n    })\n    scroll.horizontal.thumbClass = computed(() =>\n      'q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom'\n      + (scroll.horizontal.thumbHidden.value === true ? ' q-scrollarea__thumb--invisible' : '')\n    )\n    scroll.horizontal.barClass = computed(() =>\n      'q-scrollarea__bar q-scrollarea__bar--h absolute-bottom'\n      + (scroll.horizontal.thumbHidden.value === true ? ' q-scrollarea__bar--invisible' : '')\n    )\n\n    const mainStyle = computed(() => (\n      scroll.vertical.thumbHidden.value === true && scroll.horizontal.thumbHidden.value === true\n        ? props.contentStyle\n        : props.contentActiveStyle\n    ))\n\n    const thumbVertDir = [ [\n      TouchPan,\n      e => { onPanThumb(e, 'vertical') },\n      void 0,\n      { vertical: true, ...panOpts }\n    ] ]\n\n    const thumbHorizDir = [ [\n      TouchPan,\n      e => { onPanThumb(e, 'horizontal') },\n      void 0,\n      { horizontal: true, ...panOpts }\n    ] ]\n\n    function getScroll () {\n      const info = {}\n\n      axisList.forEach(axis => {\n        const data = scroll[ axis ]\n\n        info[ axis + 'Position' ] = data.position.value\n        info[ axis + 'Percentage' ] = data.percentage.value\n        info[ axis + 'Size' ] = data.size.value\n        info[ axis + 'ContainerSize' ] = container[ axis ].value\n      })\n\n      return info\n    }\n\n    // we have lots of listeners, so\n    // ensure we're not emitting same info\n    // multiple times\n    const emitScroll = debounce(() => {\n      const info = getScroll()\n      info.ref = proxy\n      emit('scroll', info)\n    }, 0)\n\n    function localSetScrollPosition (axis, offset, duration) {\n      if (axisList.includes(axis) === false) {\n        console.error('[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)')\n        return\n      }\n\n      const fn = axis === 'vertical'\n        ? setVerticalScrollPosition\n        : setHorizontalScrollPosition\n\n      fn(targetRef.value, offset, duration)\n    }\n\n    function updateContainer ({ height, width }) {\n      let change = false\n\n      if (container.vertical.value !== height) {\n        container.vertical.value = height\n        change = true\n      }\n\n      if (container.horizontal.value !== width) {\n        container.horizontal.value = width\n        change = true\n      }\n\n      change === true && startTimer()\n    }\n\n    function updateScroll ({ position }) {\n      let change = false\n\n      if (scroll.vertical.position.value !== position.top) {\n        scroll.vertical.position.value = position.top\n        change = true\n      }\n\n      if (scroll.horizontal.position.value !== position.left) {\n        scroll.horizontal.position.value = position.left\n        change = true\n      }\n\n      change === true && startTimer()\n    }\n\n    function updateScrollSize ({ height, width }) {\n      if (scroll.horizontal.size.value !== width) {\n        scroll.horizontal.size.value = width\n        startTimer()\n      }\n\n      if (scroll.vertical.size.value !== height) {\n        scroll.vertical.size.value = height\n        startTimer()\n      }\n    }\n\n    function onPanThumb (e, axis) {\n      const data = scroll[ axis ]\n\n      if (e.isFirst === true) {\n        if (data.thumbHidden.value === true) {\n          return\n        }\n\n        panRefPos = data.position.value\n        panning.value = true\n      }\n      else if (panning.value !== true) {\n        return\n      }\n\n      if (e.isFinal === true) {\n        panning.value = false\n      }\n\n      const dProp = dirProps[ axis ]\n      const containerSize = container[ axis ].value\n\n      const multiplier = (data.size.value - containerSize) / (containerSize - data.thumbSize.value)\n      const distance = e.distance[ dProp.dist ]\n      const pos = panRefPos + (e.direction === dProp.dir ? 1 : -1) * distance * multiplier\n\n      setScroll(pos, axis)\n    }\n\n    function onMousedown (evt, axis) {\n      const data = scroll[ axis ]\n\n      if (data.thumbHidden.value !== true) {\n        const offset = evt[ dirProps[ axis ].offset ]\n        if (offset < data.thumbStart.value || offset > data.thumbStart.value + data.thumbSize.value) {\n          const pos = offset - data.thumbSize.value / 2\n          setScroll(pos / container[ axis ].value * data.size.value, axis)\n        }\n\n        // activate thumb pan\n        if (data.ref.value !== null) {\n          data.ref.value.dispatchEvent(new MouseEvent(evt.type, evt))\n        }\n      }\n    }\n\n    function onVerticalMousedown (evt) {\n      onMousedown(evt, 'vertical')\n    }\n\n    function onHorizontalMousedown (evt) {\n      onMousedown(evt, 'horizontal')\n    }\n\n    function startTimer () {\n      tempShowing.value = true\n\n      timer !== null && clearTimeout(timer)\n      timer = setTimeout(() => {\n        timer = null\n        tempShowing.value = false\n      }, props.delay)\n\n      props.onScroll !== void 0 && emitScroll()\n    }\n\n    function setScroll (offset, axis) {\n      targetRef.value[ dirProps[ axis ].scroll ] = offset\n    }\n\n    function onMouseenter () {\n      hover.value = true\n    }\n\n    function onMouseleave () {\n      hover.value = false\n    }\n\n    let scrollPosition = null\n\n    watch(() => proxy.$q.lang.rtl, rtl => {\n      if (targetRef.value !== null) {\n        setHorizontalScrollPosition(\n          targetRef.value,\n          Math.abs(scroll.horizontal.position.value) * (rtl === true ? -1 : 1)\n        )\n      }\n    })\n\n    onDeactivated(() => {\n      scrollPosition = {\n        top: scroll.vertical.position.value,\n        left: scroll.horizontal.position.value\n      }\n    })\n\n    onActivated(() => {\n      if (scrollPosition === null) { return }\n\n      const scrollTarget = targetRef.value\n\n      if (scrollTarget !== null) {\n        setHorizontalScrollPosition(scrollTarget, scrollPosition.left)\n        setVerticalScrollPosition(scrollTarget, scrollPosition.top)\n      }\n    })\n\n    onBeforeUnmount(emitScroll.cancel)\n\n    // expose public methods\n    Object.assign(proxy, {\n      getScrollTarget: () => targetRef.value,\n      getScroll,\n      getScrollPosition: () => ({\n        top: scroll.vertical.position.value,\n        left: scroll.horizontal.position.value\n      }),\n      getScrollPercentage: () => ({\n        top: scroll.vertical.percentage.value,\n        left: scroll.horizontal.percentage.value\n      }),\n      setScrollPosition: localSetScrollPosition,\n      setScrollPercentage (axis, percentage, duration) {\n        localSetScrollPosition(\n          axis,\n          percentage\n            * (scroll[ axis ].size.value - container[ axis ].value)\n            * (axis === 'horizontal' && proxy.$q.lang.rtl === true ? -1 : 1),\n          duration\n        )\n      }\n    })\n\n    return () => {\n      return h('div', {\n        class: classes.value,\n        onMouseenter,\n        onMouseleave\n      }, [\n        h('div', {\n          ref: targetRef,\n          class: 'q-scrollarea__container scroll relative-position fit hide-scrollbar',\n          tabindex: props.tabindex !== void 0 ? props.tabindex : void 0\n        }, [\n          h('div', {\n            class: 'q-scrollarea__content absolute',\n            style: mainStyle.value\n          }, hMergeSlot(slots.default, [\n            h(QResizeObserver, {\n              debounce: 0,\n              onResize: updateScrollSize\n            })\n          ])),\n\n          h(QScrollObserver, {\n            axis: 'both',\n            onScroll: updateScroll\n          })\n        ]),\n\n        h(QResizeObserver, {\n          debounce: 0,\n          onResize: updateContainer\n        }),\n\n        h('div', {\n          class: scroll.vertical.barClass.value,\n          style: [ props.barStyle, props.verticalBarStyle ],\n          'aria-hidden': 'true',\n          onMousedown: onVerticalMousedown\n        }),\n\n        h('div', {\n          class: scroll.horizontal.barClass.value,\n          style: [ props.barStyle, props.horizontalBarStyle ],\n          'aria-hidden': 'true',\n          onMousedown: onHorizontalMousedown\n        }),\n\n        withDirectives(\n          h('div', {\n            ref: scroll.vertical.ref,\n            class: scroll.vertical.thumbClass.value,\n            style: scroll.vertical.style.value,\n            'aria-hidden': 'true'\n          }),\n          thumbVertDir\n        ),\n\n        withDirectives(\n          h('div', {\n            ref: scroll.horizontal.ref,\n            class: scroll.horizontal.thumbClass.value,\n            style: scroll.horizontal.style.value,\n            'aria-hidden': 'true'\n          }),\n          thumbHorizDir\n        )\n      ])\n    }\n  }\n})\n","<script setup lang=\"ts\">\nimport { Ref, computed, onMounted, ref, watch } from 'vue'\nimport { Notation } from '@decentm/allegiance-chess-core'\nimport { QScrollArea, useQuasar } from 'quasar'\n\nimport ChessPiece from './chess-piece.vue'\n\nconst props = defineProps<{\n  moveHistory: Notation.RootNode\n  activeColour: 'white' | 'black'\n  ownColour: 'white' | 'black'\n  afen: string\n  gameOver: Notation.GameOverNode | null\n}>()\n\nconst rows = computed(() => {\n  const result: Notation.Node[][] = []\n\n  props.moveHistory.children.forEach((node) => {\n    const lastRow = result.at(-1)\n\n    if (!lastRow || lastRow.length !== 1) {\n      result.push([node])\n      return\n    }\n\n    lastRow.push(node)\n  })\n\n  return result\n})\n\nconst moveHistoryScrollArea: Ref<QScrollArea | null> = ref(null)\n\nwatch(rows, () => {\n  if (!moveHistoryScrollArea.value) {\n    return\n  }\n\n  moveHistoryScrollArea.value.setScrollPosition(\n    'vertical',\n    rows.value.length * 36,\n    1000\n  )\n})\n\nonMounted(() => {\n  if (!moveHistoryScrollArea.value) {\n    return\n  }\n\n  moveHistoryScrollArea.value.setScrollPosition(\n    'vertical',\n    rows.value.length * 36,\n    1000\n  )\n})\n\nconst q = useQuasar()\n\nconst handleAFENCopy = () => {\n  if (!props.afen) {\n    return\n  }\n\n  try {\n    navigator.clipboard.writeText(props.afen)\n\n    q.notify({\n      position: 'bottom-right',\n      timeout: 4000,\n      message: 'AFEN copied to clipboard',\n      icon: 'content_copy',\n    })\n  } catch {\n    q.notify({\n      position: 'bottom-right',\n      timeout: 4000,\n      message: 'Could not write to clipboard',\n      icon: 'close',\n      iconColor: 'red',\n    })\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.white-move {\n  background-color: $chess-white;\n  color: $chess-black;\n}\n\n.black-move {\n  background-color: $chess-black;\n  color: $chess-white;\n}\n\n.highlight {\n  background-color: $chess-highlight;\n  color: $chess-black;\n}\n</style>\n\n<template>\n  <q-card\n    flat\n    bordered\n    class=\"q-ma-md full-height column justify-between\"\n    data-testid=\"game-sidebar\"\n  >\n    <transition mode=\"out-in\">\n      <q-card-section\n        class=\"bg-primary text-white q-mb-md\"\n        v-if=\"!gameOver && activeColour === ownColour\"\n      >\n        <div class=\"text-h6\">Your turn!</div>\n      </q-card-section>\n\n      <q-card-section class=\"bg-grey text-black q-mb-md\" v-else-if=\"!gameOver\">\n        <div class=\"text-h6\">Waiting for opponent...</div>\n      </q-card-section>\n\n      <q-card-section class=\"bg-negative text-white q-mb-md\" v-else>\n        <div class=\"text-h6\">Game over!</div>\n      </q-card-section>\n    </transition>\n\n    <div class=\"spacer col\" />\n\n    <div data-testid=\"default-slot\">\n      <q-separator />\n\n      <slot />\n    </div>\n\n    <div data-testid=\"afen\">\n      <q-separator />\n\n      <q-item clickable v-ripple @click=\"handleAFENCopy\">\n        <q-item-section class=\"q-mt-sm q-mb-sm\">\n          <q-item-label>AFEN</q-item-label>\n          <q-item-label caption lines=\"2\">{{ afen }}</q-item-label>\n        </q-item-section>\n\n        <q-item-section side>\n          <q-icon name=\"edit\" />\n        </q-item-section>\n      </q-item>\n    </div>\n\n    <div data-testid=\"move-history\">\n      <q-separator />\n\n      <q-scroll-area style=\"height: 500px\" ref=\"moveHistoryScrollArea\">\n        <q-card-section\n          v-for=\"(row, index) in rows\"\n          :key=\"index\"\n          horizontal\n          class=\"row q-py-none q-mx-md\"\n          :class=\"{\n            'q-pt-md': index === 0,\n            'q-pb-md': index === rows.length - 1,\n          }\"\n        >\n          <div class=\"col\" v-if=\"row[0]\">\n            <q-chip\n              :ripple=\"false\"\n              class=\"white-move\"\n              :class=\"{\n                highlight: row[0].kind !== 'move',\n              }\"\n            >\n              <chess-piece\n                v-if=\"row[0].kind === 'move' && row[0].piece\"\n                :piece=\"row[0].piece\"\n                :allegiance=\"3\"\n                :size=\"24\"\n              />\n\n              {{ Notation.writeNode(row[0]) }}\n            </q-chip>\n          </div>\n\n          <transition mode=\"out-in\">\n            <div class=\"col\" v-if=\"row[1]\">\n              <q-chip\n                :ripple=\"false\"\n                class=\"black-move\"\n                :class=\"{\n                  highlight: row[1].kind !== 'move',\n                }\"\n              >\n                <chess-piece\n                  v-if=\"row[1].kind === 'move' && row[1].piece\"\n                  :piece=\"row[1].piece\"\n                  :allegiance=\"0\"\n                  :size=\"24\"\n                />\n\n                {{ Notation.writeNode(row[1]) }}\n              </q-chip>\n            </div>\n          </transition>\n        </q-card-section>\n      </q-scroll-area>\n    </div>\n  </q-card>\n</template>\n","import { h, computed } from 'vue'\n\nimport useAlign, { useAlignProps } from '../../composables/private/use-align.js'\n\nimport { createComponent } from '../../utils/private/create.js'\nimport { hSlot } from '../../utils/private/render.js'\n\nexport default createComponent({\n  name: 'QCardActions',\n\n  props: {\n    ...useAlignProps,\n    vertical: Boolean\n  },\n\n  setup (props, { slots }) {\n    const alignClass = useAlign(props)\n\n    const classes = computed(() =>\n      `q-card__actions ${ alignClass.value }`\n      + ` q-card__actions--${ props.vertical === true ? 'vert column' : 'horiz row' }`\n    )\n\n    return () => h('div', { class: classes.value }, hSlot(slots.default))\n  }\n})\n","import { h, ref, computed, watch, onBeforeUnmount, Transition, getCurrentInstance } from 'vue'\n\nimport useHistory from '../../composables/private/use-history.js'\nimport useTimeout from '../../composables/private/use-timeout.js'\nimport useTick from '../../composables/private/use-tick.js'\nimport useModelToggle, { useModelToggleProps, useModelToggleEmits } from '../../composables/private/use-model-toggle.js'\nimport useTransition, { useTransitionProps } from '../../composables/private/use-transition.js'\nimport usePortal from '../../composables/private/use-portal.js'\nimport usePreventScroll from '../../composables/private/use-prevent-scroll.js'\n\nimport { createComponent } from '../../utils/private/create.js'\nimport { childHasFocus } from '../../utils/dom.js'\nimport { hSlot } from '../../utils/private/render.js'\nimport { addEscapeKey, removeEscapeKey } from '../../utils/private/escape-key.js'\nimport { addFocusout, removeFocusout } from '../../utils/private/focusout.js'\nimport { addFocusFn } from '../../utils/private/focus-manager.js'\n\nlet maximizedModals = 0\n\nconst positionClass = {\n  standard: 'fixed-full flex-center',\n  top: 'fixed-top justify-center',\n  bottom: 'fixed-bottom justify-center',\n  right: 'fixed-right items-center',\n  left: 'fixed-left items-center'\n}\n\nconst defaultTransitions = {\n  standard: [ 'scale', 'scale' ],\n  top: [ 'slide-down', 'slide-up' ],\n  bottom: [ 'slide-up', 'slide-down' ],\n  right: [ 'slide-left', 'slide-right' ],\n  left: [ 'slide-right', 'slide-left' ]\n}\n\nexport default createComponent({\n  name: 'QDialog',\n\n  inheritAttrs: false,\n\n  props: {\n    ...useModelToggleProps,\n    ...useTransitionProps,\n\n    transitionShow: String, // override useTransitionProps\n    transitionHide: String, // override useTransitionProps\n\n    persistent: Boolean,\n    autoClose: Boolean,\n    allowFocusOutside: Boolean,\n\n    noEscDismiss: Boolean,\n    noBackdropDismiss: Boolean,\n    noRouteDismiss: Boolean,\n    noRefocus: Boolean,\n    noFocus: Boolean,\n    noShake: Boolean,\n\n    seamless: Boolean,\n\n    maximized: Boolean,\n    fullWidth: Boolean,\n    fullHeight: Boolean,\n\n    square: Boolean,\n\n    position: {\n      type: String,\n      default: 'standard',\n      validator: val => val === 'standard'\n        || [ 'top', 'bottom', 'left', 'right' ].includes(val)\n    }\n  },\n\n  emits: [\n    ...useModelToggleEmits,\n    'shake', 'click', 'escapeKey'\n  ],\n\n  setup (props, { slots, emit, attrs }) {\n    const vm = getCurrentInstance()\n\n    const innerRef = ref(null)\n    const showing = ref(false)\n    const animating = ref(false)\n\n    let shakeTimeout = null, refocusTarget = null, isMaximized, avoidAutoClose\n\n    const hideOnRouteChange = computed(() =>\n      props.persistent !== true\n      && props.noRouteDismiss !== true\n      && props.seamless !== true\n    )\n\n    const { preventBodyScroll } = usePreventScroll()\n    const { registerTimeout } = useTimeout()\n    const { registerTick, removeTick } = useTick()\n\n    const { transitionProps, transitionStyle } = useTransition(\n      props,\n      () => defaultTransitions[ props.position ][ 0 ],\n      () => defaultTransitions[ props.position ][ 1 ]\n    )\n\n    const { showPortal, hidePortal, portalIsAccessible, renderPortal } = usePortal(\n      vm, innerRef, renderPortalContent, 'dialog'\n    )\n\n    const { hide } = useModelToggle({\n      showing,\n      hideOnRouteChange,\n      handleShow,\n      handleHide,\n      processOnMount: true\n    })\n\n    const { addToHistory, removeFromHistory } = useHistory(showing, hide, hideOnRouteChange)\n\n    const classes = computed(() =>\n      'q-dialog__inner flex no-pointer-events'\n      + ` q-dialog__inner--${ props.maximized === true ? 'maximized' : 'minimized' }`\n      + ` q-dialog__inner--${ props.position } ${ positionClass[ props.position ] }`\n      + (animating.value === true ? ' q-dialog__inner--animating' : '')\n      + (props.fullWidth === true ? ' q-dialog__inner--fullwidth' : '')\n      + (props.fullHeight === true ? ' q-dialog__inner--fullheight' : '')\n      + (props.square === true ? ' q-dialog__inner--square' : '')\n    )\n\n    const useBackdrop = computed(() => showing.value === true && props.seamless !== true)\n\n    const onEvents = computed(() => (\n      props.autoClose === true\n        ? { onClick: onAutoClose }\n        : {}\n    ))\n\n    const rootClasses = computed(() => [\n      'q-dialog fullscreen no-pointer-events '\n        + `q-dialog--${ useBackdrop.value === true ? 'modal' : 'seamless' }`,\n      attrs.class\n    ])\n\n    watch(() => props.maximized, state => {\n      showing.value === true && updateMaximized(state)\n    })\n\n    watch(useBackdrop, val => {\n      preventBodyScroll(val)\n\n      if (val === true) {\n        addFocusout(onFocusChange)\n        addEscapeKey(onEscapeKey)\n      }\n      else {\n        removeFocusout(onFocusChange)\n        removeEscapeKey(onEscapeKey)\n      }\n    })\n\n    function handleShow (evt) {\n      addToHistory()\n\n      refocusTarget = props.noRefocus === false && document.activeElement !== null\n        ? document.activeElement\n        : null\n\n      updateMaximized(props.maximized)\n      showPortal()\n      animating.value = true\n\n      if (props.noFocus !== true) {\n        document.activeElement !== null && document.activeElement.blur()\n        registerTick(focus)\n      }\n      else {\n        removeTick()\n      }\n\n      // should removeTimeout() if this gets removed\n      registerTimeout(() => {\n        if (vm.proxy.$q.platform.is.ios === true) {\n          if (props.seamless !== true && document.activeElement) {\n            const\n              { top, bottom } = document.activeElement.getBoundingClientRect(),\n              { innerHeight } = window,\n              height = window.visualViewport !== void 0\n                ? window.visualViewport.height\n                : innerHeight\n\n            if (top > 0 && bottom > height / 2) {\n              document.scrollingElement.scrollTop = Math.min(\n                document.scrollingElement.scrollHeight - height,\n                bottom >= innerHeight\n                  ? Infinity\n                  : Math.ceil(document.scrollingElement.scrollTop + bottom - height / 2)\n              )\n            }\n\n            document.activeElement.scrollIntoView()\n          }\n\n          // required in order to avoid the \"double-tap needed\" issue\n          avoidAutoClose = true\n          innerRef.value.click()\n          avoidAutoClose = false\n        }\n\n        showPortal(true) // done showing portal\n        animating.value = false\n        emit('show', evt)\n      }, props.transitionDuration)\n    }\n\n    function handleHide (evt) {\n      removeTick()\n      removeFromHistory()\n      cleanup(true)\n      animating.value = true\n      hidePortal()\n\n      if (refocusTarget !== null) {\n        ((evt && evt.type.indexOf('key') === 0\n          ? refocusTarget.closest('[tabindex]:not([tabindex^=\"-\"])')\n          : void 0\n        ) || refocusTarget).focus()\n        refocusTarget = null\n      }\n\n      // should removeTimeout() if this gets removed\n      registerTimeout(() => {\n        hidePortal(true) // done hiding, now destroy\n        animating.value = false\n        emit('hide', evt)\n      }, props.transitionDuration)\n    }\n\n    function focus (selector) {\n      addFocusFn(() => {\n        let node = innerRef.value\n\n        if (node === null || node.contains(document.activeElement) === true) {\n          return\n        }\n\n        node = (selector !== '' ? node.querySelector(selector) : null)\n          || node.querySelector('[autofocus][tabindex], [data-autofocus][tabindex]')\n          || node.querySelector('[autofocus] [tabindex], [data-autofocus] [tabindex]')\n          || node.querySelector('[autofocus], [data-autofocus]')\n          || node\n        node.focus({ preventScroll: true })\n      })\n    }\n\n    function shake (focusTarget) {\n      if (focusTarget && typeof focusTarget.focus === 'function') {\n        focusTarget.focus({ preventScroll: true })\n      }\n      else {\n        focus()\n      }\n\n      emit('shake')\n\n      const node = innerRef.value\n\n      if (node !== null) {\n        node.classList.remove('q-animate--scale')\n        node.classList.add('q-animate--scale')\n        shakeTimeout !== null && clearTimeout(shakeTimeout)\n        shakeTimeout = setTimeout(() => {\n          shakeTimeout = null\n          if (innerRef.value !== null) {\n            node.classList.remove('q-animate--scale')\n            // some platforms (like desktop Chrome)\n            // require calling focus() again\n            focus()\n          }\n        }, 170)\n      }\n    }\n\n    function onEscapeKey () {\n      if (props.seamless !== true) {\n        if (props.persistent === true || props.noEscDismiss === true) {\n          props.maximized !== true && props.noShake !== true && shake()\n        }\n        else {\n          emit('escapeKey')\n          hide()\n        }\n      }\n    }\n\n    function cleanup (hiding) {\n      if (shakeTimeout !== null) {\n        clearTimeout(shakeTimeout)\n        shakeTimeout = null\n      }\n\n      if (hiding === true || showing.value === true) {\n        updateMaximized(false)\n\n        if (props.seamless !== true) {\n          preventBodyScroll(false)\n          removeFocusout(onFocusChange)\n          removeEscapeKey(onEscapeKey)\n        }\n      }\n\n      if (hiding !== true) {\n        refocusTarget = null\n      }\n    }\n\n    function updateMaximized (active) {\n      if (active === true) {\n        if (isMaximized !== true) {\n          maximizedModals < 1 && document.body.classList.add('q-body--dialog')\n          maximizedModals++\n\n          isMaximized = true\n        }\n      }\n      else if (isMaximized === true) {\n        if (maximizedModals < 2) {\n          document.body.classList.remove('q-body--dialog')\n        }\n\n        maximizedModals--\n        isMaximized = false\n      }\n    }\n\n    function onAutoClose (e) {\n      if (avoidAutoClose !== true) {\n        hide(e)\n        emit('click', e)\n      }\n    }\n\n    function onBackdropClick (e) {\n      if (props.persistent !== true && props.noBackdropDismiss !== true) {\n        hide(e)\n      }\n      else if (props.noShake !== true) {\n        shake()\n      }\n    }\n\n    function onFocusChange (evt) {\n      // the focus is not in a vue child component\n      if (\n        props.allowFocusOutside !== true\n        && portalIsAccessible.value === true\n        && childHasFocus(innerRef.value, evt.target) !== true\n      ) {\n        focus('[tabindex]:not([tabindex=\"-1\"])')\n      }\n    }\n\n    Object.assign(vm.proxy, {\n      // expose public methods\n      focus, shake,\n\n      // private but needed by QSelect\n      __updateRefocusTarget (target) {\n        refocusTarget = target || null\n      }\n    })\n\n    onBeforeUnmount(cleanup)\n\n    function renderPortalContent () {\n      return h('div', {\n        role: 'dialog',\n        'aria-modal': useBackdrop.value === true ? 'true' : 'false',\n        ...attrs,\n        class: rootClasses.value\n      }, [\n        h(Transition, {\n          name: 'q-transition--fade',\n          appear: true\n        }, () => (\n          useBackdrop.value === true\n            ? h('div', {\n              class: 'q-dialog__backdrop fixed-full',\n              style: transitionStyle.value,\n              'aria-hidden': 'true',\n              tabindex: -1,\n              onClick: onBackdropClick\n            })\n            : null\n        )),\n\n        h(\n          Transition,\n          transitionProps.value,\n          () => (\n            showing.value === true\n              ? h('div', {\n                ref: innerRef,\n                class: classes.value,\n                style: transitionStyle.value,\n                tabindex: -1,\n                ...onEvents.value\n              }, hSlot(slots.default))\n              : null\n          )\n        )\n      ])\n    }\n\n    return renderPortal\n  }\n})\n","import { createDirective } from '../utils/private/create.js'\nimport { closePortals, getPortalProxy } from '../utils/private/portal.js'\nimport { isKeyCode } from '../utils/private/key-composition.js'\nimport getSSRProps from '../utils/private/noop-ssr-directive-transform.js'\n\n/*\n * depth\n *   < 0  --> close all chain\n *   0    --> disabled\n *   > 0  --> close chain up to N parent\n */\n\nfunction getDepth (value) {\n  if (value === false) {\n    return 0\n  }\n  if (value === true || value === void 0) {\n    return 1\n  }\n\n  const depth = parseInt(value, 10)\n  return isNaN(depth) ? 0 : depth\n}\n\nexport default createDirective(__QUASAR_SSR_SERVER__\n  ? { name: 'close-popup', getSSRProps }\n  : {\n      name: 'close-popup',\n\n      beforeMount (el, { value }) {\n        const ctx = {\n          depth: getDepth(value),\n\n          handler (evt) {\n            // allow @click to be emitted\n            ctx.depth !== 0 && setTimeout(() => {\n              const proxy = getPortalProxy(el)\n              if (proxy !== void 0) {\n                closePortals(proxy, evt, ctx.depth)\n              }\n            })\n          },\n\n          handlerKey (evt) {\n            isKeyCode(evt, 13) === true && ctx.handler(evt)\n          }\n        }\n\n        el.__qclosepopup = ctx\n\n        el.addEventListener('click', ctx.handler)\n        el.addEventListener('keyup', ctx.handlerKey)\n      },\n\n      updated (el, { value, oldValue }) {\n        if (value !== oldValue) {\n          el.__qclosepopup.depth = getDepth(value)\n        }\n      },\n\n      beforeUnmount (el) {\n        const ctx = el.__qclosepopup\n        el.removeEventListener('click', ctx.handler)\n        el.removeEventListener('keyup', ctx.handlerKey)\n        delete el.__qclosepopup\n      }\n    }\n)\n","import { useQuasar } from 'quasar'\nimport { computed } from 'vue'\n\nexport const useBoardSize = () => {\n  const q = useQuasar()\n\n  return computed(() => {\n    let result = q.screen.width\n\n    if (q.screen.gt.xs) {\n      result = q.screen.width - 65\n    }\n\n    if (q.screen.gt.sm) {\n      result = q.screen.sizes.sm\n    }\n\n    if (q.screen.gt.md) {\n      result = q.screen.sizes.md - 265\n    }\n\n    if (q.screen.gt.lg) {\n      result = q.screen.sizes.lg - 265\n    }\n\n    return Math.min(result, q.screen.height)\n  })\n}\n"],"names":["GameOutcome","q","useQuasar","useAnchorProps","useAnchor","showing","avoidEmit","configureAnchorEl","props","proxy","emit","getCurrentInstance","anchorEl","ref","touchTimer","canShow","evt","anchorEvents","isKeyCode","prevent","nextTick","target","addEvt","clearSelection","context","evts","unconfigureAnchorEl","cleanEvt","setAnchorEl","el","pickAnchorEl","watch","val","onMounted","onBeforeUnmount","useScrollTarget","configureScrollTarget","localScrollTarget","scrollFn","changeScrollEvent","scrollTarget","fn","fnProp","fnHandler","listenOpts","unconfigureScrollTarget","noParentEventWatcher","portalProxyList","getPortalProxy","closePortalMenus","getParentProxy","parent","closePortals","depth","isOnGlobalDialog","vm","usePortal","innerRef","renderPortalContent","type","portalIsActive","portalIsAccessible","portalEl","focusObj","onGlobalDialog","showPortal","isReady","removeFocusWaitFlag","createGlobalNode","addFocusWaitFlag","hidePortal","index","removeGlobalNode","onUnmounted","injectProp","h","Teleport","useTransitionProps","useTransition","defaultShowFn","defaultHideFn","computed","show","hide","useTick","tickFn","removeTick","onDeactivated","vmIsDestroyed","handlers","escDown","onKeydown","onBlur","onKeyup","update","action","addEscapeKey","client","removeEscapeKey","trigger","addFocusout","removeFocusout","notPassiveCapture","registeredList","globalHandler","portalIndex","i","state","addClickOutside","clickOutsideProps","removeClickOutside","vpLeft","vpTop","validatePosition","pos","parts","validateOffset","horizontalPos","parsePosition","rtl","getAnchorProps","offset","top","left","right","bottom","width","height","getAbsoluteAnchorProps","absoluteOffset","getTargetProps","getTopLeftProps","anchorProps","targetProps","anchorOrigin","selfOrigin","setPosition","cfg","retryNumber","targetEl","fit","cover","maxHeight","maxWidth","scrollLeft","scrollTop","origElWidth","origElHeight","elWidth","elHeight","elStyle","applyBoundaries","hasChanged","offsetY","offsetX","currentHeight","currentWidth","margin","getScrollbarWidth","innerHeight","innerWidth","anchorY","anchorX","QMenu","createComponent","useModelToggleProps","useDarkProps","useModelToggleEmits","slots","attrs","refocusTarget","unwatchPosition","avoidAutoClose","$q","hideOnRouteChange","isDark","useDark","registerTick","registerTimeout","useTimeout","transitionProps","transitionStyle","useModelToggle","handleShow","handleHide","renderPortal","e","stopAndPrevent","menuClass","onEvents","onAutoClose","handlesFocus","onEscapeKey","focus","addFocusFn","node","onFocusout","position","updatePosition","anchorCleanup","hiding","getScrollTarget","childHasFocus","Transition","hSlot","pieces","handleDismiss","captureFocus","enPassantTarget","showPromotionPopup","promotionAllegiance","focusedSquare","highlightSquares","isOpponent","coords","square","allegianceSide","isHighlighted","coordinate","coordinatesEqual","handleCoordsClick","event","isPromotion","fromSquare","_a","_b","handlePromotion","piece","handlePromotionDismiss","handleCaptureDismiss","handleCaptureClick","decision","indexToCoords","fileIndex","rankIndex","rawFile","rawRank","coordsEmpty","canMove","from","to","move","captureMoves","result","checkMoves","isChecked","squareSize","pieceFocus","handleExcuteNodeIndex","lastMove","defaultSizes","QChip","useSizeProps","sizeStyle","useSize","hasLeftIcon","leftIcon","removeIcon","isClickable","classes","text","attributes","chip","remove","onClick","onRemove","getContent","child","QIcon","label","hMergeSlotSafely","data","hDir","Ripple","axisList","dirProps","panOpts","getMinThumbSize","size","QScrollArea","tempShowing","panning","hover","container","scroll","timer","panRefPos","targetRef","diff","p","between","mainStyle","thumbVertDir","TouchPan","onPanThumb","thumbHorizDir","getScroll","info","axis","emitScroll","debounce","localSetScrollPosition","duration","setVerticalScrollPosition","setHorizontalScrollPosition","updateContainer","change","startTimer","updateScroll","updateScrollSize","dProp","containerSize","multiplier","distance","setScroll","onMousedown","onVerticalMousedown","onHorizontalMousedown","onMouseenter","onMouseleave","scrollPosition","onActivated","percentage","hMergeSlot","QResizeObserver","QScrollObserver","withDirectives","rows","lastRow","moveHistoryScrollArea","handleAFENCopy","QCardActions","useAlignProps","alignClass","useAlign","maximizedModals","positionClass","defaultTransitions","QDialog","animating","shakeTimeout","isMaximized","preventBodyScroll","usePreventScroll","addToHistory","removeFromHistory","useHistory","useBackdrop","rootClasses","updateMaximized","onFocusChange","cleanup","selector","shake","focusTarget","active","onBackdropClick","getDepth","value","ClosePopup","createDirective","ctx","oldValue","useBoardSize"],"mappings":"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"}