import{a,d as p,M as g,aj as _,w as l,Y as y,N as h,O as M,$ as C}from"./index.d1d7854b.js";import{u as w}from"./rtc-connection.bd09f2f4.js";import{F as B}from"./boards.07b20eb6.js";import"./hex.b9ec0a1b.js";import"./use-quasar.c5b2b7cc.js";const N=()=>{const{connect:i,mode:s,peerId:n,sendData:t,messages:o,disconnect:r}=w(),f=e=>{t(p.Buffer.from(JSON.stringify(e),"utf8"))},c=a(()=>o.value.filter(e=>e.type==="data").map(e=>p.Buffer.isBuffer(e.value)?JSON.parse(e.value.toString("utf8")):null)),d=a(()=>{const e=c.value.findLast(u=>u.type==="afen-update");return e&&e.value||""}),m=a(()=>o.value.some(e=>e.type==="open")),v=a(()=>{const e=c.value.find(u=>u.type==="side-assignment");return e?e.value:null});return{connect:i,mode:s,peerId:n,boardAFEN:d,sendMessage:f,open:m,disconnect:r,serverSide:v}},O=g({__name:"play-page",setup(i){const s=_(),n=N();return l(n.mode,t=>{t==="initial"&&s.push("/play")}),l(n.open,t=>{!t||(s.push(`/play/online/${n.peerId.value}`),n.mode.value==="server"&&(n.sendMessage({type:"side-assignment",value:Math.random()>.5?"white":"black"}),n.sendMessage({type:"afen-update",value:B.VanillaDefault})))}),(t,o)=>{const r=y("router-view");return h(),M(r,{connection:C(n)},null,8,["connection"])}}});export{O as default};
