import{a as J,Q as I}from"./QCard.f7f5f7ac.js";import{c as M,i as ce,a as tt,f as Ce}from"./board.71748d9d.js";import{M as W,N as m,Q as w,W as P,R as x,_ as Z,r as H,a9 as Be,x as $e,C as De,u as ze,w as O,B as lt,o as ne,j as ye,A as ot,m as ve,as as de,K as it,an as nt,h as pe,at,au as st,av as ut,a as T,a4 as rt,a5 as ct,k as _e,c as dt,z as ft,e as vt,aa as pt,aw as ht,s as mt,O as B,P as C,S as b,T as Te,a0 as le,ac as z,$ as L,Z as Ae,ae as F,U as ee,V as te}from"./index.7ca902b9.js";import{b as he,a as me,Q as Ve}from"./QList.afd901b9.js";import{c as gt,i as yt,u as _t,b as wt,d as bt,e as kt,f as St}from"./selection.9f6dca62.js";import{u as qt,a as Ct}from"./use-dark.242c33f8.js";import{b as Ee,c as $t,a as zt}from"./focus-manager.202af5b7.js";import{C as Qe}from"./chess-piece.6cc51490.js";const Tt={class:"row column full-width full-height no-pointer-events background-layer","data-testid":"background"},Et=W({__name:"background-layer",props:{ranks:{},files:{}},setup(e){return(t,o)=>(m(),w("div",Tt,[(m(!0),w(P,null,x(t.ranks,(l,i)=>(m(),w("div",{class:"rank col row full-width",key:i},[(m(!0),w(P,null,x(t.files,(r,n)=>(m(),w("div",{key:n,class:"file col"}))),128))]))),128))]))}});var Ft=Z(Et,[["__scopeId","data-v-482c5e27"]]);const Pt={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function xt({showing:e,avoidEmit:t,configureAnchorEl:o}){const{props:l,proxy:i,emit:r}=ye(),n=H(null);let u=null;function d(s){return n.value===null?!1:s===void 0||s.touches===void 0||s.touches.length<=1}const c={};o===void 0&&(Object.assign(c,{hide(s){i.hide(s)},toggle(s){i.toggle(s),s.qAnchorHandled=!0},toggleKey(s){Be(s,13)===!0&&c.toggle(s)},contextClick(s){i.hide(s),$e(s),De(()=>{i.show(s),s.qAnchorHandled=!0})},prevent:$e,mobileTouch(s){if(c.mobileCleanup(s),d(s)!==!0)return;i.hide(s),n.value.classList.add("non-selectable");const g=s.target;ze(c,"anchor",[[g,"touchmove","mobileCleanup","passive"],[g,"touchend","mobileCleanup","passive"],[g,"touchcancel","mobileCleanup","passive"],[n.value,"contextmenu","prevent","notPassive"]]),u=setTimeout(()=>{u=null,i.show(s),s.qAnchorHandled=!0},300)},mobileCleanup(s){n.value.classList.remove("non-selectable"),u!==null&&(clearTimeout(u),u=null),e.value===!0&&s!==void 0&&gt()}}),o=function(s=l.contextMenu){if(l.noParentEvent===!0||n.value===null)return;let g;s===!0?i.$q.platform.is.mobile===!0?g=[[n.value,"touchstart","mobileTouch","passive"]]:g=[[n.value,"mousedown","hide","passive"],[n.value,"contextmenu","contextClick","notPassive"]]:g=[[n.value,"click","toggle","passive"],[n.value,"keyup","toggleKey","passive"]],ze(c,"anchor",g)});function f(){ot(c,"anchor")}function y(s){for(n.value=s;n.value.classList.contains("q-anchor--skip");)n.value=n.value.parentNode;o()}function S(){if(l.target===!1||l.target===""||i.$el.parentNode===null)n.value=null;else if(l.target===!0)y(i.$el.parentNode);else{let s=l.target;if(typeof l.target=="string")try{s=document.querySelector(l.target)}catch{s=void 0}s!=null?(n.value=s.$el||s,o()):(n.value=null,console.error(`Anchor: target "${l.target}" not found`))}}return O(()=>l.contextMenu,s=>{n.value!==null&&(f(),o(s))}),O(()=>l.target,()=>{n.value!==null&&f(),S()}),O(()=>l.noParentEvent,s=>{n.value!==null&&(s===!0?f():o())}),lt(()=>{S(),t!==!0&&l.modelValue===!0&&n.value===null&&r("update:modelValue",!1)}),ne(()=>{u!==null&&clearTimeout(u),f()}),{anchorEl:n,canShow:d,anchorEvents:c}}function Mt(e,t){const o=H(null);let l;function i(u,d){const c=`${d!==void 0?"add":"remove"}EventListener`,f=d!==void 0?d:l;u!==window&&u[c]("scroll",f,ve.passive),window[c]("scroll",f,ve.passive),l=d}function r(){o.value!==null&&(i(o.value),o.value=null)}const n=O(()=>e.noParentEvent,()=>{o.value!==null&&(r(),t())});return ne(n),{localScrollTarget:o,unconfigureScrollTarget:r,changeScrollEvent:i}}const Y=[];function Ht(e,t){do{if(e.$options.name==="QMenu"){if(e.hide(t),e.$props.separateClosePopup===!0)return de(e)}else if(e.__qPortal===!0){const o=de(e);return o!==void 0&&o.$options.name==="QPopupProxy"?(e.hide(t),o):e}e=de(e)}while(e!=null)}function Lt(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function Wt(e,t,o,l){const i=H(!1),r=H(!1);let n=null;const u={},d=l==="dialog"&&Lt(e);function c(y){if(y===!0){Ee(u),r.value=!0;return}r.value=!1,i.value===!1&&(d===!1&&n===null&&(n=st(!1,l)),i.value=!0,Y.push(e.proxy),$t(u))}function f(y){if(r.value=!1,y!==!0)return;Ee(u),i.value=!1;const S=Y.indexOf(e.proxy);S!==-1&&Y.splice(S,1),n!==null&&(ut(n),n=null)}return it(()=>{f(!0)}),e.proxy.__qPortal=!0,nt(e.proxy,"contentEl",()=>t.value),{showPortal:c,hidePortal:f,portalIsActive:i,portalIsAccessible:r,renderPortal:()=>d===!0?o():i.value===!0?[pe(at,{to:n},o())]:void 0}}const Bt={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function Dt(e,t=()=>{},o=()=>{}){return{transitionProps:T(()=>{const l=`q-transition--${e.transitionShow||t()}`,i=`q-transition--${e.transitionHide||o()}`;return{appear:!0,enterFromClass:`${l}-enter-from`,enterActiveClass:`${l}-enter-active`,enterToClass:`${l}-enter-to`,leaveFromClass:`${i}-leave-from`,leaveActiveClass:`${i}-leave-active`,leaveToClass:`${i}-leave-to`}}),transitionStyle:T(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}function At(){let e;const t=ye();function o(){e=void 0}return rt(o),ne(o),{removeTick:o,registerTick(l){e=l,De(()=>{e===l&&(ct(t)===!1&&e(),e=void 0)})}}}const D=[];let j;function Vt(e){j=e.keyCode===27}function Qt(){j===!0&&(j=!1)}function Rt(e){j===!0&&(j=!1,Be(e,27)===!0&&D[D.length-1](e))}function Re(e){window[e]("keydown",Vt),window[e]("blur",Qt),window[e]("keyup",Rt),j=!1}function Nt(e){_e.is.desktop===!0&&(D.push(e),D.length===1&&Re("addEventListener"))}function Fe(e){const t=D.indexOf(e);t>-1&&(D.splice(t,1),D.length===0&&Re("removeEventListener"))}const A=[];function Ne(e){A[A.length-1](e)}function Ot(e){_e.is.desktop===!0&&(A.push(e),A.length===1&&document.body.addEventListener("focusin",Ne))}function jt(e){const t=A.indexOf(e);t>-1&&(A.splice(t,1),A.length===0&&document.body.removeEventListener("focusin",Ne))}const{notPassiveCapture:oe}=ve,V=[];function ie(e){const t=e.target;if(t===void 0||t.nodeType===8||t.classList.contains("no-pointer-events")===!0)return;let o=Y.length-1;for(;o>=0;){const l=Y[o].$;if(l.type.name==="QTooltip"){o--;continue}if(l.type.name!=="QDialog")break;if(l.props.seamless!==!0)return;o--}for(let l=V.length-1;l>=0;l--){const i=V[l];if((i.anchorEl.value===null||i.anchorEl.value.contains(t)===!1)&&(t===document.body||i.innerRef.value!==null&&i.innerRef.value.contains(t)===!1))e.qClickOutside=!0,i.onClickOutside(e);else return}}function Kt(e){V.push(e),V.length===1&&(document.addEventListener("mousedown",ie,oe),document.addEventListener("touchstart",ie,oe))}function Pe(e){const t=V.findIndex(o=>o===e);t>-1&&(V.splice(t,1),V.length===0&&(document.removeEventListener("mousedown",ie,oe),document.removeEventListener("touchstart",ie,oe)))}let xe,Me;function He(e){const t=e.split(" ");return t.length!==2?!1:["top","center","bottom"].includes(t[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(t[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function Ut(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const ge={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{ge[`${e}#ltr`]=e,ge[`${e}#rtl`]=e});function Le(e,t){const o=e.split(" ");return{vertical:o[0],horizontal:ge[`${o[1]}#${t===!0?"rtl":"ltr"}`]}}function Gt(e,t){let{top:o,left:l,right:i,bottom:r,width:n,height:u}=e.getBoundingClientRect();return t!==void 0&&(o-=t[1],l-=t[0],r+=t[1],i+=t[0],n+=t[0],u+=t[1]),{top:o,bottom:r,height:u,left:l,right:i,width:n,middle:l+(i-l)/2,center:o+(r-o)/2}}function Xt(e,t,o){let{top:l,left:i}=e.getBoundingClientRect();return l+=t.top,i+=t.left,o!==void 0&&(l+=o[1],i+=o[0]),{top:l,bottom:l+1,height:1,left:i,right:i+1,width:1,middle:i,center:l}}function Yt(e,t){return{top:0,center:t/2,bottom:t,left:0,middle:e/2,right:e}}function We(e,t,o,l){return{top:e[o.vertical]-t[l.vertical],left:e[o.horizontal]-t[l.horizontal]}}function Oe(e,t=0){if(e.targetEl===null||e.anchorEl===null||t>5)return;if(e.targetEl.offsetHeight===0||e.targetEl.offsetWidth===0){setTimeout(()=>{Oe(e,t+1)},10);return}const{targetEl:o,offset:l,anchorEl:i,anchorOrigin:r,selfOrigin:n,absoluteOffset:u,fit:d,cover:c,maxHeight:f,maxWidth:y}=e;if(_e.is.ios===!0&&window.visualViewport!==void 0){const $=document.body.style,{offsetLeft:h,offsetTop:q}=window.visualViewport;h!==xe&&($.setProperty("--q-pe-left",h+"px"),xe=h),q!==Me&&($.setProperty("--q-pe-top",q+"px"),Me=q)}const{scrollLeft:S,scrollTop:s}=o,g=u===void 0?Gt(i,c===!0?[0,0]:l):Xt(i,u,l);Object.assign(o.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:y||"100vw",maxHeight:f||"100vh",visibility:"visible"});const{offsetWidth:Q,offsetHeight:k}=o,{elWidth:R,elHeight:N}=d===!0||c===!0?{elWidth:Math.max(g.width,Q),elHeight:c===!0?Math.max(g.height,k):k}:{elWidth:Q,elHeight:k};let E={maxWidth:y,maxHeight:f};(d===!0||c===!0)&&(E.minWidth=g.width+"px",c===!0&&(E.minHeight=g.height+"px")),Object.assign(o.style,E);const a=Yt(R,N);let p=We(g,a,r,n);if(u===void 0||l===void 0)fe(p,g,a,r,n);else{const{top:$,left:h}=p;fe(p,g,a,r,n);let q=!1;if(p.top!==$){q=!0;const _=2*l[1];g.center=g.top-=_,g.bottom-=_+2}if(p.left!==h){q=!0;const _=2*l[0];g.middle=g.left-=_,g.right-=_+2}q===!0&&(p=We(g,a,r,n),fe(p,g,a,r,n))}E={top:p.top+"px",left:p.left+"px"},p.maxHeight!==void 0&&(E.maxHeight=p.maxHeight+"px",g.height>p.maxHeight&&(E.minHeight=E.maxHeight)),p.maxWidth!==void 0&&(E.maxWidth=p.maxWidth+"px",g.width>p.maxWidth&&(E.minWidth=E.maxWidth)),Object.assign(o.style,E),o.scrollTop!==s&&(o.scrollTop=s),o.scrollLeft!==S&&(o.scrollLeft=S)}function fe(e,t,o,l,i){const r=o.bottom,n=o.right,u=yt(),d=window.innerHeight-u,c=document.body.clientWidth;if(e.top<0||e.top+r>d)if(i.vertical==="center")e.top=t[l.vertical]>d/2?Math.max(0,d-r):0,e.maxHeight=Math.min(r,d);else if(t[l.vertical]>d/2){const f=Math.min(d,l.vertical==="center"?t.center:l.vertical===i.vertical?t.bottom:t.top);e.maxHeight=Math.min(r,f),e.top=Math.max(0,f-r)}else e.top=Math.max(0,l.vertical==="center"?t.center:l.vertical===i.vertical?t.top:t.bottom),e.maxHeight=Math.min(r,d-e.top);if(e.left<0||e.left+n>c)if(e.maxWidth=Math.min(n,c),i.horizontal==="middle")e.left=t[l.horizontal]>c/2?Math.max(0,c-n):0;else if(t[l.horizontal]>c/2){const f=Math.min(c,l.horizontal==="middle"?t.middle:l.horizontal===i.horizontal?t.right:t.left);e.maxWidth=Math.min(n,f),e.left=Math.max(0,f-e.maxWidth)}else e.left=Math.max(0,l.horizontal==="middle"?t.middle:l.horizontal===i.horizontal?t.left:t.right),e.maxWidth=Math.min(n,c-e.left)}var je=dt({name:"QMenu",inheritAttrs:!1,props:{...Pt,..._t,...qt,...Bt,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:He},self:{type:String,validator:He},offset:{type:Array,validator:Ut},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...wt,"click","escapeKey"],setup(e,{slots:t,emit:o,attrs:l}){let i=null,r,n,u;const d=ye(),{proxy:c}=d,{$q:f}=c,y=H(null),S=H(!1),s=T(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),g=Ct(e,f),{registerTick:Q,removeTick:k}=At(),{registerTimeout:R}=bt(),{transitionProps:N,transitionStyle:E}=Dt(e),{localScrollTarget:a,changeScrollEvent:p,unconfigureScrollTarget:$}=Mt(e,Se),{anchorEl:h,canShow:q}=xt({showing:S}),{hide:_}=kt({showing:S,canShow:q,handleShow:Xe,handleHide:Ye,hideOnRouteChange:s,processOnMount:!0}),{showPortal:K,hidePortal:U,renderPortal:G}=Wt(d,y,Je,"menu"),ae={anchorEl:h,innerRef:y,onClickOutside(v){if(e.persistent!==!0&&S.value===!0)return _(v),(v.type==="touchstart"||v.target.classList.contains("q-dialog__backdrop"))&&mt(v),!0}},we=T(()=>Le(e.anchor||(e.cover===!0?"center middle":"bottom start"),f.lang.rtl)),Ke=T(()=>e.cover===!0?we.value:Le(e.self||"top start",f.lang.rtl)),Ue=T(()=>(e.square===!0?" q-menu--square":"")+(g.value===!0?" q-menu--dark q-dark":"")),Ge=T(()=>e.autoClose===!0?{onClick:Ze}:{}),be=T(()=>S.value===!0&&e.persistent!==!0);O(be,v=>{v===!0?(Nt(ue),Kt(ae)):(Fe(ue),Pe(ae))});function se(){zt(()=>{let v=y.value;v&&v.contains(document.activeElement)!==!0&&(v=v.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||v.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||v.querySelector("[autofocus], [data-autofocus]")||v,v.focus({preventScroll:!0}))})}function Xe(v){if(i=e.noRefocus===!1?document.activeElement:null,Ot(qe),K(),Se(),r=void 0,v!==void 0&&(e.touchPosition||e.contextMenu)){const re=ft(v);if(re.left!==void 0){const{top:Ie,left:et}=h.value.getBoundingClientRect();r={left:re.left-et,top:re.top-Ie}}}n===void 0&&(n=O(()=>f.screen.width+"|"+f.screen.height+"|"+e.self+"|"+e.anchor+"|"+f.lang.rtl,X)),e.noFocus!==!0&&document.activeElement.blur(),Q(()=>{X(),e.noFocus!==!0&&se()}),R(()=>{f.platform.is.ios===!0&&(u=e.autoClose,y.value.click()),X(),K(!0),o("show",v)},e.transitionDuration)}function Ye(v){k(),U(),ke(!0),i!==null&&(v===void 0||v.qClickOutside!==!0)&&(((v&&v.type.indexOf("key")===0?i.closest('[tabindex]:not([tabindex^="-"])'):void 0)||i).focus(),i=null),R(()=>{U(!0),o("hide",v)},e.transitionDuration)}function ke(v){r=void 0,n!==void 0&&(n(),n=void 0),(v===!0||S.value===!0)&&(jt(qe),$(),Pe(ae),Fe(ue)),v!==!0&&(i=null)}function Se(){(h.value!==null||e.scrollTarget!==void 0)&&(a.value=St(h.value,e.scrollTarget),p(a.value,X))}function Ze(v){u!==!0?(Ht(c,v),o("click",v)):u=!1}function qe(v){be.value===!0&&e.noFocus!==!0&&ht(y.value,v.target)!==!0&&se()}function ue(v){o("escapeKey"),_(v)}function X(){Oe({targetEl:y.value,offset:e.offset,anchorEl:h.value,anchorOrigin:we.value,selfOrigin:Ke.value,absoluteOffset:r,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function Je(){return pe(pt,N.value,()=>S.value===!0?pe("div",{role:"menu",...l,ref:y,tabindex:-1,class:["q-menu q-position-engine scroll"+Ue.value,l.class],style:[l.style,E.value],...Ge.value},vt(t.default)):null)}return ne(ke),Object.assign(c,{focus:se,updatePosition:X}),G}});const Zt=W({__name:"promotion-selector",props:{modelValue:{type:Boolean},allegiance:{}},emits:["click","dismiss"],setup(e,{emit:t}){const o=["Q","N","R","B"],l=()=>{t("dismiss")};return(i,r)=>(m(),B(je,{cover:"","model-value":i.modelValue,"onUpdate:modelValue":l},{default:C(()=>[b(Ve,null,{default:C(()=>[(m(),w(P,null,x(o,n=>b(he,{clickable:"",key:n,class:"q-pa-sm",onClick:u=>t("click",n)},{default:C(()=>[b(me,{class:"promotion-piece"},{default:C(()=>[b(Qe,{allegiance:i.allegiance,piece:n,size:86},null,8,["allegiance","piece"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1},8,["model-value"]))}});var Jt=Z(Zt,[["__scopeId","data-v-0418dade"]]);const It=W({__name:"capture-selector",props:{modelValue:{type:Boolean},moves:{}},emits:["click","dismiss"],setup(e,{emit:t}){const o=()=>{t("dismiss")};return(l,i)=>(m(),B(je,{cover:"","model-value":l.modelValue,"onUpdate:modelValue":o},{default:C(()=>[b(Ve,null,{default:C(()=>[l.moves.includes("x")?(m(),B(he,{key:0,clickable:"",onClick:i[0]||(i[0]=r=>t("click","capture")),class:"q-py-lg"},{default:C(()=>[b(me,{class:"items-center"},{default:C(()=>[b(Te,{size:"72px",name:"close"})]),_:1})]),_:1})):le("",!0),l.moves.includes(">")?(m(),B(he,{key:1,clickable:"",onClick:i[1]||(i[1]=r=>t("click","challenge")),class:"q-py-lg"},{default:C(()=>[b(me,{class:"items-center"},{default:C(()=>[b(Te,{size:"64px",name:"arrow_forward_ios"})]),_:1})]),_:1})):le("",!0)]),_:1})]),_:1},8,["model-value"]))}});const el={class:"relative-position full-width full-height interaction-layer"},tl=["onClick"],ll=W({__name:"interaction-layer",props:{board:{},squareSize:{},ranks:{},files:{},perspective:{},pieceFocus:{}},emits:["execute-node","update-piece-focus","update-highlights"],setup(e,{emit:t}){const o=e,l=H(null),i=T(()=>o.board.enPassantTarget),r=H(null),n=H(null),u=T(()=>o.pieceFocus?o.board.getSquare(o.pieceFocus):null),d=T(()=>o.pieceFocus?o.board.getValidMoves(o.pieceFocus).map($=>$.kind!=="move"?null:$.to).filter(Boolean):[]),c=a=>{const p=o.board.getSquare(a);return p?tt(p.allegiance)!==o.perspective:!1},f=a=>d.value.some(p=>p&&M(a,p)),y=(a,p)=>{var h,q;if(p.stopPropagation(),p.preventDefault(),f(a)&&o.pieceFocus&&u.value){if(i.value&&M(i.value,a))t("execute-node",{kind:"move",type:"en-passant",from:o.pieceFocus,to:a}),t("update-piece-focus",null);else if(ce(a,o.board.activeColour)&&u&&u.value.piece===null){r.value=a;const _=o.board.getSquare(o.pieceFocus);n.value=(h=_==null?void 0:_.allegiance)!=null?h:null}else o.board.getSquare(a)?l.value=a:((q=u.value)==null?void 0:q.piece)==="K"&&Math.abs(o.pieceFocus.file-a.file)>1?t("execute-node",{kind:"move",type:"castle",side:a.file===7?"king":"queen",from:o.pieceFocus,to:a}):t("execute-node",{kind:"move",from:o.pieceFocus,to:a});return}if(c(a))return;const $=o.board.getSquare(a);t("update-piece-focus",$?a:null)},S=(a,p)=>{!o.pieceFocus||(r.value=null,t("execute-node",{kind:"move",type:"promotion",from:o.pieceFocus,to:a,promotionTo:p}),t("update-piece-focus",null))},s=()=>{r.value=null,n.value=null},g=()=>{l.value=null},Q=a=>{!o.pieceFocus||!l.value||(a==="capture"?t("execute-node",{kind:"move",type:"capture",from:o.pieceFocus,to:l.value}):t("execute-node",{kind:"move",type:"allegiance",from:o.pieceFocus,to:l.value}),l.value=null,t("update-piece-focus",null))},k=(a,p)=>{const $=a+1,h=p+1;return o.perspective==="white"?{file:$,rank:9-h}:{file:9-$,rank:h}},R=a=>!o.board.getSquare(a),N=(a,p,$)=>o.board.getValidMoves().some(q=>q.kind==="move"&&M(q.to,$)&&M(q.from,p)&&q.type===a),E=T(()=>{const a=[];return!o.pieceFocus||!l.value||(N("allegiance",o.pieceFocus,l.value)&&a.push(">"),N("capture",o.pieceFocus,l.value)&&a.push("x")),a});return(a,p)=>(m(),w("div",el,[(m(!0),w(P,null,x(a.ranks,($,h)=>(m(),w("div",{class:"col column row full-width",key:h},[(m(!0),w(P,null,x(a.files,(q,_)=>{var K,U;return m(),w("div",{key:_,class:"full-height"},[z("div",{class:Ae(["absolute",{"cursor-pointer":!R(k(_,h))||f(k(_,h)),"cursor-not-allowed":c(k(_,h))&&!u.value}]),onClick:G=>y(k(_,h),G),style:F(a.perspective==="white"?{width:`${a.squareSize}px`,height:`${a.squareSize}px`,left:`${(k(_,h).file-1)*a.squareSize}px`,bottom:`${(k(_,h).rank-1)*a.squareSize}px`}:{width:`${a.squareSize}px`,height:`${a.squareSize}px`,right:`${(k(_,h).file-1)*a.squareSize}px`,top:`${(k(_,h).rank-1)*a.squareSize}px`})},[l.value&&L(M)(l.value,k(_,h))?(m(),B(It,{key:0,moves:E.value,"model-value":(K=L(M)(l.value,k(_,h)))!=null?K:!1,size:a.squareSize,onClick:Q,onDismiss:g},null,8,["moves","model-value","size"])):le("",!0)],14,tl),n.value!==null&&(L(ce)(k(_,h),"white")||L(ce)(k(_,h),"black"))?(m(),B(Jt,{key:0,"model-value":(U=L(M)(r.value,k(_,h)))!=null?U:!1,allegiance:n.value,size:a.squareSize,onClick:G=>S(k(_,h),G),onDismiss:s},null,8,["model-value","allegiance","size","onClick"])):le("",!0)])}),128))]))),128))]))}});var ol=Z(ll,[["__scopeId","data-v-2b4692d1"]]);const il={class:"relative-position full-width full-height column no-pointer-events indicators-layer"},nl=W({__name:"indicators-layer",props:{board:{},ranks:{},files:{},squareSize:{},perspective:{},pieceFocus:{}},setup(e){const t=e,o=T(()=>t.pieceFocus?t.board.getValidMoves(t.pieceFocus).map(f=>f.kind!=="move"?null:f.to).filter(Boolean):[]),l=d=>o.value.some(c=>c&&M(d,c)),i=d=>!t.board.getSquare(d),r=(d,c)=>{const f=d+1,y=c+1;return t.perspective==="white"?{file:f,rank:9-y}:{file:9-f,rank:y}},n=T(()=>t.board.getCheckMoves()),u=d=>n.value.some(c=>c.kind==="move"&&M(c.to,d));return(d,c)=>(m(),w("div",il,[(m(!0),w(P,null,x(d.ranks,(f,y)=>(m(),w("div",{class:"col column row full-width",key:y},[(m(!0),w(P,null,x(d.files,(S,s)=>(m(),w("div",{key:s,class:Ae(["full-height move-placeholder",{even:y%2===0?s%2===0:s%2!==0,focus:L(M)(d.pieceFocus,r(s,y)),show:l(r(s,y)),capture:!i(r(s,y)),target:i(r(s,y)),checked:u(r(s,y))}])},null,2))),128))]))),128))]))}});var al=Z(nl,[["__scopeId","data-v-56f470a5"]]);const sl={class:"relative-position full-width full-height no-pointer-events pieces-layer"},ul=W({__name:"pieces-layer",props:{modelValue:{},squareSize:{},perspective:{}},setup(e){return(t,o)=>(m(),w("div",sl,[(m(!0),w(P,null,x(t.modelValue,(l,i)=>(m(),w("div",{key:i},[l?(m(),B(Qe,{key:0,"data-testid":"piece",class:"absolute",piece:l.piece,allegiance:l.allegiance,size:t.squareSize,style:F(t.perspective==="white"?{left:`${(l.file-1)*t.squareSize}px`,bottom:`${(l.rank-1)*t.squareSize}px`}:{right:`${(l.file-1)*t.squareSize}px`,top:`${(l.rank-1)*t.squareSize}px`})},null,8,["piece","allegiance","size","style"])):(m(),w("div",{key:1,style:F({width:`${t.squareSize}px`,height:`${t.squareSize}px`})},null,4))]))),128))]))}});var rl=Z(ul,[["__scopeId","data-v-7ad57934"]]);const cl={class:"absolute full-width full-height"},dl={class:"absolute full-width full-height"},fl={class:"absolute full-width full-height"},vl={class:"absolute full-width full-height"},pl=W({__name:"board-table",props:{board:{},width:{},perspective:{},playAs:{}},emits:["execute-node"],setup(e,{emit:t}){const o=e,l=T(()=>o.width/8),i=H(null),r=n=>{t("execute-node",n),i.value=null};return(n,u)=>(m(),w("div",{"data-testid":"chess-board",class:"relative-position column",style:F({width:o.width+"px",height:o.width+"px"})},[z("div",cl,[b(Ft,{ranks:8,files:8})]),z("div",dl,[b(al,{board:n.board,"square-size":l.value,files:8,ranks:8,perspective:n.perspective,"piece-focus":i.value},null,8,["board","square-size","perspective","piece-focus"])]),z("div",fl,[b(rl,{"model-value":n.board.getSquares(),perspective:o.perspective,"square-size":l.value},null,8,["model-value","perspective","square-size"])]),z("div",vl,[b(ol,{onExecuteNode:r,onUpdatePieceFocus:u[0]||(u[0]=d=>i.value=d),"piece-focus":i.value,board:n.board,"square-size":l.value,files:8,ranks:8,perspective:o.perspective},null,8,["piece-focus","board","square-size","perspective"])])],4))}}),hl={class:"column"},ml={class:"row"},gl={class:"col"},$l=W({__name:"chess-board",props:{board:{},width:{},perspective:{},playAs:{}},emits:["execute-node"],setup(e,{emit:t}){const o=e,l=T(()=>o.width/8/2.5);return(i,r)=>(m(),w("div",{style:F({width:`${i.width}px`})},[z("div",hl,[z("div",{class:"row",style:F({height:`${l.value}px`})},[z("div",{style:F({width:`${l.value}px`})},null,4),(m(),w(P,null,x(8,(n,u)=>b(I,{key:u,class:"col column full-height justify-center",flat:""},{default:C(()=>[b(J,{class:"text-center q-pa-none"},{default:C(()=>[ee(te(L(Ce)(i.perspective==="white"?9-(8-u):8-u).toUpperCase()),1)]),_:2},1024)]),_:2},1024)),64)),z("div",{style:F({width:`${l.value}px`})},null,4)],4),z("div",ml,[z("div",{class:"column",style:F({width:`${l.value}px`})},[(m(),w(P,null,x(8,(n,u)=>b(I,{key:u,class:"col column full-height justify-center text-center",flat:""},{default:C(()=>[b(J,{class:"q-pa-none"},{default:C(()=>[ee(te(i.perspective==="white"?8-u:9-(8-u)),1)]),_:2},1024)]),_:2},1024)),64))],4),z("div",gl,[b(pl,{onExecuteNode:r[0]||(r[0]=n=>t("execute-node",n)),board:i.board,perspective:i.perspective,"play-as":i.playAs,width:i.width-l.value*2},null,8,["board","perspective","play-as","width"])]),z("div",{class:"column",style:F({width:`${l.value}px`})},[(m(),w(P,null,x(8,(n,u)=>b(I,{key:u,class:"col column full-height justify-center text-center",flat:""},{default:C(()=>[b(J,{class:"q-pa-none"},{default:C(()=>[ee(te(i.perspective==="white"?8-u:9-(8-u)),1)]),_:2},1024)]),_:2},1024)),64))],4)]),z("div",{class:"row",style:F({height:`${l.value}px`})},[z("div",{style:F({width:`${l.value}px`})},null,4),(m(),w(P,null,x(8,(n,u)=>b(I,{key:u,class:"col column full-height justify-center",flat:""},{default:C(()=>[b(J,{class:"text-center q-pa-none"},{default:C(()=>[ee(te(L(Ce)(i.perspective==="white"?9-(8-u):8-u).toUpperCase()),1)]),_:2},1024)]),_:2},1024)),64)),z("div",{style:F({width:`${l.value}px`})},null,4)],4)])],4))}});export{$l as _};
