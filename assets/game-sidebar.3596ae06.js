import{a as R,Q as le}from"./QCard.781a9cad.js";import{G as rt,p as ct,t as dt,w as ft,b as vt,c as H,i as ve,a as ht,f as $e}from"./board.6abea6e8.js";import{M as A,N as v,Q as b,W as F,R as P,_ as Z,r as W,a9 as Ae,A as ze,g as Ve,y as xe,w as U,o as pt,f as se,j as ue,D as mt,l as me,as as he,K as gt,an as _t,h as D,at as yt,au as bt,av as wt,a as q,a4 as kt,a5 as St,s as be,c as Re,C as qt,e as Ct,aa as Ne,aw as $t,t as Qe,O as M,P as S,S as k,T as oe,a0 as Y,ac as z,$ as L,Z as Oe,ae as E,U as K,V as G,ax as zt,ay as xt,F as Tt,az as Et,aA as Ft,af as Pt,ag as Mt}from"./index.8fb4d5f0.js";import{b as ge,a as _e,Q as je}from"./QList.c3f98d17.js";import{c as Bt,i as Ht,u as Lt,b as Wt,d as Dt,e as At,f as Vt}from"./selection.a0c874b8.js";import{u as Ke,a as Ge}from"./use-dark.8ed248c2.js";import{b as Te,c as Rt,a as Nt}from"./focus-manager.202af5b7.js";import{C as Ue}from"./chess-piece.4abe5418.js";var Ee=Object.freeze(Object.defineProperty({__proto__:null,GameOutcome:rt,parse:ct,tokenize:dt,writeNode:ft,write:vt},Symbol.toStringTag,{value:"Module"}));const Qt={class:"row column full-width full-height no-pointer-events background-layer","data-testid":"background"},Ot=A({__name:"background-layer",props:{ranks:{},files:{}},setup(e){return(l,o)=>(v(),b("div",Qt,[(v(!0),b(F,null,P(l.ranks,(t,i)=>(v(),b("div",{class:"rank col row full-width",key:i},[(v(!0),b(F,null,P(l.files,(n,a)=>(v(),b("div",{key:a,class:"file col"}))),128))]))),128))]))}});var jt=Z(Ot,[["__scopeId","data-v-482c5e27"]]);const Kt={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function Gt({showing:e,avoidEmit:l,configureAnchorEl:o}){const{props:t,proxy:i,emit:n}=ue(),a=W(null);let u=null;function f(s){return a.value===null?!1:s===void 0||s.touches===void 0||s.touches.length<=1}const c={};o===void 0&&(Object.assign(c,{hide(s){i.hide(s)},toggle(s){i.toggle(s),s.qAnchorHandled=!0},toggleKey(s){Ae(s,13)===!0&&c.toggle(s)},contextClick(s){i.hide(s),ze(s),Ve(()=>{i.show(s),s.qAnchorHandled=!0})},prevent:ze,mobileTouch(s){if(c.mobileCleanup(s),f(s)!==!0)return;i.hide(s),a.value.classList.add("non-selectable");const m=s.target;xe(c,"anchor",[[m,"touchmove","mobileCleanup","passive"],[m,"touchend","mobileCleanup","passive"],[m,"touchcancel","mobileCleanup","passive"],[a.value,"contextmenu","prevent","notPassive"]]),u=setTimeout(()=>{u=null,i.show(s),s.qAnchorHandled=!0},300)},mobileCleanup(s){a.value.classList.remove("non-selectable"),u!==null&&(clearTimeout(u),u=null),e.value===!0&&s!==void 0&&Bt()}}),o=function(s=t.contextMenu){if(t.noParentEvent===!0||a.value===null)return;let m;s===!0?i.$q.platform.is.mobile===!0?m=[[a.value,"touchstart","mobileTouch","passive"]]:m=[[a.value,"mousedown","hide","passive"],[a.value,"contextmenu","contextClick","notPassive"]]:m=[[a.value,"click","toggle","passive"],[a.value,"keyup","toggleKey","passive"]],xe(c,"anchor",m)});function h(){mt(c,"anchor")}function y(s){for(a.value=s;a.value.classList.contains("q-anchor--skip");)a.value=a.value.parentNode;o()}function C(){if(t.target===!1||t.target===""||i.$el.parentNode===null)a.value=null;else if(t.target===!0)y(i.$el.parentNode);else{let s=t.target;if(typeof t.target=="string")try{s=document.querySelector(t.target)}catch{s=void 0}s!=null?(a.value=s.$el||s,o()):(a.value=null,console.error(`Anchor: target "${t.target}" not found`))}}return U(()=>t.contextMenu,s=>{a.value!==null&&(h(),o(s))}),U(()=>t.target,()=>{a.value!==null&&h(),C()}),U(()=>t.noParentEvent,s=>{a.value!==null&&(s===!0?h():o())}),pt(()=>{C(),l!==!0&&t.modelValue===!0&&a.value===null&&n("update:modelValue",!1)}),se(()=>{u!==null&&clearTimeout(u),h()}),{anchorEl:a,canShow:f,anchorEvents:c}}function Ut(e,l){const o=W(null);let t;function i(u,f){const c=`${f!==void 0?"add":"remove"}EventListener`,h=f!==void 0?f:t;u!==window&&u[c]("scroll",h,me.passive),window[c]("scroll",h,me.passive),t=f}function n(){o.value!==null&&(i(o.value),o.value=null)}const a=U(()=>e.noParentEvent,()=>{o.value!==null&&(n(),l())});return se(a),{localScrollTarget:o,unconfigureScrollTarget:n,changeScrollEvent:i}}const ie=[];function Yt(e,l){do{if(e.$options.name==="QMenu"){if(e.hide(l),e.$props.separateClosePopup===!0)return he(e)}else if(e.__qPortal===!0){const o=he(e);return o!==void 0&&o.$options.name==="QPopupProxy"?(e.hide(l),o):e}e=he(e)}while(e!=null)}function Xt(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function Zt(e,l,o,t){const i=W(!1),n=W(!1);let a=null;const u={},f=t==="dialog"&&Xt(e);function c(y){if(y===!0){Te(u),n.value=!0;return}n.value=!1,i.value===!1&&(f===!1&&a===null&&(a=bt(!1,t)),i.value=!0,ie.push(e.proxy),Rt(u))}function h(y){if(n.value=!1,y!==!0)return;Te(u),i.value=!1;const C=ie.indexOf(e.proxy);C!==-1&&ie.splice(C,1),a!==null&&(wt(a),a=null)}return gt(()=>{h(!0)}),e.proxy.__qPortal=!0,_t(e.proxy,"contentEl",()=>l.value),{showPortal:c,hidePortal:h,portalIsActive:i,portalIsAccessible:n,renderPortal:()=>f===!0?o():i.value===!0?[D(yt,{to:a},o())]:void 0}}const Jt={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function It(e,l=()=>{},o=()=>{}){return{transitionProps:q(()=>{const t=`q-transition--${e.transitionShow||l()}`,i=`q-transition--${e.transitionHide||o()}`;return{appear:!0,enterFromClass:`${t}-enter-from`,enterActiveClass:`${t}-enter-active`,enterToClass:`${t}-enter-to`,leaveFromClass:`${i}-leave-from`,leaveActiveClass:`${i}-leave-active`,leaveToClass:`${i}-leave-to`}}),transitionStyle:q(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}function el(){let e;const l=ue();function o(){e=void 0}return kt(o),se(o),{removeTick:o,registerTick(t){e=t,Ve(()=>{e===t&&(St(l)===!1&&e(),e=void 0)})}}}const N=[];let X;function tl(e){X=e.keyCode===27}function ll(){X===!0&&(X=!1)}function ol(e){X===!0&&(X=!1,Ae(e,27)===!0&&N[N.length-1](e))}function Ye(e){window[e]("keydown",tl),window[e]("blur",ll),window[e]("keyup",ol),X=!1}function il(e){be.is.desktop===!0&&(N.push(e),N.length===1&&Ye("addEventListener"))}function Fe(e){const l=N.indexOf(e);l>-1&&(N.splice(l,1),N.length===0&&Ye("removeEventListener"))}const Q=[];function Xe(e){Q[Q.length-1](e)}function al(e){be.is.desktop===!0&&(Q.push(e),Q.length===1&&document.body.addEventListener("focusin",Xe))}function nl(e){const l=Q.indexOf(e);l>-1&&(Q.splice(l,1),Q.length===0&&document.body.removeEventListener("focusin",Xe))}const{notPassiveCapture:ae}=me,O=[];function ne(e){const l=e.target;if(l===void 0||l.nodeType===8||l.classList.contains("no-pointer-events")===!0)return;let o=ie.length-1;for(;o>=0;){const t=ie[o].$;if(t.type.name==="QTooltip"){o--;continue}if(t.type.name!=="QDialog")break;if(t.props.seamless!==!0)return;o--}for(let t=O.length-1;t>=0;t--){const i=O[t];if((i.anchorEl.value===null||i.anchorEl.value.contains(l)===!1)&&(l===document.body||i.innerRef.value!==null&&i.innerRef.value.contains(l)===!1))e.qClickOutside=!0,i.onClickOutside(e);else return}}function sl(e){O.push(e),O.length===1&&(document.addEventListener("mousedown",ne,ae),document.addEventListener("touchstart",ne,ae))}function Pe(e){const l=O.findIndex(o=>o===e);l>-1&&(O.splice(l,1),O.length===0&&(document.removeEventListener("mousedown",ne,ae),document.removeEventListener("touchstart",ne,ae)))}let Me,Be;function He(e){const l=e.split(" ");return l.length!==2?!1:["top","center","bottom"].includes(l[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(l[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function ul(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const ye={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{ye[`${e}#ltr`]=e,ye[`${e}#rtl`]=e});function Le(e,l){const o=e.split(" ");return{vertical:o[0],horizontal:ye[`${o[1]}#${l===!0?"rtl":"ltr"}`]}}function rl(e,l){let{top:o,left:t,right:i,bottom:n,width:a,height:u}=e.getBoundingClientRect();return l!==void 0&&(o-=l[1],t-=l[0],n+=l[1],i+=l[0],a+=l[0],u+=l[1]),{top:o,bottom:n,height:u,left:t,right:i,width:a,middle:t+(i-t)/2,center:o+(n-o)/2}}function cl(e,l,o){let{top:t,left:i}=e.getBoundingClientRect();return t+=l.top,i+=l.left,o!==void 0&&(t+=o[1],i+=o[0]),{top:t,bottom:t+1,height:1,left:i,right:i+1,width:1,middle:i,center:t}}function dl(e,l){return{top:0,center:l/2,bottom:l,left:0,middle:e/2,right:e}}function We(e,l,o,t){return{top:e[o.vertical]-l[t.vertical],left:e[o.horizontal]-l[t.horizontal]}}function Ze(e,l=0){if(e.targetEl===null||e.anchorEl===null||l>5)return;if(e.targetEl.offsetHeight===0||e.targetEl.offsetWidth===0){setTimeout(()=>{Ze(e,l+1)},10);return}const{targetEl:o,offset:t,anchorEl:i,anchorOrigin:n,selfOrigin:a,absoluteOffset:u,fit:f,cover:c,maxHeight:h,maxWidth:y}=e;if(be.is.ios===!0&&window.visualViewport!==void 0){const x=document.body.style,{offsetLeft:_,offsetTop:$}=window.visualViewport;_!==Me&&(x.setProperty("--q-pe-left",_+"px"),Me=_),$!==Be&&(x.setProperty("--q-pe-top",$+"px"),Be=$)}const{scrollLeft:C,scrollTop:s}=o,m=u===void 0?rl(i,c===!0?[0,0]:t):cl(i,u,t);Object.assign(o.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:y||"100vw",maxHeight:h||"100vh",visibility:"visible"});const{offsetWidth:V,offsetHeight:d}=o,{elWidth:B,elHeight:j}=f===!0||c===!0?{elWidth:Math.max(m.width,V),elHeight:c===!0?Math.max(m.height,d):d}:{elWidth:V,elHeight:d};let T={maxWidth:y,maxHeight:h};(f===!0||c===!0)&&(T.minWidth=m.width+"px",c===!0&&(T.minHeight=m.height+"px")),Object.assign(o.style,T);const r=dl(B,j);let g=We(m,r,n,a);if(u===void 0||t===void 0)pe(g,m,r,n,a);else{const{top:x,left:_}=g;pe(g,m,r,n,a);let $=!1;if(g.top!==x){$=!0;const w=2*t[1];m.center=m.top-=w,m.bottom-=w+2}if(g.left!==_){$=!0;const w=2*t[0];m.middle=m.left-=w,m.right-=w+2}$===!0&&(g=We(m,r,n,a),pe(g,m,r,n,a))}T={top:g.top+"px",left:g.left+"px"},g.maxHeight!==void 0&&(T.maxHeight=g.maxHeight+"px",m.height>g.maxHeight&&(T.minHeight=T.maxHeight)),g.maxWidth!==void 0&&(T.maxWidth=g.maxWidth+"px",m.width>g.maxWidth&&(T.minWidth=T.maxWidth)),Object.assign(o.style,T),o.scrollTop!==s&&(o.scrollTop=s),o.scrollLeft!==C&&(o.scrollLeft=C)}function pe(e,l,o,t,i){const n=o.bottom,a=o.right,u=Ht(),f=window.innerHeight-u,c=document.body.clientWidth;if(e.top<0||e.top+n>f)if(i.vertical==="center")e.top=l[t.vertical]>f/2?Math.max(0,f-n):0,e.maxHeight=Math.min(n,f);else if(l[t.vertical]>f/2){const h=Math.min(f,t.vertical==="center"?l.center:t.vertical===i.vertical?l.bottom:l.top);e.maxHeight=Math.min(n,h),e.top=Math.max(0,h-n)}else e.top=Math.max(0,t.vertical==="center"?l.center:t.vertical===i.vertical?l.top:l.bottom),e.maxHeight=Math.min(n,f-e.top);if(e.left<0||e.left+a>c)if(e.maxWidth=Math.min(a,c),i.horizontal==="middle")e.left=l[t.horizontal]>c/2?Math.max(0,c-a):0;else if(l[t.horizontal]>c/2){const h=Math.min(c,t.horizontal==="middle"?l.middle:t.horizontal===i.horizontal?l.right:l.left);e.maxWidth=Math.min(a,h),e.left=Math.max(0,h-e.maxWidth)}else e.left=Math.max(0,t.horizontal==="middle"?l.middle:t.horizontal===i.horizontal?l.left:l.right),e.maxWidth=Math.min(a,c-e.left)}var Je=Re({name:"QMenu",inheritAttrs:!1,props:{...Kt,...Lt,...Ke,...Jt,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:He},self:{type:String,validator:He},offset:{type:Array,validator:ul},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...Wt,"click","escapeKey"],setup(e,{slots:l,emit:o,attrs:t}){let i=null,n,a,u;const f=ue(),{proxy:c}=f,{$q:h}=c,y=W(null),C=W(!1),s=q(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),m=Ge(e,h),{registerTick:V,removeTick:d}=el(),{registerTimeout:B}=Dt(),{transitionProps:j,transitionStyle:T}=It(e),{localScrollTarget:r,changeScrollEvent:g,unconfigureScrollTarget:x}=Ut(e,qe),{anchorEl:_,canShow:$}=Gt({showing:C}),{hide:w}=At({showing:C,canShow:$,handleShow:ot,handleHide:it,hideOnRouteChange:s,processOnMount:!0}),{showPortal:J,hidePortal:I,renderPortal:ee}=Zt(f,y,nt,"menu"),re={anchorEl:_,innerRef:y,onClickOutside(p){if(e.persistent!==!0&&C.value===!0)return w(p),(p.type==="touchstart"||p.target.classList.contains("q-dialog__backdrop"))&&Qe(p),!0}},we=q(()=>Le(e.anchor||(e.cover===!0?"center middle":"bottom start"),h.lang.rtl)),et=q(()=>e.cover===!0?we.value:Le(e.self||"top start",h.lang.rtl)),tt=q(()=>(e.square===!0?" q-menu--square":"")+(m.value===!0?" q-menu--dark q-dark":"")),lt=q(()=>e.autoClose===!0?{onClick:at}:{}),ke=q(()=>C.value===!0&&e.persistent!==!0);U(ke,p=>{p===!0?(il(de),sl(re)):(Fe(de),Pe(re))});function ce(){Nt(()=>{let p=y.value;p&&p.contains(document.activeElement)!==!0&&(p=p.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||p.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||p.querySelector("[autofocus], [data-autofocus]")||p,p.focus({preventScroll:!0}))})}function ot(p){if(i=e.noRefocus===!1?document.activeElement:null,al(Ce),J(),qe(),n=void 0,p!==void 0&&(e.touchPosition||e.contextMenu)){const fe=qt(p);if(fe.left!==void 0){const{top:st,left:ut}=_.value.getBoundingClientRect();n={left:fe.left-ut,top:fe.top-st}}}a===void 0&&(a=U(()=>h.screen.width+"|"+h.screen.height+"|"+e.self+"|"+e.anchor+"|"+h.lang.rtl,te)),e.noFocus!==!0&&document.activeElement.blur(),V(()=>{te(),e.noFocus!==!0&&ce()}),B(()=>{h.platform.is.ios===!0&&(u=e.autoClose,y.value.click()),te(),J(!0),o("show",p)},e.transitionDuration)}function it(p){d(),I(),Se(!0),i!==null&&(p===void 0||p.qClickOutside!==!0)&&(((p&&p.type.indexOf("key")===0?i.closest('[tabindex]:not([tabindex^="-"])'):void 0)||i).focus(),i=null),B(()=>{I(!0),o("hide",p)},e.transitionDuration)}function Se(p){n=void 0,a!==void 0&&(a(),a=void 0),(p===!0||C.value===!0)&&(nl(Ce),x(),Pe(re),Fe(de)),p!==!0&&(i=null)}function qe(){(_.value!==null||e.scrollTarget!==void 0)&&(r.value=Vt(_.value,e.scrollTarget),g(r.value,te))}function at(p){u!==!0?(Yt(c,p),o("click",p)):u=!1}function Ce(p){ke.value===!0&&e.noFocus!==!0&&$t(y.value,p.target)!==!0&&ce()}function de(p){o("escapeKey"),w(p)}function te(){Ze({targetEl:y.value,offset:e.offset,anchorEl:_.value,anchorOrigin:we.value,selfOrigin:et.value,absoluteOffset:n,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function nt(){return D(Ne,j.value,()=>C.value===!0?D("div",{role:"menu",...t,ref:y,tabindex:-1,class:["q-menu q-position-engine scroll"+tt.value,t.class],style:[t.style,T.value],...lt.value},Ct(l.default)):null)}return se(Se),Object.assign(c,{focus:ce,updatePosition:te}),ee}});const fl=A({__name:"promotion-selector",props:{modelValue:{type:Boolean},allegiance:{}},emits:["click","dismiss"],setup(e,{emit:l}){const o=["Q","N","R","B"],t=()=>{l("dismiss")};return(i,n)=>(v(),M(Je,{cover:"","model-value":i.modelValue,"onUpdate:modelValue":t},{default:S(()=>[k(je,null,{default:S(()=>[(v(),b(F,null,P(o,a=>k(ge,{clickable:"",key:a,class:"q-pa-sm",onClick:u=>l("click",a)},{default:S(()=>[k(_e,{class:"promotion-piece"},{default:S(()=>[k(Ue,{allegiance:i.allegiance,piece:a,size:86},null,8,["allegiance","piece"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1},8,["model-value"]))}});var vl=Z(fl,[["__scopeId","data-v-0418dade"]]);const hl=A({__name:"capture-selector",props:{modelValue:{type:Boolean},moves:{}},emits:["click","dismiss"],setup(e,{emit:l}){const o=()=>{l("dismiss")};return(t,i)=>(v(),M(Je,{cover:"","model-value":t.modelValue,"onUpdate:modelValue":o},{default:S(()=>[k(je,null,{default:S(()=>[t.moves.includes("x")?(v(),M(ge,{key:0,clickable:"",onClick:i[0]||(i[0]=n=>l("click","capture")),class:"q-py-lg"},{default:S(()=>[k(_e,{class:"items-center"},{default:S(()=>[k(oe,{size:"72px",name:"close"})]),_:1})]),_:1})):Y("",!0),t.moves.includes(">")?(v(),M(ge,{key:1,clickable:"",onClick:i[1]||(i[1]=n=>l("click","challenge")),class:"q-py-lg"},{default:S(()=>[k(_e,{class:"items-center"},{default:S(()=>[k(oe,{size:"64px",name:"arrow_forward_ios"})]),_:1})]),_:1})):Y("",!0)]),_:1})]),_:1},8,["model-value"]))}});const pl={class:"relative-position full-width full-height interaction-layer"},ml=["onClick"],gl=A({__name:"interaction-layer",props:{board:{},squareSize:{},ranks:{},files:{},perspective:{},pieceFocus:{}},emits:["execute-node","update-piece-focus","update-highlights"],setup(e,{emit:l}){const o=e,t=W(null),i=q(()=>o.board.enPassantTarget),n=W(null),a=W(null),u=q(()=>o.pieceFocus?o.board.getSquare(o.pieceFocus):null),f=q(()=>o.pieceFocus?o.board.getValidMoves(o.pieceFocus).map(x=>x.kind!=="move"?null:x.to).filter(Boolean):[]),c=r=>{const g=o.board.getSquare(r);return g?ht(g.allegiance)!==o.perspective:!1},h=r=>f.value.some(g=>g&&H(r,g)),y=(r,g)=>{var _,$;if(g.stopPropagation(),g.preventDefault(),h(r)&&o.pieceFocus&&u.value){if(i.value&&H(i.value,r))l("execute-node",{kind:"move",type:"en-passant",from:o.pieceFocus,to:r}),l("update-piece-focus",null);else if(ve(r,o.board.activeColour)&&u&&u.value.piece===null){n.value=r;const w=o.board.getSquare(o.pieceFocus);a.value=(_=w==null?void 0:w.allegiance)!=null?_:null}else o.board.getSquare(r)?t.value=r:(($=u.value)==null?void 0:$.piece)==="K"&&Math.abs(o.pieceFocus.file-r.file)>1?l("execute-node",{kind:"move",type:"castle",side:r.file===7?"king":"queen",from:o.pieceFocus,to:r}):l("execute-node",{kind:"move",from:o.pieceFocus,to:r});return}if(c(r))return;const x=o.board.getSquare(r);l("update-piece-focus",x?r:null)},C=(r,g)=>{!o.pieceFocus||(n.value=null,l("execute-node",{kind:"move",type:"promotion",from:o.pieceFocus,to:r,promotionTo:g}),l("update-piece-focus",null))},s=()=>{n.value=null,a.value=null},m=()=>{t.value=null},V=r=>{!o.pieceFocus||!t.value||(r==="capture"?l("execute-node",{kind:"move",type:"capture",from:o.pieceFocus,to:t.value}):l("execute-node",{kind:"move",type:"allegiance",from:o.pieceFocus,to:t.value}),t.value=null,l("update-piece-focus",null))},d=(r,g)=>{const x=r+1,_=g+1;return o.perspective==="white"?{file:x,rank:9-_}:{file:9-x,rank:_}},B=r=>!o.board.getSquare(r),j=(r,g,x)=>o.board.getValidMoves().some($=>$.kind==="move"&&H($.to,x)&&H($.from,g)&&$.type===r),T=q(()=>{const r=[];return!o.pieceFocus||!t.value||(j("allegiance",o.pieceFocus,t.value)&&r.push(">"),j("capture",o.pieceFocus,t.value)&&r.push("x")),r});return(r,g)=>(v(),b("div",pl,[(v(!0),b(F,null,P(r.ranks,(x,_)=>(v(),b("div",{class:"col column row full-width",key:_},[(v(!0),b(F,null,P(r.files,($,w)=>{var J,I;return v(),b("div",{key:w,class:"full-height"},[z("div",{class:Oe(["absolute",{"cursor-pointer":!B(d(w,_))||h(d(w,_)),"cursor-not-allowed":c(d(w,_))&&!u.value}]),onClick:ee=>y(d(w,_),ee),style:E(r.perspective==="white"?{width:`${r.squareSize}px`,height:`${r.squareSize}px`,left:`${(d(w,_).file-1)*r.squareSize}px`,bottom:`${(d(w,_).rank-1)*r.squareSize}px`}:{width:`${r.squareSize}px`,height:`${r.squareSize}px`,right:`${(d(w,_).file-1)*r.squareSize}px`,top:`${(d(w,_).rank-1)*r.squareSize}px`})},[t.value&&L(H)(t.value,d(w,_))?(v(),M(hl,{key:0,moves:T.value,"model-value":(J=L(H)(t.value,d(w,_)))!=null?J:!1,size:r.squareSize,onClick:V,onDismiss:m},null,8,["moves","model-value","size"])):Y("",!0)],14,ml),a.value!==null&&(L(ve)(d(w,_),"white")||L(ve)(d(w,_),"black"))?(v(),M(vl,{key:0,"model-value":(I=L(H)(n.value,d(w,_)))!=null?I:!1,allegiance:a.value,size:r.squareSize,onClick:ee=>C(d(w,_),ee),onDismiss:s},null,8,["model-value","allegiance","size","onClick"])):Y("",!0)])}),128))]))),128))]))}});var _l=Z(gl,[["__scopeId","data-v-2b4692d1"]]);const yl={class:"relative-position full-width full-height column no-pointer-events indicators-layer"},bl=A({__name:"indicators-layer",props:{board:{},ranks:{},files:{},squareSize:{},perspective:{},pieceFocus:{}},setup(e){const l=e,o=q(()=>l.pieceFocus?l.board.getValidMoves(l.pieceFocus).map(h=>h.kind!=="move"?null:h.to).filter(Boolean):[]),t=f=>o.value.some(c=>c&&H(f,c)),i=f=>!l.board.getSquare(f),n=(f,c)=>{const h=f+1,y=c+1;return l.perspective==="white"?{file:h,rank:9-y}:{file:9-h,rank:y}},a=q(()=>l.board.getCheckMoves()),u=f=>a.value.some(c=>c.kind==="move"&&H(c.to,f));return(f,c)=>(v(),b("div",yl,[(v(!0),b(F,null,P(f.ranks,(h,y)=>(v(),b("div",{class:"col column row full-width",key:y},[(v(!0),b(F,null,P(f.files,(C,s)=>(v(),b("div",{key:s,class:Oe(["full-height move-placeholder",{even:y%2===0?s%2===0:s%2!==0,focus:L(H)(f.pieceFocus,n(s,y)),show:t(n(s,y)),capture:!i(n(s,y)),target:i(n(s,y)),checked:u(n(s,y))}])},null,2))),128))]))),128))]))}});var wl=Z(bl,[["__scopeId","data-v-56f470a5"]]);const kl={class:"relative-position full-width full-height no-pointer-events pieces-layer"},Sl=A({__name:"pieces-layer",props:{modelValue:{},squareSize:{},perspective:{}},setup(e){return(l,o)=>(v(),b("div",kl,[(v(!0),b(F,null,P(l.modelValue,(t,i)=>(v(),b("div",{key:i},[t?(v(),M(Ue,{key:0,"data-testid":"piece",class:"absolute",piece:t.piece,allegiance:t.allegiance,size:l.squareSize,style:E(l.perspective==="white"?{left:`${(t.file-1)*l.squareSize}px`,bottom:`${(t.rank-1)*l.squareSize}px`}:{right:`${(t.file-1)*l.squareSize}px`,top:`${(t.rank-1)*l.squareSize}px`})},null,8,["piece","allegiance","size","style"])):(v(),b("div",{key:1,style:E({width:`${l.squareSize}px`,height:`${l.squareSize}px`})},null,4))]))),128))]))}});var ql=Z(Sl,[["__scopeId","data-v-7ad57934"]]);const Cl={class:"absolute full-width full-height"},$l={class:"absolute full-width full-height"},zl={class:"absolute full-width full-height"},xl={class:"absolute full-width full-height"},Tl=A({__name:"board-table",props:{board:{},width:{},perspective:{},playAs:{}},emits:["execute-node"],setup(e,{emit:l}){const o=e,t=q(()=>o.width/8),i=W(null),n=a=>{l("execute-node",a),i.value=null};return(a,u)=>(v(),b("div",{"data-testid":"chess-board",class:"relative-position column",style:E({width:o.width+"px",height:o.width+"px"})},[z("div",Cl,[k(jt,{ranks:8,files:8})]),z("div",$l,[k(wl,{board:a.board,"square-size":t.value,files:8,ranks:8,perspective:a.perspective,"piece-focus":i.value},null,8,["board","square-size","perspective","piece-focus"])]),z("div",zl,[k(ql,{"model-value":a.board.getSquares(),perspective:o.perspective,"square-size":t.value},null,8,["model-value","perspective","square-size"])]),z("div",xl,[k(_l,{onExecuteNode:n,onUpdatePieceFocus:u[0]||(u[0]=f=>i.value=f),"piece-focus":i.value,board:a.board,"square-size":t.value,files:8,ranks:8,perspective:o.perspective},null,8,["piece-focus","board","square-size","perspective"])])],4))}}),El={class:"column"},Fl={class:"row"},Pl={class:"col"},Gl=A({__name:"chess-board",props:{board:{},width:{},perspective:{},playAs:{}},emits:["execute-node"],setup(e,{emit:l}){const o=e,t=q(()=>o.width/8/2.5);return(i,n)=>(v(),b("div",{style:E({width:`${i.width}px`})},[z("div",El,[z("div",{class:"row",style:E({height:`${t.value}px`})},[z("div",{style:E({width:`${t.value}px`})},null,4),(v(),b(F,null,P(8,(a,u)=>k(le,{key:u,class:"col column full-height justify-center",flat:""},{default:S(()=>[k(R,{class:"text-center q-pa-none"},{default:S(()=>[K(G(L($e)(i.perspective==="white"?9-(8-u):8-u).toUpperCase()),1)]),_:2},1024)]),_:2},1024)),64)),z("div",{style:E({width:`${t.value}px`})},null,4)],4),z("div",Fl,[z("div",{class:"column",style:E({width:`${t.value}px`})},[(v(),b(F,null,P(8,(a,u)=>k(le,{key:u,class:"col column full-height justify-center text-center",flat:""},{default:S(()=>[k(R,{class:"q-pa-none"},{default:S(()=>[K(G(i.perspective==="white"?8-u:9-(8-u)),1)]),_:2},1024)]),_:2},1024)),64))],4),z("div",Pl,[k(Tl,{onExecuteNode:n[0]||(n[0]=a=>l("execute-node",a)),board:i.board,perspective:i.perspective,"play-as":i.playAs,width:i.width-t.value*2},null,8,["board","perspective","play-as","width"])]),z("div",{class:"column",style:E({width:`${t.value}px`})},[(v(),b(F,null,P(8,(a,u)=>k(le,{key:u,class:"col column full-height justify-center text-center",flat:""},{default:S(()=>[k(R,{class:"q-pa-none"},{default:S(()=>[K(G(i.perspective==="white"?8-u:9-(8-u)),1)]),_:2},1024)]),_:2},1024)),64))],4)]),z("div",{class:"row",style:E({height:`${t.value}px`})},[z("div",{style:E({width:`${t.value}px`})},null,4),(v(),b(F,null,P(8,(a,u)=>k(le,{key:u,class:"col column full-height justify-center",flat:""},{default:S(()=>[k(R,{class:"text-center q-pa-none"},{default:S(()=>[K(G(L($e)(i.perspective==="white"?9-(8-u):8-u).toUpperCase()),1)]),_:2},1024)]),_:2},1024)),64)),z("div",{style:E({width:`${t.value}px`})},null,4)],4)])],4))}}),Ml={xs:8,sm:10,md:14,lg:20,xl:24};var De=Re({name:"QChip",props:{...Ke,...zt,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:l,emit:o}){const{proxy:{$q:t}}=ue(),i=Ge(e,t),n=xt(e,Ml),a=q(()=>e.selected===!0||e.icon!==void 0),u=q(()=>e.selected===!0?e.iconSelected||t.iconSet.chip.selected:e.icon),f=q(()=>e.iconRemove||t.iconSet.chip.remove),c=q(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),h=q(()=>{const d=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(d?` text-${d} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(c.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(i.value===!0?" q-chip--dark q-dark":"")}),y=q(()=>{const d=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},B={...d,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||t.lang.label.remove};return{chip:d,remove:B}});function C(d){d.keyCode===13&&s(d)}function s(d){e.disable||(o("update:selected",!e.selected),o("click",d))}function m(d){(d.keyCode===void 0||d.keyCode===13)&&(Qe(d),e.disable===!1&&(o("update:modelValue",!1),o("remove")))}function V(){const d=[];c.value===!0&&d.push(D("div",{class:"q-focus-helper"})),a.value===!0&&d.push(D(oe,{class:"q-chip__icon q-chip__icon--left",name:u.value}));const B=e.label!==void 0?[D("div",{class:"ellipsis"},[e.label])]:void 0;return d.push(D("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},Et(l.default,B))),e.iconRight&&d.push(D(oe,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&d.push(D(oe,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:f.value,...y.value.remove,onClick:m,onKeyup:m})),d}return()=>{if(e.modelValue===!1)return;const d={class:h.value,style:n.value};return c.value===!0&&Object.assign(d,y.value.chip,{onClick:s,onKeyup:C}),Tt("div",d,V(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[Ft,e.ripple]])}}});const Ie=e=>(Pt("data-v-0066e02d"),e=e(),Mt(),e),Bl=Ie(()=>z("div",{class:"text-h6"},"Your turn!",-1)),Hl=Ie(()=>z("div",{class:"text-h6"},"Waiting for opponent...",-1)),Ll={key:0,class:"col"},Wl={key:1,class:"col"},Dl=A({__name:"game-sidebar",props:{moveHistory:{},activeColour:{},ownColour:{}},setup(e){const l=e,o=q(()=>{const t=[];return l.moveHistory.children.forEach(i=>{const n=t.at(-1);if(!n||n.length!==1){t.push([i]);return}n.push(i)}),t});return(t,i)=>(v(),M(le,{flat:"",bordered:"",class:"q-ma-md"},{default:S(()=>[k(Ne,{mode:"out-in"},{default:S(()=>[t.activeColour===t.ownColour?(v(),M(R,{key:0,class:"bg-primary text-white q-mb-md"},{default:S(()=>[Bl]),_:1})):(v(),M(R,{key:1,class:"bg-grey text-black q-mb-md"},{default:S(()=>[Hl]),_:1}))]),_:1}),(v(!0),b(F,null,P(o.value,(n,a)=>(v(),M(R,{key:a,horizontal:"",class:"row q-py-none q-mx-md"},{default:S(()=>[n[0]?(v(),b("div",Ll,[k(De,{class:"white-move"},{default:S(()=>[K(G(L(Ee).writeNode(n[0])),1)]),_:2},1024)])):Y("",!0),n[1]?(v(),b("div",Wl,[k(De,{class:"black-move"},{default:S(()=>[K(G(L(Ee).writeNode(n[1])),1)]),_:2},1024)])):Y("",!0)]),_:2},1024))),128))]),_:1}))}});var Ul=Z(Dl,[["__scopeId","data-v-0066e02d"]]);export{Ul as G,Gl as _};
