var T=Object.defineProperty;var z=(e,u,n)=>u in e?T(e,u,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[u]=n;var _=(e,u,n)=>(z(e,typeof u!="symbol"?u+"":u,n),n);import{u as I,a as Q}from"./use-dark.02aaef7f.js";import{c as R,aj as j,ak as H,a as g,h as x,L as V,j as J,e as L,al as U,r as w,B as W,o as X,d as q,M as D,am as Y,an as G,w as N,Y as K,N as E,O as B,$ as Z,P as $,ao as ee,S as M}from"./index.6f489cc4.js";import{u as te}from"./use-can-render.d9a961ff.js";import{H as O}from"./hex.4419bc91.js";import{u as ne}from"./use-quasar.b1536429.js";import{F as re}from"./boards.07b20eb6.js";const se={xs:2,sm:4,md:6,lg:10,xl:14};function A(e,u,n){return{transform:u===!0?`translateX(${n.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var oe=R({name:"QLinearProgress",props:{...I,...j,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:u}){const{proxy:n}=J(),m=Q(e,n.$q),p=H(e,se),l=g(()=>e.indeterminate===!0||e.query===!0),y=g(()=>e.reverse!==e.query),i=g(()=>({...p.value!==null?p.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),c=g(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),a=g(()=>A(e.buffer!==void 0?e.buffer:1,y.value,n.$q)),o=g(()=>`with${e.instantFeedback===!0?"out":""}-transition`),t=g(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${o.value} q-linear-progress__track--${m.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),r=g(()=>A(l.value===!0?1:e.value,y.value,n.$q)),v=g(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${o.value} q-linear-progress__model--${l.value===!0?"in":""}determinate`),f=g(()=>({width:`${e.value*100}%`})),C=g(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${o.value}`);return()=>{const s=[x("div",{class:t.value,style:a.value}),x("div",{class:v.value,style:r.value})];return e.stripe===!0&&l.value===!1&&s.push(x("div",{class:C.value,style:f.value})),x("div",{class:c.value,style:i.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},V(u.default,s))}}}),ae=R({name:"QNoSsr",props:{tag:{type:String,default:"div"},placeholder:String},setup(e,{slots:u}){const n=te();return()=>{const m={};if(n.value===!0){const l=L(u.default);return l===void 0?l:l.length>1?x(e.tag,m,l):l[0]}m.class="q-no-ssr-placeholder";const p=L(u.placeholder);if(p!==void 0)return p.length>1?x(e.tag,m,p):p[0];if(e.placeholder!==void 0)return x(e.tag,m,e.placeholder)}}});const le=()=>{const e=ne();return{notify:n=>{e.notify({timeout:4e3,position:"bottom-right",...n})}}};var F={exports:{}};(function(e){var u=Object.prototype.hasOwnProperty,n="~";function m(){}Object.create&&(m.prototype=Object.create(null),new m().__proto__||(n=!1));function p(c,a,o){this.fn=c,this.context=a,this.once=o||!1}function l(c,a,o,t,r){if(typeof o!="function")throw new TypeError("The listener must be a function");var v=new p(o,t||c,r),f=n?n+a:a;return c._events[f]?c._events[f].fn?c._events[f]=[c._events[f],v]:c._events[f].push(v):(c._events[f]=v,c._eventsCount++),c}function y(c,a){--c._eventsCount===0?c._events=new m:delete c._events[a]}function i(){this._events=new m,this._eventsCount=0}i.prototype.eventNames=function(){var a=[],o,t;if(this._eventsCount===0)return a;for(t in o=this._events)u.call(o,t)&&a.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(o)):a},i.prototype.listeners=function(a){var o=n?n+a:a,t=this._events[o];if(!t)return[];if(t.fn)return[t.fn];for(var r=0,v=t.length,f=new Array(v);r<v;r++)f[r]=t[r].fn;return f},i.prototype.listenerCount=function(a){var o=n?n+a:a,t=this._events[o];return t?t.fn?1:t.length:0},i.prototype.emit=function(a,o,t,r,v,f){var C=n?n+a:a;if(!this._events[C])return!1;var s=this._events[C],b=arguments.length,h,d;if(s.fn){switch(s.once&&this.removeListener(a,s.fn,void 0,!0),b){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,o),!0;case 3:return s.fn.call(s.context,o,t),!0;case 4:return s.fn.call(s.context,o,t,r),!0;case 5:return s.fn.call(s.context,o,t,r,v),!0;case 6:return s.fn.call(s.context,o,t,r,v,f),!0}for(d=1,h=new Array(b-1);d<b;d++)h[d-1]=arguments[d];s.fn.apply(s.context,h)}else{var S=s.length,k;for(d=0;d<S;d++)switch(s[d].once&&this.removeListener(a,s[d].fn,void 0,!0),b){case 1:s[d].fn.call(s[d].context);break;case 2:s[d].fn.call(s[d].context,o);break;case 3:s[d].fn.call(s[d].context,o,t);break;case 4:s[d].fn.call(s[d].context,o,t,r);break;default:if(!h)for(k=1,h=new Array(b-1);k<b;k++)h[k-1]=arguments[k];s[d].fn.apply(s[d].context,h)}}return!0},i.prototype.on=function(a,o,t){return l(this,a,o,t,!1)},i.prototype.once=function(a,o,t){return l(this,a,o,t,!0)},i.prototype.removeListener=function(a,o,t,r){var v=n?n+a:a;if(!this._events[v])return this;if(!o)return y(this,v),this;var f=this._events[v];if(f.fn)f.fn===o&&(!r||f.once)&&(!t||f.context===t)&&y(this,v);else{for(var C=0,s=[],b=f.length;C<b;C++)(f[C].fn!==o||r&&!f[C].once||t&&f[C].context!==t)&&s.push(f[C]);s.length?this._events[v]=s.length===1?s[0]:s:y(this,v)}return this},i.prototype.removeAllListeners=function(a){var o;return a?(o=n?n+a:a,this._events[o]&&y(this,o)):(this._events=new m,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=n,i.EventEmitter=i,e.exports=i})(F);class ue extends F.exports.EventEmitter{constructor(){super(...arguments);_(this,"id","mock-peer");_(this,"options",{});_(this,"open",!1);_(this,"socket",null);_(this,"connections",{});_(this,"destroyed",!1);_(this,"disconnected",!1);_(this,"_getMessages",()=>[]);_(this,"connect",()=>null);_(this,"call",()=>null);_(this,"_removeConnection",()=>null);_(this,"getConnection",()=>null);_(this,"destroy",()=>null);_(this,"disconnect",()=>null);_(this,"reconnect",()=>null);_(this,"listAllPeers",()=>null);_(this,"emitError",()=>null);_(this,"_serializers",{})}}const ie=async()=>{if(typeof window=="undefined")return ue;const{Peer:e}=await U(()=>import("./bundler.b2ec5918.js"),["assets/bundler.b2ec5918.js","assets/index.6f489cc4.js","assets/index.d684e578.css"]);return e},ce=async()=>{const e=await ie(),u=w(null),{notify:n}=le(),m=w(null),p=w([]),l=w(),y=w("initial"),i=r=>{p.value=[...p.value,r]},c=r=>{const v=h=>{if(h instanceof ArrayBuffer){i({type:"data",value:q.Buffer.from(h)});return}if(!q.Buffer.isBuffer(h)){console.warn("Non-buffer data received through WebRTC!",h);return}i({type:"data",value:h})},f=h=>{i({type:"state",value:h})},C=()=>{i({type:"open",value:void 0})},s=h=>{var d;i({type:"error",value:h}),(d=l.value)==null||d.close(),n({message:"Connection error",caption:h.message,icon:"link_off",iconColor:"red"})},b=()=>{var h,d,S,k,P;(h=l.value)==null||h.on("data",v),(d=l.value)==null||d.on("error",s),(S=l.value)==null||S.on("close",b),(k=l.value)==null||k.on("iceStateChanged",f),(P=l.value)==null||P.on("open",C),y.value="initial",l.value=null,p.value=[],n({message:"Connection closed",icon:"link_off"})};r.on("data",v),r.on("error",s),r.on("close",b),r.on("iceStateChanged",f),r.on("open",C)};return W(()=>{u.value=new e,u.value.on("open",r=>{m.value=O.utf8ToHex(r),n({message:"Connection ready",icon:"check",iconColor:"green"})}),u.value.on("connection",r=>{if(l.value){n({message:"Refused secondary connection",icon:"link_off",iconColor:"red"}),r.close();return}y.value="server",c(r),l.value=r,n({message:"Connected to guest",icon:"link"})})}),X(()=>{var r,v;(r=u.value)==null||r.destroy(),(v=l.value)==null||v.close()}),{connect:r=>{if(l.value||!u.value||!r)return;const v=O.hexToUtf8(r),f=u.value.connect(v);y.value="client",c(f),l.value=f,n({message:"Connected to host",icon:"link"})},mode:y,peerId:m,messages:p,sendData:r=>l.value?(l.value.send(r),i({type:"data",value:r}),!0):!1,disconnect:()=>l.value?(l.value.close(),l.value=null,!0):!1}},fe=async()=>{const{connect:e,mode:u,peerId:n,sendData:m,messages:p,disconnect:l}=await ce(),y=t=>{m(q.Buffer.from(JSON.stringify(t),"utf8"))},i=g(()=>p.value.filter(t=>t.type==="data").map(t=>q.Buffer.isBuffer(t.value)?JSON.parse(t.value.toString("utf8")):null)),c=g(()=>{const t=i.value.findLast(r=>r.type==="afen-update");return t&&t.value||""}),a=g(()=>p.value.some(t=>t.type==="open")),o=g(()=>{const t=i.value.find(r=>r.type==="side-assignment");return t?t.value:null});return{connect:e,mode:u,peerId:n,boardAFEN:c,sendMessage:y,open:a,disconnect:l,serverSide:o}},ve=D({__name:"play-wrapper",async setup(e){let u,n;const m=Y(),p=([u,n]=G(()=>fe()),u=await u,n(),u);return N(p.mode,l=>{l==="initial"&&m.push("/play")}),N(p.open,l=>{!l||(m.push(`/play/online/${p.peerId.value}`),p.mode.value==="server"&&(p.sendMessage({type:"side-assignment",value:Math.random()>.5?"white":"black"}),p.sendMessage({type:"afen-update",value:re.VanillaDefault})))}),(l,y)=>{const i=K("router-view");return E(),B(i,{connection:Z(p)},null,8,["connection"])}}}),Ce=D({__name:"play-page",setup(e){return(u,n)=>(E(),B(ae,null,{default:$(()=>[(E(),B(ee,null,{fallback:$(()=>[M(oe,{indeterminate:"",color:"primary"})]),default:$(()=>[M(ve)]),_:1}))]),_:1}))}});export{Ce as default};
