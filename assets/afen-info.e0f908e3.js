import{a as ie,Q as se}from"./QCard.c60a0688.js";import{C as Z,c as W,i as me,a as ut,f as Pe,B as rt}from"./chess-piece.cd5c1dbd.js";import{M as Q,N as m,Q as k,W as M,R as H,aa as ne,r as B,a9 as Ne,x as xe,C as Re,u as Ae,w as J,B as ke,o as de,j as qe,A as ct,m as ye,as as ge,K as dt,ao as ft,h as be,at as vt,au as pt,av as ht,a as S,a4 as mt,a5 as gt,k as Se,c as _t,z as yt,af as bt,e as wt,aw as kt,s as qt,O as T,P as h,S as r,T as V,a0 as D,ab as E,$ as N,Z as Ke,_ as A,U as x,V as K,D as St,ax as Ct}from"./index.d1d7854b.js";import{b as R,a as P,Q as Ce}from"./QList.2cb99a77.js";import{c as $t,i as zt,u as Et,b as Ft,d as Tt,e as Pt,f as xt}from"./selection.4308e43c.js";import{u as At,a as Mt}from"./use-dark.8e0bd895.js";import{b as Me,c as Ht,a as Lt}from"./focus-manager.202af5b7.js";import{Q as L}from"./QItemLabel.b3a264de.js";import{Q as ue}from"./QSeparator.9485bc3c.js";import{u as Wt}from"./use-quasar.c5b2b7cc.js";const Bt={class:"row column full-width full-height no-pointer-events background-layer","data-testid":"background"},Dt=Q({__name:"background-layer",props:{ranks:{},files:{}},setup(e){return(l,t)=>(m(),k("div",Bt,[(m(!0),k(M,null,H(l.ranks,(o,a)=>(m(),k("div",{class:"rank col row full-width",key:a},[(m(!0),k(M,null,H(l.files,(f,n)=>(m(),k("div",{key:n,class:"file col"}))),128))]))),128))]))}});var Qt=ne(Dt,[["__scopeId","data-v-482c5e27"]]);const Vt={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function Nt({showing:e,avoidEmit:l,configureAnchorEl:t}){const{props:o,proxy:a,emit:f}=qe(),n=B(null);let c=null;function u(i){return n.value===null?!1:i===void 0||i.touches===void 0||i.touches.length<=1}const d={};t===void 0&&(Object.assign(d,{hide(i){a.hide(i)},toggle(i){a.toggle(i),i.qAnchorHandled=!0},toggleKey(i){Ne(i,13)===!0&&d.toggle(i)},contextClick(i){a.hide(i),xe(i),Re(()=>{a.show(i),i.qAnchorHandled=!0})},prevent:xe,mobileTouch(i){if(d.mobileCleanup(i),u(i)!==!0)return;a.hide(i),n.value.classList.add("non-selectable");const _=i.target;Ae(d,"anchor",[[_,"touchmove","mobileCleanup","passive"],[_,"touchend","mobileCleanup","passive"],[_,"touchcancel","mobileCleanup","passive"],[n.value,"contextmenu","prevent","notPassive"]]),c=setTimeout(()=>{c=null,a.show(i),i.qAnchorHandled=!0},300)},mobileCleanup(i){n.value.classList.remove("non-selectable"),c!==null&&(clearTimeout(c),c=null),e.value===!0&&i!==void 0&&$t()}}),t=function(i=o.contextMenu){if(o.noParentEvent===!0||n.value===null)return;let _;i===!0?a.$q.platform.is.mobile===!0?_=[[n.value,"touchstart","mobileTouch","passive"]]:_=[[n.value,"mousedown","hide","passive"],[n.value,"contextmenu","contextClick","notPassive"]]:_=[[n.value,"click","toggle","passive"],[n.value,"keyup","toggleKey","passive"]],Ae(d,"anchor",_)});function v(){ct(d,"anchor")}function p(i){for(n.value=i;n.value.classList.contains("q-anchor--skip");)n.value=n.value.parentNode;t()}function q(){if(o.target===!1||o.target===""||a.$el.parentNode===null)n.value=null;else if(o.target===!0)p(a.$el.parentNode);else{let i=o.target;if(typeof o.target=="string")try{i=document.querySelector(o.target)}catch{i=void 0}i!=null?(n.value=i.$el||i,t()):(n.value=null,console.error(`Anchor: target "${o.target}" not found`))}}return J(()=>o.contextMenu,i=>{n.value!==null&&(v(),t(i))}),J(()=>o.target,()=>{n.value!==null&&v(),q()}),J(()=>o.noParentEvent,i=>{n.value!==null&&(i===!0?v():t())}),ke(()=>{q(),l!==!0&&o.modelValue===!0&&n.value===null&&f("update:modelValue",!1)}),de(()=>{c!==null&&clearTimeout(c),v()}),{anchorEl:n,canShow:u,anchorEvents:d}}function Rt(e,l){const t=B(null);let o;function a(c,u){const d=`${u!==void 0?"add":"remove"}EventListener`,v=u!==void 0?u:o;c!==window&&c[d]("scroll",v,ye.passive),window[d]("scroll",v,ye.passive),o=u}function f(){t.value!==null&&(a(t.value),t.value=null)}const n=J(()=>e.noParentEvent,()=>{t.value!==null&&(f(),l())});return de(n),{localScrollTarget:t,unconfigureScrollTarget:f,changeScrollEvent:a}}const ae=[];function Kt(e,l){do{if(e.$options.name==="QMenu"){if(e.hide(l),e.$props.separateClosePopup===!0)return ge(e)}else if(e.__qPortal===!0){const t=ge(e);return t!==void 0&&t.$options.name==="QPopupProxy"?(e.hide(l),t):e}e=ge(e)}while(e!=null)}function jt(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function Ot(e,l,t,o){const a=B(!1),f=B(!1);let n=null;const c={},u=o==="dialog"&&jt(e);function d(p){if(p===!0){Me(c),f.value=!0;return}f.value=!1,a.value===!1&&(u===!1&&n===null&&(n=pt(!1,o)),a.value=!0,ae.push(e.proxy),Ht(c))}function v(p){if(f.value=!1,p!==!0)return;Me(c),a.value=!1;const q=ae.indexOf(e.proxy);q!==-1&&ae.splice(q,1),n!==null&&(ht(n),n=null)}return dt(()=>{v(!0)}),e.proxy.__qPortal=!0,ft(e.proxy,"contentEl",()=>l.value),{showPortal:d,hidePortal:v,portalIsActive:a,portalIsAccessible:f,renderPortal:()=>u===!0?t():a.value===!0?[be(vt,{to:n},t())]:void 0}}const Ut={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function Gt(e,l=()=>{},t=()=>{}){return{transitionProps:S(()=>{const o=`q-transition--${e.transitionShow||l()}`,a=`q-transition--${e.transitionHide||t()}`;return{appear:!0,enterFromClass:`${o}-enter-from`,enterActiveClass:`${o}-enter-active`,enterToClass:`${o}-enter-to`,leaveFromClass:`${a}-leave-from`,leaveActiveClass:`${a}-leave-active`,leaveToClass:`${a}-leave-to`}}),transitionStyle:S(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}function Xt(){let e;const l=qe();function t(){e=void 0}return mt(t),de(t),{removeTick:t,registerTick(o){e=o,Re(()=>{e===o&&(gt(l)===!1&&e(),e=void 0)})}}}const j=[];let I;function Yt(e){I=e.keyCode===27}function Zt(){I===!0&&(I=!1)}function Jt(e){I===!0&&(I=!1,Ne(e,27)===!0&&j[j.length-1](e))}function je(e){window[e]("keydown",Yt),window[e]("blur",Zt),window[e]("keyup",Jt),I=!1}function It(e){Se.is.desktop===!0&&(j.push(e),j.length===1&&je("addEventListener"))}function He(e){const l=j.indexOf(e);l>-1&&(j.splice(l,1),j.length===0&&je("removeEventListener"))}const O=[];function Oe(e){O[O.length-1](e)}function el(e){Se.is.desktop===!0&&(O.push(e),O.length===1&&document.body.addEventListener("focusin",Oe))}function tl(e){const l=O.indexOf(e);l>-1&&(O.splice(l,1),O.length===0&&document.body.removeEventListener("focusin",Oe))}const{notPassiveCapture:re}=ye,U=[];function ce(e){const l=e.target;if(l===void 0||l.nodeType===8||l.classList.contains("no-pointer-events")===!0)return;let t=ae.length-1;for(;t>=0;){const o=ae[t].$;if(o.type.name==="QTooltip"){t--;continue}if(o.type.name!=="QDialog")break;if(o.props.seamless!==!0)return;t--}for(let o=U.length-1;o>=0;o--){const a=U[o];if((a.anchorEl.value===null||a.anchorEl.value.contains(l)===!1)&&(l===document.body||a.innerRef.value!==null&&a.innerRef.value.contains(l)===!1))e.qClickOutside=!0,a.onClickOutside(e);else return}}function ll(e){U.push(e),U.length===1&&(document.addEventListener("mousedown",ce,re),document.addEventListener("touchstart",ce,re))}function Le(e){const l=U.findIndex(t=>t===e);l>-1&&(U.splice(l,1),U.length===0&&(document.removeEventListener("mousedown",ce,re),document.removeEventListener("touchstart",ce,re)))}let We,Be;function De(e){const l=e.split(" ");return l.length!==2?!1:["top","center","bottom"].includes(l[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(l[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function ol(e){return e?!(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"):!0}const we={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(e=>{we[`${e}#ltr`]=e,we[`${e}#rtl`]=e});function Qe(e,l){const t=e.split(" ");return{vertical:t[0],horizontal:we[`${t[1]}#${l===!0?"rtl":"ltr"}`]}}function al(e,l){let{top:t,left:o,right:a,bottom:f,width:n,height:c}=e.getBoundingClientRect();return l!==void 0&&(t-=l[1],o-=l[0],f+=l[1],a+=l[0],n+=l[0],c+=l[1]),{top:t,bottom:f,height:c,left:o,right:a,width:n,middle:o+(a-o)/2,center:t+(f-t)/2}}function nl(e,l,t){let{top:o,left:a}=e.getBoundingClientRect();return o+=l.top,a+=l.left,t!==void 0&&(o+=t[1],a+=t[0]),{top:o,bottom:o+1,height:1,left:a,right:a+1,width:1,middle:a,center:o}}function il(e,l){return{top:0,center:l/2,bottom:l,left:0,middle:e/2,right:e}}function Ve(e,l,t,o){return{top:e[t.vertical]-l[o.vertical],left:e[t.horizontal]-l[o.horizontal]}}function Ue(e,l=0){if(e.targetEl===null||e.anchorEl===null||l>5)return;if(e.targetEl.offsetHeight===0||e.targetEl.offsetWidth===0){setTimeout(()=>{Ue(e,l+1)},10);return}const{targetEl:t,offset:o,anchorEl:a,anchorOrigin:f,selfOrigin:n,absoluteOffset:c,fit:u,cover:d,maxHeight:v,maxWidth:p}=e;if(Se.is.ios===!0&&window.visualViewport!==void 0){const z=document.body.style,{offsetLeft:b,offsetTop:$}=window.visualViewport;b!==We&&(z.setProperty("--q-pe-left",b+"px"),We=b),$!==Be&&(z.setProperty("--q-pe-top",$+"px"),Be=$)}const{scrollLeft:q,scrollTop:i}=t,_=c===void 0?al(a,d===!0?[0,0]:o):nl(a,c,o);Object.assign(t.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:p||"100vw",maxHeight:v||"100vh",visibility:"visible"});const{offsetWidth:G,offsetHeight:C}=t,{elWidth:X,elHeight:Y}=u===!0||d===!0?{elWidth:Math.max(_.width,G),elHeight:d===!0?Math.max(_.height,C):C}:{elWidth:G,elHeight:C};let F={maxWidth:p,maxHeight:v};(u===!0||d===!0)&&(F.minWidth=_.width+"px",d===!0&&(F.minHeight=_.height+"px")),Object.assign(t.style,F);const s=il(X,Y);let y=Ve(_,s,f,n);if(c===void 0||o===void 0)_e(y,_,s,f,n);else{const{top:z,left:b}=y;_e(y,_,s,f,n);let $=!1;if(y.top!==z){$=!0;const w=2*o[1];_.center=_.top-=w,_.bottom-=w+2}if(y.left!==b){$=!0;const w=2*o[0];_.middle=_.left-=w,_.right-=w+2}$===!0&&(y=Ve(_,s,f,n),_e(y,_,s,f,n))}F={top:y.top+"px",left:y.left+"px"},y.maxHeight!==void 0&&(F.maxHeight=y.maxHeight+"px",_.height>y.maxHeight&&(F.minHeight=F.maxHeight)),y.maxWidth!==void 0&&(F.maxWidth=y.maxWidth+"px",_.width>y.maxWidth&&(F.minWidth=F.maxWidth)),Object.assign(t.style,F),t.scrollTop!==i&&(t.scrollTop=i),t.scrollLeft!==q&&(t.scrollLeft=q)}function _e(e,l,t,o,a){const f=t.bottom,n=t.right,c=zt(),u=window.innerHeight-c,d=document.body.clientWidth;if(e.top<0||e.top+f>u)if(a.vertical==="center")e.top=l[o.vertical]>u/2?Math.max(0,u-f):0,e.maxHeight=Math.min(f,u);else if(l[o.vertical]>u/2){const v=Math.min(u,o.vertical==="center"?l.center:o.vertical===a.vertical?l.bottom:l.top);e.maxHeight=Math.min(f,v),e.top=Math.max(0,v-f)}else e.top=Math.max(0,o.vertical==="center"?l.center:o.vertical===a.vertical?l.top:l.bottom),e.maxHeight=Math.min(f,u-e.top);if(e.left<0||e.left+n>d)if(e.maxWidth=Math.min(n,d),a.horizontal==="middle")e.left=l[o.horizontal]>d/2?Math.max(0,d-n):0;else if(l[o.horizontal]>d/2){const v=Math.min(d,o.horizontal==="middle"?l.middle:o.horizontal===a.horizontal?l.right:l.left);e.maxWidth=Math.min(n,v),e.left=Math.max(0,v-e.maxWidth)}else e.left=Math.max(0,o.horizontal==="middle"?l.middle:o.horizontal===a.horizontal?l.left:l.right),e.maxWidth=Math.min(n,d-e.left)}var Ge=_t({name:"QMenu",inheritAttrs:!1,props:{...Vt,...Et,...At,...Ut,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:De},self:{type:String,validator:De},offset:{type:Array,validator:ol},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...Ft,"click","escapeKey"],setup(e,{slots:l,emit:t,attrs:o}){let a=null,f,n,c;const u=qe(),{proxy:d}=u,{$q:v}=d,p=B(null),q=B(!1),i=S(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),_=Mt(e,v),{registerTick:G,removeTick:C}=Xt(),{registerTimeout:X}=Tt(),{transitionProps:Y,transitionStyle:F}=Gt(e),{localScrollTarget:s,changeScrollEvent:y,unconfigureScrollTarget:z}=Rt(e,Fe),{anchorEl:b,canShow:$}=Nt({showing:q}),{hide:w}=Pt({showing:q,canShow:$,handleShow:lt,handleHide:ot,hideOnRouteChange:i,processOnMount:!0}),{showPortal:ee,hidePortal:te,renderPortal:le}=Ot(u,p,nt,"menu"),fe={anchorEl:b,innerRef:p,onClickOutside(g){if(e.persistent!==!0&&q.value===!0)return w(g),(g.type==="touchstart"||g.target.classList.contains("q-dialog__backdrop"))&&qt(g),!0}},$e=S(()=>Qe(e.anchor||(e.cover===!0?"center middle":"bottom start"),v.lang.rtl)),Ie=S(()=>e.cover===!0?$e.value:Qe(e.self||"top start",v.lang.rtl)),et=S(()=>(e.square===!0?" q-menu--square":"")+(_.value===!0?" q-menu--dark q-dark":"")),tt=S(()=>e.autoClose===!0?{onClick:at}:{}),ze=S(()=>q.value===!0&&e.persistent!==!0);J(ze,g=>{g===!0?(It(pe),ll(fe)):(He(pe),Le(fe))});function ve(){Lt(()=>{let g=p.value;g&&g.contains(document.activeElement)!==!0&&(g=g.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||g.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||g.querySelector("[autofocus], [data-autofocus]")||g,g.focus({preventScroll:!0}))})}function lt(g){if(a=e.noRefocus===!1?document.activeElement:null,el(Te),ee(),Fe(),f=void 0,g!==void 0&&(e.touchPosition||e.contextMenu)){const he=yt(g);if(he.left!==void 0){const{top:it,left:st}=b.value.getBoundingClientRect();f={left:he.left-st,top:he.top-it}}}n===void 0&&(n=J(()=>v.screen.width+"|"+v.screen.height+"|"+e.self+"|"+e.anchor+"|"+v.lang.rtl,oe)),e.noFocus!==!0&&document.activeElement.blur(),G(()=>{oe(),e.noFocus!==!0&&ve()}),X(()=>{v.platform.is.ios===!0&&(c=e.autoClose,p.value.click()),oe(),ee(!0),t("show",g)},e.transitionDuration)}function ot(g){C(),te(),Ee(!0),a!==null&&(g===void 0||g.qClickOutside!==!0)&&(((g&&g.type.indexOf("key")===0?a.closest('[tabindex]:not([tabindex^="-"])'):void 0)||a).focus(),a=null),X(()=>{te(!0),t("hide",g)},e.transitionDuration)}function Ee(g){f=void 0,n!==void 0&&(n(),n=void 0),(g===!0||q.value===!0)&&(tl(Te),z(),Le(fe),He(pe)),g!==!0&&(a=null)}function Fe(){(b.value!==null||e.scrollTarget!==void 0)&&(s.value=xt(b.value,e.scrollTarget),y(s.value,oe))}function at(g){c!==!0?(Kt(d,g),t("click",g)):c=!1}function Te(g){ze.value===!0&&e.noFocus!==!0&&kt(p.value,g.target)!==!0&&ve()}function pe(g){t("escapeKey"),w(g)}function oe(){Ue({targetEl:p.value,offset:e.offset,anchorEl:b.value,anchorOrigin:$e.value,selfOrigin:Ie.value,absoluteOffset:f,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function nt(){return be(bt,Y.value,()=>q.value===!0?be("div",{role:"menu",...o,ref:p,tabindex:-1,class:["q-menu q-position-engine scroll"+et.value,o.class],style:[o.style,F.value],...tt.value},wt(l.default)):null)}return de(Ee),Object.assign(d,{focus:ve,updatePosition:oe}),le}});const sl=Q({__name:"promotion-selector",props:{modelValue:{type:Boolean},allegiance:{}},emits:["click","dismiss"],setup(e,{emit:l}){const t=["Q","N","R","B"],o=()=>{l("dismiss")};return(a,f)=>(m(),T(Ge,{cover:"","model-value":a.modelValue,"onUpdate:modelValue":o},{default:h(()=>[r(Ce,null,{default:h(()=>[(m(),k(M,null,H(t,n=>r(R,{clickable:"",key:n,class:"q-pa-sm",onClick:c=>l("click",n)},{default:h(()=>[r(P,{class:"promotion-piece"},{default:h(()=>[r(Z,{allegiance:a.allegiance,piece:n,size:86},null,8,["allegiance","piece"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1},8,["model-value"]))}});var ul=ne(sl,[["__scopeId","data-v-0418dade"]]);const rl=Q({__name:"capture-selector",props:{modelValue:{type:Boolean},moves:{}},emits:["click","dismiss"],setup(e,{emit:l}){const t=()=>{l("dismiss")};return(o,a)=>(m(),T(Ge,{cover:"","model-value":o.modelValue,"onUpdate:modelValue":t},{default:h(()=>[r(Ce,null,{default:h(()=>[o.moves.includes("x")?(m(),T(R,{key:0,clickable:"",onClick:a[0]||(a[0]=f=>l("click","capture")),class:"q-py-lg"},{default:h(()=>[r(P,{class:"items-center"},{default:h(()=>[r(V,{size:"72px",name:"close"})]),_:1})]),_:1})):D("",!0),o.moves.includes(">")?(m(),T(R,{key:1,clickable:"",onClick:a[1]||(a[1]=f=>l("click","challenge")),class:"q-py-lg"},{default:h(()=>[r(P,{class:"items-center"},{default:h(()=>[r(V,{size:"64px",name:"arrow_forward_ios"})]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1},8,["model-value"]))}});const cl={class:"relative-position full-width full-height interaction-layer"},dl=["onClick"],fl=Q({__name:"interaction-layer",props:{board:{},squareSize:{},ranks:{},files:{},perspective:{},pieceFocus:{}},emits:["execute-node","update-piece-focus","update-highlights"],setup(e,{emit:l}){const t=e,o=B(null),a=S(()=>t.board.enPassantTarget),f=B(null),n=B(null),c=S(()=>t.pieceFocus?t.board.getSquare(t.pieceFocus):null),u=S(()=>t.pieceFocus?t.board.getValidMoves(t.pieceFocus).map(z=>z.kind!=="move"?null:z.to).filter(Boolean):[]),d=s=>{const y=t.board.getSquare(s);return y?ut(y.allegiance)!==t.perspective:!1},v=s=>u.value.some(y=>y&&W(s,y)),p=(s,y)=>{var b,$;if(y.stopPropagation(),y.preventDefault(),v(s)&&t.pieceFocus&&c.value){if(a.value&&W(a.value,s))l("execute-node",{kind:"move",type:"en-passant",from:t.pieceFocus,to:s}),l("update-piece-focus",null);else if(me(s,t.board.activeColour)&&c&&c.value.piece===null){f.value=s;const w=t.board.getSquare(t.pieceFocus);n.value=(b=w==null?void 0:w.allegiance)!=null?b:null}else t.board.getSquare(s)?o.value=s:(($=c.value)==null?void 0:$.piece)==="K"&&Math.abs(t.pieceFocus.file-s.file)>1?l("execute-node",{kind:"move",type:"castle",side:s.file===7?"king":"queen",from:t.pieceFocus,to:s}):l("execute-node",{kind:"move",from:t.pieceFocus,to:s});return}if(d(s))return;const z=t.board.getSquare(s);l("update-piece-focus",z?s:null)},q=(s,y)=>{!t.pieceFocus||(f.value=null,l("execute-node",{kind:"move",type:"promotion",from:t.pieceFocus,to:s,promotionTo:y}),l("update-piece-focus",null))},i=()=>{f.value=null,n.value=null},_=()=>{o.value=null},G=s=>{!t.pieceFocus||!o.value||(s==="capture"?l("execute-node",{kind:"move",type:"capture",from:t.pieceFocus,to:o.value}):l("execute-node",{kind:"move",type:"allegiance",from:t.pieceFocus,to:o.value}),o.value=null,l("update-piece-focus",null))},C=(s,y)=>{const z=s+1,b=y+1;return t.perspective==="white"?{file:z,rank:9-b}:{file:9-z,rank:b}},X=s=>!t.board.getSquare(s),Y=(s,y,z)=>t.board.getValidMoves().some($=>$.kind==="move"&&W($.to,z)&&W($.from,y)&&$.type===s),F=S(()=>{const s=[];return!t.pieceFocus||!o.value||(Y("allegiance",t.pieceFocus,o.value)&&s.push(">"),Y("capture",t.pieceFocus,o.value)&&s.push("x")),s});return(s,y)=>(m(),k("div",cl,[(m(!0),k(M,null,H(s.ranks,(z,b)=>(m(),k("div",{class:"col column row full-width",key:b},[(m(!0),k(M,null,H(s.files,($,w)=>{var ee,te;return m(),k("div",{key:w,class:"full-height"},[E("div",{class:Ke(["absolute",{"cursor-pointer":!X(C(w,b))||v(C(w,b)),"cursor-not-allowed":d(C(w,b))&&!c.value}]),onClick:le=>p(C(w,b),le),style:A(s.perspective==="white"?{width:`${s.squareSize}px`,height:`${s.squareSize}px`,left:`${(C(w,b).file-1)*s.squareSize}px`,bottom:`${(C(w,b).rank-1)*s.squareSize}px`}:{width:`${s.squareSize}px`,height:`${s.squareSize}px`,right:`${(C(w,b).file-1)*s.squareSize}px`,top:`${(C(w,b).rank-1)*s.squareSize}px`})},[o.value&&N(W)(o.value,C(w,b))?(m(),T(rl,{key:0,moves:F.value,"model-value":(ee=N(W)(o.value,C(w,b)))!=null?ee:!1,size:s.squareSize,onClick:G,onDismiss:_},null,8,["moves","model-value","size"])):D("",!0)],14,dl),n.value!==null&&(N(me)(C(w,b),"white")||N(me)(C(w,b),"black"))?(m(),T(ul,{key:0,"model-value":(te=N(W)(f.value,C(w,b)))!=null?te:!1,allegiance:n.value,size:s.squareSize,onClick:le=>q(C(w,b),le),onDismiss:i},null,8,["model-value","allegiance","size","onClick"])):D("",!0)])}),128))]))),128))]))}});var vl=ne(fl,[["__scopeId","data-v-2b4692d1"]]);const pl={class:"relative-position full-width full-height column no-pointer-events indicators-layer"},hl=Q({__name:"indicators-layer",props:{board:{},ranks:{},files:{},squareSize:{},perspective:{},pieceFocus:{}},setup(e){const l=e,t=S(()=>l.pieceFocus?l.board.getValidMoves(l.pieceFocus).map(v=>v.kind!=="move"?null:v.to).filter(Boolean):[]),o=u=>t.value.some(d=>d&&W(u,d)),a=u=>!l.board.getSquare(u),f=(u,d)=>{const v=u+1,p=d+1;return l.perspective==="white"?{file:v,rank:9-p}:{file:9-v,rank:p}},n=S(()=>l.board.getCheckMoves()),c=u=>n.value.some(d=>d.kind==="move"&&W(d.to,u));return(u,d)=>(m(),k("div",pl,[(m(!0),k(M,null,H(u.ranks,(v,p)=>(m(),k("div",{class:"col column row full-width",key:p},[(m(!0),k(M,null,H(u.files,(q,i)=>(m(),k("div",{key:i,class:Ke(["full-height move-placeholder",{even:p%2===0?i%2===0:i%2!==0,focus:N(W)(u.pieceFocus,f(i,p)),show:o(f(i,p)),capture:!a(f(i,p)),target:a(f(i,p)),checked:c(f(i,p))}])},null,2))),128))]))),128))]))}});var ml=ne(hl,[["__scopeId","data-v-56f470a5"]]);const gl={class:"relative-position full-width full-height no-pointer-events pieces-layer"},_l=Q({__name:"pieces-layer",props:{modelValue:{},squareSize:{},perspective:{}},setup(e){return(l,t)=>(m(),k("div",gl,[(m(!0),k(M,null,H(l.modelValue,(o,a)=>(m(),k("div",{key:a},[o?(m(),T(Z,{key:0,"data-testid":"piece",class:"absolute",piece:o.piece,allegiance:o.allegiance,size:l.squareSize,style:A(l.perspective==="white"?{left:`${(o.file-1)*l.squareSize}px`,bottom:`${(o.rank-1)*l.squareSize}px`}:{right:`${(o.file-1)*l.squareSize}px`,top:`${(o.rank-1)*l.squareSize}px`})},null,8,["piece","allegiance","size","style"])):(m(),k("div",{key:1,style:A({width:`${l.squareSize}px`,height:`${l.squareSize}px`})},null,4))]))),128))]))}});var yl=ne(_l,[["__scopeId","data-v-7ad57934"]]),Xe="/allegiance-chess/assets/686544__troube__wooden-button-out.9f2750b6.ogg",Ye="/allegiance-chess/assets/270148__theriavirra__drumsticks-stagg-maple-7an-click-no3.080cde81.wav",Ze="/allegiance-chess/assets/342200__christopherderp__videogame-menu-button-click.a6b3f6b9.wav",Je="/allegiance-chess/assets/321083__benjaminnelan__wooden-click.d2b26b22.wav";const bl={class:"absolute full-width full-height"},wl={class:"absolute full-width full-height"},kl={class:"absolute full-width full-height"},ql={class:"absolute full-width full-height"},Sl=Q({__name:"board-table",props:{board:{},width:{},perspective:{},playAs:{}},emits:["execute-node"],setup(e,{emit:l}){const t=e,o=new Audio(Xe),a=new Audio(Ye),f=new Audio(Ze),n=new Audio(Je);a.volume=.2,n.volume=.3,f.volume=.3,ke(async()=>{try{await o.play()}catch{}});const c=S(()=>t.width/8),u=B(null),d=v=>{l("execute-node",v),u.value=null};return(v,p)=>(m(),k("div",{"data-testid":"chess-board",class:"relative-position column",style:A({width:t.width+"px",height:t.width+"px"})},[E("div",bl,[r(Qt,{ranks:8,files:8})]),E("div",wl,[r(ml,{board:v.board,"square-size":c.value,files:8,ranks:8,perspective:v.perspective,"piece-focus":u.value},null,8,["board","square-size","perspective","piece-focus"])]),E("div",kl,[r(yl,{"model-value":v.board.getSquares(),perspective:t.perspective,"square-size":c.value},null,8,["model-value","perspective","square-size"])]),E("div",ql,[r(vl,{onExecuteNode:d,onUpdatePieceFocus:p[0]||(p[0]=q=>u.value=q),"piece-focus":u.value,board:v.board,"square-size":c.value,files:8,ranks:8,perspective:t.perspective},null,8,["piece-focus","board","square-size","perspective"])])],4))}}),Cl={class:"column"},$l={class:"row"},zl={class:"col"},Dl=Q({__name:"chess-board",props:{board:{},width:{},perspective:{},playAs:{}},emits:["execute-node"],setup(e,{emit:l}){const t=e,o=new Audio(Xe),a=new Audio(Ye),f=new Audio(Ze),n=new Audio(Je);a.volume=.2,n.volume=.3,f.volume=.3,ke(async()=>{try{await o.play()}catch{}});const c=S(()=>t.width/8/2.5);return(u,d)=>(m(),k("div",Cl,[E("div",{class:"row",style:A({height:`${c.value}px`})},[E("div",{style:A({width:`${c.value}px`})},null,4),(m(),k(M,null,H(8,(v,p)=>r(se,{key:p,class:"col column full-height justify-center",flat:""},{default:h(()=>[r(ie,{class:"text-center q-pa-none"},{default:h(()=>[x(K(N(Pe)(u.perspective==="white"?9-(8-p):8-p).toUpperCase()),1)]),_:2},1024)]),_:2},1024)),64)),E("div",{style:A({width:`${c.value}px`})},null,4)],4),E("div",$l,[E("div",{class:"column",style:A({width:`${c.value}px`})},[(m(),k(M,null,H(8,(v,p)=>r(se,{key:p,class:"col column full-height justify-center text-center",flat:""},{default:h(()=>[r(ie,{class:"q-pa-none"},{default:h(()=>[x(K(u.perspective==="white"?8-p:9-(8-p)),1)]),_:2},1024)]),_:2},1024)),64))],4),E("div",zl,[r(Sl,{onExecuteNode:d[0]||(d[0]=v=>l("execute-node",v)),board:u.board,perspective:u.perspective,"play-as":u.playAs,width:u.width-c.value},null,8,["board","perspective","play-as","width"])]),E("div",{class:"column",style:A({width:`${c.value}px`})},[(m(),k(M,null,H(8,(v,p)=>r(se,{key:p,class:"col column full-height justify-center text-center",flat:""},{default:h(()=>[r(ie,{class:"q-pa-none"},{default:h(()=>[x(K(u.perspective==="white"?8-p:9-(8-p)),1)]),_:2},1024)]),_:2},1024)),64))],4)]),E("div",{class:"row",style:A({height:`${c.value}px`})},[E("div",{style:A({width:`${c.value}px`})},null,4),(m(),k(M,null,H(8,(v,p)=>r(se,{key:p,class:"col column full-height justify-center",flat:""},{default:h(()=>[r(ie,{class:"text-center q-pa-none"},{default:h(()=>[x(K(N(Pe)(u.perspective==="white"?9-(8-p):8-p).toUpperCase()),1)]),_:2},1024)]),_:2},1024)),64)),E("div",{style:A({width:`${c.value}px`})},null,4)],4)]))}}),El={class:"row"},Ql=Q({__name:"afen-info",props:{modelValue:{}},setup(e){const l=e,t=S(()=>{const d=new rt;return d.importAFEN(l.modelValue),d}),o=S(()=>{if(!!t.value)return t.value.activeColour}),a=S(()=>{if(!!t.value)return t.value.halfmoveClock}),f=S(()=>{if(!!t.value)return t.value.fullmoveNumber}),n=S(()=>{if(!!t.value)return t.value.castlingRights}),c=Wt(),u=()=>{if(!!t.value)try{navigator.clipboard.writeText(l.modelValue),c.notify({position:"bottom-right",timeout:4e3,message:"AFEN copied to clipboard",icon:"content_copy"})}catch{c.notify({position:"bottom-right",timeout:4e3,message:"Could not write to clipboard",icon:"close",iconColor:"red"})}};return(d,v)=>(m(),T(Ce,null,{default:h(()=>[St((m(),T(R,{clickable:"",onClick:u},{default:h(()=>[r(P,{class:"q-mt-sm q-mb-sm"},{default:h(()=>[r(L,null,{default:h(()=>[x("AFEN")]),_:1}),r(L,{caption:"",lines:"2"},{default:h(()=>[x(K(d.modelValue),1)]),_:1})]),_:1}),r(P,{side:""},{default:h(()=>[r(V,{name:"edit"})]),_:1})]),_:1})),[[Ct]]),r(ue,{inset:""}),r(R,null,{default:h(()=>[r(P,{class:"q-mt-sm q-mb-sm"},{default:h(()=>[r(L,null,{default:h(()=>[x("Next move")]),_:1}),r(L,{caption:"",lines:"2"},{default:h(()=>[x(K(o.value),1)]),_:1})]),_:1}),r(P,{side:""},{default:h(()=>[r(V,{name:"arrow_forward_ios"})]),_:1})]),_:1}),r(ue,{inset:""}),r(R,null,{default:h(()=>[r(P,{class:"q-mt-sm q-mb-sm"},{default:h(()=>[r(L,null,{default:h(()=>[x("Halfmove clock")]),_:1}),r(L,{caption:"",lines:"2"},{default:h(()=>[x(K(a.value),1)]),_:1})]),_:1}),r(P,{side:""},{default:h(()=>[r(V,{name:"hourglass_bottom"})]),_:1})]),_:1}),r(ue,{inset:""}),r(R,null,{default:h(()=>[r(P,{class:"q-mt-sm q-mb-sm"},{default:h(()=>[r(L,null,{default:h(()=>[x("Fullmove number")]),_:1}),r(L,{caption:"",lines:"2"},{default:h(()=>[x(K(f.value),1)]),_:1})]),_:1}),r(P,{side:""},{default:h(()=>[r(V,{name:"update"})]),_:1})]),_:1}),r(ue,{inset:""}),r(R,null,{default:h(()=>[r(P,{class:"q-mt-sm q-mb-sm"},{default:h(()=>[r(L,null,{default:h(()=>[x("Castling rights")]),_:1}),r(L,{caption:"",lines:"2"},{default:h(()=>{var p,q,i,_;return[E("div",El,[(p=n.value)!=null&&p.white.includes("queen")?(m(),T(Z,{key:0,allegiance:3,piece:"Q",size:24})):D("",!0),(q=n.value)!=null&&q.white.includes("king")?(m(),T(Z,{key:1,allegiance:3,piece:"K",size:24})):D("",!0),(i=n.value)!=null&&i.black.includes("queen")?(m(),T(Z,{key:2,allegiance:0,piece:"Q",size:24})):D("",!0),(_=n.value)!=null&&_.black.includes("king")?(m(),T(Z,{key:3,allegiance:0,piece:"K",size:24})):D("",!0),!n.value||n.value.black.length===0&&n.value.white.length===0?(m(),T(V,{key:4,name:"close"})):D("",!0)])]}),_:1})]),_:1}),r(P,{side:""},{default:h(()=>[r(V,{name:"castle"})]),_:1})]),_:1})]),_:1}))}});export{Dl as _,Ql as a};
